

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>9. Rules list &mdash; Exakat 1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="10. Real Code Cases" href="Cases.html" />
    <link rel="prev" title="8. Rulesets" href="Rulesets.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Exakat
          

          
          </a>

          
            
            
              <div class="version">
                2.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Features.html">2. Exakat features</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">3. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Upgrading.html">4. Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tutorial.html">5. Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="FAQ.html">6. Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Commands.html">7. Exakat commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="Rulesets.html">8. Rulesets</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">9. Rules list</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">9.1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#http-raw-post-data-usage">9.2. $HTTP_RAW_POST_DATA Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#suggestions">9.2.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-errormsg-usage">9.3. $php_errormsg Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id3">9.3.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#this-belongs-to-classes-or-traits">9.4. $this Belongs To Classes Or Traits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">9.4.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#this-is-not-an-array">9.5. $this Is Not An Array</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">9.5.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#this-is-not-for-static-methods">9.6. $this Is Not For Static Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id17">9.6.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#for-exponent">9.7. ** For Exponent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id21">9.7.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#class">9.8. ::class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id24">9.8.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#operator">9.9. &#64; Operator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id27">9.9.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#abstract-away">9.10. Abstract Away</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id29">9.10.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#abstract-or-implements">9.11. Abstract Or Implements</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id31">9.11.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#abstract-static-methods">9.12. Abstract Static Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id43">9.12.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#access-protected-structures">9.13. Access Protected Structures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id45">9.13.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-private">9.14. Accessing Private</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-default-value">9.15. Add Default Value</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id48">9.15.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-zero">9.16. Adding Zero</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id50">9.16.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#aliases-usage">9.17. Aliases Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id52">9.17.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#all-uppercase-variables">9.18. All Uppercase Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#already-parents-interface">9.19. Already Parents Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id55">9.19.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#already-parents-trait">9.20. Already Parents Trait</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id58">9.20.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#altering-foreach-without-reference">9.21. Altering Foreach Without Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id61">9.21.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#alternative-syntax-consistence">9.22. Alternative Syntax Consistence</a></li>
<li class="toctree-l2"><a class="reference internal" href="#always-anchor-regex">9.23. Always Anchor Regex</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id64">9.23.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#always-positive-comparison">9.24. Always Positive Comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id66">9.24.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#always-use-function-with-array-key-exists">9.25. Always Use Function With array_key_exists()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id70">9.25.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ambiguous-array-index">9.26. Ambiguous Array Index</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id72">9.26.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ambiguous-static">9.27. Ambiguous Static</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ambiguous-visibilities">9.28. Ambiguous Visibilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id79">9.28.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#anonymous-classes">9.29. Anonymous Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#argument-should-be-typehinted">9.30. Argument Should Be Typehinted</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id82">9.30.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#array-fill-with-objects">9.31. Array_Fill() With Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id84">9.31.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#array-merge-needs-array-of-arrays">9.32. Array_merge Needs Array Of Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id90">9.32.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assert-function-is-reserved">9.33. Assert Function Is Reserved</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id92">9.33.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assign-and-compare">9.34. Assign And Compare</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id94">9.34.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assign-default-to-properties">9.35. Assign Default To Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id96">9.35.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assign-with-and-precedence">9.36. Assign With And Precedence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id99">9.36.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#assigned-twice">9.37. Assigned Twice</a></li>
<li class="toctree-l2"><a class="reference internal" href="#assumptions">9.38. Assumptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id102">9.38.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#autoappend">9.39. Autoappend</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id104">9.39.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-concat-in-loop">9.40. Avoid Concat In Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id106">9.40.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-large-array-assignation">9.41. Avoid Large Array Assignation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id108">9.41.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-optional-properties">9.42. Avoid Optional Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id110">9.42.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-parenthesis">9.43. Avoid Parenthesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-real">9.44. Avoid Real</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id113">9.44.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-self-in-interface">9.45. Avoid Self In Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id117">9.45.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-substr-one">9.46. Avoid Substr() One</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id120">9.46.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-those-hash-functions">9.47. Avoid Those Hash Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id122">9.47.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-using-stdclass">9.48. Avoid Using stdClass</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id124">9.48.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-array-push">9.49. Avoid array_push()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id128">9.49.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-array-unique">9.50. Avoid array_unique()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id132">9.50.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-get-class">9.51. Avoid get_class()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-glob-usage">9.52. Avoid glob() Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id143">9.52.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-mb-dectect-encoding">9.53. Avoid mb_dectect_encoding()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id147">9.53.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-option-arrays-in-constructors">9.54. Avoid option arrays in constructors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id150">9.54.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-set-error-handler-context-argument">9.55. Avoid set_error_handler $context Argument</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id153">9.55.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#avoid-sleep-usleep">9.56. Avoid sleep()/usleep()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id157">9.56.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bad-constants-names">9.57. Bad Constants Names</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id159">9.57.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bad-typehint-relay">9.58. Bad Typehint Relay</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id161">9.58.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bail-out-early">9.59. Bail Out Early</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id163">9.59.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#binary-glossary">9.60. Binary Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bracketless-blocks">9.61. Bracketless Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#break-outside-loop">9.62. Break Outside Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="#break-with-0">9.63. Break With 0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id176">9.63.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#break-with-non-integer">9.64. Break With Non Integer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#buried-assignation">9.65. Buried Assignation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id180">9.65.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cache-variable-outside-loop">9.66. Cache Variable Outside Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id183">9.66.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#callback-function-needs-return">9.67. Callback Function Needs Return</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id187">9.67.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#calltime-pass-by-reference">9.68. Calltime Pass By Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id189">9.68.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#can-t-count-non-countable">9.69. Can’t Count Non-Countable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id192">9.69.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#can-t-extend-final">9.70. Can’t Extend Final</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id194">9.70.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#can-t-throw-throwable">9.71. Can’t Throw Throwable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id196">9.71.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cancel-common-method">9.72. Cancel Common Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id201">9.72.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cancelled-parameter">9.73. Cancelled Parameter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id203">9.73.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cant-implement-traversable">9.74. Cant Implement Traversable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id205">9.74.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cant-inherit-abstract-method">9.75. Cant Inherit Abstract Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id207">9.75.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cant-instantiate-class">9.76. Cant Instantiate Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cant-use-return-value-in-write-context">9.77. Cant Use Return Value In Write Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#case-insensitive-constants">9.78. Case Insensitive Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cast-to-boolean">9.79. Cast To Boolean</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id216">9.79.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#cast-unset-usage">9.80. Cast Unset Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id218">9.80.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#casting-ternary">9.81. Casting Ternary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id220">9.81.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#catch-overwrite-variable">9.82. Catch Overwrite Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id222">9.82.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#catch-undefined-variable">9.83. Catch Undefined Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id224">9.83.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#check-all-types">9.84. Check All Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id226">9.84.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#check-crypto-key-length">9.85. Check Crypto Key Length</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id228">9.85.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#check-json">9.86. Check JSON</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id231">9.86.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#check-on-call-usage">9.87. Check On __Call Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id236">9.87.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#child-class-removes-typehint">9.88. Child Class Removes Typehint</a></li>
<li class="toctree-l2"><a class="reference internal" href="#class-const-with-array">9.89. Class Const With Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="#class-could-be-final">9.90. Class Could Be Final</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id240">9.90.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#class-function-confusion">9.91. Class Function Confusion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id242">9.91.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#class-should-be-final-by-ocramius">9.92. Class Should Be Final By Ocramius</a></li>
<li class="toctree-l2"><a class="reference internal" href="#class-without-parent">9.93. Class Without Parent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id245">9.93.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#class-interface-or-trait-with-identical-names">9.94. Class, Interface Or Trait With Identical Names</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id247">9.94.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#classes-mutually-extending-each-other">9.95. Classes Mutually Extending Each Other</a></li>
<li class="toctree-l2"><a class="reference internal" href="#clone-with-non-object">9.96. Clone With Non-Object</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id250">9.96.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#close-tags">9.97. Close Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="#closure-could-be-a-callback">9.98. Closure Could Be A Callback</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id256">9.98.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#closure-may-use-this">9.99. Closure May Use $this</a></li>
<li class="toctree-l2"><a class="reference internal" href="#coalesce-and-concat">9.100. Coalesce And Concat</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id261">9.100.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#coalesce-equal">9.101. Coalesce Equal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id263">9.101.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#common-alternatives">9.102. Common Alternatives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id265">9.102.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compact-inexistant-variable">9.103. Compact Inexistant Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id269">9.103.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compare-hash">9.104. Compare Hash</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id271">9.104.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compared-comparison">9.105. Compared Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complex-dynamic-names">9.106. Complex Dynamic Names</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id275">9.106.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#concat-and-addition">9.107. Concat And Addition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id277">9.107.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#concat-empty-string">9.108. Concat Empty String</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id279">9.108.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#concrete-visibility">9.109. Concrete Visibility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id281">9.109.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configure-extract">9.110. Configure Extract</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id287">9.110.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#const-visibility-usage">9.111. Const Visibility Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id289">9.111.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#const-with-array">9.112. Const With Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constant-class">9.113. Constant Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id293">9.113.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#constant-comparison">9.114. Constant Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constant-scalar-expressions">9.115. Constant Scalar Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constant-typo-looks-like-a-variable">9.116. Constant Typo Looks Like A Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id300">9.116.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#constants-created-outside-its-namespace">9.117. Constants Created Outside Its Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="#constants-with-strange-names">9.118. Constants With Strange Names</a></li>
<li class="toctree-l2"><a class="reference internal" href="#continue-is-for-loop">9.119. Continue Is For Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id313">9.119.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-abstract-class">9.120. Could Be Abstract Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id317">9.120.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-callable">9.121. Could Be Callable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id319">9.121.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-class-constant">9.122. Could Be Class Constant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-constant">9.123. Could Be Constant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id323">9.123.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-else">9.124. Could Be Else</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id325">9.124.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-float">9.125. Could Be Float</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id327">9.125.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-integer">9.126. Could Be Integer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id329">9.126.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-iterable">9.127. Could Be Iterable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id331">9.127.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-null">9.128. Could Be Null</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id333">9.128.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-parent">9.129. Could Be Parent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id335">9.129.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-parent-method">9.130. Could Be Parent Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id339">9.130.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-private-class-constant">9.131. Could Be Private Class Constant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-protected-class-constant">9.132. Could Be Protected Class Constant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-protected-method">9.133. Could Be Protected Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-protected-property">9.134. Could Be Protected Property</a></li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-self">9.135. Could Be Self</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id346">9.135.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-static">9.136. Could Be Static</a></li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-static-closure">9.137. Could Be Static Closure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id353">9.137.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-string">9.138. Could Be String</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id355">9.138.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-stringable">9.139. Could Be Stringable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id357">9.139.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-be-void">9.140. Could Be Void</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id359">9.140.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-make-a-function">9.141. Could Make A Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id361">9.141.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-alias">9.142. Could Use Alias</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id363">9.142.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-compact">9.143. Could Use Compact</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id367">9.143.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-promoted-properties">9.144. Could Use Promoted Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id370">9.144.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-short-assignation">9.145. Could Use Short Assignation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id372">9.145.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-try">9.146. Could Use Try</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id374">9.146.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-dir">9.147. Could Use __DIR__</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id378">9.147.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-array-fill-keys">9.148. Could Use array_fill_keys</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id382">9.148.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-array-unique">9.149. Could Use array_unique</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id386">9.149.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-self">9.150. Could Use self</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id389">9.150.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#could-use-str-repeat">9.151. Could Use str_repeat()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id393">9.151.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#crc32-might-be-negative">9.152. Crc32() Might Be Negative</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cyclic-references">9.153. Cyclic References</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id399">9.153.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dangling-array-references">9.154. Dangling Array References</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id401">9.154.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deep-definitions">9.155. Deep Definitions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id403">9.155.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#define-with-array">9.156. Define With Array</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependant-abstract-classes">9.157. Dependant Abstract Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id408">9.157.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dependant-trait">9.158. Dependant Trait</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id411">9.158.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deprecated-php-functions">9.159. Deprecated PHP Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id413">9.159.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dereferencing-string-and-arrays">9.160. Dereferencing String And Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#detect-current-class">9.161. Detect Current Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id420">9.161.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#different-argument-counts">9.162. Different Argument Counts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id422">9.162.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#direct-call-to-clone">9.163. Direct Call To __clone()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id424">9.163.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#direct-injection">9.164. Direct Injection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id426">9.164.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#directly-use-file">9.165. Directly Use File</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id430">9.165.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#disconnected-classes">9.166. Disconnected Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id432">9.166.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#do-in-base">9.167. Do In Base</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id434">9.167.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-be-too-manual">9.168. Don’t Be Too Manual</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id436">9.168.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-change-incomings">9.169. Don’t Change Incomings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-echo-error">9.170. Don’t Echo Error</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id439">9.170.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-loop-on-yield">9.171. Don’t Loop On Yield</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id441">9.171.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-pollute-global-space">9.172. Don’t Pollute Global Space</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id443">9.172.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-read-and-write-in-one-expression">9.173. Don’t Read And Write In One Expression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id445">9.173.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-send-this-in-constructor">9.174. Don’t Send $this In Constructor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id448">9.174.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#don-t-unset-properties">9.175. Don’t Unset Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id451">9.175.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dont-change-the-blind-var">9.176. Dont Change The Blind Var</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dont-collect-void">9.177. Dont Collect Void</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id455">9.177.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dont-compare-typed-boolean">9.178. Dont Compare Typed Boolean</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id457">9.178.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dont-mix">9.179. Dont Mix ++</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id459">9.179.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#double-assignation">9.180. Double Assignation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#double-instructions">9.181. Double Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id462">9.181.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#double-object-assignation">9.182. Double Object Assignation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id464">9.182.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#double-array-flip">9.183. Double array_flip()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id469">9.183.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#drop-else-after-return">9.184. Drop Else After Return</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id471">9.184.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#drop-substr-last-arg">9.185. Drop Substr Last Arg</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id475">9.185.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#duplicate-literal">9.186. Duplicate Literal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id477">9.186.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#dynamic-library-loading">9.187. Dynamic Library Loading</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id479">9.187.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#echo-or-print">9.188. Echo Or Print</a></li>
<li class="toctree-l2"><a class="reference internal" href="#echo-with-concat">9.189. Echo With Concat</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id482">9.189.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ellipsis-usage">9.190. Ellipsis Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#else-if-versus-elseif">9.191. Else If Versus Elseif</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id487">9.191.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-blocks">9.192. Empty Blocks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id489">9.192.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-classes">9.193. Empty Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id491">9.193.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-function">9.194. Empty Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id493">9.194.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-instructions">9.195. Empty Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id495">9.195.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-interfaces">9.196. Empty Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id497">9.196.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-list">9.197. Empty List</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id499">9.197.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-namespace">9.198. Empty Namespace</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id501">9.198.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-slots-in-arrays">9.199. Empty Slots In Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#empty-traits">9.200. Empty Traits</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id504">9.200.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-try-catch">9.201. Empty Try Catch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id506">9.201.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#empty-with-expression">9.202. Empty With Expression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id511">9.202.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#encoded-simple-letters">9.203. Encoded Simple Letters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id513">9.203.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#eval-usage">9.204. Eval() Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id519">9.204.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exceeding-typehint">9.205. Exceeding Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id521">9.205.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exception-order">9.206. Exception Order</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id523">9.206.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exit-usage">9.207. Exit() Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id526">9.207.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#exponent-usage">9.208. Exponent Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id530">9.208.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#failed-substr-comparison">9.209. Failed Substr Comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id532">9.209.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fetch-one-row-format">9.210. Fetch One Row Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id534">9.210.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#filter-to-add-slashes">9.211. Filter To add_slashes()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id538">9.211.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#final-class-usage">9.212. Final Class Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#final-methods-usage">9.213. Final Methods Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#flexible-heredoc">9.214. Flexible Heredoc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fn-argument-variable-confusion">9.215. Fn Argument Variable Confusion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id545">9.215.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#for-using-functioncall">9.216. For Using Functioncall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id548">9.216.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#foreach-don-t-change-pointer">9.217. Foreach Don’t Change Pointer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id553">9.217.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#foreach-on-object">9.218. Foreach On Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#foreach-reference-is-not-modified">9.219. Foreach Reference Is Not Modified</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id556">9.219.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#foreach-with-list">9.220. Foreach With list()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#forgotten-interface">9.221. Forgotten Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id563">9.221.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#forgotten-thrown">9.222. Forgotten Thrown</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id565">9.222.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#forgotten-visibility">9.223. Forgotten Visibility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id570">9.223.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#forgotten-whitespace">9.224. Forgotten Whitespace</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id572">9.224.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fossilized-method">9.225. Fossilized Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fully-qualified-constants">9.226. Fully Qualified Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id577">9.226.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#function-subscripting">9.227. Function Subscripting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#function-subscripting-old-style">9.228. Function Subscripting, Old Style</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id580">9.228.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#functions-removed-in-php-5-4">9.229. Functions Removed In PHP 5.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functions-removed-in-php-5-5">9.230. Functions Removed In PHP 5.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id583">9.230.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#generator-cannot-return">9.231. Generator Cannot Return</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id585">9.231.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#getting-last-element">9.232. Getting Last Element</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id587">9.232.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#global-inside-loop">9.233. Global Inside Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id589">9.233.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#global-usage">9.234. Global Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#group-use-declaration">9.235. Group Use Declaration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#group-use-trailing-comma">9.236. Group Use Trailing Comma</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hardcoded-passwords">9.237. Hardcoded Passwords</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id595">9.237.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hash-algorithms">9.238. Hash Algorithms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id597">9.238.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hash-algorithms-incompatible-with-php-5-3">9.239. Hash Algorithms Incompatible With PHP 5.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hash-algorithms-incompatible-with-php-5-4-5-5">9.240. Hash Algorithms Incompatible With PHP 5.4/5.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hash-algorithms-incompatible-with-php-7-1">9.241. Hash Algorithms Incompatible With PHP 7.1-</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hash-algorithms-incompatible-with-php-7-4">9.242. Hash Algorithms Incompatible With PHP 7.4-</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hash-will-use-objects">9.243. Hash Will Use Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="#heredoc-delimiter">9.244. Heredoc Delimiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hexadecimal-in-string">9.245. Hexadecimal In String</a></li>
<li class="toctree-l2"><a class="reference internal" href="#hidden-nullable">9.246. Hidden Nullable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id612">9.246.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#hidden-use-expression">9.247. Hidden Use Expression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id616">9.247.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#htmlentities-calls">9.248. Htmlentities Calls</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id620">9.248.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#identical-conditions">9.249. Identical Conditions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id622">9.249.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#identical-consecutive-expression">9.250. Identical Consecutive Expression</a></li>
<li class="toctree-l2"><a class="reference internal" href="#identical-on-both-sides">9.251. Identical On Both Sides</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id625">9.251.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#if-with-same-conditions">9.252. If With Same Conditions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id627">9.252.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#iffectations">9.253. Iffectations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id630">9.253.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#illegal-name-for-method">9.254. Illegal Name For Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id632">9.254.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#implement-is-for-interface">9.255. Implement Is For Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id634">9.255.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#implemented-methods-are-public">9.256. Implemented Methods Are Public</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id637">9.256.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#implied-if">9.257. Implied If</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implode-one-arg">9.258. Implode One Arg</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id642">9.258.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#implode-arguments-order">9.259. Implode() Arguments Order</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id646">9.259.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#inclusion-wrong-case">9.260. Inclusion Wrong Case</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id648">9.260.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#incompatible-signature-methods">9.261. Incompatible Signature Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id652">9.261.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#incompatible-signature-methods-with-covariance">9.262. Incompatible Signature Methods With Covariance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id657">9.262.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#incompilable-files">9.263. Incompilable Files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id659">9.263.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#inconsistent-elseif">9.264. Inconsistent Elseif</a></li>
<li class="toctree-l2"><a class="reference internal" href="#indices-are-int-or-string">9.265. Indices Are Int Or String</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id662">9.265.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#indirect-injection">9.266. Indirect Injection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id666">9.266.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#infinite-recursion">9.267. Infinite Recursion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id668">9.267.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#instantiating-abstract-class">9.268. Instantiating Abstract Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#insufficient-property-typehint">9.269. Insufficient Property Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id672">9.269.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#insufficient-typehint">9.270. Insufficient Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id674">9.270.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#integer-as-property">9.271. Integer As Property</a></li>
<li class="toctree-l2"><a class="reference internal" href="#integer-conversion">9.272. Integer Conversion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id677">9.272.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interfaces-don-t-ensure-properties">9.273. Interfaces Don’t Ensure Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id679">9.273.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interfaces-is-not-implemented">9.274. Interfaces Is Not Implemented</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id682">9.274.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interpolation">9.275. Interpolation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#invalid-constant-name">9.276. Invalid Constant Name</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id687">9.276.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#invalid-octal-in-string">9.277. Invalid Octal In String</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id689">9.277.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#invalid-pack-format">9.278. Invalid Pack Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id696">9.278.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#invalid-regex">9.279. Invalid Regex</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id698">9.279.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#is-actually-zero">9.280. Is Actually Zero</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id700">9.280.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#is-a-with-string">9.281. Is_A() With String</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id703">9.281.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#isset-multiple-arguments">9.282. Isset Multiple Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id705">9.282.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#isset-on-the-whole-array">9.283. Isset() On The Whole Array</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id711">9.283.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#joining-file">9.284. Joining file()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id721">9.284.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#keep-files-access-restricted">9.285. Keep Files Access Restricted</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id723">9.285.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#large-try-block">9.286. Large Try Block</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id725">9.286.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#list-short-syntax">9.287. List Short Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-with-appends">9.288. List With Appends</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id730">9.288.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#list-with-keys">9.289. List With Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-with-reference">9.290. List With Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id734">9.290.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#locally-unused-property">9.291. Locally Unused Property</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id736">9.291.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#logical-mistakes">9.292. Logical Mistakes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id738">9.292.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#logical-operators-favorite">9.293. Logical Operators Favorite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id741">9.293.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#logical-should-use-symbolic-operators">9.294. Logical Should Use Symbolic Operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id744">9.294.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#logical-to-in-array">9.295. Logical To in_array</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id749">9.295.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lone-blocks">9.296. Lone Blocks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id751">9.296.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#long-arguments">9.297. Long Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id754">9.297.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lost-references">9.298. Lost References</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id756">9.298.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#magic-visibility">9.299. Magic Visibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="#make-global-a-property">9.300. Make Global A Property</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id761">9.300.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#make-magic-concrete">9.301. Make Magic Concrete</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id763">9.301.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#make-one-call-with-array">9.302. Make One Call With Array</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id770">9.302.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#malformed-octal">9.303. Malformed Octal</a></li>
<li class="toctree-l2"><a class="reference internal" href="#max-level-of-nesting">9.304. Max Level Of Nesting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id774">9.304.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#maybe-missing-new">9.305. Maybe Missing New</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id776">9.305.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mbstring-third-arg">9.306. Mbstring Third Arg</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id781">9.306.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mbstring-unknown-encoding">9.307. Mbstring Unknown Encoding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id783">9.307.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#memoize-magiccall">9.308. Memoize MagicCall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id785">9.308.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#merge-if-then">9.309. Merge If Then</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id787">9.309.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#method-collision-traits">9.310. Method Collision Traits</a></li>
<li class="toctree-l2"><a class="reference internal" href="#method-could-be-private-method">9.311. Method Could Be Private Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#method-could-be-static">9.312. Method Could Be Static</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id796">9.312.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#method-signature-must-be-compatible">9.313. Method Signature Must Be Compatible</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id798">9.313.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#methodcall-on-new">9.314. Methodcall On New</a></li>
<li class="toctree-l2"><a class="reference internal" href="#methods-without-return">9.315. Methods Without Return</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id801">9.315.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#minus-one-on-error">9.316. Minus One On Error</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id804">9.316.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mismatch-parameter-and-type">9.317. Mismatch Parameter And Type</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id806">9.317.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mismatch-parameter-name">9.318. Mismatch Parameter Name</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id808">9.318.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mismatch-properties-typehints">9.319. Mismatch Properties Typehints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id811">9.319.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mismatch-type-and-default">9.320. Mismatch Type And Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id815">9.320.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mismatched-default-arguments">9.321. Mismatched Default Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id817">9.321.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mismatched-ternary-alternatives">9.322. Mismatched Ternary Alternatives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id819">9.322.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mismatched-typehint">9.323. Mismatched Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id821">9.323.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#missing-abstract-method">9.324. Missing Abstract Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id823">9.324.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#missing-cases-in-switch">9.325. Missing Cases In Switch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id827">9.325.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#missing-include">9.326. Missing Include</a></li>
<li class="toctree-l2"><a class="reference internal" href="#missing-parenthesis">9.327. Missing Parenthesis</a></li>
<li class="toctree-l2"><a class="reference internal" href="#missing-some-returntype">9.328. Missing Some Returntype</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id832">9.328.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#missing-typehint">9.329. Missing Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id835">9.329.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mistaken-concatenation">9.330. Mistaken Concatenation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mixed-concat-and-interpolation">9.331. Mixed Concat And Interpolation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id838">9.331.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mixed-keys-arrays">9.332. Mixed Keys Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id840">9.332.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mkdir-default">9.333. Mkdir Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id843">9.333.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#modernize-empty-with-expression">9.334. Modernize Empty With Expression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id847">9.334.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#modified-typed-parameter">9.335. Modified Typed Parameter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id850">9.335.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-alias-definitions">9.336. Multiple Alias Definitions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id852">9.336.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-alias-definitions-per-file">9.337. Multiple Alias Definitions Per File</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-class-declarations">9.338. Multiple Class Declarations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id855">9.338.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-classes-in-one-file">9.339. Multiple Classes In One File</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id857">9.339.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-constant-definition">9.340. Multiple Constant Definition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id859">9.340.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-declaration-of-strict-types">9.341. Multiple Declaration Of Strict_types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id861">9.341.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-definition-of-the-same-argument">9.342. Multiple Definition Of The Same Argument</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id864">9.342.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-exceptions-catch">9.343. Multiple Exceptions Catch()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-identical-trait-or-interface">9.344. Multiple Identical Trait Or Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id867">9.344.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-index-definition">9.345. Multiple Index Definition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id869">9.345.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-type-variable">9.346. Multiple Type Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id871">9.346.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-unset">9.347. Multiple Unset()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id875">9.347.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiple-usage-of-same-trait">9.348. Multiple Usage Of Same Trait</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id878">9.348.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiples-identical-case">9.349. Multiples Identical Case</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id880">9.349.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiply-by-one">9.350. Multiply By One</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id882">9.350.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#must-call-parent-constructor">9.351. Must Call Parent Constructor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id887">9.351.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#must-return-methods">9.352. Must Return Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id894">9.352.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#named-regex">9.353. Named Regex</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id896">9.353.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#negative-power">9.354. Negative Power</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id902">9.354.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#negative-start-index-in-array">9.355. Negative Start Index In Array</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id905">9.355.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nested-ifthen">9.356. Nested Ifthen</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nested-ternary">9.357. Nested Ternary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id908">9.357.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nested-ternary-without-parenthesis">9.358. Nested Ternary Without Parenthesis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id910">9.358.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#never-used-parameter">9.359. Never Used Parameter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id912">9.359.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#never-used-properties">9.360. Never Used Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id916">9.360.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#new-constants-in-php-7-2">9.361. New Constants In PHP 7.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-constants-in-php-7-4">9.362. New Constants In PHP 7.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id919">9.362.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-5-4">9.363. New Functions In PHP 5.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-5-5">9.364. New Functions In PHP 5.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-5-6">9.365. New Functions In PHP 5.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-7-0">9.366. New Functions In PHP 7.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-7-1">9.367. New Functions In PHP 7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-7-2">9.368. New Functions In PHP 7.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id933">9.368.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-7-3">9.369. New Functions In PHP 7.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-7-4">9.370. New Functions In PHP 7.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="#new-functions-in-php-8-0">9.371. New Functions In PHP 8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="#next-month-trap">9.372. Next Month Trap</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id940">9.372.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-append-on-source">9.373. No Append On Source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id943">9.373.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-boolean-as-default">9.374. No Boolean As Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id945">9.374.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-choice">9.375. No Choice</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id947">9.375.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-class-as-typehint">9.376. No Class As Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id949">9.376.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-class-in-global">9.377. No Class In Global</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id951">9.377.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-count-with-0">9.378. No Count With 0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id967">9.378.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-direct-call-to-magic-method">9.379. No Direct Call To Magic Method</a></li>
<li class="toctree-l2"><a class="reference internal" href="#no-direct-usage">9.380. No Direct Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id978">9.380.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-ent-ignore">9.381. No ENT_IGNORE</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id982">9.381.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-empty-regex">9.382. No Empty Regex</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id984">9.382.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-hardcoded-hash">9.383. No Hardcoded Hash</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id986">9.383.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-hardcoded-ip">9.384. No Hardcoded Ip</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id988">9.384.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-hardcoded-path">9.385. No Hardcoded Path</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id992">9.385.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-hardcoded-port">9.386. No Hardcoded Port</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id994">9.386.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-list-with-string">9.387. No List With String</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id999">9.387.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-literal-for-reference">9.388. No Literal For Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1001">9.388.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-magic-method-with-array">9.389. No Magic Method With Array</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1003">9.389.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-more-curly-arrays">9.390. No More Curly Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1005">9.390.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-need-for-else">9.391. No Need For Else</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1011">9.391.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-need-for-triple-equal">9.392. No Need For Triple Equal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1013">9.392.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-need-for-get-class">9.393. No Need For get_class()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1019">9.393.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-net-for-xml-load">9.394. No Net For Xml Load</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1022">9.394.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-parenthesis-for-language-construct">9.395. No Parenthesis For Language Construct</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1024">9.395.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-plus-one">9.396. No Plus One</a></li>
<li class="toctree-l2"><a class="reference internal" href="#no-public-access">9.397. No Public Access</a></li>
<li class="toctree-l2"><a class="reference internal" href="#no-real-comparison">9.398. No Real Comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1029">9.398.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-reference-for-static-property">9.399. No Reference For Static Property</a></li>
<li class="toctree-l2"><a class="reference internal" href="#no-reference-for-ternary">9.400. No Reference For Ternary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1034">9.400.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-reference-on-left-side">9.401. No Reference On Left Side</a></li>
<li class="toctree-l2"><a class="reference internal" href="#no-return-for-generator">9.402. No Return For Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#no-return-or-throw-in-finally">9.403. No Return Or Throw In Finally</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1040">9.403.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-return-used">9.404. No Return Used</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1043">9.404.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-self-referencing-constant">9.405. No Self Referencing Constant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1048">9.405.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-spread-for-hash">9.406. No Spread For Hash</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1051">9.406.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-string-with-append">9.407. No String With Append</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1053">9.407.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-substr-minus-one">9.408. No Substr Minus One</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1055">9.408.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-weak-ssl-crypto">9.409. No Weak SSL Crypto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1057">9.409.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-array-merge-in-loops">9.410. No array_merge() In Loops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1062">9.410.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-get-class-with-null">9.411. No get_class() With Null</a></li>
<li class="toctree-l2"><a class="reference internal" href="#no-isset-with-empty">9.412. No isset() With empty()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1073">9.412.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#no-mb-substr-in-loop">9.413. No mb_substr In Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1079">9.413.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#non-ascii-variables">9.414. Non Ascii Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1081">9.414.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#non-nullable-getters">9.415. Non Nullable Getters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1083">9.415.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#non-static-methods-called-in-a-static">9.416. Non Static Methods Called In A Static</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1095">9.416.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#non-constant-index-in-array">9.417. Non-constant Index In Array</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1098">9.417.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#non-lowercase-keywords">9.418. Non-lowercase Keywords</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1100">9.418.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#not-a-scalar-type">9.419. Not A Scalar Type</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1103">9.419.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#not-equal-is-not">9.420. Not Equal Is Not !==</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1106">9.420.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#not-not">9.421. Not Not</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1110">9.421.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#null-on-new">9.422. Null On New</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1112">9.422.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#null-or-boolean-arrays">9.423. Null Or Boolean Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1114">9.423.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nullable-with-constant">9.424. Nullable With Constant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1116">9.424.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#nullable-without-check">9.425. Nullable Without Check</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1118">9.425.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#numeric-literal-separator">9.426. Numeric Literal Separator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1120">9.426.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#objects-don-t-need-references">9.427. Objects Don’t Need References</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1122">9.427.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#old-style-constructor">9.428. Old Style Constructor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1124">9.428.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#old-style-autoload">9.429. Old Style __autoload()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1126">9.429.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#one-if-is-sufficient">9.430. One If Is Sufficient</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1128">9.430.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#one-letter-functions">9.431. One Letter Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1130">9.431.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#one-variable-string">9.432. One Variable String</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1133">9.432.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#only-variable-for-reference">9.433. Only Variable For Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1137">9.433.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#only-variable-passed-by-reference">9.434. Only Variable Passed By Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1141">9.434.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#only-variable-returned-by-reference">9.435. Only Variable Returned By Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimize-explode">9.436. Optimize Explode()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1153">9.436.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#or-die">9.437. Or Die</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1155">9.437.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#order-of-declaration">9.438. Order Of Declaration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overwritten-exceptions">9.439. Overwritten Exceptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1159">9.439.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#overwritten-literals">9.440. Overwritten Literals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#overwritten-source-and-value">9.441. Overwritten Source And Value</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1165">9.441.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-0-new-classes">9.442. PHP 7.0 New Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-0-new-interfaces">9.443. PHP 7.0 New Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-0-removed-directives">9.444. PHP 7.0 Removed Directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-0-removed-functions">9.445. PHP 7.0 Removed Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1175">9.445.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-0-scalar-typehints">9.446. PHP 7.0 Scalar Typehints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-1-microseconds">9.447. PHP 7.1 Microseconds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-1-removed-directives">9.448. PHP 7.1 Removed Directives</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-1-scalar-typehints">9.449. PHP 7.1 Scalar Typehints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-2-deprecations">9.450. PHP 7.2 Deprecations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1182">9.450.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-2-object-keyword">9.451. PHP 7.2 Object Keyword</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-2-removed-functions">9.452. PHP 7.2 Removed Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-2-scalar-typehints">9.453. PHP 7.2 Scalar Typehints</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-3-last-empty-argument">9.454. PHP 7.3 Last Empty Argument</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-3-removed-functions">9.455. PHP 7.3 Removed Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-4-constant-deprecation">9.456. PHP 7.4 Constant Deprecation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1194">9.456.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-4-removed-directives">9.457. PHP 7.4 Removed Directives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1196">9.457.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-4-removed-functions">9.458. PHP 7.4 Removed Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1199">9.458.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-4-reserved-keyword">9.459. PHP 7.4 Reserved Keyword</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1203">9.459.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-74-new-directives">9.460. PHP 74 New Directives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1205">9.460.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-8-0-removed-constants">9.461. PHP 8.0 Removed Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1207">9.461.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-8-0-removed-directives">9.462. PHP 8.0 Removed Directives</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1209">9.462.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-8-0-removed-functions">9.463. PHP 8.0 Removed Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-80-named-parameter-variadic">9.464. PHP 80 Named Parameter Variadic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1224">9.464.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-keywords-as-names">9.465. PHP Keywords As Names</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1228">9.465.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-resources-turned-into-objects">9.466. PHP Resources Turned Into Objects</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1230">9.466.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php5-indirect-variable-expression">9.467. PHP5 Indirect Variable Expression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1232">9.467.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php7-dirname">9.468. PHP7 Dirname</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1239">9.468.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parameter-hiding">9.469. Parameter Hiding</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1241">9.469.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parent-first">9.470. Parent First</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1245">9.470.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parent-static-or-self-outside-class">9.471. Parent, Static Or Self Outside Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parenthesis-as-parameter">9.472. Parenthesis As Parameter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1256">9.472.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pathinfo-returns-may-vary">9.473. Pathinfo() Returns May Vary</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1258">9.473.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-indirect-expression">9.474. Php 7 Indirect Expression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1260">9.474.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-1-new-class">9.475. Php 7.1 New Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-2-new-class">9.476. Php 7.2 New Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-7-4-new-class">9.477. Php 7.4 New Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1264">9.477.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-8-0-only-typehints">9.478. Php 8.0 Only TypeHints</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1266">9.478.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php-8-0-variable-syntax-tweaks">9.479. Php 8.0 Variable Syntax Tweaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#php-usematch">9.480. Php/UseMatch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1269">9.480.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#php7-relaxed-keyword">9.481. Php7 Relaxed Keyword</a></li>
<li class="toctree-l2"><a class="reference internal" href="#phpinfo">9.482. Phpinfo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1275">9.482.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#possible-alias-confusion">9.483. Possible Alias Confusion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1277">9.483.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#possible-increment">9.484. Possible Increment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1280">9.484.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#possible-infinite-loop">9.485. Possible Infinite Loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="#possible-missing-subpattern">9.486. Possible Missing Subpattern</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1285">9.486.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pre-increment">9.487. Pre-increment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1287">9.487.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#prefix-and-suffixes-with-typehint">9.488. Prefix And Suffixes With Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1291">9.488.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#preprocess-arrays">9.489. Preprocess Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1293">9.489.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#preprocessable">9.490. Preprocessable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1295">9.490.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#print-and-die">9.491. Print And Die</a></li>
<li class="toctree-l2"><a class="reference internal" href="#printf-number-of-arguments">9.492. Printf Number Of Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1302">9.492.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#processing-collector">9.493. Processing Collector</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1306">9.493.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#property-could-be-local">9.494. Property Could Be Local</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1308">9.494.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#property-could-be-private-property">9.495. Property Could Be Private Property</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1310">9.495.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#property-used-in-one-method-only">9.496. Property Used In One Method Only</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1313">9.496.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#property-variable-confusion">9.497. Property Variable Confusion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1315">9.497.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#queries-in-loops">9.498. Queries In Loops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1317">9.498.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#raised-access-level">9.499. Raised Access Level</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1321">9.499.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#random-without-try">9.500. Random Without Try</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1327">9.500.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#randomly-sorted-arrays">9.501. Randomly Sorted Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1329">9.501.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#redeclared-php-functions">9.502. Redeclared PHP Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1331">9.502.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#redefined-class-constants">9.503. Redefined Class Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="#redefined-default">9.504. Redefined Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1334">9.504.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#redefined-private-property">9.505. Redefined Private Property</a></li>
<li class="toctree-l2"><a class="reference internal" href="#redefined-property">9.506. Redefined Property</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reflection-export-is-deprecated">9.507. Reflection Export() Is Deprecated</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1340">9.507.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#regex-on-arrays">9.508. Regex On Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1346">9.508.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#register-globals">9.509. Register Globals</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1350">9.509.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#relay-function">9.510. Relay Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1352">9.510.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#repeated-interface">9.511. Repeated Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1356">9.511.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#repeated-regex">9.512. Repeated Regex</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1358">9.512.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#repeated-print">9.513. Repeated print()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1360">9.513.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reserved-keywords-in-php-7">9.514. Reserved Keywords In PHP 7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1363">9.514.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#results-may-be-missing">9.515. Results May Be Missing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#rethrown-exceptions">9.516. Rethrown Exceptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1366">9.516.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#return-true-false">9.517. Return True False</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1368">9.517.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#return-with-parenthesis">9.518. Return With Parenthesis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1371">9.518.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#reuse-variable">9.519. Reuse Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1373">9.519.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#safe-curl-options">9.520. Safe Curl Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1375">9.520.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#safe-http-headers">9.521. Safe HTTP Headers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1377">9.521.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#same-conditions-in-condition">9.522. Same Conditions In Condition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1379">9.522.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#same-variable-foreach">9.523. Same Variable Foreach</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scalar-are-not-arrays">9.524. Scalar Are Not Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1382">9.524.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#scalar-or-object-property">9.525. Scalar Or Object Property</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1384">9.525.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#self-using-trait">9.526. Self Using Trait</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1387">9.526.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#semantic-typing">9.527. Semantic Typing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1389">9.527.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#session-lazy-write">9.528. Session Lazy Write</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1391">9.528.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#set-aside-code">9.529. Set Aside Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1393">9.529.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#set-cookie-safe-arguments">9.530. Set Cookie Safe Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1396">9.530.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setlocale-uses-constants">9.531. Setlocale() Uses Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1400">9.531.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#several-instructions-on-the-same-line">9.532. Several Instructions On The Same Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="#short-open-tags">9.533. Short Open Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="#short-syntax-for-arrays">9.534. Short Syntax For Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="#should-be-single-quote">9.535. Should Be Single Quote</a></li>
<li class="toctree-l2"><a class="reference internal" href="#should-chain-exception">9.536. Should Chain Exception</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1410">9.536.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-deep-clone">9.537. Should Deep Clone</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1414">9.537.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-have-destructor">9.538. Should Have Destructor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1416">9.538.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-make-alias">9.539. Should Make Alias</a></li>
<li class="toctree-l2"><a class="reference internal" href="#should-make-ternary">9.540. Should Make Ternary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#should-preprocess-chr">9.541. Should Preprocess Chr()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1422">9.541.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-typecast">9.542. Should Typecast</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1425">9.542.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-coalesce">9.543. Should Use Coalesce</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1427">9.543.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-constants">9.544. Should Use Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1429">9.544.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-explode-args">9.545. Should Use Explode Args</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1433">9.545.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-foreach">9.546. Should Use Foreach</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1437">9.546.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-function">9.547. Should Use Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1439">9.547.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-local-class">9.548. Should Use Local Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1445">9.548.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-math">9.549. Should Use Math</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1447">9.549.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-operator">9.550. Should Use Operator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1454">9.550.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-prepared-statement">9.551. Should Use Prepared Statement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1456">9.551.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-setcookie">9.552. Should Use SetCookie()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1462">9.552.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-array-column">9.553. Should Use array_column()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1468">9.553.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-array-filter">9.554. Should Use array_filter()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1476">9.554.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-use-session-regenerateid">9.555. Should Use session_regenerateid()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1478">9.555.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#should-yield-with-key">9.556. Should Yield With Key</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1482">9.556.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#signature-trailing-comma">9.557. Signature Trailing Comma</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1484">9.557.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#silently-cast-integer">9.558. Silently Cast Integer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1486">9.558.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#similar-integers">9.559. Similar Integers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1488">9.559.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simple-global-variable">9.560. Simple Global Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1490">9.560.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simple-switch">9.561. Simple Switch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1492">9.561.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#simplify-regex">9.562. Simplify Regex</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1494">9.562.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#slice-arrays-first">9.563. Slice Arrays First</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1496">9.563.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#slow-functions">9.564. Slow Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1519">9.564.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sqlite3-requires-single-quotes">9.565. Sqlite3 Requires Single Quotes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1521">9.565.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#static-global-variables-confusion">9.566. Static Global Variables Confusion</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1526">9.566.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#static-loop">9.567. Static Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1533">9.567.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#static-methods-called-from-object">9.568. Static Methods Called From Object</a></li>
<li class="toctree-l2"><a class="reference internal" href="#static-methods-can-t-contain-this">9.569. Static Methods Can’t Contain $this</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1547">9.569.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#strange-name-for-constants">9.570. Strange Name For Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1549">9.570.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#strange-name-for-variables">9.571. Strange Name For Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1551">9.571.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#strict-comparison-with-booleans">9.572. Strict Comparison With Booleans</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1555">9.572.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#string-initialization">9.573. String Initialization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1557">9.573.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#string-may-hold-a-variable">9.574. String May Hold A Variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="#strings-with-strange-space">9.575. Strings With Strange Space</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1560">9.575.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#strpos-like-comparison">9.576. Strpos()-like Comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1578">9.576.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#strtr-arguments">9.577. Strtr Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1583">9.577.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#substr-to-trim">9.578. Substr To Trim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1594">9.578.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#substring-first">9.579. Substring First</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1598">9.579.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#suspicious-comparison">9.580. Suspicious Comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1600">9.580.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#swapped-arguments">9.581. Swapped Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1602">9.581.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#switch-fallthrough">9.582. Switch Fallthrough</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1605">9.582.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#switch-to-switch">9.583. Switch To Switch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1610">9.583.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#switch-with-too-many-default">9.584. Switch With Too Many Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1613">9.584.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#switch-without-default">9.585. Switch Without Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1617">9.585.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ternary-in-concat">9.586. Ternary In Concat</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1620">9.586.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#test-then-cast">9.587. Test Then Cast</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1622">9.587.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#throw-functioncall">9.588. Throw Functioncall</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1624">9.588.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#throw-in-destruct">9.589. Throw In Destruct</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1627">9.589.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#throw-was-an-expression">9.590. Throw Was An Expression</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1630">9.590.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#throws-an-assignement">9.591. Throws An Assignement</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1632">9.591.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#timestamp-difference">9.592. Timestamp Difference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1634">9.592.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#too-long-a-block">9.593. Too Long A Block</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1638">9.593.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#too-many-array-dimensions">9.594. Too Many Array Dimensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1640">9.594.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#too-many-children">9.595. Too Many Children</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1642">9.595.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#too-many-dereferencing">9.596. Too Many Dereferencing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1645">9.596.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#too-many-finds">9.597. Too Many Finds</a></li>
<li class="toctree-l2"><a class="reference internal" href="#too-many-injections">9.598. Too Many Injections</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1648">9.598.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#too-many-local-variables">9.599. Too Many Local Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1651">9.599.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#too-many-native-calls">9.600. Too Many Native Calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="#too-many-parameters">9.601. Too Many Parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1655">9.601.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#too-much-indented">9.602. Too Much Indented</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1657">9.602.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#trailing-comma-in-calls">9.603. Trailing Comma In Calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trait-not-found">9.604. Trait Not Found</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1661">9.604.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#typed-property-usage">9.605. Typed Property Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1663">9.605.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#typehint-must-be-returned">9.606. Typehint Must Be Returned</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1665">9.606.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#typehinted-references">9.607. Typehinted References</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1668">9.607.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unbinding-closures">9.608. Unbinding Closures</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1682">9.608.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#uncaught-exceptions">9.609. Uncaught Exceptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1684">9.609.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unchecked-resources">9.610. Unchecked Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unconditional-break-in-loop">9.611. Unconditional Break In Loop</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1691">9.611.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-class">9.612. Undefined ::class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-caught-exceptions">9.613. Undefined Caught Exceptions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1696">9.613.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-class-constants">9.614. Undefined Class Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1698">9.614.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-classes">9.615. Undefined Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1700">9.615.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-constant-name">9.616. Undefined Constant Name</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1704">9.616.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-constants">9.617. Undefined Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1707">9.617.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-functions">9.618. Undefined Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1709">9.618.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-insteadof">9.619. Undefined Insteadof</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1712">9.619.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-interfaces">9.620. Undefined Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1717">9.620.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-parent">9.621. Undefined Parent</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1721">9.621.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-properties">9.622. Undefined Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1723">9.622.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-trait">9.623. Undefined Trait</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1725">9.623.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-variable">9.624. Undefined Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1728">9.624.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#undefined-static-or-self">9.625. Undefined static:: Or self::</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1734">9.625.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unicode-escape-partial">9.626. Unicode Escape Partial</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unicode-escape-syntax">9.627. Unicode Escape Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uninitilized-property">9.628. Uninitilized Property</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1738">9.628.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#union-typehint">9.629. Union Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1741">9.629.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unitialized-properties">9.630. Unitialized Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1743">9.630.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unknown-parameter-name">9.631. Unknown Parameter Name</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1745">9.631.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unknown-pcre2-option">9.632. Unknown Pcre2 Option</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unkown-regex-options">9.633. Unkown Regex Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unpacking-inside-arrays">9.634. Unpacking Inside Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1752">9.634.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unpreprocessed-values">9.635. Unpreprocessed Values</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1754">9.635.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unreachable-class-constant">9.636. Unreachable Class Constant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1758">9.636.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unreachable-code">9.637. Unreachable Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1763">9.637.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unresolved-catch">9.638. Unresolved Catch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1765">9.638.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unresolved-classes">9.639. Unresolved Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1767">9.639.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unresolved-instanceof">9.640. Unresolved Instanceof</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1771">9.640.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unresolved-use">9.641. Unresolved Use</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1774">9.641.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unserialize-second-arg">9.642. Unserialize Second Arg</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1778">9.642.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unset-in-foreach">9.643. Unset In Foreach</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1781">9.643.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unsupported-types-with-operators">9.644. Unsupported Types With Operators</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1783">9.644.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unthrown-exception">9.645. Unthrown Exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unused-arguments">9.646. Unused Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1788">9.646.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-class-constant">9.647. Unused Class Constant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1790">9.647.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-classes">9.648. Unused Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unused-constants">9.649. Unused Constants</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1793">9.649.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-exception-variable">9.650. Unused Exception Variable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1795">9.650.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-functions">9.651. Unused Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1797">9.651.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-global">9.652. Unused Global</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1799">9.652.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-inherited-variable-in-closure">9.653. Unused Inherited Variable In Closure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1803">9.653.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-interfaces">9.654. Unused Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1806">9.654.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-label">9.655. Unused Label</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1808">9.655.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-methods">9.656. Unused Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1811">9.656.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-private-methods">9.657. Unused Private Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1814">9.657.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-private-properties">9.658. Unused Private Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1817">9.658.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-protected-methods">9.659. Unused Protected Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1819">9.659.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-returned-value">9.660. Unused Returned Value</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unused-trait-in-class">9.661. Unused Trait In Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1823">9.661.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unused-use">9.662. Unused Use</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1825">9.662.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#unusual-case-for-php-functions">9.663. Unusual Case For PHP Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#upload-filename-injection">9.664. Upload Filename Injection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1829">9.664.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-class-operator">9.665. Use ::Class Operator</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1835">9.665.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-null">9.666. Use === null</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1838">9.666.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-array-functions">9.667. Use Array Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1847">9.667.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-basename-suffix">9.668. Use Basename Suffix</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1852">9.668.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-case-value">9.669. Use Case Value</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1855">9.669.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-const-and-functions">9.670. Use Const And Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-constant">9.671. Use Constant</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1859">9.671.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-constant-as-arguments">9.672. Use Constant As Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1881">9.672.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-count-recursive">9.673. Use Count Recursive</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1884">9.673.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-datetimeimmutable-class">9.674. Use DateTimeImmutable Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1886">9.674.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-instanceof">9.675. Use Instanceof</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1892">9.675.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-list-with-foreach">9.676. Use List With Foreach</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1898">9.676.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-lower-case-for-parent-static-and-self">9.677. Use Lower Case For Parent, Static And Self</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1907">9.677.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-named-boolean-in-argument-definition">9.678. Use Named Boolean In Argument Definition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-nullable-type">9.679. Use Nullable Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-php-object-api">9.680. Use PHP Object API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1912">9.680.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-php7-encapsed-strings">9.681. Use PHP7 Encapsed Strings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-pathinfo">9.682. Use Pathinfo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1922">9.682.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-positive-condition">9.683. Use Positive Condition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1924">9.683.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-system-tmp">9.684. Use System Tmp</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1927">9.684.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-the-blind-var">9.685. Use The Blind Var</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1929">9.685.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-url-query-functions">9.686. Use Url Query Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1935">9.686.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-with-fully-qualified-name">9.687. Use With Fully Qualified Name</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1937">9.687.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-array-slice">9.688. Use array_slice()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1942">9.688.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-const">9.689. Use const</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1947">9.689.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-get-debug-type">9.690. Use get_debug_type()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1949">9.690.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-is-countable">9.691. Use is_countable</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1952">9.691.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-json-decode-options">9.692. Use json_decode() Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1956">9.692.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-password-hash">9.693. Use password_hash()</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-pathinfo-arguments">9.694. Use pathinfo() Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1966">9.694.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-random-int">9.695. Use random_int()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1978">9.695.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-session-start-options">9.696. Use session_start() Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1980">9.696.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#use-str-contains">9.697. Use str_contains()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1987">9.697.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#used-once-property">9.698. Used Once Property</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1989">9.698.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#used-once-variables">9.699. Used Once Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1993">9.699.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#used-once-variables-in-scope">9.700. Used Once Variables (In Scope)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1995">9.700.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-abstract-class">9.701. Useless Abstract Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1999">9.701.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-alias">9.702. Useless Alias</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2001">9.702.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-brackets">9.703. Useless Brackets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2003">9.703.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-catch">9.704. Useless Catch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2006">9.704.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-check">9.705. Useless Check</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2013">9.705.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-constructor">9.706. Useless Constructor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#useless-default-argument">9.707. Useless Default Argument</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2016">9.707.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-final">9.708. Useless Final</a></li>
<li class="toctree-l2"><a class="reference internal" href="#useless-global">9.709. Useless Global</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2024">9.709.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-instructions">9.710. Useless Instructions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2026">9.710.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-interfaces">9.711. Useless Interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2030">9.711.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-parenthesis">9.712. Useless Parenthesis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2033">9.712.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-referenced-argument">9.713. Useless Referenced Argument</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2037">9.713.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-return">9.714. Useless Return</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2039">9.714.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-switch">9.715. Useless Switch</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2041">9.715.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-type-casting">9.716. Useless Type Casting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2044">9.716.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-type-check">9.717. Useless Type Check</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2047">9.717.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-typehint">9.718. Useless Typehint</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2052">9.718.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#useless-unset">9.719. Useless Unset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2056">9.719.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#uses-default-values">9.720. Uses Default Values</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2061">9.720.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-this-outside-a-class">9.721. Using $this Outside A Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-deprecated-method">9.722. Using Deprecated Method</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2066">9.722.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usort-sorting-in-php-7-0">9.723. Usort Sorting In PHP 7.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2071">9.723.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#var-keyword">9.724. Var Keyword</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2074">9.724.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#variable-global">9.725. Variable Global</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variable-is-not-a-condition">9.726. Variable Is Not A Condition</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2079">9.726.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#variables-with-one-letter-names">9.727. Variables With One Letter Names</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2081">9.727.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#weak-typing">9.728. Weak Typing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2084">9.728.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#weird-array-index">9.729. Weird Array Index</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2086">9.729.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#while-list-each">9.730. While(List() = Each())</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2088">9.730.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#written-only-variables">9.731. Written Only Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2090">9.731.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-access-style-to-property">9.732. Wrong Access Style to Property</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2097">9.732.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-argument-type">9.733. Wrong Argument Type</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2099">9.733.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-attribute-configuration">9.734. Wrong Attribute Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2101">9.734.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-case-namespaces">9.735. Wrong Case Namespaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2103">9.735.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-class-name-case">9.736. Wrong Class Name Case</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2105">9.736.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-function-name-case">9.737. Wrong Function Name Case</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2108">9.737.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-number-of-arguments">9.738. Wrong Number Of Arguments</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2110">9.738.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-optional-parameter">9.739. Wrong Optional Parameter</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2113">9.739.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-parameter-type">9.740. Wrong Parameter Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-range-check">9.741. Wrong Range Check</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2116">9.741.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-type-for-native-php-function">9.742. Wrong Type For Native PHP Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2118">9.742.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-type-returned">9.743. Wrong Type Returned</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2120">9.743.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-type-with-call">9.744. Wrong Type With Call</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2122">9.744.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-typed-property-default">9.745. Wrong Typed Property Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2124">9.745.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-typehinted-name">9.746. Wrong Typehinted Name</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2126">9.746.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wrong-fopen-mode">9.747. Wrong fopen() Mode</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2132">9.747.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#yoda-comparison">9.748. Yoda Comparison</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dir-then-slash">9.749. __DIR__ Then Slash</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2137">9.749.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#debuginfo-usage">9.750. __debugInfo() Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tostring-throws-exception">9.751. __toString() Throws Exception</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2147">9.751.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#array-key-exists-speedup">9.752. array_key_exists() Speedup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2156">9.752.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#array-key-exists-works-on-arrays">9.753. array_key_exists() Works On Arrays</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2160">9.753.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#array-merge-and-variadic">9.754. array_merge() And Variadic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2167">9.754.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#crypt-without-salt">9.755. crypt() Without Salt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2172">9.755.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#curl-version-has-no-argument">9.756. curl_version() Has No Argument</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2175">9.756.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#error-reporting-with-integers">9.757. error_reporting() With Integers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2178">9.757.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#eval-without-try">9.758. eval() Without Try</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2180">9.758.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#ext-apc">9.759. ext/apc</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ext-dba">9.760. ext/dba</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ext-ereg">9.761. ext/ereg</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ext-fdf">9.762. ext/fdf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ext-mcrypt">9.763. ext/mcrypt</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ext-mhash">9.764. ext/mhash</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ext-ming">9.765. ext/ming</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ext-mysql">9.766. ext/mysql</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filter-input-as-a-source">9.767. filter_input() As A Source</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2194">9.767.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fputcsv-in-loops">9.768. fputcsv() In Loops</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2197">9.768.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#func-get-arg-modified">9.769. func_get_arg() Modified</a></li>
<li class="toctree-l2"><a class="reference internal" href="#idn-to-ascii-new-default">9.770. idn_to_ascii() New Default</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2203">9.770.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#include-once-usage">9.771. include_once() Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2205">9.771.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#isset-with-constant">9.772. isset() With Constant</a></li>
<li class="toctree-l2"><a class="reference internal" href="#list-may-omit-variables">9.773. list() May Omit Variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2212">9.773.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mb-strrpos-third-argument">9.774. mb_strrpos() Third Argument</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2216">9.774.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mcrypt-create-iv-with-default-values">9.775. mcrypt_create_iv() With Default Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="#move-uploaded-file-instead-of-copy">9.776. move_uploaded_file Instead Of copy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2223">9.776.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#openssl-random-pseudo-byte-second-argument">9.777. openssl_random_pseudo_byte() Second Argument</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2225">9.777.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#parse-str-warning">9.778. parse_str() Warning</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2229">9.778.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#preg-match-all-flag">9.779. preg_match_all() Flag</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2234">9.779.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#preg-replace-with-option-e">9.780. preg_replace With Option e</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2241">9.780.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#self-parent-static-outside-class">9.781. self, parent, static Outside Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-exception-handler-warning">9.782. set_exception_handler() Warning</a></li>
<li class="toctree-l2"><a class="reference internal" href="#strip-tags-skips-closed-tag">9.783. strip_tags Skips Closed Tag</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2254">9.783.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#strpos-too-much">9.784. strpos() Too Much</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2259">9.784.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#time-vs-strtotime">9.785. time() Vs strtotime()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2263">9.785.1. Suggestions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#var-dump-usage">9.786. var_dump()… Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2265">9.786.1. Suggestions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Cases.html">10. Real Code Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="Reports.html">11. Reports</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">12. Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="Development.html">13. Custom analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="Glossary.html">14. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="Definitions.html">15. Definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contribute.html">16. Ideas</a></li>
<li class="toctree-l1"><a class="reference internal" href="Contributors.html">17. List of contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="Annex.html">18. Annex</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Exakat</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>9. Rules list</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Rules.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rules-list">
<span id="rules"></span><h1>9. Rules list<a class="headerlink" href="#rules-list" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>9.1. Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="http-raw-post-data-usage">
<span id="id1"></span><h2>9.2. $HTTP_RAW_POST_DATA Usage<a class="headerlink" href="#http-raw-post-data-usage" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">$HTTP_RAW_POST_DATA</span></code> is deprecated, and should be replaced by <code class="docutils literal notranslate"><span class="pre">php://input</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">$HTTP_RAW_POST_DATA</span></code> is deprecated since PHP 5.6.</p>
<p>It is possible to prepare code to this lack of feature by setting <code class="docutils literal notranslate"><span class="pre">always_populate_raw_post_data</span></code> to -1.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 5.5 and older</span>
<span class="nv">$postdata</span> <span class="o">=</span> <span class="nv">$HTTP_RAW_POST_DATA</span><span class="p">;</span>

<span class="c1">// PHP 5.6 and more recent</span>
<span class="nv">$postdata</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nx">php</span><span class="o">://</span><span class="nx">input</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.httprawpostdata.php">$HTTP_RAW_POST_DATA variable</a>.</p>
<div class="section" id="suggestions">
<h3>9.2.1. Suggestions<a class="headerlink" href="#suggestions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use php://input with fopen() instead.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/RawPostDataUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-errormsg-usage">
<span id="id2"></span><h2>9.3. $php_errormsg Usage<a class="headerlink" href="#php-errormsg-usage" title="Permalink to this headline">¶</a></h2>
<p>$php_errormsg is removed since PHP 8.0. $php_errormsg tracks the last error message, with the directive <cite>track_errors</cite>. All was removed in PHP 8.0, and shall be replaced with <a class="reference external" href="https://www.php.net/error_get_last">error_get_last()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$php_errormsg</span><span class="p">;</span>

    <span class="k">echo</span> <span class="s1">&#39;Last error: &#39;</span><span class="o">.</span><span class="nv">$php_errormsg</span><span class="p">;</span>

    <span class="k">echo</span> <span class="s1">&#39;Also, last error: &#39;</span><span class="o">.</span><span class="nb">error_get_last</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id3">
<h3>9.3.1. Suggestions<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use error_get_last() instead.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/PhpErrorMsgUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="this-belongs-to-classes-or-traits">
<span id="id4"></span><h2>9.4. $this Belongs To Classes Or Traits<a class="headerlink" href="#this-belongs-to-classes-or-traits" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> variable represents the current object, inside a class or trait scope.</p>
<p>It is a pseudo-variable, and should be used within class’s or trait’s methods and not outside. It should also not be used in <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods.</p>
<p>PHP 7.1 is stricter and check for <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> at several situations. Some are found by <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> analysis, some are dynamic analysis.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// as an argument</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Using global</span>
    <span class="k">global</span> <span class="nv">$this</span><span class="p">;</span>
    <span class="c1">// Using static (not a property)</span>
    <span class="k">static</span> <span class="nv">$this</span><span class="p">;</span>

    <span class="c1">// Can&#39;t unset it</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>

    <span class="k">try</span> <span class="p">{</span>
        <span class="c1">// inside a foreach</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$this</span><span class="p">)</span> <span class="p">{</span>  <span class="p">}</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$this</span> <span class="o">=&gt;</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>  <span class="p">}</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$b</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="p">)</span> <span class="p">{</span>  <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$this</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// inside a catch</span>
    <span class="p">}</span>

    <span class="c1">// with Variable Variable</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nv">$$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Using references</span>
        <span class="nv">$a</span> <span class="o">=&amp;</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

        <span class="c1">// Using extract(), parse_str() or similar functions</span>
        <span class="nb">extract</span><span class="p">([</span><span class="k">this</span> <span class="o">=&gt;</span> <span class="mi">42</span><span class="p">]);</span>  <span class="c1">// throw new Error(Cannot re-assign $this)</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Using __call</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span> <span class="c1">// prints object(C)#1 (0) {}, php-7.0 printed NULL</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">test</span><span class="p">();</span>   <span class="c1">// prints ops</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id7">
<h3>9.4.1. Suggestions<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do not use <cite>$this</cite> as a variable name, except for the current object, in a class, trait or closure.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ThisIsForClasses</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openemr-classes-thisisforclasses"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="this-is-not-an-array">
<span id="id8"></span><h2>9.5. $this Is Not An Array<a class="headerlink" href="#this-is-not-an-array" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">$this</span></code> variable represents the current object and it is not an array.</p>
<p>This is unless the class (or its parents) has the <code class="docutils literal notranslate"><span class="pre">ArrayAccess</span></code> interface, or extends <code class="docutils literal notranslate"><span class="pre">ArrayObject</span></code> or <code class="docutils literal notranslate"><span class="pre">SimpleXMLElement</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $this is an array</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="nx">ArrayAccess</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">++</span><span class="nv">$this</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// $this is not an array</span>
<span class="k">class</span> <span class="nc">Foo2</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="o">++</span><span class="nv">$this</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/class.arrayaccess.php">ArrayAccess</a>, <a class="reference external" href="https://www.php.net/manual/en/class.arrayobject.php">ArrayObject</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">The Basics</a>.</p>
<div class="section" id="id9">
<h3>9.5.1. Suggestions<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extends <code class="docutils literal notranslate"><span class="pre">ArrayObject</span></code>, or a class that extends it, to use <code class="docutils literal notranslate"><span class="pre">$this</span></code> as an array too.</li>
<li>Implements <code class="docutils literal notranslate"><span class="pre">ArrayAccess</span></code> to use <code class="docutils literal notranslate"><span class="pre">$this</span></code> as an array too.</li>
<li>Use a property in the current class to store the data, instead of $this directly.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ThisIsNotAnArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="this-is-not-for-static-methods">
<span id="id10"></span><h2>9.6. $this Is Not For Static Methods<a class="headerlink" href="#this-is-not-for-static-methods" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> methods shouldn’t use <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> variable.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> variable represents an object, the current object. It is not compatible with a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method, which may operate without any object.</p>
<p>While executing a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> is actually set to <a class="reference external" href="https://www.php.net/manual/en/language.types.null.php">NULL</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">static</span> <span class="nv">$staticProperty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Static methods should use static properties</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">count</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$staticProperty</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Static methods can&#39;t use $this</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>   <span class="c1">// No $this usage in a static method</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static Keyword &lt;https://www.php.net/manual/en/language.oop5.`static</a>.php&gt;`_.</p>
<div class="section" id="id17">
<h3>9.6.1. Suggestions<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the static keyword on the method, and update all calls to this method to use $this</li>
<li>Remove the usage of $this in the method, replacing it with static properties</li>
<li>Make $this an argument (and change its name) : then, make the method a function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ThisIsNotForStatic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-static-this.md">no-static-this</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="for-exponent">
<span id="id18"></span><h2>9.7. ** For Exponent<a class="headerlink" href="#for-exponent" title="Permalink to this headline">¶</a></h2>
<p>The operator <code class="docutils literal notranslate"><span class="pre">**</span></code> calculates exponents, also known as power.</p>
<p>Use it instead of the slower function <a class="reference external" href="https://www.php.net/pow">pow()</a>. This operator was introduced in PHP 5.6.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$cube</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1">// 8</span>

    <span class="nv">$cubeInPHP56</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// 8</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Be aware the the ‘-‘ operator has lower priority than the <a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">**</a> operator : this leads to the following confusing result.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">echo</span> <span class="o">-</span><span class="mi">3</span> <span class="o">**</span> <span class="mi">2</span><span class="p">;</span>
    <span class="c1">// displays -9, instead of 9</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is due to the parser that processes separately <code class="docutils literal notranslate"><span class="pre">-</span></code> and the following number. Since <code class="docutils literal notranslate"><span class="pre">**</span></code> has priority, the power operation happens first.</p>
<p>Being an operator, <code class="docutils literal notranslate"><span class="pre">**</span></code> is faster than <a class="reference external" href="https://www.php.net/pow">pow()</a>. This is a microoptimisation.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">Arithmetic Operators</a>.</p>
<div class="section" id="id21">
<h3>9.7.1. Suggestions<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the <code class="docutils literal notranslate"><span class="pre">**</span></code> operator</li>
<li>For powers of 2, use the bitshift operators</li>
<li>For literal powers of 2, consider using the <code class="docutils literal notranslate"><span class="pre">0xFFFFFFFFF</span></code> syntax.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NewExponent</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#traq-php-newexponent"><span class="std std-ref">Traq</span></a>, <a class="reference internal" href="Cases.html#teampass-php-newexponent"><span class="std std-ref">TeamPass</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="class">
<span id="id22"></span><h2>9.8. ::class<a class="headerlink" href="#class" title="Permalink to this headline">¶</a></h2>
<p>PHP has a special class constant to hold the name of the class : <code class="docutils literal notranslate"><span class="pre">class</span></code> keyword. It represents the class name that is used in the left part of the operator.</p>
<p>Using <code class="docutils literal notranslate"><span class="pre">\:\:class</span></code> is safer than relying on a string. It does adapt if the class’s name or its namespace is changed’. It is also faster, though it is a micro-optimisation.</p>
<p>It is introduced in PHP 5.5.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">A\B\C</span> <span class="k">as</span> <span class="nx">UsedName</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nx">ClassName</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>
        <span class="k">echo</span> <span class="nx">UsedName</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$f</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">(</span> <span class="p">);</span>
<span class="nv">$f</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">(</span> <span class="p">);</span>
<span class="c1">// displays ClassName</span>
<span class="c1">// displays A\B\C</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Be aware that <code class="docutils literal notranslate"><span class="pre">\:\:class</span></code> is a replacement for <a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__CLASS__</a> magic constant.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.constants.php">Class Constant</a>.</p>
<div class="section" id="id24">
<h3>9.8.1. Suggestions<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use ::class whenever possible. That exclude any dynamic call.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/StaticclassUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="operator">
<span id="id25"></span><h2>9.9. &#64; Operator<a class="headerlink" href="#operator" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.operators.errorcontrol.php">&#64;</a> is the ‘no scream’ operator : it suppresses error output.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Set x with incoming value, or else null.</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="o">@</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This operator is actually very slow : it will process the error all the way up, and finally decide not to display it. It is often faster to check the conditions first, then run the method without <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>.</p>
<p>You may also set display_error to 0 in the <code class="docutils literal notranslate"><span class="pre">php.ini</span></code> : this will avoid user’s error display, but will keep the error in the PHP logs, for later processing.</p>
<p>The only situation where <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> is useful is when a native PHP function displays errors messages when error happens and there is no way to check it from the code.</p>
<p>This is the case with <a class="reference external" href="https://www.php.net/fopen">fopen()</a>, <a class="reference external" href="https://www.php.net/stream_socket_server">stream_socket_server()</a>, <a class="reference external" href="https://www.php.net/token_get_all">token_get_all()</a>.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.errorcontrol.php">Error Control Operators</a> and <a class="reference external" href="https://derickrethans.nl/five-reasons-why-the-shutop-operator-should-be-avoided.html">Five reasons why the shut-op operator should be avoided</a>.</p>
<div class="section" id="id27">
<h3>9.9.1. Suggestions<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the &#64; operator by default</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="26%" />
<col width="6%" />
<col width="47%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>authorizedFunctions</td>
<td>noscream_functions.json</td>
<td>data</td>
<td>Functions that are authorized to sports a &#64;.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/Noscream</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-noscream.md">no-noscream</a></td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phinx-structures-noscream"><span class="std std-ref">Phinx</span></a>, <a class="reference internal" href="Cases.html#phpipam-structures-noscream"><span class="std std-ref">PhpIPAM</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="abstract-away">
<span id="id28"></span><h2>9.10. Abstract Away<a class="headerlink" href="#abstract-away" title="Permalink to this headline">¶</a></h2>
<p>Avoid using PHP native functions that produce data direcly in the code. For example, <a class="reference external" href="https://www.php.net/date">date()</a> or <a class="reference external" href="https://www.php.net/random_int">random_int()</a>. They should be abstracted away in a method, that will be replaced later for testing purposes, or even debugging.</p>
<p>To abstract such calls, place them in a method, and add an interface to this method. Then, create and use those objects.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// abstracted away date</span>
<span class="nv">$today</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MyDate</span><span class="p">();</span>
<span class="k">echo</span> <span class="s1">&#39;Date : &#39;</span><span class="o">.</span><span class="nv">$today</span><span class="o">-&gt;</span><span class="na">date</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">);</span>

<span class="c1">// hard coded date of today : it changes all the time.</span>
<span class="k">echo</span> <span class="s1">&#39;Date : &#39;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">);</span>

<span class="k">interface</span> <span class="nx">MyCalendar</span><span class="p">{</span>
    <span class="k">function</span> <span class="nf">date</span><span class="p">(</span><span class="nv">$format</span><span class="p">)</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">MyDate</span> <span class="k">implements</span> <span class="nx">MyCalendar</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">date</span><span class="p">(</span><span class="nv">$format</span><span class="p">)</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Valid implementation, reserved for testing purpose</span>
<span class="c1">// This prevents from waiting 4 years for a test.</span>
<span class="k">class</span> <span class="nc">MyDateForTest</span> <span class="k">implements</span> <span class="nx">MyCalendar</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">date</span><span class="p">(</span><span class="nv">$format</span><span class="p">)</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;2016-02-29 12:00:00&#39;</span><span class="p">));</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis targets two API for abstraction : time and random values. Time and date related functions may be replaced by <a class="reference external" href="https://carbon.nesbot.com/docs/">Carbon</a>, <a class="reference external" href="https://github.com/lcobucci/clock">Clock</a>, <a class="reference external" href="https://github.com/cakephp/chronos">Chronos</a>. Random values may be replaced with <a class="reference external" href="https://github.com/ircmaxell/RandomLib/">RandomLib</a> or a custome interface.</p>
<p>See also <a class="reference external" href="https://blog.frankdejonge.nl/being-in-control-of-time-in-php/">Being in control of time in PHP</a> and <a class="reference external" href="https://www.orbitale.io/2019/12/24/how-to-test-non-deterministic-code.html">How to test non-deterministic code</a>.</p>
<div class="section" id="id29">
<h3>9.10.1. Suggestions<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Abstract away the calls to native PHP functions, and upgrade the unit tests</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="8%" />
<col width="9%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>abstractableCalls</td>
<td>&#160;</td>
<td>ini_hash</td>
<td>Functions that shouldn’t be called directly, unless in a method.</td>
</tr>
<tr class="row-odd"><td>abstractableClasses</td>
<td>&#160;</td>
<td>ini_hash</td>
<td>Classes that shouldn’t be instantiated directly, unless in a method.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Patterns/AbstractAway</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="abstract-or-implements">
<span id="id30"></span><h2>9.11. Abstract Or Implements<a class="headerlink" href="#abstract-or-implements" title="Permalink to this headline">¶</a></h2>
<p>A class must implements all abstract methods of it <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a>, or be abstract too.</p>
<p>While PHP lints this code, it won’t execute it and stop with a Fatal Error : <code class="docutils literal notranslate"><span class="pre">Class</span> <span class="pre">BA</span> <span class="pre">contains</span> <span class="pre">1</span> <span class="pre">abstract</span> <span class="pre">method</span> <span class="pre">and</span> <span class="pre">must</span> <span class="pre">therefore</span> <span class="pre">be</span> <span class="pre">declared</span> <span class="pre">abstract</span> <span class="pre">or</span> <span class="pre">implement</span> <span class="pre">the</span> <span class="pre">remaining</span> <span class="pre">methods</span> <span class="pre">(A\:\:aFoo)</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">abstract</span> <span class="k">function</span> <span class="nf">FooBar</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// This is in another file : php -l would detect it right away</span>

<span class="k">class</span> <span class="nc">FooFoo</span> <span class="k">extends</span> <span class="nx">Foo</span> <span class="p">{</span>
    <span class="c1">// The method is not defined.</span>
    <span class="c1">// The class must be abstract, just like Foo</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/abstract">Class Abstraction</a>.</p>
<div class="section" id="id31">
<h3>9.11.1. Suggestions<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Implements all the abstract methods of the class</li>
<li>Make the class abstract</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/AbstractOrImplements</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-classes-abstractorimplements"><span class="std std-ref">Zurmo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="abstract-static-methods">
<span id="id32"></span><h2>9.12. Abstract Static Methods<a class="headerlink" href="#abstract-static-methods" title="Permalink to this headline">¶</a></h2>
<p>Methods cannot be both abstract and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>. <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> methods belong to a class, and will not be overridden by the child class. For normal methods, PHP will start at the object level, then go up the hierarchy to find the method. With <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>, it is necessary to mention the name, or use Late <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> Binding, with <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>. Hence, it is useless to have an abstract <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method : it should be a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method.</p>
<p>A child class is able to declare a method with the same name than a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method in the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a>, but those two methods will stay independent.</p>
<p>This is not the case anymore in PHP 7.0+.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// This is not possible</span>
    <span class="k">static</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Why does PHP 5.2+ disallow abstract `static</a> class methods? &lt;<a class="reference external" href="https://stackoverflow.com/questions/999066/why-does-php-5-2-disallow-abstract">https://stackoverflow.com/questions/999066/why-does-php-5-2-disallow-abstract</a>-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>-class-methods&gt;`_.</p>
<div class="section" id="id43">
<h3>9.12.1. Suggestions<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove abstract keyword from the method</li>
<li>Remove static keyword from the method</li>
<li>Remove the method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/AbstractStatic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="access-protected-structures">
<span id="id44"></span><h2>9.13. Access Protected Structures<a class="headerlink" href="#access-protected-structures" title="Permalink to this headline">¶</a></h2>
<p>It is not allowed to access protected properties or methods from outside the class or its relatives.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.visibility.php">Visibility</a> and <a class="reference external" href="https://torquemag.io/2016/05/understanding-concept-visibility-object-oriented-php/">Understanding The Concept Of Visibility In Object Oriented PHP</a>.</p>
<div class="section" id="id45">
<h3>9.13.1. Suggestions<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change ‘protected’ to ‘public’ to relax the constraint</li>
<li>Add a getter method to reach the target value</li>
<li>Remove the access to the protected value and find it another way</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/AccessProtected</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="accessing-private">
<span id="id46"></span><h2>9.14. Accessing Private<a class="headerlink" href="#accessing-private" title="Permalink to this headline">¶</a></h2>
<p>List of calls to private properties/methods that will compile but yield some fatal error upon execution.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">b</span> <span class="k">extends</span> <span class="nx">a</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">c</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/AccessPrivate</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="add-default-value">
<span id="id47"></span><h2>9.15. Add Default Value<a class="headerlink" href="#add-default-value" title="Permalink to this headline">¶</a></h2>
<p>Parameter in methods definition may receive a default value. This allows the called method to set a value when the parameter is omitted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_integer</span><span class="p">(</span><span class="nv">$i</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php">Function arguments</a>.</p>
<div class="section" id="id48">
<h3>9.15.1. Suggestions<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a default value for parameters</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/AddDefaultValue</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-functions-adddefaultvalue"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#typo3-functions-adddefaultvalue"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="adding-zero">
<span id="id49"></span><h2>9.16. Adding Zero<a class="headerlink" href="#adding-zero" title="Permalink to this headline">¶</a></h2>
<p>Adding 0 is useless, as 0 is the neutral element for addition. Besides, when one of the argument is an integer, PHP triggers a cast to integer.</p>
<p>It is recommended to make the cast explicit with <code class="docutils literal notranslate"><span class="pre">(int)</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Explicit cast</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Useless addition</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">()</span> <span class="o">+</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">+</span> <span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Also works with minus</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">-</span> <span class="nv">$c</span><span class="p">;</span> <span class="c1">// drop the 0, but keep the minus</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nv">$c</span> <span class="o">-</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// drop the 0 and the minus</span>

<span class="nv">$a</span> <span class="o">+=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">-=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Adding zero is also reported when the zero is a defined constants.</p>
<p>If it is used to type cast a value to integer, then casting with <code class="docutils literal notranslate"><span class="pre">(int)</span></code> is clearer.</p>
<div class="section" id="id50">
<h3>9.16.1. Suggestions<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the +/- 0, may be the whole assignation</li>
<li>Use an explicit type casting operator (int)</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/AddZero</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-useless-math.md">no-useless-math</a></td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thelia-structures-addzero"><span class="std std-ref">Thelia</span></a>, <a class="reference internal" href="Cases.html#openemr-structures-addzero"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="aliases-usage">
<span id="id51"></span><h2>9.17. Aliases Usage<a class="headerlink" href="#aliases-usage" title="Permalink to this headline">¶</a></h2>
<p>PHP manual recommends to avoid function aliases.</p>
<p>Some functions have several names, and both may be used the same way. However, one of the names is the main name, and the others are aliases. Aliases may be removed or change or dropped in the future. Even if this is not forecast, it is good practice to use the main name, instead of the aliases.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// official way to count an array</span>
<span class="nv">$n</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// official way to count an array</span>
<span class="nv">$n</span> <span class="o">=</span> <span class="nb">sizeof</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Aliases are compiled in PHP, and do not provide any performances over the normal function.</p>
<p>Aliases are more likely to be removed later, but they have been around for a long time.</p>
<p>See documentation : <a class="reference external" href="https://www.php.net/manual/en/aliases.php">List of function aliases</a>.</p>
<div class="section" id="id52">
<h3>9.17.1. Suggestions<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use PHP recommended functions</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/AliasesUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-aliases.md">no-aliases</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#cleverstyle-functions-aliasesusage"><span class="std std-ref">Cleverstyle</span></a>, <a class="reference internal" href="Cases.html#phpmyadmin-functions-aliasesusage"><span class="std std-ref">phpMyAdmin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="all-uppercase-variables">
<span id="id53"></span><h2>9.18. All Uppercase Variables<a class="headerlink" href="#all-uppercase-variables" title="Permalink to this headline">¶</a></h2>
<p>Usually, global variables are all in uppercase, so as to differentiate them easily. Though, this is not always the case, with examples like $argc, $argv or $http_response_header.</p>
<p>When using custom variables, try to use lowercase <code class="docutils literal notranslate"><span class="pre">$variables</span></code>, <code class="docutils literal notranslate"><span class="pre">$camelCase</span></code>, <code class="docutils literal notranslate"><span class="pre">$sturdyCase</span></code> or <code class="docutils literal notranslate"><span class="pre">$snake_case</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP super global, also identified by the initial _</span>
<span class="nv">$localVariable</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">;</span>

<span class="c1">// PHP globals</span>
<span class="nv">$localVariable</span> <span class="o">=</span> <span class="nv">$GLOBALS</span><span class="p">[</span><span class="s1">&#39;HTTPS&#39;</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.php">Predefined Variables</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/VariableUppercase</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="already-parents-interface">
<span id="id54"></span><h2>9.19. Already Parents Interface<a class="headerlink" href="#already-parents-interface" title="Permalink to this headline">¶</a></h2>
<p>The same interface is implemented by a class and one of its children.</p>
<p>That way, the child doesn’t need to implement the interface, nor define its methods to be an instance of the interface.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">i</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">A</span> <span class="k">implements</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">i</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">__METHOD__</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This implements is useless.</span>
<span class="k">class</span> <span class="nc">AB</span> <span class="k">extends</span> <span class="nx">A</span> <span class="k">implements</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="c1">// No definition for function i()</span>
<span class="p">}</span>

<span class="c1">// Implements i is understated</span>
<span class="k">class</span> <span class="nc">AB</span> <span class="k">extends</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="c1">// redefinition of the i method</span>
    <span class="k">function</span> <span class="nf">i</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="no">__METHOD__</span><span class="o">.</span><span class="s1">&#39; &#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AB</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$x</span> <span class="nx">instanceof</span> <span class="nx">i</span><span class="p">);</span>
<span class="c1">// true</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AC</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$x</span> <span class="nx">instanceof</span> <span class="nx">i</span><span class="p">);</span>
<span class="c1">// true</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id55">
<h3>9.19.1. Suggestions<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Keep the implements call in the class that do implements the methods. Remove it from the children classes.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/AlreadyParentsInterface</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-interfaces-alreadyparentsinterface"><span class="std std-ref">WordPress</span></a>, <a class="reference internal" href="Cases.html#thelia-interfaces-alreadyparentsinterface"><span class="std std-ref">Thelia</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="already-parents-trait">
<span id="id56"></span><h2>9.20. Already Parents Trait<a class="headerlink" href="#already-parents-trait" title="Permalink to this headline">¶</a></h2>
<p>Trait is already used a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a>’s class or trait. There is no use to include it a second time.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">trait</span> <span class="nx">ta</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">tb</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">trait</span> <span class="nx">t1</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">ta</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">tb</span><span class="p">;</span> <span class="c1">// also used by ta</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">b</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t1</span><span class="p">;</span> <span class="c1">// also required by class c</span>
    <span class="k">use</span> <span class="nx">ta</span><span class="p">;</span> <span class="c1">// also required by trait t1</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">c</span> <span class="k">extends</span> <span class="nx">b</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.traits.php">Traits</a>.</p>
<div class="section" id="id58">
<h3>9.20.1. Suggestions<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Eliminate one of the trait request</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/AlreadyParentsTrait</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="altering-foreach-without-reference">
<span id="id59"></span><h2>9.21. Altering Foreach Without Reference<a class="headerlink" href="#altering-foreach-without-reference" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">Foreach()</a> loop that should use a reference.</p>
<p>When using a foreach loop that modifies the original source, it is recommended to use referenced variables, rather than access the original value with $source[$index].</p>
<p>Using references is then must faster, and easier to read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Using references in foreach</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$source</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Avoid foreach : use array_map</span>
<span class="nv">$source</span> <span class="o">=</span> <span class="nb">array_walk</span><span class="p">(</span><span class="nv">$source</span><span class="p">,</span> <span class="s1">&#39;newValue&#39;</span><span class="p">);</span>
    <span class="c1">// Here, $key MUST be the second argument or newValue</span>

<span class="c1">// Slow version to update the array</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$source</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$source</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newValue</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$key</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>You may also use <a class="reference external" href="https://www.php.net/array_walk">array_walk()</a> or <a class="reference external" href="https://www.php.net/array_map">array_map()</a> (when $key is not used) to avoid the use of foreach.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a>.</p>
<div class="section" id="id61">
<h3>9.21.1. Suggestions<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the reference on the modified blind variable, and avoid accessing the source array</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/AlteringForeachWithoutReference</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/use-reference-to-alter-in-foreach.md">use-reference-to-alter-in-foreach</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#contao-structures-alteringforeachwithoutreference"><span class="std std-ref">Contao</span></a>, <a class="reference internal" href="Cases.html#wordpress-structures-alteringforeachwithoutreference"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="alternative-syntax-consistence">
<span id="id62"></span><h2>9.22. Alternative Syntax Consistence<a class="headerlink" href="#alternative-syntax-consistence" title="Permalink to this headline">¶</a></h2>
<p>PHP allows for two syntax : the alternative syntax, and the classic syntax.</p>
<p>The classic syntax is almost always used. When used, the alternative syntax is used in templates.</p>
<p>This analysis reports files that are using both syntax at the same time. This is confusing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Mixing both syntax is confusing.</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="o">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$item</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">print</span> <span class="nv">$item</span> <span class="nx">elements\n</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">print</span> <span class="nv">$item</span> <span class="nx">element\n</span><span class="p">;</span>
    <span class="p">}</span>
<span class="k">endforeach</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/AlternativeConsistenceByFile</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="always-anchor-regex">
<span id="id63"></span><h2>9.23. Always Anchor Regex<a class="headerlink" href="#always-anchor-regex" title="Permalink to this headline">¶</a></h2>
<p>Unanchored regex finds the requested pattern, and leaves room for malicious content.</p>
<p>Without <code class="docutils literal notranslate"><span class="pre">^</span></code> and <code class="docutils literal notranslate"><span class="pre">$</span></code>, the regex searches for any pattern that satisfies the criteria, leaving any unused part of the string available for arbitrary content. It is recommended to use both anchor</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$birthday</span> <span class="o">=</span> <span class="nx">getSomeDate</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">);</span>

<span class="c1">// Permissive version : $birthday = &#39;1970-01-01&lt;script&gt;xss();&lt;/script&gt;&#39;;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/\d{4}-\d{2}-\d{2}/&#39;</span><span class="p">,</span> <span class="nv">$birthday</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Wrong data format for your birthday!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Restrictive version : $birthday = &#39;1970-01-01&#39;;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^\d{4}-\d{2}-\d{2}$/&#39;</span><span class="p">,</span> <span class="nv">$birthday</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Wrong data format for your birthday!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="s1">&#39;Your birthday is on &#39;</span><span class="o">.</span><span class="nv">$birthday</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that $ may be a line ending, still leaving room after it for injection.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$birthday</span> <span class="o">=</span> <span class="s1">&#39;1970-01-01&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="o">.</span><span class="s1">&#39;&lt;script&gt;xss();&lt;/script&gt;&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis reports false positive when the regex is used to search a pattern in a much larger string. Check if this rule doesn’t apply, though.</p>
<p>See also <a class="reference external" href="https://cwe.mitre.org/data/definitions/625.html">CWE-625: Permissive Regular Expression</a>.</p>
<div class="section" id="id64">
<h3>9.23.1. Suggestions<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add an anchor to the beginning and ending of the string</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/AnchorRegex</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="always-positive-comparison">
<span id="id65"></span><h2>9.24. Always Positive Comparison<a class="headerlink" href="#always-positive-comparison" title="Permalink to this headline">¶</a></h2>
<p>Some PHP native functions, such as <a class="reference external" href="https://www.php.net/count">count()</a>, <a class="reference external" href="https://www.php.net/strlen">strlen()</a>, or <a class="reference external" href="https://www.php.net/abs">abs()</a> only returns positive or null values.</p>
<p>When comparing them to 0, the following expressions are always true and should be avoided.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>

<span class="nb">var_dump</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">);</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id66">
<h3>9.24.1. Suggestions<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Compare count() to non-zero values</li>
<li>Use empty()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NeverNegative</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#magento-structures-nevernegative"><span class="std std-ref">Magento</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="always-use-function-with-array-key-exists">
<span id="id67"></span><h2>9.25. Always Use Function With array_key_exists()<a class="headerlink" href="#always-use-function-with-array-key-exists" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a> has been granted a special VM opcode, and is much faster. This applies to PHP 7.4 and more recent.</p>
<p>It requires that <a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a> is statically resolved, either with an initial <code class="docutils literal notranslate"><span class="pre">\</span></code>, or a <code class="docutils literal notranslate"><span class="pre">use</span> <span class="pre">function</span></code> expression. This doesn’t affect the global namespace.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">my</span><span class="o">/</span><span class="nx">name</span><span class="o">/</span><span class="nx">space</span><span class="p">;</span>

<span class="c1">// do not forget the &#39;function&#39; keyword, or it will apply to classes.</span>
<span class="k">use</span> <span class="k">function</span> <span class="nf">array_key_exists</span> <span class="k">as</span> <span class="nx">foo</span><span class="p">;</span> <span class="c1">// the alias is not necessary, and may be omitted.</span>

<span class="c1">// array_key_exists is aliased to foo :</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>

<span class="c1">// This call requires a fallback to global, and will be slow.</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis is related to Php/ShouldUseFunction, and is a special case, that only concerns <a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a>.</p>
<p>See also <a class="reference external" href="https://bugs.php.net/bug.php?id=76148">Add array_key_exists to the list of specialy compiled functions</a>.</p>
<div class="section" id="id70">
<h3>9.25.1. Suggestions<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the <cite>use</cite> command for arrray_key_exists(), at the beginning of the script</li>
<li>Use an initial before array_key_exists()</li>
<li>Remove the namespace</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/Php74ArrayKeyExists</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="ambiguous-array-index">
<span id="id71"></span><h2>9.26. Ambiguous Array Index<a class="headerlink" href="#ambiguous-array-index" title="Permalink to this headline">¶</a></h2>
<p>Indexes should not be defined with different types than int or string.</p>
<p>Array indices only accept integers and strings, so any other type of literal is reported. In fact, <code class="docutils literal notranslate"><span class="pre">null</span></code> is turned into an empty string, booleans are turned into an integer, and real numbers are truncated (not rounded).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span>  <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s1">&#39;1&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
      <span class="mf">1.0</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
      <span class="k">true</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">];</span>
<span class="c1">// $x only contains one element : 1 =&gt; 4</span>

<span class="c1">// Still wrong, immediate typecast to 1</span>
<span class="nv">$x</span><span class="p">[</span><span class="mf">1.0</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="nv">$x</span><span class="p">[</span><span class="k">true</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>They are indeed distinct, but may lead to confusion.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.array.php">array</a>.</p>
<div class="section" id="id72">
<h3>9.26.1. Suggestions<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Only use string or integer as key for an array.</li>
<li>Use transtyping operator (string) and (int) to make sure of the type</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/AmbiguousKeys</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#prestashop-arrays-ambiguouskeys"><span class="std std-ref">PrestaShop</span></a>, <a class="reference internal" href="Cases.html#mautic-arrays-ambiguouskeys"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="ambiguous-static">
<span id="id73"></span><h2>9.27. Ambiguous Static<a class="headerlink" href="#ambiguous-static" title="Permalink to this headline">¶</a></h2>
<p>Methods or properties with the same name, are defined <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> in one class, and not <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> in another. This is error prone, as it requires a good knowledge of the code to make it <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> or not.</p>
<p>Try to keep the methods simple and unique. Consider renaming the methods and properties to distinguish them easily. A method and a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method have probably different responsibilities.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">mixedStaticMethod</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">b</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">function</span> <span class="nf">mixedStaticMethod</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="o">/...</span> <span class="nx">a</span> <span class="nx">lot</span> <span class="nx">more</span> <span class="nx">code</span> <span class="nx">later</span> <span class="o">.../</span>

<span class="nv">$c</span><span class="o">-&gt;</span><span class="na">mixedStaticMethod</span><span class="p">();</span>
<span class="c1">// or</span>
<span class="nv">$c</span><span class="o">::</span><span class="na">mixedStaticMethod</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/AmbiguousStatic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ambiguous-visibilities">
<span id="id78"></span><h2>9.28. Ambiguous Visibilities<a class="headerlink" href="#ambiguous-visibilities" title="Permalink to this headline">¶</a></h2>
<p>The properties have the same name, but have different visibilities, across different classes.</p>
<p>While it is legit to have a property with the same name in different classes, it may easily lead to confusion. As soon as the context is need to understand if the property is accessible or not, the readability suffers.</p>
<p>It is recommended to handle the same properties in the same way across classes, even when the classes are not related.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">person</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$address</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">gangster</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$nickname</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$address</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$someone</span> <span class="o">=</span> <span class="nx">Human</span><span class="o">::</span><span class="na">load</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39;Hello, &#39;</span><span class="o">.</span><span class="nv">$someone</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id79">
<h3>9.28.1. Suggestions<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Sync visibilities for both properties, in the different classes</li>
<li>Use different names for properties with different usages</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/AmbiguousVisibilities</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#typo3-classes-ambiguousvisibilities"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="anonymous-classes">
<span id="id80"></span><h2>9.29. Anonymous Classes<a class="headerlink" href="#anonymous-classes" title="Permalink to this headline">¶</a></h2>
<p>Anonymous classes.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Anonymous class, available since PHP 7.0</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="k">class</span> <span class="err">{ </span><span class="nc">function</span> <span class="nx">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="k">echo</span> <span class="no">__METHOD__</span><span class="p">;</span> <span class="p">}</span> <span class="p">};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/Anonymous</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="argument-should-be-typehinted">
<span id="id81"></span><h2>9.30. Argument Should Be Typehinted<a class="headerlink" href="#argument-should-be-typehinted" title="Permalink to this headline">¶</a></h2>
<p>When a method expects objects as argument, those arguments should be typehinted. This way, it provides early warning that a wrong object is being sent to the method.</p>
<p>The analyzer will detect situations where a class, or the keywords ‘array’ or ‘callable’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// What are the possible classes that have a &#39;foo&#39; method?</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$bar</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/manual/en/class.closure.php">Closure</a> arguments are omitted.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">Type declarations</a>.</p>
<div class="section" id="id82">
<h3>9.30.1. Suggestions<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the typehint to the function arguments</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/ShouldBeTypehinted</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/always-typehint.md">always-typehint</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-functions-shouldbetypehinted"><span class="std std-ref">Dolphin</span></a>, <a class="reference internal" href="Cases.html#mautic-functions-shouldbetypehinted"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="array-fill-with-objects">
<span id="id83"></span><h2>9.31. Array_Fill() With Objects<a class="headerlink" href="#array-fill-with-objects" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/array_fill">array_fill()</a> fills an array with identical objects, not copies nor clones. This means that all the filled objects are a reference to the same object. Changing one of them will change any of them.</p>
<p>Make sure this is the intended effect in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="k">new</span> <span class="k">StdClass</span><span class="p">();</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="nv">$x</span><span class="p">);</span>

<span class="nv">$array</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">y</span> <span class="o">=</span> <span class="nx">Set</span> <span class="nx">in</span> <span class="nx">object</span> <span class="c1">#3;</span>

<span class="c1">// displays Set in object #3;</span>
<span class="k">echo</span> <span class="nv">$array</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">y</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This applies to <a class="reference external" href="https://www.php.net/array_pad">array_pad()</a> too. It doesn’t apply to <a class="reference external" href="https://www.php.net/array_fill_keys">array_fill_keys()</a>, as objects will be cast to a string before usage in this case.</p>
<div class="section" id="id84">
<h3>9.31.1. Suggestions<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a loop to fill in the array with cloned() objects.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ArrayFillWithObjects</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="array-merge-needs-array-of-arrays">
<span id="id85"></span><h2>9.32. Array_merge Needs Array Of Arrays<a class="headerlink" href="#array-merge-needs-array-of-arrays" title="Permalink to this headline">¶</a></h2>
<p>When collecting data to feed <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a>, use an array of array as default value. <code class="docutils literal notranslate"><span class="pre">`array(`array())</span> <span class="pre">&lt;https://www.php.net/array&gt;`_`</span></code> is the neutral value for <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a>;</p>
<p>This analysis also reports when the used types are not an array : <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a> does not accept scalar values, but only arrays.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// safe default value</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">());</span>

<span class="c1">// when $list is empty, it is</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$list</span> <span class="k">as</span> <span class="nv">$l</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$l</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Since PHP 7.4, it is possible to call <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a> without an argument : this means the default value may an empty array. This array shall not contain scalar values.</p>
<p>See also <a class="reference external" href="https://www.php.net/array_merge">array_merge</a>.</p>
<div class="section" id="id90">
<h3>9.32.1. Suggestions<a class="headerlink" href="#id90" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use <code class="docutils literal notranslate"><span class="pre">`array(array())`</span></code> or <code class="docutils literal notranslate"><span class="pre">`[[]]`</span></code> as default value for array_merge()</li>
<li>Remove any non-array value from the values in the default array</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ArrayMergeArrayArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="assert-function-is-reserved">
<span id="id91"></span><h2>9.33. Assert Function Is Reserved<a class="headerlink" href="#assert-function-is-reserved" title="Permalink to this headline">¶</a></h2>
<p>Avoid defining an <code class="docutils literal notranslate"><span class="pre">assert</span></code> function in namespaces.</p>
<p>While they work fine when the assertions are active (<code class="docutils literal notranslate"><span class="pre">zend.assertions=1</span></code>), calls to unqualified <code class="docutils literal notranslate"><span class="pre">assert</span></code> are optimized away when assertions are not active.</p>
<p>Since PHP 7.3, a fatal error is emitted : <code class="docutils literal notranslate"><span class="pre">Defining</span> <span class="pre">a</span> <span class="pre">custom</span> <span class="pre">`assert()</span> <span class="pre">&lt;https://www.php.net/assert&gt;`_</span> <span class="pre">function</span> <span class="pre">is</span> <span class="pre">deprecated,</span> <span class="pre">as</span> <span class="pre">the</span> <span class="pre">function</span> <span class="pre">has</span> <span class="pre">special</span> <span class="pre">semantics</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">//      Run this with zend.assertions=1 and</span>
<span class="c1">// Then run this with zend.assertions=0</span>

<span class="k">namespace</span> <span class="nx">Test</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">assert</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$foo</span><span class="p">;</span>

        <span class="nv">$foo</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">Test</span> <span class="p">{</span>
    <span class="nb">assert</span><span class="p">();</span>

    <span class="nb">var_dump</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$foo</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/assert">assert</a> and <a class="reference external" href="https://bugs.php.net/bug.php?id=75445">User-defined assert function is optimized away with zend.assertions=-1</a>.</p>
<div class="section" id="id92">
<h3>9.33.1. Suggestions<a class="headerlink" href="#id92" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Rename the custom function with another name</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/AssertFunctionIsReserved</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="assign-and-compare">
<span id="id93"></span><h2>9.34. Assign And Compare<a class="headerlink" href="#assign-and-compare" title="Permalink to this headline">¶</a></h2>
<p>Assignation has a lower precedence than comparison. As such, the assignation always happens after the comparison. This leads to the comparison being stored in the variable, and not the value being compared.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$id</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$needle</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $id now contains a boolean (true or false), but not the position of the $needle.</span>
<span class="p">}</span>

<span class="c1">// probably valid comparison, as $found will end up being a boolean</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$found</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$needle</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// always valid comparison, with parenthesis</span>
<span class="k">if</span> <span class="p">((</span><span class="nv">$id</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$needle</span><span class="p">))</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $id now contains a boolean (true or false), but not the position of the $needle.</span>
<span class="p">}</span>

<span class="c1">// Being a lone instruction, this is always valid : there is no double usage with if condition</span>
<span class="nv">$isFound</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$needle</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">;</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operator Precedence</a>.</p>
<div class="section" id="id94">
<h3>9.34.1. Suggestions<a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use parenthesis</li>
<li>Separate assignation and comparison</li>
<li>Drop assignation or comparison</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/AssigneAndCompare</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="assign-default-to-properties">
<span id="id95"></span><h2>9.35. Assign Default To Properties<a class="headerlink" href="#assign-default-to-properties" title="Permalink to this headline">¶</a></h2>
<p>Properties may be assigned default values at declaration time. Such values may be later modified, if needed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$propertyWithDefault</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$propertyWithoutDefault</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$propertyThatCantHaveDefault</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Skip this extra line, and give the default value above</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">propertyWithoutDefault</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="c1">// Static expressions are available to set up simple computation at definition time.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">propertyWithoutDefault</span> <span class="o">=</span> <span class="nx">OtherClass</span><span class="o">::</span><span class="na">CONSTANT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

        <span class="c1">// Arrays, just like scalars, may be set at definition time</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">propertyWithoutDefault</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>

        <span class="c1">// Objects or resources can&#39;t be made default. That is OK.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">propertyThatCantHaveDefault</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/file.txt&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">propertyThatCantHaveDefault</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Fileinfo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Default values will save some instructions in the constructor, and makes the value obvious in the code.</p>
<div class="section" id="id96">
<h3>9.35.1. Suggestions<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a default value whenever possible. This is easy for scalars, and array()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MakeDefault</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/use-properties-default-values.md">use-properties-default-values</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#livezilla-classes-makedefault"><span class="std std-ref">LiveZilla</span></a>, <a class="reference internal" href="Cases.html#phpmyadmin-classes-makedefault"><span class="std std-ref">phpMyAdmin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="assign-with-and-precedence">
<span id="id97"></span><h2>9.36. Assign With And Precedence<a class="headerlink" href="#assign-with-and-precedence" title="Permalink to this headline">¶</a></h2>
<p>The lettered logical operators yield to assignation. It may collect less information than expected.</p>
<p>It is recommended to use the &amp;&amp;, ^ and || operators, instead of and, or and xor, to prevent confusion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The expected behavior is</span>
<span class="c1">// The following are equivalent</span>
 <span class="nv">$a</span> <span class="o">=</span>  <span class="nv">$b</span>  <span class="o">&amp;&amp;</span> <span class="nv">$c</span><span class="p">;</span>
 <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">&amp;&amp;</span> <span class="nv">$c</span><span class="p">);</span>

<span class="c1">// The unexpected behavior is</span>
<span class="c1">// The following are equivalent</span>
 <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span>  <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>
<span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operator Precedence</a>.</p>
<div class="section" id="id99">
<h3>9.36.1. Suggestions<a class="headerlink" href="#id99" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use symbol &amp;&amp; rather than letter and</li>
<li>To be safe, add parenthesis to enforce priorities</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/AssignAnd</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-php-assignand"><span class="std std-ref">xataface</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="assigned-twice">
<span id="id100"></span><h2>9.37. Assigned Twice<a class="headerlink" href="#assigned-twice" title="Permalink to this headline">¶</a></h2>
<p>The same variable is assigned twice in the same function.</p>
<p>While this is possible and quite common, it is also a good practice to avoid changing a value from one literal to another. It is far better to assign the new value to</p>
<p>Incremental changes to a variables are not reported here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// incremental changes of $a;</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nx">uppercase</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

    <span class="nv">$b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="nx">bar</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
    <span class="c1">// B changed its purpose. Why not call it $d?</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

    <span class="c1">// This is some forgotten debug</span>
    <span class="nv">$e</span> <span class="o">=</span> <span class="nv">$config</span><span class="o">-&gt;</span><span class="na">getSomeList</span><span class="p">();</span>
    <span class="nv">$e</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;OneElement&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/AssignedTwiceOrMore</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="assumptions">
<span id="id101"></span><h2>9.38. Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h2>
<p>Assumptions in the code, that leads to possible bugs.</p>
<p>Some conditions may be very weak, and lead to errors. For example, the code below checks that the variable <cite>$a</cite> is not null, then uses it as an array. There is no relationship between ‘not null’ and ‘being an array’, so this is an assumption.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Assumption : if $a is not null, then it is an array. This is not always the case.</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Assumption : if $a is not null, then it is an array. Here, the typehint will ensure that it is the case.</span>
<span class="c1">// Although, a more readable test is is_array()</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">?</span><span class="k">array</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://rskuipers.com/entry/from-assumptions-to-assertions">From assumptions to assertions</a>.</p>
<div class="section" id="id102">
<h3>9.38.1. Suggestions<a class="headerlink" href="#id102" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Assumptions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="autoappend">
<span id="id103"></span><h2>9.39. Autoappend<a class="headerlink" href="#autoappend" title="Permalink to this headline">¶</a></h2>
<p>Appending a variable to itself leads to enormous usage of memory.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Always append a value to a distinct variable</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$c</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// This copies the array to itself, and double the size each loop</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$c</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$c</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id104">
<h3>9.39.1. Suggestions<a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the variable in the append, on the left</li>
<li>Change the variable in the append, on the right</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/Autoappend</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-concat-in-loop">
<span id="id105"></span><h2>9.40. Avoid Concat In Loop<a class="headerlink" href="#avoid-concat-in-loop" title="Permalink to this headline">¶</a></h2>
<p>Concatenations inside a loop generate a lot of temporary variables. They are accumulated and tend to raise the memory usage, leading to slower performances.</p>
<p>It is recommended to store the values in an array, and then use <a class="reference external" href="https://www.php.net/implode">implode()</a> on that array to make the concatenation at once. The effect is positive when the source array has at least 50 elements.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Concatenation in one operation</span>
<span class="nv">$tmp</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span><span class="p">(</span><span class="nx">data_source</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$tmp</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$final</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$tmp</span><span class="p">);</span>

<span class="c1">// Concatenation in many operations</span>
<span class="k">foreach</span><span class="p">(</span><span class="nx">data_source</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$final</span> <span class="o">.=</span> <span class="nv">$data</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The same doesn’t apply to addition and multiplication, with <a class="reference external" href="https://www.php.net/array_sum">array_sum()</a> and array_multiply(), as those operations work on the current memory allocation, and don’t need to allocate new memory at each step.</p>
<p>See also <a class="reference external" href="https://blog.blackfire.io/php-7-performance-improvements-encapsed-strings-optimization.html">PHP 7 performance improvements (3/5): Encapsed strings optimization</a>.</p>
<div class="section" id="id106">
<h3>9.40.1. Suggestions<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Collect all pieces in an array, then implode() the array in one call.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/NoConcatInLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#suitecrm-performances-noconcatinloop"><span class="std std-ref">SuiteCrm</span></a>, <a class="reference internal" href="Cases.html#thinkphp-performances-noconcatinloop"><span class="std std-ref">ThinkPHP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-large-array-assignation">
<span id="id107"></span><h2>9.41. Avoid Large Array Assignation<a class="headerlink" href="#avoid-large-array-assignation" title="Permalink to this headline">¶</a></h2>
<p>Avoid setting large arrays to local variables. This is done every time the function is called.</p>
<p>There are different ways to avoid this : inject the array, build the array once. Using an constant or even a global variable is faster.</p>
<p>The effect on small arrays (less than 10 elements) is not significant. Arrays with 10 elements or more are reported here. The effect is also more important on functions that are called often, or within loops.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// with constants, for functions</span>
<span class="k">const</span> <span class="no">ARRAY</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$array</span> <span class="o">=</span> <span class="k">ARRAY</span><span class="p">;</span>
    <span class="c1">//more code</span>
<span class="p">}</span>

<span class="c1">// with class constants, for methods</span>
<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">ARRAY</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$array</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">ARRAY</span><span class="p">;</span>
        <span class="c1">//more code</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// with properties, for methods</span>
<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$array</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">array</span><span class="p">;</span>
        <span class="c1">//more code</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// injection, leveraging default values</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">//more code</span>
<span class="p">}</span>

<span class="c1">// local cache with static</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">static</span> <span class="nv">$array</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$array</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">//more code</span>
<span class="p">}</span>

<span class="c1">// Avoid creating the same array all the time in a function</span>
<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// assign to non local variable is OK.</span>
        <span class="c1">// Here, to a property, though it may be better in a __construct or as default values</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">s</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>

        <span class="c1">// This is wasting resources, as it is done each time.</span>
        <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id108">
<h3>9.41.1. Suggestions<a class="headerlink" href="#id108" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the literal a global constant or a class constant</li>
<li>Make the literal an argument, so it is injected</li>
<li>Make the literal an property, with it as default value</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoAssignationInFunction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-optional-properties">
<span id="id109"></span><h2>9.42. Avoid Optional Properties<a class="headerlink" href="#avoid-optional-properties" title="Permalink to this headline">¶</a></h2>
<p>Avoid optional properties, to prevent littering the code with existence checks.</p>
<p>When a property has to be checked once for existence, it is safer to check it each time. This leads to a decrease in readability and a lot of checks added to the code.</p>
<p>Either make sure the property is set with an actual object rather than with null, or use a null object. A null object offers the same interface than the expected object, but does nothing. It allows calling its methods, without running into a Fatal error, nor testing it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Example is courtesy &#39;The Coding Machine&#39; : it has been adapted from its original form. See link below.</span>

<span class="k">class</span> <span class="nc">MyMailer</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$logger</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">LoggerInterface</span> <span class="nv">$logger</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span> <span class="o">=</span> <span class="nv">$logger</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">sendMail</span><span class="p">(</span><span class="nx">Mail</span> <span class="nv">$mail</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Since $this-&gt;logger may be null, it must be tested anytime it is used.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">logger</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;Mail successfully sent.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://bestpractices.thecodingmachine.com/php/design_beautiful_classes_and_methods.html#avoid-optional-services-as-much-as-possible">Avoid optional services as much as possible</a>, <a class="reference external" href="https://www.sitepoint.com/the-null-object-pattern-polymorphism-in-domain-models/">The Null Object Pattern – Polymorphism in Domain Models</a>, and <a class="reference external" href="https://dzone.com/articles/practical-php-refactoring-26">Practical PHP Refactoring: Introduce Null Object</a>.</p>
<div class="section" id="id110">
<h3>9.42.1. Suggestions<a class="headerlink" href="#id110" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a null object to fill any missing value</li>
<li>Make sure the property is set at constructor time</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/AvoidOptionalProperties</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-classes-avoidoptionalproperties"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#dolibarr-classes-avoidoptionalproperties"><span class="std std-ref">Dolibarr</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-parenthesis">
<span id="id111"></span><h2>9.43. Avoid Parenthesis<a class="headerlink" href="#avoid-parenthesis" title="Permalink to this headline">¶</a></h2>
<p>Avoid Parenthesis for language construct. Languages constructs are a few PHP native elements, that looks like functions but are not.</p>
<p>Among other distinction, those elements cannot be directly used as variable function call, and they may be used with or without parenthesis.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// normal usage of include</span>
<span class="k">include</span> <span class="s1">&#39;file.php&#39;</span><span class="p">;</span>

<span class="c1">// This looks like a function and is not</span>
<span class="k">include</span><span class="p">(</span><span class="s1">&#39;file2.php&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The usage of parenthesis actually give some feeling of comfort, it won’t prevent PHP from combining those argument with any later operators, leading to unexpected results.</p>
<p>Even if most of the time, usage of parenthesis is legit, it is recommended to avoid them.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PrintWithoutParenthesis</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="avoid-real">
<span id="id112"></span><h2>9.44. Avoid Real<a class="headerlink" href="#avoid-real" title="Permalink to this headline">¶</a></h2>
<p>PHP has two float data type : real and double. <code class="docutils literal notranslate"><span class="pre">real</span></code> is rarely used, and might be deprecated in PHP 7.4.</p>
<p>To prepare code, avoid using <a class="reference external" href="https://www.php.net/is_real">is_real()</a> and the <code class="docutils literal notranslate"><span class="pre">(real)</span></code> typecast.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// safe way to check for float</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_float</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">float</span><span class="p">)</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Avoid doing that</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_real</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">real</span><span class="p">)</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_4">PHP RFC: Deprecations for PHP 7.4</a>.</p>
<div class="section" id="id113">
<h3>9.44.1. Suggestions<a class="headerlink" href="#id113" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace is_real() by is_float()</li>
<li>Replace (real) by (float)</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/AvoidReal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-self-in-interface">
<span id="id114"></span><h2>9.45. Avoid Self In Interface<a class="headerlink" href="#avoid-self-in-interface" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">Self</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">Parent</a> are tricky when used in an interface.</p>
<p><code class="docutils literal notranslate"><span class="pre">self</span></code> refers to the current interface or its extended parents : as long as the constant is defined in the interface family, this is valid.  On the other hand, when <code class="docutils literal notranslate"><span class="pre">self</span></code> refers to the current class, the resolution of names will happen at execution time, leading to confusing results.</p>
<p><code class="docutils literal notranslate"><span class="pre">parent</span></code> has the same behavior than <code class="docutils literal notranslate"><span class="pre">self</span></code>, except that it doesn’t accept to be used inside an interface, as it will yield an error. This is one of those error that lint but won’t execute in certain conditions.</p>
<p><code class="docutils literal notranslate"><span class="pre">Static</span></code> can’t be used in an interface, as it needs to be resolved at call time anyway.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="k">extends</span> <span class="nx">ii</span> <span class="p">{</span>
    <span class="c1">// This &#39;self&#39; is valid : it refers to the interface i</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">I</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">I2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

    <span class="c1">// This &#39;self&#39; is also valid, as it refers to interface ii, which is a part of interface i</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">I2</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">IP</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>

    <span class="c1">// This makes interface i dependant on the host class</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">I3</span> <span class="o">=</span> <span class="k">parent</span><span class="o">::</span><span class="na">A</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">Scope Resolution Operator (::)</a>.</p>
<div class="section" id="id117">
<h3>9.45.1. Suggestions<a class="headerlink" href="#id117" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a fully qualified namespace instead of self</li>
<li>Use a locally defined constant, so self is a valid reference</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/AvoidSelfInInterface</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-substr-one">
<span id="id118"></span><h2>9.46. Avoid Substr() One<a class="headerlink" href="#avoid-substr-one" title="Permalink to this headline">¶</a></h2>
<p>Use array notation <code class="docutils literal notranslate"><span class="pre">$string[$position]</span></code> to reach a single byte in a string.</p>
<p>There are two ways to access a byte in a string : <a class="reference external" href="https://www.php.net/substr">substr()</a> and <code class="docutils literal notranslate"><span class="pre">$v[$pos]</span></code>.</p>
<p>The second style is more readable. It may be up to four times faster, though it is a micro-optimization. It is recommended to use it.</p>
<p>PHP 7.1 also introduces the support of negative offsets as string index : negative offset are also reported.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;ab人cde&#39;</span><span class="p">;</span>

<span class="k">echo</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$string</span><span class="p">[</span><span class="nv">$pos</span><span class="p">];</span>

<span class="k">echo</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// when $pos = 1</span>
<span class="c1">// displays bbb</span>
<span class="c1">// when $pos = 2</span>
<span class="c1">// displays ??人</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Beware that <a class="reference external" href="https://www.php.net/substr">substr()</a> and <code class="docutils literal notranslate"><span class="pre">$v[$pos]</span></code> are similar, while <a class="reference external" href="https://www.php.net/mb_substr">mb_substr()</a> is not. The first function works on bytes, while the latter works on characters.</p>
<div class="section" id="id120">
<h3>9.46.1. Suggestions<a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace substr() with the array notations for strings.</li>
<li>Replace substr() with a call to mb_substr().</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoSubstrOne</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-structures-nosubstrone"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#livezilla-structures-nosubstrone"><span class="std std-ref">LiveZilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-those-hash-functions">
<span id="id121"></span><h2>9.47. Avoid Those Hash Functions<a class="headerlink" href="#avoid-those-hash-functions" title="Permalink to this headline">¶</a></h2>
<p>The following cryptography algorithms are considered insecure, and should be replaced with new and more performant algorithms.</p>
<p><code class="docutils literal notranslate"><span class="pre">MD2</span></code>, <code class="docutils literal notranslate"><span class="pre">MD4</span></code>, <code class="docutils literal notranslate"><span class="pre">MD5</span></code>, <code class="docutils literal notranslate"><span class="pre">SHA0</span></code>, <code class="docutils literal notranslate"><span class="pre">SHA1</span></code>, <code class="docutils literal notranslate"><span class="pre">CRC</span></code>, <code class="docutils literal notranslate"><span class="pre">DES</span></code>, <code class="docutils literal notranslate"><span class="pre">3DES</span></code>, <code class="docutils literal notranslate"><span class="pre">RC2</span></code>, <code class="docutils literal notranslate"><span class="pre">RC4</span></code>.</p>
<p>When possible, avoid using them, may it be as PHP functions, or hashing function configurations (mcrypt, hash…).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Weak cryptographic algorithm</span>
<span class="k">echo</span> <span class="nb">md5</span><span class="p">(</span><span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="c1">// Weak crypotgraphic algorthim, used with a modern PHP extension (easier to update)</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="c1">// Strong crypotgraphic algorthim, used with a modern PHP extension</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha156&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Weak cryptography is commonly used for hashing values when caching them. In such cases, security is not a primary concern. However, it may later become such, when hackers get access to the cache folders, or if the cached identifier is published. As a preventive protection, it is recommended to always use a secure hashing function.</p>
<p>See also <a class="reference external" href="https://en.wikipedia.org/wiki/Secure_Hash_Algorithms">Secure Hash Algorithms</a>.</p>
<div class="section" id="id122">
<h3>9.47.1. Suggestions<a class="headerlink" href="#id122" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Keep the current crypto, and add a call to a stronger one.</li>
<li>Change the crypto for a more modern one and update the related databases</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/AvoidThoseCrypto</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-using-stdclass">
<span id="id123"></span><h2>9.48. Avoid Using stdClass<a class="headerlink" href="#avoid-using-stdclass" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">stdClass</span></code> is the default class for PHP. It is instantiated when PHP needs to return a object, but no class is specifically available.</p>
<p>It is recommended to avoid instantiating this class, nor use it is any way.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$json</span> <span class="o">=</span> <span class="s1">&#39;{a:1,b:2,c:3}&#39;</span><span class="p">;</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">);</span>
<span class="c1">// $object is a stdClass, as returned by json_decode</span>

<span class="c1">// Fast building of $o</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">json_encode</span><span class="p">(</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="nv">$a</span><span class="p">);</span>

<span class="c1">// Slow building of $o</span>
<span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">();</span>
<span class="nv">$o</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$o</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$o</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">json_encode</span><span class="p">(</span><span class="nv">$o</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>If you need a <code class="docutils literal notranslate"><span class="pre">stdClass</span></code> object, it is faster to build it as an array, then cast it, than instantiate <code class="docutils literal notranslate"><span class="pre">stdClass</span></code>. This is a micro-optimisation.</p>
<div class="section" id="id124">
<h3>9.48.1. Suggestions<a class="headerlink" href="#id124" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create a custom class to handle the properties</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseStdclass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-array-push">
<span id="id125"></span><h2>9.49. Avoid array_push()<a class="headerlink" href="#avoid-array-push" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/array_push">array_push()</a> is slower than the [] operator.</p>
<p>This is also true if the [] operator is called several times, while <a class="reference external" href="https://www.php.net/array_push">array_push()</a> may be called only once.
And using count after the push is also faster than collecting <a class="reference external" href="https://www.php.net/array_push">array_push()</a> return value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
<span class="c1">// Fast version</span>
<span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="nv">$count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="c1">// Slow version</span>
<span class="nb">array_push</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="nv">$count</span> <span class="o">=</span> <span class="nb">array_push</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">);</span>

<span class="c1">// Multiple version :</span>
<span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">array_push</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is a micro-optimisation.</p>
<div class="section" id="id128">
<h3>9.49.1. Suggestions<a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the [] operator</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/AvoidArrayPush</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-array-unique">
<span id="id129"></span><h2>9.50. Avoid array_unique()<a class="headerlink" href="#avoid-array-unique" title="Permalink to this headline">¶</a></h2>
<p>The native function <a class="reference external" href="https://www.php.net/array_unique">array_unique()</a> is much slower than using other alternatives, such as <a class="reference external" href="https://www.php.net/array_count_values">array_count_values()</a>, <a class="reference external" href="https://www.php.net/array_flip">array_flip()</a>/<a class="reference external" href="https://www.php.net/array_keys">array_keys()</a>, or even a <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> loops.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// using array_unique()</span>
<span class="nv">$uniques</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nv">$someValues</span><span class="p">);</span>

<span class="c1">// When values are strings or integers</span>
<span class="nv">$uniques</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nb">array_count_values</span><span class="p">(</span><span class="nv">$someValues</span><span class="p">));</span>
<span class="nv">$uniques</span> <span class="o">=</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nb">array_flip</span><span class="p">(</span><span class="nv">$someValues</span><span class="p">))</span>

<span class="c1">//even some loops are faster.</span>
<span class="nv">$uniques</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$someValues</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$uniques</span><span class="p">,</span> <span class="nv">$s</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$uniques</span><span class="p">[]</span> <span class="nv">$s</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/array_unique">array_unique</a>.</p>
<div class="section" id="id132">
<h3>9.50.1. Suggestions<a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Upgrade to PHP 7.2</li>
<li>Use an alternative way to make values unique in an array, using array_count_values(), for example.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoArrayUnique</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.2-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-get-class">
<span id="id133"></span><h2>9.51. Avoid get_class()<a class="headerlink" href="#avoid-get-class" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">get_class()</span></code> should be replaced with the <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> operator to check the class of an object.</p>
<p><code class="docutils literal notranslate"><span class="pre">get_class()</span></code> only compares the full namespace name of the object’s class, while <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> actually resolves the name, using the local namespace and aliases.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="k">use</span> <span class="k">Stdclass</span> <span class="k">as</span> <span class="nx">baseClass</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Slow and prone to namespace errors</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">get_class</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;Stdclass&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// doSomething()</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Faster, and uses aliases.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$arg</span> <span class="nx">instanceof</span> <span class="nx">baseClass</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// doSomething()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/get_class">get_class</a> and <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">Instanceof</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UseInstanceof</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="avoid-glob-usage">
<span id="id134"></span><h2>9.52. Avoid glob() Usage<a class="headerlink" href="#avoid-glob-usage" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/glob">glob()</a> and <a class="reference external" href="https://www.php.net/scandir">scandir()</a> sorts results by default. When that kind of sorting is not needed, save some time by requesting <code class="docutils literal notranslate"><span class="pre">NOSORT</span></code> with those functions.</p>
<p>Besides, whenever possible, use <a class="reference external" href="https://www.php.net/scandir">scandir()</a> instead of <a class="reference external" href="https://www.php.net/glob">glob()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Scandir without sorting is the fastest.</span>
<span class="nb">scandir</span><span class="p">(</span><span class="s1">&#39;docs/&#39;</span><span class="p">,</span> <span class="nx">SCANDIR_SORT_NONE</span><span class="p">);</span>

<span class="c1">// Scandir sorts files by default. Same as above, but with sorting</span>
<span class="nb">scandir</span><span class="p">(</span><span class="s1">&#39;docs/&#39;</span><span class="p">);</span>

<span class="c1">// glob sorts files by default. Same as below, but no sorting</span>
<span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;docs/*&#39;</span><span class="p">,</span> <span class="nx">GLOB_NOSORT</span><span class="p">);</span>

<span class="c1">// glob sorts files by default. This is the slowest version</span>
<span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;docs/*&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Using <a class="reference external" href="https://www.php.net/opendir">opendir()</a> and a while loop may be even faster.</p>
<p>This analysis skips <a class="reference external" href="https://www.php.net/scandir">scandir()</a> and <a class="reference external" href="https://www.php.net/glob">glob()</a> if they are expliciely configured with flags (aka, sorting is explicitly needed).</p>
<p><a class="reference external" href="https://www.php.net/glob">glob()</a> accepts wildchar, such as <code class="docutils literal notranslate"><span class="pre">*</span></code>, that may not easily replaced with <a class="reference external" href="https://www.php.net/scandir">scandir()</a> or <a class="reference external" href="https://www.php.net/opendir">opendir()</a>.</p>
<p>See also <a class="reference external" href="https://www.phparch.com/2010/04/putting-glob-to-the-test/">Putting glob to the test</a>, <a class="reference external" href="https://dev.to/bdelespierre/how-to-list-files-recursively-in-a-directory-with-php-iterators-5c0m">How to list files recursively in a directory with PHP iterators</a> and <a class="reference external" href="https://www.php.net/manual/en/wrappers.glob.php">glob://</a>.</p>
<div class="section" id="id143">
<h3>9.52.1. Suggestions<a class="headerlink" href="#id143" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use FilesystemIterator, DirectoryIterator classes.</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">RegexIterator</span></code> to filter any unwanted results from <code class="docutils literal notranslate"><span class="pre">FilesystemIterator</span></code>.</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">glob</span></code> protocol for files : $it = new DirectoryIterator(‘glob://path/to/examples/<a href="#id144"><span class="problematic" id="id145">*</span></a>.php’);</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/NoGlob</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phinx-performances-noglob"><span class="std std-ref">Phinx</span></a>, <a class="reference internal" href="Cases.html#nextcloud-performances-noglob"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-mb-dectect-encoding">
<span id="id146"></span><h2>9.53. Avoid mb_dectect_encoding()<a class="headerlink" href="#avoid-mb-dectect-encoding" title="Permalink to this headline">¶</a></h2>
<p>mb_dectect_encoding() is bad at guessing encoding.</p>
<p>For example, UTF-8 and ISO-8859-1 share some common characters : when a string is build with them it is impossible to differentiate the actual encoding.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$encoding</span> <span class="o">=</span> <span class="nx">mb_encoding_detect</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://php.net/mb-encoding-detect">mb_encoding_detect</a>, <a class="reference external" href="https://www.daganhenderson.com/blog/2013/07/php-encoding-character-sets">PHP vs. The Developer: Encoding Character Sets</a>, <a class="reference external" href="https://youtu.be/K2zS6vbBb9A?t=1375">DPC2019: Of representation and interpretation: A unified theory - Arnout Boks</a>.</p>
<div class="section" id="id147">
<h3>9.53.1. Suggestions<a class="headerlink" href="#id147" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Store and transmit the data format</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/AvoidMbDectectEncoding</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-option-arrays-in-constructors">
<span id="id148"></span><h2>9.54. Avoid option arrays in constructors<a class="headerlink" href="#avoid-option-arrays-in-constructors" title="Permalink to this headline">¶</a></h2>
<p>Avoid option arrays in constructors. Use one parameter per injected element.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="c1">// Distinct arguments, all typehinted if possible</span>
    <span class="k">function</span> <span class="nf">__constructor</span><span class="p">(</span><span class="nx">A</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">B</span> <span class="nv">$b</span><span class="p">,</span> <span class="nx">C</span> <span class="nv">$c</span><span class="p">,</span> <span class="nx">D</span> <span class="nv">$d</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">=</span> <span class="nv">$c</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">d</span> <span class="o">=</span> <span class="nv">$d</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="c1">// One argument, spread over several properties</span>
    <span class="k">function</span> <span class="nf">__constructor</span><span class="p">(</span><span class="k">array</span> <span class="nv">$options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">d</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://bestpractices.thecodingmachine.com/php/design_beautiful_classes_and_methods.html#avoid-option-arrays-in-constructors">Avoid option arrays in constructors</a> and <a class="reference external" href="https://wiki.php.net/rfc/named_params#type-safe_and_documented_options">PHP RFC: Named Arguments (Type-safe and documented options)</a>.</p>
<div class="section" id="id150">
<h3>9.54.1. Suggestions<a class="headerlink" href="#id150" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Spread the options in the argument list, one argument each</li>
<li>Use a configuration class, that hold all the elements with clear names, instead of an array</li>
<li>Use named parameters to pass and document the arguments</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/AvoidOptionArrays</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-set-error-handler-context-argument">
<span id="id151"></span><h2>9.55. Avoid set_error_handler $context Argument<a class="headerlink" href="#avoid-set-error-handler-context-argument" title="Permalink to this headline">¶</a></h2>
<p>Avoid configuring <a class="reference external" href="https://www.php.net/set_error_handler">set_error_handler()</a> with a method that accepts 5 arguments. The last argument, <code class="docutils literal notranslate"><span class="pre">$errcontext</span></code>, is deprecated since PHP 7.2, and will be removed later.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// setting error_handler with an incorrect closure</span>
<span class="nb">set_error_handler</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="nv">$errfile</span><span class="p">,</span> <span class="nv">$errline</span><span class="p">)</span> <span class="p">{});</span>

<span class="c1">// setting error_handler with an incorrect closure</span>
<span class="nb">set_error_handler</span><span class="p">(</span><span class="k">function</span><span class="p">(</span><span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="nv">$errfile</span><span class="p">,</span> <span class="nv">$errline</span><span class="p">,</span> <span class="nv">$errcontext</span><span class="p">)</span> <span class="p">{});</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/set_error_handler">set_error_handler()</a>;</p>
<div class="section" id="id153">
<h3>9.55.1. Suggestions<a class="headerlink" href="#id153" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the 6th argument of registered handlers.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/AvoidSetErrorHandlerContextArg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#shopware-php-avoidseterrorhandlercontextarg"><span class="std std-ref">shopware</span></a>, <a class="reference internal" href="Cases.html#vanilla-php-avoidseterrorhandlercontextarg"><span class="std std-ref">Vanilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="avoid-sleep-usleep">
<span id="id154"></span><h2>9.56. Avoid sleep()/usleep()<a class="headerlink" href="#avoid-sleep-usleep" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/sleep">sleep()</a> and <a class="reference external" href="https://www.php.net/usleep">usleep()</a> help saturate the web server.</p>
<p>Pausing the script for a specific amount of time means that the Web server is also making all related resources sleep, such as database, sockets, session, etc. This may used to set up a DOS on the server.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$begin</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nx">checkLogin</span><span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$password</span><span class="p">);</span>
<span class="nv">$end</span>   <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

<span class="c1">// Making all login checks looks the same</span>
<span class="nb">usleep</span><span class="p">(</span><span class="mi">1000000</span> <span class="o">-</span> <span class="p">(</span><span class="nv">$end</span> <span class="o">-</span> <span class="nv">$begin</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000000</span><span class="p">);</span>

<span class="c1">// Any hit on this page now uses 1 second, no matter if load is high or not</span>
<span class="c1">// Is it now possible to saturate the webserver in 1 s ?</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>As much as possible, avoid delaying the end of the script.</p>
<p><a class="reference external" href="https://www.php.net/sleep">sleep()</a> and <a class="reference external" href="https://www.php.net/usleep">usleep()</a> have less impact in commandline (<code class="docutils literal notranslate"><span class="pre">CLI</span></code>).</p>
<div class="section" id="id157">
<h3>9.56.1. Suggestions<a class="headerlink" href="#id157" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a deadline of usage in the session, and wait past this deadline to start serving again. Until then, abort immediately.</li>
<li>Use element in the GUI to delay or slow usage.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/NoSleep</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="bad-constants-names">
<span id="id158"></span><h2>9.57. Bad Constants Names<a class="headerlink" href="#bad-constants-names" title="Permalink to this headline">¶</a></h2>
<p>PHP’s manual recommends that developer do not use constants with the convention <code class="docutils literal notranslate"><span class="pre">__NAME__</span></code>. Those are reserved for PHP future use.</p>
<p>For example, <code class="docutils literal notranslate"><span class="pre">__TRAIT__</span></code> recently appeared in PHP, as a magic constant. In the future, other may appear.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">const</span> <span class="no">__MY_APP_CONST__</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">const</span> <span class="no">__MY_APP_CONST__</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;__MY_OTHER_APP_CONST__&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The analyzer will report any constant which name is <code class="docutils literal notranslate"><span class="pre">__.*.__</span></code>, or even <code class="docutils literal notranslate"><span class="pre">_.*_</span></code> (only one underscore).</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.constants.php">Constants</a>.</p>
<div class="section" id="id159">
<h3>9.57.1. Suggestions<a class="headerlink" href="#id159" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using names that doesn’t comply with PHP’s convention</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/BadConstantnames</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#prestashop-constants-badconstantnames"><span class="std std-ref">PrestaShop</span></a>, <a class="reference internal" href="Cases.html#zencart-constants-badconstantnames"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="bad-typehint-relay">
<span id="id160"></span><h2>9.58. Bad Typehint Relay<a class="headerlink" href="#bad-typehint-relay" title="Permalink to this headline">¶</a></h2>
<p>A bad typehint relay happens where a type hinted argument is relayed to a parameter with another typehint. This will lead to a Fatal error, and stop the code. This is possibly a piece of dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// the $i argument is relayed to bar, which is expecting a string.</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$i</span><span class="p">)</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">bar</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// the return value for the bar function is not compatible with the one from foo;</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$s</span><span class="p">)</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$string</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to harmonize the typehints, so the two methods are compatible.</p>
<div class="section" id="id161">
<h3>9.58.1. Suggestions<a class="headerlink" href="#id161" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Harmonize the typehint so they match one with the other.</li>
<li>Remove dead code</li>
<li>Apply type casting before calling the next function, or return value</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/BadTypehintRelay</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="bail-out-early">
<span id="id162"></span><h2>9.59. Bail Out Early<a class="headerlink" href="#bail-out-early" title="Permalink to this headline">¶</a></h2>
<p>When using conditions, it is recommended to quit in the current context, and avoid else clause altogether.</p>
<p>The main benefit is to make clear the method applies a condition, and stop immediately when it is not satisfied.
The main sequence is then focused on the actual code.</p>
<p>This works with the <code class="docutils literal notranslate"><span class="pre">break</span></code>, <code class="docutils literal notranslate"><span class="pre">continue</span></code>, <code class="docutils literal notranslate"><span class="pre">throw</span></code> and <code class="docutils literal notranslate"><span class="pre">goto</span></code> keywords too, depending on situations.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Bailing out early, low level of indentation</span>
<span class="k">function</span> <span class="nf">foo1</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Works with continue too</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span> <span class="o">=&gt;</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// No need for else</span>
<span class="k">function</span> <span class="nf">foo2</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// No need for else : return goes into then.</span>
<span class="k">function</span> <span class="nf">foo3</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Make a return early, and make the condition visible.</span>
<span class="k">function</span> <span class="nf">foo3</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">methodcall</span><span class="p">();</span>
        <span class="nx">functioncall</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://github.com/jupeter/clean-code-php#avoid-nesting-too-deeply-and-return-early-part-1">Avoid nesting too deeply and return early (part 1)</a> and <a class="reference external" href="https://github.com/jupeter/clean-code-php#avoid-nesting-too-deeply-and-return-early-part-2">Avoid nesting too deeply and return early (part 2)</a>.</p>
<div class="section" id="id163">
<h3>9.59.1. Suggestions<a class="headerlink" href="#id163" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Detect errors, and then, return as soon as possible.</li>
<li>When a if…then branches are unbalanced, test for the small branch, finish it with return. Then keep the other branch as the main code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/BailOutEarly</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openemr-structures-bailoutearly"><span class="std std-ref">OpenEMR</span></a>, <a class="reference internal" href="Cases.html#opencfp-structures-bailoutearly"><span class="std std-ref">opencfp</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="binary-glossary">
<span id="id164"></span><h2>9.60. Binary Glossary<a class="headerlink" href="#binary-glossary" title="Permalink to this headline">¶</a></h2>
<p>List of all the integer values using the binary format.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">0</span><span class="nx">b10</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mi">0</span><span class="nx">B0101</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/Binary</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="bracketless-blocks">
<span id="id165"></span><h2>9.61. Bracketless Blocks<a class="headerlink" href="#bracketless-blocks" title="Permalink to this headline">¶</a></h2>
<p>PHP allows one liners as <a class="reference external" href="https://www.php.net/manual/en/control-structures.for.php">for()</a>, <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>, <a class="reference external" href="https://www.php.net/manual/en/control-structures.while.php">while()</a>, do/<a class="reference external" href="https://www.php.net/manual/en/control-structures.while.php">while()</a> loops, or as then/else expressions.</p>
<p>It is generally considered a bad practice, as readability is lower and there are non-negligible risk of excluding from the loop the next instruction.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Legit one liner</span>
<span class="k">foreach</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$letter</span><span class="p">)</span> <span class="o">++</span><span class="nv">$letterCount</span><span class="p">;</span>

<span class="c1">// More readable version, even for a one liner.</span>
<span class="k">foreach</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$letter</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">++</span><span class="nv">$letterCount</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a> cannot be without bracket.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/Bracketless</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="break-outside-loop">
<span id="id168"></span><h2>9.62. Break Outside Loop<a class="headerlink" href="#break-outside-loop" title="Permalink to this headline">¶</a></h2>
<p>Starting with PHP 7, <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> or <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a> that are outside a loop (for, <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>, do…`while() &lt;<a class="reference external" href="https://www.php.net/manual/en/control-structures.while.php">https://www.php.net/manual/en/control-structures.while.php</a>&gt;`_, <a class="reference external" href="https://www.php.net/manual/en/control-structures.while.php">while())</a> or a <a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a> statement won’t compile anymore.</p>
<p>It is not possible anymore to include a piece of code inside a loop that will then <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// outside a loop : This won&#39;t compile</span>
    <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// Compile OK</span>

        <span class="k">break</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// This won&#39;t compile, as this break is in one loop, and not 2</span>
    <span class="p">}</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$array2</span> <span class="k">as</span> <span class="nv">$a2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// OK in PHP 5 and 7</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/BreakOutsideLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="break-with-0">
<span id="id173"></span><h2>9.63. Break With 0<a class="headerlink" href="#break-with-0" title="Permalink to this headline">¶</a></h2>
<p>Cannot <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> 0, as this makes no sense. <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">Break</a> 1 is the minimum, and is the default value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// Can&#39;t break 0. Must be 1 or more, depending on the level of nesting.</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id176">
<h3>9.63.1. Suggestions<a class="headerlink" href="#id176" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove 0, or the break</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/Break0</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="break-with-non-integer">
<span id="id177"></span><h2>9.64. Break With Non Integer<a class="headerlink" href="#break-with-non-integer" title="Permalink to this headline">¶</a></h2>
<p>When using a <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a>, the argument of the operator must be a positive non-null integer literal or be omitted.</p>
<p>Other values were acceptable in PHP 5.3 and previous version, but this is now reported as an error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// Can&#39;t break $a, even if it contains an integer.</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">break</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// can&#39;t break on float</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span><span class="p">(</span><span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span> <span class="mf">2.2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/BreakNonInteger</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="buried-assignation">
<span id="id179"></span><h2>9.65. Buried Assignation<a class="headerlink" href="#buried-assignation" title="Permalink to this headline">¶</a></h2>
<p>Those assignations are buried in the code, and placed in unexpected situations.</p>
<p>They are difficult to spot, and may be confusing. It is advised to place them in a more visible place.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $b may be assigned before processing $a</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$c</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// Display property p immeiately, but also, keeps the object for later</span>
<span class="k">echo</span> <span class="p">(</span><span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">x</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>

<span class="c1">// legit syntax, but the double assignation is not obvious.</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">$j</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id180">
<h3>9.65.1. Suggestions<a class="headerlink" href="#id180" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extract the assignation and set it on its own line, prior to the current expression.</li>
<li>Check if the local variable is necessary</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/BuriedAssignation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xoops-structures-buriedassignation"><span class="std std-ref">XOOPS</span></a>, <a class="reference internal" href="Cases.html#mautic-structures-buriedassignation"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cache-variable-outside-loop">
<span id="id181"></span><h2>9.66. Cache Variable Outside Loop<a class="headerlink" href="#cache-variable-outside-loop" title="Permalink to this headline">¶</a></h2>
<p>Avoid recalculating constant values inside the loop.</p>
<p>Do the calculation once, outside the loops, and then reuse the value each time.</p>
<p>One of the classic example if doing <code class="docutils literal notranslate"><span class="pre">count($array)</span></code> in a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop : since the source is constant during the loop, the result of <a class="reference external" href="https://www.php.net/count">count()</a> is always the same.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/some/path&#39;</span><span class="p">;</span>
<span class="nv">$fullpath</span> <span class="o">=</span> <span class="nb">realpath</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$path</span><span class="s2">/more/dirs/&quot;</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Only moving parts are used in the loop</span>
    <span class="nb">copy</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$fullpath</span><span class="o">.</span><span class="nv">$file</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/some/path&#39;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $fullpath is calculated each loop</span>
    <span class="nv">$fullpath</span> <span class="o">=</span> <span class="nb">realpath</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$path</span><span class="s2">/more/dirs/&quot;</span><span class="p">);</span>
    <span class="nb">copy</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$fullpath</span><span class="o">.</span><span class="nv">$file</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Depending on the load of the called method, this may increase the speed of the loop from little to enormously.</p>
<div class="section" id="id183">
<h3>9.66.1. Suggestions<a class="headerlink" href="#id183" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using blind variables outside loops.</li>
<li>Store blind variables in local variables or properties for later reuse.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/CacheVariableOutsideLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="callback-function-needs-return">
<span id="id184"></span><h2>9.67. Callback Function Needs Return<a class="headerlink" href="#callback-function-needs-return" title="Permalink to this headline">¶</a></h2>
<p>When used with <a class="reference external" href="https://www.php.net/array_map">array_map()</a> functions, the callback must return something. This return may be in the form of a <code class="docutils literal notranslate"><span class="pre">return</span></code> statement, a global variable or a parameter with a reference. All those solutions extract information from the callback.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This filters each element</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nv">$x</span> <span class="o">==</span> <span class="mi">2</span><span class="p">;</span> <span class="p">});</span>

<span class="c1">// This return void for every element</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="p">;</span> <span class="p">});</span>

<span class="c1">// costly array_sum()</span>
<span class="nv">$sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$sum</span><span class="p">)</span> <span class="p">{</span><span class="nv">$sum</span> <span class="o">+=</span> <span class="nv">$x</span><span class="p">;</span> <span class="p">});</span>

<span class="c1">// costly array_sum()</span>
<span class="k">global</span> <span class="nv">$sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span><span class="k">global</span> <span class="nv">$sum</span><span class="p">;</span> <span class="nv">$sum</span> <span class="o">+=</span> <span class="nv">$x</span><span class="p">;</span> <span class="p">});</span>

<span class="c1">// register_shutown_function() doesn&#39;t require any return</span>
<span class="nx">register_shutown_function</span><span class="p">(</span><span class="nx">my_shutdown</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The following functions are omitted, as they don’t require the return :</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/forward_static_call_array">forward_static_call_array()</a></li>
<li><a class="reference external" href="https://www.php.net/forward_static_call">forward_static_call()</a></li>
<li><a class="reference external" href="https://www.php.net/register_shutdown_function">register_shutdown_function()</a></li>
<li><a class="reference external" href="https://www.php.net/register_tick_function">register_tick_function()</a></li>
</ul>
<p>See also <a class="reference external" href="https://www.php.net/array_map">array_map</a>.</p>
<div class="section" id="id187">
<h3>9.67.1. Suggestions<a class="headerlink" href="#id187" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add an explicit return to the callback</li>
<li>Use <cite>null</cite> to unset elements in an array without destroying the index</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/CallbackNeedsReturn</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#contao-functions-callbackneedsreturn"><span class="std std-ref">Contao</span></a>, <a class="reference internal" href="Cases.html#phpdocumentor-functions-callbackneedsreturn"><span class="std std-ref">Phpdocumentor</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="calltime-pass-by-reference">
<span id="id188"></span><h2>9.68. Calltime Pass By Reference<a class="headerlink" href="#calltime-pass-by-reference" title="Permalink to this headline">¶</a></h2>
<p>PHP doesn’t allow when a value is turned into a reference at functioncall, since PHP 5.4.</p>
<p>Either the function use a reference in its signature, either the reference won’t pass.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$arg</span> <span class="o">=</span> <span class="nb">ucfirst</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$name</span><span class="p">));</span>
    <span class="k">echo</span> <span class="s1">&#39;Hello &#39;</span><span class="o">.</span><span class="nv">$arg</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span><span class="p">;</span>
<span class="nx">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$a</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id189">
<h3>9.68.1. Suggestions<a class="headerlink" href="#id189" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the signature of the called method accept references</li>
<li>Remove the reference from the method call</li>
<li>Use an object instead of a scalar</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CalltimePassByReference</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="can-t-count-non-countable">
<span id="id190"></span><h2>9.69. Can’t Count Non-Countable<a class="headerlink" href="#can-t-count-non-countable" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/count">Count()</a> emits an error when it tries to count scalars or objects what don’t implement Countable interface.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Normal usage</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">.</span><span class="nx">items\n</span><span class="p">;</span>

<span class="c1">// Error emiting usage</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;1234&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span><span class="o">.</span><span class="nx">chars\n</span><span class="p">;</span>

<span class="c1">// Error emiting usage</span>
<span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$unsetVar</span><span class="p">)</span><span class="o">.</span><span class="nx">elements\n</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration72.incompatible.php#migration72.incompatible.warn-on-non-countable-types">Warn when counting non-countable types</a>.</p>
<div class="section" id="id192">
<h3>9.69.1. Suggestions<a class="headerlink" href="#id192" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a check before using count such as a type check</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CanCountNonCountable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="can-t-extend-final">
<span id="id193"></span><h2>9.70. Can’t Extend Final<a class="headerlink" href="#can-t-extend-final" title="Permalink to this headline">¶</a></h2>
<p>It is not possible to extend final classes.</p>
<p>Since PHP fails with a fatal error, this means that the extending class is probably not used in the rest of the code. Check for dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// File Foo</span>
    <span class="k">final</span> <span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
        <span class="k">public</span> <span class="k">final</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// doSomething</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>In a separate file :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// File Bar</span>
    <span class="k">class</span> <span class="nc">bar</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.final.php">Final Keyword</a>.</p>
<div class="section" id="id194">
<h3>9.70.1. Suggestions<a class="headerlink" href="#id194" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the final keyword</li>
<li>Remove the extending class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CantExtendFinal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="can-t-throw-throwable">
<span id="id195"></span><h2>9.71. Can’t Throw Throwable<a class="headerlink" href="#can-t-throw-throwable" title="Permalink to this headline">¶</a></h2>
<p>Classes extending <code class="docutils literal notranslate"><span class="pre">Throwable</span></code> can’t be thrown. The same applies to interfaces.</p>
<p>Although this code lints, PHP throws a Fatal error when executing or including it : <code class="docutils literal notranslate"><span class="pre">Class</span> <span class="pre">fooThrowable</span> <span class="pre">cannot</span> <span class="pre">implement</span> <span class="pre">interface</span> <span class="pre">`Throwable</span> <span class="pre">&lt;https://www.php.net/manual/en/class.throwable.php&gt;`_,</span> <span class="pre">extend</span> <span class="pre">Exception</span> <span class="pre">or</span> <span class="pre">Error</span> <span class="pre">instead</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is the way to go</span>
<span class="k">class</span> <span class="nc">fooException</span> <span class="k">extends</span> <span class="nx">\Exception</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// This is not possible and a lot of work</span>
<span class="k">class</span> <span class="nc">fooThrowable</span> <span class="k">implements</span> <span class="nx">\throwable</span> <span class="p">{</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/class.throwable.php">Throwable</a>, <a class="reference external" href="https://www.php.net/manual/en/class.exception.php">Exception</a> and <a class="reference external" href="https://www.php.net/manual/en/class.error.php">Error</a>.</p>
<div class="section" id="id196">
<h3>9.71.1. Suggestions<a class="headerlink" href="#id196" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extends the Exception class</li>
<li>Extends the Error class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/CantThrow</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cancel-common-method">
<span id="id197"></span><h2>9.72. Cancel Common Method<a class="headerlink" href="#cancel-common-method" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> method’s is too little used in children.</p>
<p>The <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class has a method, which is customised in children classes, though most of the time, those are empty : hence, cancelled.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">abstract</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">();</span>
    <span class="k">abstract</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">y1</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">y2</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="c1">// foo is cancelled : it must be written, but has no use.</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>  <span class="p">}</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">};</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>A threshold of <code class="docutils literal notranslate"><span class="pre">cancelThreshold</span></code> % of the children methods have to be cancelled to report the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class. By default, it is 75 (or 3 out of 4).</p>
<div class="section" id="id201">
<h3>9.72.1. Suggestions<a class="headerlink" href="#id201" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the common method, and the cancelled methods in the children</li>
<li>Fill the children’s methods with actual code</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="8%" />
<col width="8%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>cancelThreshold</td>
<td>75</td>
<td>integer</td>
<td>Minimal number of cancelled methods to suggest the cancellation of the parent.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CancelCommonMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cancelled-parameter">
<span id="id202"></span><h2>9.73. Cancelled Parameter<a class="headerlink" href="#cancelled-parameter" title="Permalink to this headline">¶</a></h2>
<p>When a parameter is hardcoded, and doesn’t have any usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $b is cancelled, and cannot be changed.</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="c1">// $a is the only parameter here</span>
    <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $b is actually processed</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="nx">process</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>

    <span class="nv">$b</span> <span class="o">=</span> <span class="nv">$c</span><span class="p">;</span>

    <span class="c1">// $a is the only parameter here</span>
    <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id203">
<h3>9.73.1. Suggestions<a class="headerlink" href="#id203" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/CancelledParameter</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cant-implement-traversable">
<span id="id204"></span><h2>9.74. Cant Implement Traversable<a class="headerlink" href="#cant-implement-traversable" title="Permalink to this headline">¶</a></h2>
<p>It is not possible to implement the <code class="docutils literal notranslate"><span class="pre">Traversable``interface.</span> <span class="pre">The</span> <span class="pre">alternative</span> <span class="pre">is</span> <span class="pre">to</span> <span class="pre">implement</span> <span class="pre">``Iterator</span></code> or <code class="docutils literal notranslate"><span class="pre">IteratorAggregate</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Traversable</span></code> may be useful when used with <code class="docutils literal notranslate"><span class="pre">instanceof</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This lints, but doesn&#39;t run</span>
<span class="k">class</span> <span class="nc">x</span> <span class="k">implements</span> <span class="nx">Traversable</span> <span class="p">{</span>

<span class="p">}</span>

<span class="k">if</span><span class="p">(</span> <span class="nv">$argument</span> <span class="nx">instanceof</span> <span class="nx">Traversable</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/class.traversable.php">Traversable</a>, <a class="reference external" href="https://www.php.net/manual/en/class.iterator.php">Iterator</a> and <a class="reference external" href="https://www.php.net/manual/en/class.iteratoraggregate.php">IteratorAggregate</a>..</p>
<div class="section" id="id205">
<h3>9.74.1. Suggestions<a class="headerlink" href="#id205" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Implement Iterator or IteratorAggregate</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/CantImplementTraversable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cant-inherit-abstract-method">
<span id="id206"></span><h2>9.75. Cant Inherit Abstract Method<a class="headerlink" href="#cant-inherit-abstract-method" title="Permalink to this headline">¶</a></h2>
<p>Inheriting abstract methods was made available in PHP 7.2. In previous versions, it emitted a fatal error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">A</span>           <span class="p">{</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="k">stdClass</span> <span class="nv">$x</span><span class="p">);</span>  <span class="p">}</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">B</span> <span class="k">extends</span> <span class="nx">A</span> <span class="p">{</span> <span class="k">abstract</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span><span class="o">:</span> <span class="k">stdClass</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">//   Fatal error: Can&#39;t inherit abstract function A::bar()</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/allow-abstract-function-override">PHP RFC: Allow abstract function override</a>.</p>
<div class="section" id="id207">
<h3>9.75.1. Suggestions<a class="headerlink" href="#id207" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid inheriting abstract methods for compatibility beyond 7.2 (and older)</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CantInheritAbstractMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cant-instantiate-class">
<span id="id208"></span><h2>9.76. Cant Instantiate Class<a class="headerlink" href="#cant-instantiate-class" title="Permalink to this headline">¶</a></h2>
<p>When constructor is not public, it is not possible to instantiate such a class. Either this is a conception choice, or there are factories to handle that. Either way, it is not possible to call new on such class.</p>
<p>PHP reports an error similar to this one : ‘Call to private Y::<a class="reference external" href="https://www.php.net/manual/en/language.oop5.decon.php">__construct()</a> from invalid context’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//This is the way to go</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="nx">X</span><span class="o">::</span><span class="na">factory</span><span class="p">();</span>

<span class="c1">//This is not possible</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">X</span><span class="p">();</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="c1">//This is also the case with proctected __construct</span>
    <span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">factory</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">X</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://stackoverflow.com/questions/26079/in-a-php5-class-when-does-a-private-constructor-get-called">In a PHP5 class, when does a private constructor get called?</a>, <a class="reference external" href="http://verraes.net/2014/06/named-constructors-in-php/">Named Constructors in PHP</a> and <a class="reference external" href="http://ralphschindler.com/2012/03/09/php-constructor-best-practices-and-the-prototype-pattern">PHP Constructor Best Practices And The Prototype Pattern</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CantInstantiateClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-classes-cantinstantiateclass"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cant-use-return-value-in-write-context">
<span id="id209"></span><h2>9.77. Cant Use Return Value In Write Context<a class="headerlink" href="#cant-use-return-value-in-write-context" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/empty">empty()</a> used to work only on data containers, such as variables. Until PHP 5.5, it was not possible to use directly expressions, such as functioncalls, inside an <a class="reference external" href="https://www.php.net/empty">empty()</a> function call : they were met with a ‘Can’t use function return value in write context’ fatal error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$boolean</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Valid since PHP 5.5</span>
<span class="k">echo</span> <span class="k">empty</span><span class="p">(</span><span class="nx">foo</span><span class="p">(</span><span class="k">true</span><span class="p">))</span> <span class="o">:</span> <span class="s1">&#39;true&#39;</span> <span class="o">:</span> <span class="s1">&#39;false&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This also applies to methodcalls, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> or not.</p>
<p>See also <a class="reference external" href="https://stackoverflow.com/questions/1075534/cant-use-method-return-value-in-write-context">Cant Use Return Value In Write Context</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/CantUseReturnValueInWriteContext</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="case-insensitive-constants">
<span id="id213"></span><h2>9.78. Case Insensitive Constants<a class="headerlink" href="#case-insensitive-constants" title="Permalink to this headline">¶</a></h2>
<p>PHP constants may be case insensitive, when defined with <a class="reference external" href="https://www.php.net/define">define()</a> and the third argument.</p>
<p>This feature is deprecated since PHP 7.3 and will be removed in PHP 8.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// case sensitive</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// case insensitive</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="k">echo</span> <span class="nx">A</span><span class="p">;</span>
<span class="c1">// This is not possible</span>
<span class="c1">//echo a;</span>

<span class="c1">// both possible</span>
<span class="k">echo</span> <span class="nx">B</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">b</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.define.php">define</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/CaseInsensitiveConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cast-to-boolean">
<span id="id215"></span><h2>9.79. Cast To Boolean<a class="headerlink" href="#cast-to-boolean" title="Permalink to this headline">¶</a></h2>
<p>This expression may be reduced by casting to boolean type.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$variable</span> <span class="o">=</span> <span class="nv">$condition</span> <span class="o">==</span> <span class="s1">&#39;met&#39;</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// Same as</span>
<span class="nv">$variable</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="nv">$condition</span> <span class="o">==</span> <span class="s1">&#39;met&#39;</span><span class="p">;</span>

<span class="nv">$variable</span> <span class="o">=</span> <span class="nv">$condition</span> <span class="o">==</span> <span class="s1">&#39;met&#39;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// Same as (Note the condition inversion)</span>
<span class="nv">$variable</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="nv">$condition</span> <span class="o">!=</span> <span class="s1">&#39;met&#39;</span><span class="p">;</span>
<span class="c1">// also, with an indentical condition</span>
<span class="nv">$variable</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="nv">$condition</span> <span class="o">==</span> <span class="s1">&#39;met&#39;</span><span class="p">;</span>

<span class="c1">// This also works with straight booleans expressions</span>
<span class="nv">$variable</span> <span class="o">=</span> <span class="nv">$condition</span> <span class="o">==</span> <span class="s1">&#39;met&#39;</span> <span class="o">?</span> <span class="k">true</span> <span class="o">:</span> <span class="k">false</span><span class="p">;</span>
<span class="c1">// Same as</span>
<span class="nv">$variable</span> <span class="o">=</span> <span class="nv">$condition</span> <span class="o">==</span> <span class="s1">&#39;met&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id216">
<h3>9.79.1. Suggestions<a class="headerlink" href="#id216" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the old expression and use <code class="docutils literal notranslate"><span class="pre">(bool)</span></code> operator instead</li>
<li>Change the target values from true/false, or 0/1 to non-binary values, like strings or integers beyond 0 and 1.</li>
<li>Complete the current branches with other commands</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CastToBoolean</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#mediawiki-structures-casttoboolean"><span class="std std-ref">MediaWiki</span></a>, <a class="reference internal" href="Cases.html#dolibarr-structures-casttoboolean"><span class="std std-ref">Dolibarr</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="cast-unset-usage">
<span id="id217"></span><h2>9.80. Cast Unset Usage<a class="headerlink" href="#cast-unset-usage" title="Permalink to this headline">¶</a></h2>
<p>Usage of the <cite>(unset)</cite> cast operator. It is removed in PHP 8.0, and was deprecated since PHP 7.2.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">(</span><span class="nb">unset</span><span class="p">)</span> <span class="nv">$a</span><span class="p">;</span>

<span class="c1">// functioncall is OK</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.null.php#language.types.null.casting">Unset casting</a>.</p>
<div class="section" id="id218">
<h3>9.80.1. Suggestions<a class="headerlink" href="#id218" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace <cite>(unset)</cite> with a call to unset().</li>
<li>Remove the unset call altogether.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/CastUnsetUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="casting-ternary">
<span id="id219"></span><h2>9.81. Casting Ternary<a class="headerlink" href="#casting-ternary" title="Permalink to this headline">¶</a></h2>
<p>Type casting has a precedence over ternary operator, and is applied first. When this happens, the condition is cast, although it is often useless as PHP will do it if needed.</p>
<p>This applies to the ternary operator, the coalesce operator ?: and the null-coalesce operator ??.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$b</span> <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$b</span> <span class="o">?:</span> <span class="mi">4</span><span class="p">;</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$b</span> <span class="o">??</span> <span class="mi">4</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The last example generates first an error <cite>Undefined variable: b</cite>, since $b is first cast to a string. The result is then an empty string, which leads to an empty string to be stored into $a. Multiple errors cascade.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operators Precedence</a>.</p>
<div class="section" id="id220">
<h3>9.81.1. Suggestions<a class="headerlink" href="#id220" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add parenthesis around the ternary operator</li>
<li>Skip the casting</li>
<li>Cast in another expression</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CastingTernary</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="catch-overwrite-variable">
<span id="id221"></span><h2>9.82. Catch Overwrite Variable<a class="headerlink" href="#catch-overwrite-variable" title="Permalink to this headline">¶</a></h2>
<p>The try/catch structure uses some variables that are also in use in this scope. In case of a caught exception, the exception will be put in the catch variable, and overwrite the current value, loosing some data.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// variables and caught exceptions are distinct</span>
<span class="nv">$argument</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nx">methodThatMayRaiseException</span><span class="p">(</span><span class="nv">$argument</span><span class="p">);</span>
<span class="p">}</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// here, $e has been changed to an exception.</span>
<span class="p">}</span>

<span class="c1">// variables and caught exceptions are overlapping</span>
<span class="nv">$e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nx">methodThatMayRaiseException</span><span class="p">();</span>
<span class="p">}</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// here, $e has been changed to an exception.</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to use another name for these catch variables.</p>
<div class="section" id="id222">
<h3>9.82.1. Suggestions<a class="headerlink" href="#id222" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a standard : only use $e (or else) to catch exceptions. Avoid using them for anything else, parameter, property or local variable.</li>
<li>Change the variable, and keep the caught exception</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CatchShadowsVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-catch-overwrite.md">no-catch-overwrite</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpipam-structures-catchshadowsvariable"><span class="std std-ref">PhpIPAM</span></a>, <a class="reference internal" href="Cases.html#suitecrm-structures-catchshadowsvariable"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="catch-undefined-variable">
<span id="id223"></span><h2>9.83. Catch Undefined Variable<a class="headerlink" href="#catch-undefined-variable" title="Permalink to this headline">¶</a></h2>
<p>Always initialize variable before the try block, when they are used in a catch block. If the exception is raised before the variable is defined, the catch block may have to handle an undefined variable, leading to more chaos.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nx">mayThrowAnException</span><span class="p">();</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $a is already defined, as it was done before the try block</span>
    <span class="c1">// $b may not be defined, as it was initialized after the exception-throwing expression</span>
    <span class="k">echo</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id224">
<h3>9.83.1. Suggestions<a class="headerlink" href="#id224" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always define the variable used in the catch clause, before the try block.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/CatchUndefinedVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="check-all-types">
<span id="id225"></span><h2>9.84. Check All Types<a class="headerlink" href="#check-all-types" title="Permalink to this headline">¶</a></h2>
<p>When checking for time, avoid using else. Mention explicitly all tested type, and raise an exception when reaching else.</p>
<p>PHP has a short list of scalar types : null, boolean, integer, real, strings, object, resource and array. When a variable is not holding one the the type, then it may be of any other type.</p>
<p>Most of the time, when using a simple <a class="reference external" href="https://www.php.net/is_string">is_string()</a> / else test, this is relying on the conception of the code. By construction, the arguments may be one of two types : array or string.</p>
<p>What happens often is that in case of failure in the code (database not working, another class not checking its results), a third type is pushed to the structure, and it ends up breaking the execution.</p>
<p>The safe way is to check the various types all the time, and use the default case (here, the else) to throw exception() or test an assertion and handle the special case.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// hasty version</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$argument</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$out</span> <span class="o">=</span> <span class="nv">$argument</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Here, $argument is NOT an array. What if it is an object ? or a NULL ?</span>
    <span class="nv">$out</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$argument</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Safe type checking : do not assume that &#39;not an array&#39; means that it is the other expected type.</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$argument</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$out</span> <span class="o">=</span> <span class="nv">$argument</span><span class="p">;</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$argument</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$out</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$argument</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">assert</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="s1">&#39;$argument is not an array nor a string, as expected!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Using <a class="reference external" href="https://www.php.net/is_callable">is_callable()</a>, <a class="reference external" href="https://www.php.net/is_iterable">is_iterable()</a> with this structure is fine : when variable is callable or not, while a variable is an integer or else.</p>
<p>Using a type test without else is also accepted here. This is a special treatment for this test, and all others are ignored. This aspect may vary depending on situations and projects.</p>
<div class="section" id="id226">
<h3>9.84.1. Suggestions<a class="headerlink" href="#id226" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Include a default case to handle all unknown situations</li>
<li>Include and process explicit types as much as possible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CheckAllTypes</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zend-config-structures-checkalltypes"><span class="std std-ref">Zend-Config</span></a>, <a class="reference internal" href="Cases.html#vanilla-structures-checkalltypes"><span class="std std-ref">Vanilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="check-crypto-key-length">
<span id="id227"></span><h2>9.85. Check Crypto Key Length<a class="headerlink" href="#check-crypto-key-length" title="Permalink to this headline">¶</a></h2>
<p>Each cryptography algorithm requires a reasonable length. Make sure an up-to-date length is used.</p>
<p>This rule use the following recommendations :</p>
<ul class="simple">
<li>OPENSSL_KEYTYPE_RSA’ =&gt; 3072</li>
<li>OPENSSL_KEYTYPE_DSA’ =&gt; 2048</li>
<li>OPENSSL_KEYTYPE_DH’  =&gt; 2048</li>
<li>OPENSSL_KEYTYPE_EC’  =&gt; 512</li>
</ul>
<p>The values above are used with the openssl PHP extension.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Extracted from the documentation</span>

<span class="c1">// Generates a new and strong key</span>
<span class="nv">$private_key</span> <span class="o">=</span> <span class="nb">openssl_pkey_new</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="nx">private_key_type</span> <span class="o">=&gt;</span> <span class="nx">OPENSSL_KEYTYPE_EC</span><span class="p">,</span>
    <span class="nx">private_key_bits</span> <span class="o">=&gt;</span> <span class="mi">1024</span><span class="p">,</span>
<span class="p">));</span>

<span class="c1">// Generates a new and weak key</span>
<span class="nv">$private_key</span> <span class="o">=</span> <span class="nb">openssl_pkey_new</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="nx">private_key_type</span> <span class="o">=&gt;</span> <span class="nx">OPENSSL_KEYTYPE_EC</span><span class="p">,</span>
    <span class="nx">private_key_bits</span> <span class="o">=&gt;</span> <span class="mi">256</span><span class="p">,</span>
<span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://paragonie.com/blog/2019/03/definitive-2019-guide-cryptographic-key-sizes-and-algorithm-recommendations">The Definitive 2019 Guide to Cryptographic Key Sizes and Algorithm Recommendations</a> and <a class="reference external" href="https://www.keylength.com/">Cryptographic Key Length Recommendation</a>.</p>
<div class="section" id="id228">
<h3>9.85.1. Suggestions<a class="headerlink" href="#id228" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/CryptoKeyLength</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="check-json">
<span id="id229"></span><h2>9.86. Check JSON<a class="headerlink" href="#check-json" title="Permalink to this headline">¶</a></h2>
<p>Check errors whenever JSON is encoded or decoded.</p>
<p>In particular, <code class="docutils literal notranslate"><span class="pre">NULL</span></code> is a valid decoded JSON response. If you want to avoid mistaking <a class="reference external" href="https://www.php.net/manual/en/language.types.null.php">NULL</a> for an error, it is recommended to call <code class="docutils literal notranslate"><span class="pre">json_last_error</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$encoded</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$incoming</span><span class="p">);</span>
<span class="c1">// Unless JSON must contains some non-null data, this mistakes NULL and error</span>
<span class="k">if</span><span class="p">(</span><span class="nb">json_last_error</span><span class="p">()</span> <span class="o">!=</span> <span class="nx">JSON_ERROR_NONE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Error when encoding JSON&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$decoded</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$incoming</span><span class="p">);</span>
<span class="c1">// Unless JSON must contains some non-null data, this mistakes NULL and error</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$decoded</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://ayesh.me/Upgrade-PHP-7.3#json-exceptions">Option to make json_encode and json_decode throw exceptions on errors</a>, <a class="reference external" href="https://www.php.net/json_last_error">json_last_error</a>.</p>
<div class="section" id="id231">
<h3>9.86.1. Suggestions<a class="headerlink" href="#id231" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always check after JSON operation : encoding or decoding.</li>
<li>Add a call to json_last_error()</li>
<li>Configure operations to throw an exception upon error (<code class="docutils literal notranslate"><span class="pre">JSON_THROW_ON_ERROR</span></code>), and catch it.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CheckJson</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#woocommerce-structures-checkjson"><span class="std std-ref">Woocommerce</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="check-on-call-usage">
<span id="id232"></span><h2>9.87. Check On __Call Usage<a class="headerlink" href="#check-on-call-usage" title="Permalink to this headline">¶</a></h2>
<p>When using the magic methods <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__call()</a> and __staticcall(), make sure the method exists before calling it.</p>
<p>If the method doesn’t exists, then the same method will be called again, leading to the same failure. Finally, it will crash PHP.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">safeCall</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">__class</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// unsafe call, no checks</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$name</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$name</span><span class="p">(</span><span class="o">...</span><span class="nv">$args</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">unsafeCall</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">__class</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// unsafe call, no checks</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$name</span><span class="p">(</span><span class="o">...</span><span class="nv">$args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.overloading.php#object.call">Method overloading</a> and <a href="#id233"><span class="problematic" id="id234">``</span></a>Magical PHP: <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__call</a> &lt;<a class="reference external" href="https://www.garfieldtech.com/index.php/blog/magical-php-call">https://www.garfieldtech.com/index.php/blog/magical-php-call</a>&gt;`_.</p>
<div class="section" id="id236">
<h3>9.87.1. Suggestions<a class="headerlink" href="#id236" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a call to method_exists() before using any method name</li>
<li>Relay the call to another object that doesn’t handle __call() or __callStatic()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CheckOnCallUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="child-class-removes-typehint">
<span id="id237"></span><h2>9.88. Child Class Removes Typehint<a class="headerlink" href="#child-class-removes-typehint" title="Permalink to this headline">¶</a></h2>
<p>PHP 7.2 introduced the ability to remove a typehint when overloading a method. This is not valid code for older versions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foobar</span><span class="p">(</span><span class="nx">foo</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">bar</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foobar</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ChildRemoveTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class-const-with-array">
<span id="id238"></span><h2>9.89. Class Const With Array<a class="headerlink" href="#class-const-with-array" title="Permalink to this headline">¶</a></h2>
<p>Constant defined with const keyword may be arrays but only stating with PHP 5.6. Define never accept arrays : it only accepts scalar values.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ClassConstWithArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class-could-be-final">
<span id="id239"></span><h2>9.90. Class Could Be Final<a class="headerlink" href="#class-could-be-final" title="Permalink to this headline">¶</a></h2>
<p>Any class that has no extension should be <code class="docutils literal notranslate"><span class="pre">final</span></code> by default.</p>
<p>As stated by <code class="docutils literal notranslate"><span class="pre">Matthias</span> <span class="pre">Noback</span></code> : <code class="docutils literal notranslate"><span class="pre">If</span> <span class="pre">a</span> <span class="pre">class</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">marked</span> <span class="pre">final,</span> <span class="pre">it</span> <span class="pre">has</span> <span class="pre">at</span> <span class="pre">least</span> <span class="pre">one</span> <span class="pre">subclass</span></code>.</p>
<p>Prevent your classes from being subclassed by making them <code class="docutils literal notranslate"><span class="pre">final</span></code>. Sometimes, classes are not meant or thought to be derivable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{}</span>            <span class="c1">// This class is extended</span>
<span class="k">class</span> <span class="nc">y</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{}</span>  <span class="c1">// This class is extended</span>
<span class="k">class</span> <span class="nc">z</span> <span class="k">extends</span> <span class="nx">y</span> <span class="p">{}</span>  <span class="c1">// This class is not extended</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">z2</span> <span class="k">extends</span> <span class="nx">y</span> <span class="p">{}</span>  <span class="c1">// This class is not extended</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://matthiasnoback.nl/2018/08/negative-architecture-and-assumptions-about-code/">Negative architecture, and assumptions about code</a>.</p>
<div class="section" id="id240">
<h3>9.90.1. Suggestions<a class="headerlink" href="#id240" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the class final</li>
<li>Extends the class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeFinal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="class-function-confusion">
<span id="id241"></span><h2>9.91. Class Function Confusion<a class="headerlink" href="#class-function-confusion" title="Permalink to this headline">¶</a></h2>
<p>Avoid classes and functions bearing the same name.</p>
<p>When functions and classes bear the same name, calling them may be confusing. This may also lead to forgotten ‘new’ keyword.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

<span class="c1">// Forgetting the &#39;new&#39; operator is easy</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">foo</span><span class="p">();</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id242">
<h3>9.91.1. Suggestions<a class="headerlink" href="#id242" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a naming convention to distinguish functions and classes</li>
<li>Rename the class or the function (or both)</li>
<li>Use an alias with a <cite>use</cite> expression</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ClassFunctionConfusion</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="class-should-be-final-by-ocramius">
<span id="id243"></span><h2>9.92. Class Should Be Final By Ocramius<a class="headerlink" href="#class-should-be-final-by-ocramius" title="Permalink to this headline">¶</a></h2>
<p>‘Make your classes always final, if they implement an interface, and no other public methods are defined’.</p>
<p>When a class should be final, as explained by <code class="docutils literal notranslate"><span class="pre">Ocramius</span></code> (<code class="docutils literal notranslate"><span class="pre">Marco</span> <span class="pre">Pivetta</span></code>).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">i1</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">i1</span><span class="p">()</span> <span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Class should final, as its public methods are in an interface</span>
<span class="k">class</span> <span class="nc">finalClass</span> <span class="k">implements</span> <span class="nx">i1</span> <span class="p">{</span>
    <span class="c1">// public interface</span>
    <span class="k">function</span> <span class="nf">i1</span> <span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// private method</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">a1</span> <span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://ocramius.github.io/blog/when-to-declare-classes-final/">When to declare classes final</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/FinalByOcramius</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="class-without-parent">
<span id="id244"></span><h2>9.93. Class Without Parent<a class="headerlink" href="#class-without-parent" title="Permalink to this headline">¶</a></h2>
<p>Classes should not refer to <code class="docutils literal notranslate"><span class="pre">parent</span></code> when it is not extending another class.</p>
<p>In PHP 7.4, it is a Deprecated warning. In PHP 7.3, it was a Fatal error, when the code was finally executed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">foo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id245">
<h3>9.93.1. Suggestions<a class="headerlink" href="#id245" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Update the class and make it extends another class</li>
<li>Change the parent mention with a fully qualified name</li>
<li>Remove the call to the parent altogether</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NoParent</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="class-interface-or-trait-with-identical-names">
<span id="id246"></span><h2>9.94. Class, Interface Or Trait With Identical Names<a class="headerlink" href="#class-interface-or-trait-with-identical-names" title="Permalink to this headline">¶</a></h2>
<p>The following names are used at the same time for classes, interfaces or traits. For example,</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">class</span> <span class="nc">a</span>     <span class="p">{</span> <span class="cm">/* some definitions */</span> <span class="p">}</span>
    <span class="k">interface</span> <span class="nx">a</span> <span class="p">{</span> <span class="cm">/* some definitions */</span> <span class="p">}</span>
    <span class="k">trait</span> <span class="nx">a</span>     <span class="p">{</span> <span class="cm">/* some definitions */</span> <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Even if they are in different namespaces, identical names makes classes easy to confuse. This is often solved by using alias at import time : this leads to more confusion, as a class suddenly changes its name.</p>
<p>Internally, PHP use the same list for all classes, interfaces and traits. As such, it is not allowed to have both a trait and a class with the same name.</p>
<p>In PHP 4, and PHP 5 before namespaces, it was not possible to have classes with the same name. They were simply included after a check.</p>
<div class="section" id="id247">
<h3>9.94.1. Suggestions<a class="headerlink" href="#id247" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use distinct names for every class, trait and interface.</li>
<li>Keep eponymous classes, traits and interfaces in distinct files, for definition but also for usage. When this happens, rename one of them.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CitSameName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#shopware-classes-citsamename"><span class="std std-ref">shopware</span></a>, <a class="reference internal" href="Cases.html#nextcloud-classes-citsamename"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="classes-mutually-extending-each-other">
<span id="id248"></span><h2>9.95. Classes Mutually Extending Each Other<a class="headerlink" href="#classes-mutually-extending-each-other" title="Permalink to this headline">¶</a></h2>
<p>Those classes are extending each other, creating an extension loop. PHP will yield a fatal error at running time, even if it is compiling the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This code is lintable but won&#39;t run</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="nx">Bar</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">Bar</span> <span class="k">extends</span> <span class="nx">Foo</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// The loop may be quite large</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="nx">Bar</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">Bar</span> <span class="k">extends</span> <span class="nx">Bar2</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">Bar2</span> <span class="k">extends</span> <span class="nx">Foo</span> <span class="p">{</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MutualExtension</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="clone-with-non-object">
<span id="id249"></span><h2>9.96. Clone With Non-Object<a class="headerlink" href="#clone-with-non-object" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">clone</span></code> keyword must be used on variables, properties or results from a function or method call.</p>
<p><code class="docutils literal notranslate"><span class="pre">clone</span></code> cannot be used with constants or literals.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span> <span class="p">}</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">x</span><span class="p">();</span>

<span class="c1">// Valid clone</span>
<span class="nv">$y</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$x</span><span class="p">;</span>

<span class="c1">// Invalid clone</span>
<span class="nv">$y</span> <span class="o">=</span> <span class="k">clone</span> <span class="nx">x</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Cloning a non-object lint but won’t execute.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.cloning.php">Object cloning</a>.</p>
<div class="section" id="id250">
<h3>9.96.1. Suggestions<a class="headerlink" href="#id250" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Only clone containers (like variables, properties…)</li>
<li>Add typehint to injected properties, so they are checked as objects.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CloneWithNonObject</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="close-tags">
<span id="id251"></span><h2>9.97. Close Tags<a class="headerlink" href="#close-tags" title="Permalink to this headline">¶</a></h2>
<p>PHP manual recommends that script should be left open, without the final closing ?&gt;. This way, one will avoid the infamous bug ‘Header already sent’, associated with left-over spaces, that are lying after this closing tag.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/CloseTags</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/leave-last-closing-out.md">leave-last-closing-out</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="closure-could-be-a-callback">
<span id="id252"></span><h2>9.98. Closure Could Be A Callback<a class="headerlink" href="#closure-could-be-a-callback" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/class.closure.php">Closure</a> or arrowfunction could be simplified to a callback. Callbacks are strings or arrays.</p>
<p>A simple closure that only returns arguments relayed to another function or method, could be reduced to a simpler expression. They</p>
<p><a class="reference external" href="https://www.php.net/manual/en/class.closure.php">Closure</a> may be simplified with a string, for functioncall, with an array for methodcalls and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methodcalls.</p>
<p>Performances : simplifying a closure tends to reduce the call time by 50%.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Simple and faster call to strtoupper</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;strtoupper&#39;</span><span class="p">,</span> <span class="nv">$array</span><span class="p">);</span>

<span class="c1">// Here the closure doesn&#39;t add any feature over strtoupper</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$x</span><span class="p">);},</span> <span class="nv">$array</span><span class="p">);</span>

<span class="c1">// Methodcall example : no fix</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">strtoupper</span><span class="p">()</span> <span class="p">;},</span> <span class="nv">$array</span><span class="p">);</span>

<span class="c1">// Methodcall example  : replace with array($y, &#39;strtoupper&#39;)</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$y</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$y</span><span class="o">-&gt;</span><span class="na">strtoupper</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">;},</span> <span class="nv">$array</span><span class="p">);</span>

<span class="c1">// Static methodcall example</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$x</span><span class="o">::</span><span class="na">strtoupper</span><span class="p">()</span> <span class="p">;},</span> <span class="nv">$array</span><span class="p">);</span>

<span class="c1">// Static methodcall example   : replace with array(&#39;A&#39;, &#39;strtoupper&#39;)</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">A</span><span class="o">::</span><span class="na">strtoupper</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">;},</span> <span class="nv">$array</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/closure">Closure class</a> and <a class="reference external" href="https://www.php.net/manual/en/language.types.callable.php">Callbacks / Callables</a>.</p>
<div class="section" id="id256">
<h3>9.98.1. Suggestions<a class="headerlink" href="#id256" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the closure by a string, with the name of the called function</li>
<li>Replace the closure by an array, with the name of the called method and the object as first element</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/Closure2String</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-functions-closure2string"><span class="std std-ref">Tine20</span></a>, <a class="reference internal" href="Cases.html#nextcloud-functions-closure2string"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="closure-may-use-this">
<span id="id257"></span><h2>9.99. Closure May Use $this<a class="headerlink" href="#closure-may-use-this" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> is automatically accessible to closures.</p>
<p>When closures were introduced in PHP, they couldn’t use the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> variable, making is cumbersome to access local properties when the closure was created within an object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Invalid code in PHP 5.4 and less</span>
<span class="k">class</span> <span class="nc">Test</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testing</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Test</span><span class="p">;</span>
<span class="nv">$function</span> <span class="o">=</span> <span class="nv">$object</span><span class="o">-&gt;</span><span class="na">testing</span><span class="p">();</span>
<span class="nv">$function</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is not the case anymore since PHP 5.4.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.anonymous.php">Anonymous functions</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ClosureThisSupport</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="coalesce-and-concat">
<span id="id260"></span><h2>9.100. Coalesce And Concat<a class="headerlink" href="#coalesce-and-concat" title="Permalink to this headline">¶</a></h2>
<p>The concatenation operator dot has precedence over the coalesce operator ??.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Parenthesis are the right solution when in doubt</span>
<span class="k">echo</span> <span class="nx">a</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">??</span> <span class="s1">&#39;d&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="nv">$e</span><span class="p">;</span>

<span class="c1">// &#39;a&#39; . $b is evaluated first, leading ot a useless ?? operator</span>
<span class="s1">&#39;a&#39;</span> <span class="o">.</span> <span class="nv">$b</span> <span class="o">??</span> <span class="nv">$c</span><span class="p">;</span>

<span class="c1">// &#39;d&#39; . &#39;e&#39; is evaluated first, leading to $b OR &#39;de&#39;.</span>
<span class="k">echo</span> <span class="nv">$b</span> <span class="o">??</span> <span class="s1">&#39;d&#39;</span> <span class="o">.</span> <span class="s1">&#39;e&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id261">
<h3>9.100.1. Suggestions<a class="headerlink" href="#id261" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add parenthesis around ?? operator to avoid misbehavior</li>
<li>Do not use dot and ?? together in the same expression</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CoalesceAndConcat</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="coalesce-equal">
<span id="id262"></span><h2>9.101. Coalesce Equal<a class="headerlink" href="#coalesce-equal" title="Permalink to this headline">¶</a></h2>
<p>Usage of coalesce assignement operator. The operator is available in PHP since PHP 7.4.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Coalesce operator, since PHP 5.3</span>
<span class="nv">$a</span> <span class="o">??=</span> <span class="s1">&#39;default value&#39;</span><span class="p">;</span>

<span class="c1">// Equivalent to the line above</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$a</span> <span class="o">??</span> <span class="s1">&#39;default value&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.comparison.php#language.operators.comparison.ternary">Ternary Operator</a>.</p>
<div class="section" id="id263">
<h3>9.101.1. Suggestions<a class="headerlink" href="#id263" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the short assignement syntax</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/CoalesceEqual</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.4 and more recent</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="common-alternatives">
<span id="id264"></span><h2>9.102. Common Alternatives<a class="headerlink" href="#common-alternatives" title="Permalink to this headline">¶</a></h2>
<p>In the following conditional structures, expressions were found that are common to both ‘then’ and ‘else’. It may be interesting, though not always possible, to put them both out of the conditional, and reduce line count.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$b</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$b</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
    <span class="nv">$b</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>may be rewritten in :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$b</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$b</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id265">
<h3>9.102.1. Suggestions<a class="headerlink" href="#id265" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Collect common expressions, and move them before of after the if/then expression.</li>
<li>Move a prefix and suffixes to a third-party method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CommonAlternatives</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-structures-commonalternatives"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#nextcloud-structures-commonalternatives"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="compact-inexistant-variable">
<span id="id266"></span><h2>9.103. Compact Inexistant Variable<a class="headerlink" href="#compact-inexistant-variable" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/compact">Compact()</a> doesn’t warn when it tries to work on an inexistant variable. It just ignores the variable.</p>
<p>This behavior changed in PHP 7.3, and <a class="reference external" href="https://www.php.net/compact">compact()</a> now emits a warning when the compacted variable doesn’t exist.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// $c doesn&#39;t exists, and is not compacted.</span>
    <span class="k">return</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>For performances reasons, this analysis only works inside methods and functions.</p>
<p>See also <a class="reference external" href="http://www.php.net/compact">compact</a> and <a class="reference external" href="https://wiki.php.net/rfc/compact">PHP RFC: Make compact function reports undefined passed variables</a>.</p>
<div class="section" id="id269">
<h3>9.103.1. Suggestions<a class="headerlink" href="#id269" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the name of variable in the compact() argument list</li>
<li>Remove the name of variable in the compact() argument list</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/CompactInexistant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="compare-hash">
<span id="id270"></span><h2>9.104. Compare Hash<a class="headerlink" href="#compare-hash" title="Permalink to this headline">¶</a></h2>
<p>When comparing hash values, it is important to use the strict comparison : <a class="reference external" href="https://www.php.net/hash_equals">hash_equals()</a>, <code class="docutils literal notranslate"><span class="pre">===</span></code> or <code class="docutils literal notranslate"><span class="pre">!==</span></code>.</p>
<p>In a number of situations, the hash value will start with <code class="docutils literal notranslate"><span class="pre">0e</span></code>, and PHP will understand that the comparison involves integers : it will then convert the strings into numbers, and it may end up converting them to 0.</p>
<p>Here is an example :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The two following passwords hashes matches, while they are not the same.</span>
<span class="nv">$hashed_password</span> <span class="o">=</span> <span class="mf">0e462097431906509000000000000</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">,</span><span class="s1">&#39;240610708&#39;</span><span class="p">,</span><span class="k">false</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$hashed_password</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">print</span> <span class="s1">&#39;Matched.&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// hash returns a string, that is mistaken with 0 by PHP</span>
<span class="c1">// The strength of the hashing algorithm is not a problem</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;ripemd160&#39;</span><span class="p">,</span><span class="s1">&#39;20583002034&#39;</span><span class="p">,</span><span class="k">false</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">print</span> <span class="s1">&#39;Matched.&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">,</span><span class="s1">&#39;240610708&#39;</span><span class="p">,</span><span class="k">false</span><span class="p">)</span> <span class="o">!==</span> <span class="nv">$hashed_password</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">print</span> <span class="s1">&#39;NOT Matched.&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Display true</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">md5</span><span class="p">(</span><span class="s1">&#39;240610708&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">md5</span><span class="p">(</span><span class="s1">&#39;QNKCDZO&#39;</span><span class="p">)</span> <span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>You may also use <a class="reference external" href="https://www.php.net/password_hash">password_hash()</a> and <a class="reference external" href="https://www.php.net/password_verify">password_verify()</a> : they work together without integer conversion problems, and they can’t be confused with a number.</p>
<p>See also <a class="reference external" href="https://blog.whitehatsec.com/magic-hashes/">Magic Hashes</a> <a class="reference external" href="https://stackoverflow.com/questions/5211132/what-is-the-best-way-to-compare-hashed-strings-php/23959696#23959696">What is the best way to compare hashed strings? (PHP)</a> and <a class="reference external" href="https://news.ycombinator.com/item?id=9484757">md5(‘240610708’) == md5(‘QNKCDZO’)</a>.</p>
<div class="section" id="id271">
<h3>9.104.1. Suggestions<a class="headerlink" href="#id271" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use dedicated functions for hash comparisons</li>
<li>Use identity operators (===), and not equality operators (==) to compare hashes</li>
<li>Compare hashes in the database (or external system), where such confusion is not possible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/CompareHash</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/strict-comparisons.md">strict-comparisons</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#traq-security-comparehash"><span class="std std-ref">Traq</span></a>, <a class="reference internal" href="Cases.html#livezilla-security-comparehash"><span class="std std-ref">LiveZilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="compared-comparison">
<span id="id272"></span><h2>9.105. Compared Comparison<a class="headerlink" href="#compared-comparison" title="Permalink to this headline">¶</a></h2>
<p>Usually, comparison are sufficient, and it is rare to have to compare the result of comparison. Check if this two-stage comparison is really needed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$needle</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// the expression above apply precedence :</span>
<span class="c1">// it is equivalent to :</span>
<span class="k">if</span> <span class="p">((</span><span class="nv">$a</span> <span class="o">===</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$needle</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operators Precedence</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ComparedComparison</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="complex-dynamic-names">
<span id="id274"></span><h2>9.106. Complex Dynamic Names<a class="headerlink" href="#complex-dynamic-names" title="Permalink to this headline">¶</a></h2>
<p>Avoid using expressions as names for variables or methods.</p>
<p>There are no place for checks or flow control, leading to any rogue value to be used as is. Besides, the expression is often overlooked, and not expected there : this makes the code less readable.</p>
<p>It is recommended to build the name in a separate variable, apply the usual checks for existence and validity, and then use the name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Code is more readable</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nx">strolower</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">property_exists</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$name</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">missingPropertyexception</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="nv">$name</span><span class="p">;</span>

<span class="c1">// This is not check</span>
<span class="k">echo</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="p">{</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$string</span><span class="p">)};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis only accept simple containers, such as variables, properties.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">Dynamically Access PHP Object Properties with `$this</a> &lt;<a class="reference external" href="https://drupalize.me/blog/201508/dynamically-access-php-object-properties">https://drupalize.me/blog/201508/dynamically-access-php-object-properties</a>&gt;`_.</p>
<div class="section" id="id275">
<h3>9.106.1. Suggestions<a class="headerlink" href="#id275" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extract the expression from the variable syntax, and make it a separate variable.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/ComplexDynamicNames</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="concat-and-addition">
<span id="id276"></span><h2>9.107. Concat And Addition<a class="headerlink" href="#concat-and-addition" title="Permalink to this headline">¶</a></h2>
<p>Precedence between addition and concatenation has changed. In PHP 7.4, addition has precedence, and before, addition and concatenation had the same precedence.</p>
<p>From the RFC : <code class="docutils literal notranslate"><span class="pre">Currently</span> <span class="pre">the</span> <span class="pre">precedence</span> <span class="pre">of</span> <span class="pre">'.',</span> <span class="pre">'+'</span> <span class="pre">and</span> <span class="pre">'-'</span> <span class="pre">operators</span> <span class="pre">are</span> <span class="pre">equal.</span> <span class="pre">Any</span> <span class="pre">combination</span> <span class="pre">of</span> <span class="pre">these</span> <span class="pre">operators</span> <span class="pre">are</span> <span class="pre">simply</span> <span class="pre">evaluated</span> <span class="pre">left-to-right</span></code>.</p>
<p>This is counter-intuitive though: you rarely want to add or subtract concatenated strings which in general are not numbers. However, given PHP’s capability of seamlessly converting an integer to a string, concatenation of these values is desired.``</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Extracted from the RFC</span>
<span class="k">echo</span> <span class="nx">sum</span><span class="o">:</span> <span class="o">.</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>

<span class="c1">// current behavior: evaluated left-to-right</span>
<span class="k">echo</span> <span class="p">(</span><span class="nx">sum</span><span class="o">:</span> <span class="o">.</span> <span class="nv">$a</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>

<span class="c1">// desired behavior: addition and subtraction have a higher precendence</span>
<span class="k">echo</span> <span class="nx">sum</span> <span class="o">:</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis reports any addition and concatenation that are mixed, without parenthesis. Addition also means substraction here, aka using <cite>+</cite> or <cite>-</cite>.</p>
<p>The same applies to bitshift operations, <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>. There is no RFC for this change.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/concatenation_precedence">Change the precedence of the concatenation operator</a>.</p>
<div class="section" id="id277">
<h3>9.107.1. Suggestions<a class="headerlink" href="#id277" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add parenthesis around the addition to ensure its expected priority</li>
<li>Move the addition outside the concatenation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="96%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ConcatAndAddition</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="concat-empty-string">
<span id="id278"></span><h2>9.108. Concat Empty String<a class="headerlink" href="#concat-empty-string" title="Permalink to this headline">¶</a></h2>
<p>Using a concatenation to make a value a string should be replaced with a type cast.</p>
<p>Type cast to a string is done with <code class="docutils literal notranslate"><span class="pre">(string)</span></code> operator. There is also the function <a class="reference external" href="https://www.php.net/strval">strval()</a>, although it is less recommended.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// explicite way to cast a value</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$a</span><span class="p">;</span> <span class="c1">// $b is a string with the content 3</span>

<span class="c1">// Wrong way to cast a value</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nv">$a</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span><span class="p">;</span> <span class="c1">// $c is a string with the content 3</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span> <span class="nv">$a</span><span class="p">;</span> <span class="c1">// $c is a string with the content 3</span>
<span class="nv">$a</span> <span class="o">.=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>     <span class="c1">// $a is a string with the content 3</span>

<span class="c1">// Wrong way to cast a value</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nv">$a</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span> <span class="o">.</span> <span class="nv">$b</span><span class="p">;</span> <span class="c1">// This is not reported. The empty string is useless, but not meant to type cast</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://php.net/manual/en/language.types.type-juggling.php#language.types.typecasting">Type Casting</a> and <a class="reference external" href="https://developer.hyvor.com/tutorials/php/type-casting">PHP Type Casting</a>.</p>
<div class="section" id="id279">
<h3>9.108.1. Suggestions<a class="headerlink" href="#id279" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid concatenating with empty strings</li>
<li>Use (string) operator to cast to string</li>
<li>Remove any concatenated empty string</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ConcatEmpty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="concrete-visibility">
<span id="id280"></span><h2>9.109. Concrete Visibility<a class="headerlink" href="#concrete-visibility" title="Permalink to this headline">¶</a></h2>
<p>Methods that implements an interface in a class must be public.</p>
<p>PHP does lint this, unless the interface and the class are in the same file. At execution, it stops immediately with a Fatal error : ‘Access level to c::iPrivate() must be public (as in class i) ‘;</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">iPrivate</span><span class="p">()</span> <span class="p">;</span>
    <span class="k">function</span> <span class="nf">iProtected</span><span class="p">()</span> <span class="p">;</span>
    <span class="k">function</span> <span class="nf">iPublic</span><span class="p">()</span> <span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">c</span> <span class="k">implements</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="c1">// Methods that implements an interface in a class must be public.</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">iPrivate</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">iProtected</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">iPublic</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.interfaces.php">Interfaces</a>.</p>
<div class="section" id="id281">
<h3>9.109.1. Suggestions<a class="headerlink" href="#id281" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always set interface methods to public.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/ConcreteVisibility</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="configure-extract">
<span id="id282"></span><h2>9.110. Configure Extract<a class="headerlink" href="#configure-extract" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.php.net/extract">extract()</a> function overwrites local variables when left unconfigured.</p>
<p>Extract imports variables from an array into the local scope. In case of a conflict, that is when a local variable already exists, it overwrites the previous variable.</p>
<p>In fact, <a class="reference external" href="https://www.php.net/extract">extract()</a> may be configured to handle the situation differently : it may skip the conflicting variable, prefix it, prefix it only if it exists, only import overwriting variables… It may also import them as references to the original values.</p>
<p>This analysis reports <a class="reference external" href="https://www.php.net/extract">extract()</a> when it is not configured explicitly. If overwriting is the intended objective, it is not reported.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// ignore overwriting variables</span>
<span class="nb">extract</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nx">EXTR_SKIP</span><span class="p">);</span>

<span class="c1">// prefix all variables explicitly variables with &#39;php_&#39;</span>
<span class="nb">extract</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nx">EXTR_PREFIX_ALL</span><span class="p">,</span> <span class="s1">&#39;php_&#39;</span><span class="p">);</span>

<span class="c1">// overwrites explicitly variables</span>
<span class="nb">extract</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nx">EXTR_OVERWRITE</span><span class="p">);</span>

<span class="c1">// overwrites implicitely variables : do we really want that?</span>
<span class="nb">extract</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nx">EXTR_OVERWRITE</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Always avoid using <a class="reference external" href="https://www.php.net/extract">extract()</a> on untrusted sources, such as <code class="docutils literal notranslate"><span class="pre">$_GET</span></code>, <code class="docutils literal notranslate"><span class="pre">$_POST</span></code>, <code class="docutils literal notranslate"><span class="pre">$_FILES</span></code>, or even databases records.</p>
<p>See also <a class="reference external" href="https://www.php.net/extract">extract</a>.</p>
<div class="section" id="id287">
<h3>9.110.1. Suggestions<a class="headerlink" href="#id287" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use the second argument of extract(), and avoid using <code class="docutils literal notranslate"><span class="pre">EXTR_OVERWRITE</span></code></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/ConfigureExtract</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-security-configureextract"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#dolibarr-security-configureextract"><span class="std std-ref">Dolibarr</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="const-visibility-usage">
<span id="id288"></span><h2>9.111. Const Visibility Usage<a class="headerlink" href="#const-visibility-usage" title="Permalink to this headline">¶</a></h2>
<p>Visibility for class constant controls the accessibility to class constant.</p>
<p>A public constant may be used anywhere in the code; a protected constant usage is restricted to the class and its relatives; a private constant is restricted to itself.</p>
<p>This feature was introduced in PHP 7.1. It is recommended to use explicit visibility, and, whenever possible, make the visibility private.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">protected</span> <span class="k">const</span> <span class="no">b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">const</span> <span class="no">c</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">d</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">const</span> <span class="no">d</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.constants.php">Class Constants</a> and <a class="reference external" href="https://wiki.php.net/rfc/class_const_visibility">PHP RFC: Support Class Constant Visibility</a>.</p>
<div class="section" id="id289">
<h3>9.111.1. Suggestions<a class="headerlink" href="#id289" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add constant visibility, at least ‘public’.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ConstVisibilityUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="const-with-array">
<span id="id290"></span><h2>9.112. Const With Array<a class="headerlink" href="#const-with-array" title="Permalink to this headline">¶</a></h2>
<p>The const keyword supports array. This feature was added in PHP 5.6.</p>
<p>The array must be filled with other constants. It may also be build using the ‘+’ operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">const</span> <span class="no">PRIMES</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">];</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">TWENTY_THREE</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">MORE_PRIMES</span> <span class="o">=</span> <span class="nx">PRIMES</span> <span class="o">+</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">19</span><span class="p">];</span>
    <span class="k">const</span> <span class="no">EVEN_MORE_PRIMES</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">MORE_PRIMES</span> <span class="o">+</span> <span class="p">[</span><span class="nx">self</span><span class="o">::</span><span class="na">TWENTY_THREE</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.constants.php">Class Constants</a> and <a class="reference external" href="https://www.php.net/manual/en/language.constants.syntax.php">Constants Syntax</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ConstWithArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="constant-class">
<span id="id292"></span><h2>9.113. Constant Class<a class="headerlink" href="#constant-class" title="Permalink to this headline">¶</a></h2>
<p>A class or an interface only made up of constants. Constants usually have to be used in conjunction of some behavior (methods, class…) and never alone.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">ConstantClass</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">KBIT</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">MBIT</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">KBIT</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">GBIT</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">MBIT</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">PBIT</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">GBIT</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>As such, they should be PHP constants (build with define or const), or included in a class with other methods and properties.</p>
<p>See also <a class="reference external" href="https://stackoverflow.com/questions/16838266/php-classes-containing-only-constants">PHP Classes containing only constants</a>.</p>
<div class="section" id="id293">
<h3>9.113.1. Suggestions<a class="headerlink" href="#id293" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the class an interface</li>
<li>Make the class an abstract class, to avoid its instantiation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ConstantClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="constant-comparison">
<span id="id294"></span><h2>9.114. Constant Comparison<a class="headerlink" href="#constant-comparison" title="Permalink to this headline">¶</a></h2>
<p>Constant to the left or right is a favorite.</p>
<p>Comparisons are commutative : they may be $a == B or B == $a. The analyzed code show less than 10% of one of the two : for consistency reasons, it is recommended to make them all the same.</p>
<p>Putting the constant on the left is also called ‘Yoda Comparison’, as it mimics the famous characters style of speech. It prevents errors like ‘B = $a’ where the comparison is turned into an assignation.</p>
<p>The natural way is to put the constant on the right. It is often less surprising.</p>
<p>Every comparison operator is used when finding the favorite.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nx">B</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">&gt;</span> <span class="nx">D</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$e</span> <span class="o">!==</span> <span class="nx">G</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">do</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$f</span> <span class="o">===</span> <span class="nx">B</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nx">B</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>

<span class="c1">// be consistent</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">B</span> <span class="o">===</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// Compari</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">B</span> <span class="o">&lt;=</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ConstantComparisonConsistance</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="constant-scalar-expressions">
<span id="id295"></span><h2>9.115. Constant Scalar Expressions<a class="headerlink" href="#constant-scalar-expressions" title="Permalink to this headline">¶</a></h2>
<p>Define constant with the result of <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> expressions. This means that constants may be defined with the const keyword, with the help of various operators but without any functioncalls.</p>
<p>This feature was introduced in PHP 5.6. It also supports <a class="reference external" href="https://www.php.net/array">array()</a>, and expressions in arrays.</p>
<p>Those expressions (using simple operators) may only manipulate other constants, and all values must be known at compile time.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// simple definition</span>
<span class="k">const</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// constant scalar expression</span>
<span class="k">const</span> <span class="no">B</span> <span class="o">=</span> <span class="nx">A</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// constant scalar expression</span>
<span class="k">const</span> <span class="no">C</span> <span class="o">=</span> <span class="p">[</span><span class="nx">A</span> <span class="o">**</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span> <span class="o">=&gt;</span> <span class="nx">B</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/const_scalar_exprs">Constant Scalar Expressions</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ConstantScalarExpression</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="constant-typo-looks-like-a-variable">
<span id="id299"></span><h2>9.116. Constant Typo Looks Like A Variable<a class="headerlink" href="#constant-typo-looks-like-a-variable" title="Permalink to this headline">¶</a></h2>
<p>A constant bears the same name as a variable. This might be a typo.</p>
<p>When the constant doesn’t exist, PHP 8.0 yields a Fatal Error and stops execution. PHP 7.4 turns the undefined constant into its string equivalent.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Get an object or null</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span>

<span class="c1">// PHP 8.0 stops here, with a Fatal Error</span>
<span class="c1">// PHP 7.4 makes this a string, and the condition is always true</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nx">object</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// In PHP 7.4, this is not protected by the condition, and may yield an error.</span>
    <span class="nv">$object</span><span class="o">-&gt;</span><span class="na">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis is case sensitive.</p>
<div class="section" id="id300">
<h3>9.116.1. Suggestions<a class="headerlink" href="#id300" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a $ sign to the constant</li>
<li>Use a different name for the variable, or the constant</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/ConstantTypo</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Medium</td>
</tr>
<tr class="row-odd"><td>Related rule</td>
<td><a class="reference internal" href="#undefined-constants"><span class="std std-ref">Undefined Constants</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="constants-created-outside-its-namespace">
<span id="id301"></span><h2>9.117. Constants Created Outside Its Namespace<a class="headerlink" href="#constants-created-outside-its-namespace" title="Permalink to this headline">¶</a></h2>
<p>Constants Created Outside Its Namespace.</p>
<p>Using the <a class="reference external" href="https://www.php.net/define">define()</a> function, it is possible to create constant outside their namespace, but using the fully qualified namespace.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">A\B</span> <span class="p">{</span>
    <span class="c1">// define A\B\C as 1</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">D\E</span> <span class="p">{</span>
    <span class="c1">// define A\B\C as 1, while outside the A\B namespace</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;A\B\C&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>However, this makes the code confusing and difficult to debug. It is recommended to move the constant definition to its namespace.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/CreatedOutsideItsNamespace</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="constants-with-strange-names">
<span id="id303"></span><h2>9.118. Constants With Strange Names<a class="headerlink" href="#constants-with-strange-names" title="Permalink to this headline">¶</a></h2>
<p>List of constants being defined with names that are incompatible with PHP standards.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Define a valid PHP constant</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ABC&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">const</span> <span class="no">ABCD</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// Define an invalid PHP constant</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ABC!&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;ABC!&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nb">constant</span><span class="p">(</span><span class="s1">&#39;ABC!&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;Undefined&#39;</span><span class="p">;</span>

<span class="c1">// Const doesn&#39;t allow illegal names</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.constants.php">PHP Constants</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/ConstantStrangeNames</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="continue-is-for-loop">
<span id="id304"></span><h2>9.119. Continue Is For Loop<a class="headerlink" href="#continue-is-for-loop" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> and <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a> are very similar in PHP : they both <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> out of loop or switch. Yet, <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a> should be reserved for loops.</p>
<p>Since PHP 7.3, the execution will emit a warning when finding a <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a> inside a switch inside a loop : ‘”<a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a>” targeting switch is equivalent to “<a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a>”. Did you mean to use “<a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a> 2”?’</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$foo</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">switch</span> <span class="p">(</span><span class="nv">$bar</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;baz&#39;</span><span class="o">:</span>
            <span class="k">continue</span><span class="p">;</span> <span class="c1">// In PHP: Behaves like &#39;break;&#39;</span>
                      <span class="c1">// In C:   Behaves like &#39;continue 2;&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">Deprecate and remove `continue</a> targeting switch &lt;<a class="reference external" href="https://wiki.php.net/rfc/continue_on_switch_deprecation">https://wiki.php.net/rfc/continue_on_switch_deprecation</a>&gt;`_.</p>
<div class="section" id="id313">
<h3>9.119.1. Suggestions<a class="headerlink" href="#id313" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace break by continue</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="5%" />
<col width="95%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ContinueIsForLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xoops-structures-continueisforloop"><span class="std std-ref">XOOPS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-abstract-class">
<span id="id314"></span><h2>9.120. Could Be Abstract Class<a class="headerlink" href="#could-be-abstract-class" title="Permalink to this headline">¶</a></h2>
<p>An abstract class is never instantiated, and has children class that are. As such, a ‘<a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a>’ class that is never instantiated by itself, but has its own children instantiated could be marked as abstract.</p>
<p>That will prevent new code to try to instantiate it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Example code would actually be split over multiple files.</span>


<span class="c1">// That class could be abstract</span>
<span class="k">class</span> <span class="nc">motherClass</span> <span class="p">{}</span>

<span class="c1">// Those classes shouldn&#39;t be abstract</span>
<span class="k">class</span> <span class="nc">firstChildren</span> <span class="k">extends</span> <span class="nx">motherClass</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">secondChildren</span> <span class="k">extends</span> <span class="nx">motherClass</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">thirdChildren</span> <span class="k">extends</span> <span class="nx">motherClass</span> <span class="p">{}</span>

<span class="k">new</span> <span class="nx">firstChildren</span><span class="p">();</span>
<span class="k">new</span> <span class="nx">secondChildren</span><span class="p">();</span>
<span class="k">new</span> <span class="nx">thirdChildren</span><span class="p">();</span>

<span class="c1">//Not a single : new motherClass()</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/abstract">Class Abstraction</a> <a class="reference external" href="https://phpenthusiast.com/object-oriented-php-tutorials/abstract-classes-and-methods">Abstract classes and methods</a>.</p>
<div class="section" id="id317">
<h3>9.120.1. Suggestions<a class="headerlink" href="#id317" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make this class an abstract class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeAbstractClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#edusoho-classes-couldbeabstractclass"><span class="std std-ref">Edusoho</span></a>, <a class="reference internal" href="Cases.html#shopware-classes-couldbeabstractclass"><span class="std std-ref">shopware</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-callable">
<span id="id318"></span><h2>9.121. Could Be Callable<a class="headerlink" href="#could-be-callable" title="Permalink to this headline">¶</a></h2>
<p>Mark arguments and return types that can be set to <code class="docutils literal notranslate"><span class="pre">callable</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Accept a callable as input</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returns value as return</span>
    <span class="k">return</span> <span class="nv">$b</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id319">
<h3>9.121.1. Suggestions<a class="headerlink" href="#id319" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add <cite>callable</cite> typehint to the code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeCallable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-class-constant">
<span id="id320"></span><h2>9.122. Could Be Class Constant<a class="headerlink" href="#could-be-class-constant" title="Permalink to this headline">¶</a></h2>
<p>When a property is defined and read, but never modified, it may be a constant.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// $this-&gt;bar is never modified.</span>
    <span class="k">private</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// $this-&gt;foofoo is modified, at least once</span>
    <span class="k">private</span> <span class="nv">$foofoo</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">method</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foofoo</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">+</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foofoo</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foofoo</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Starting with PHP 5.6, even <a class="reference external" href="https://www.php.net/array">array()</a> may be defined as constants.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeClassConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="could-be-constant">
<span id="id322"></span><h2>9.123. Could Be Constant<a class="headerlink" href="#could-be-constant" title="Permalink to this headline">¶</a></h2>
<p>Literals may be replaced by an existing constant.</p>
<p>Constants makes the code easier to read, as they may bear a meaningful name. They also hide implementation values, with a readable name, such as <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">READABLE=</span> <span class="pre">true;</span></code>. Later, upgrading constant values is easier than scouring the code with a new literal.</p>
<p>Not all literal can be replaced by a constant values : sometimes, literal may have the same literal value, but different meanings. Check with your application semantics before changing any literal with a constant.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">const</span> <span class="no">A</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">X</span> <span class="o">=</span> <span class="s1">&#39;abcd&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Could be replaced by B;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;ab&#39;</span><span class="p">;</span>

<span class="c1">// Could be replaced by A;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>

<span class="c1">// Could be replaced by foo::X;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;abcd&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis currently doesn’t support arrays.</p>
<p>This analysis also skips very common values, such as boolean, <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">1</span></code>. This prevents too many false positive.</p>
<div class="section" id="id323">
<h3>9.123.1. Suggestions<a class="headerlink" href="#id323" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Turn the literal into an existing constant</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/CouldBeConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-else">
<span id="id324"></span><h2>9.124. Could Be Else<a class="headerlink" href="#could-be-else" title="Permalink to this headline">¶</a></h2>
<p>Merge opposition conditions into one if/then structure.</p>
<p>When two if/then structures follow each other, using a condition and its opposite, they may be merged into one.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Short version</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Long version</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id325">
<h3>9.124.1. Suggestions<a class="headerlink" href="#id325" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge the two conditions into one structure</li>
<li>Check if the second condition is still applicable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CouldBeElse</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#sugarcrm-structures-couldbeelse"><span class="std std-ref">SugarCrm</span></a>, <a class="reference internal" href="Cases.html#openemr-structures-couldbeelse"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-float">
<span id="id326"></span><h2>9.125. Could Be Float<a class="headerlink" href="#could-be-float" title="Permalink to this headline">¶</a></h2>
<p>Mark arguments, properties and return types that can be set to <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Accept an int as input</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returns a float (cubic root of $b);</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id327">
<h3>9.125.1. Suggestions<a class="headerlink" href="#id327" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add <cite>float</cite> typehint to the code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeFloat</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-integer">
<span id="id328"></span><h2>9.126. Could Be Integer<a class="headerlink" href="#could-be-integer" title="Permalink to this headline">¶</a></h2>
<p>Mark arguments, properties and return types that can be set to <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Accept an int as input</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returns an int</span>
    <span class="k">return</span> <span class="nv">$b</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id329">
<h3>9.126.1. Suggestions<a class="headerlink" href="#id329" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add <cite>int</cite> typehint to the code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeInt</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-iterable">
<span id="id330"></span><h2>9.127. Could Be Iterable<a class="headerlink" href="#could-be-iterable" title="Permalink to this headline">¶</a></h2>
<p>Mark arguments, properties and return types that can be set to <code class="docutils literal notranslate"><span class="pre">iterable</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Accept an array or a traversable Object as input</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$b</span> <span class="k">as</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>

    <span class="p">}</span>

    <span class="c1">// Returns an array</span>
    <span class="k">return</span> <span class="p">[</span><span class="nv">$b</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id331">
<h3>9.127.1. Suggestions<a class="headerlink" href="#id331" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add <cite>iterable</cite> typehint to the code (PHP 8.0+).</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeIterable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-null">
<span id="id332"></span><h2>9.128. Could Be Null<a class="headerlink" href="#could-be-null" title="Permalink to this headline">¶</a></h2>
<p>Mark arguments and return types that can be null.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Accept null as input, when used as third argument of file_get_contents</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$s</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="nx">URL</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>

    <span class="c1">// Returns a string</span>
    <span class="k">return</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="nv">$s</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id333">
<h3>9.128.1. Suggestions<a class="headerlink" href="#id333" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add <cite>null</cite> typehint to the code (PHP 8.0+).</li>
<li>Add <cite>?</cite> typehint to the code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeNull</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-parent">
<span id="id334"></span><h2>9.129. Could Be Parent<a class="headerlink" href="#could-be-parent" title="Permalink to this headline">¶</a></h2>
<p>Mark arguments, return types and properties that can be set to <code class="docutils literal notranslate"><span class="pre">parent</span></code>.</p>
<p>This analysis works when typehints have already been configured.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="k">extends</span> <span class="nx">w</span> <span class="p">{</span>
    <span class="c1">// Accept a w object as input</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">w</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">:</span> <span class="nx">w</span> <span class="p">{</span>
        <span class="c1">// Returns a w object</span>
        <span class="k">return</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id335">
<h3>9.129.1. Suggestions<a class="headerlink" href="#id335" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add <cite>parent</cite> typehint to the code.</li>
<li>Add the literal class/type typehint to the code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeParent</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-parent-method">
<span id="id336"></span><h2>9.130. Could Be Parent Method<a class="headerlink" href="#could-be-parent-method" title="Permalink to this headline">¶</a></h2>
<p>A method is defined in several children, but not in a the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class. It may be worth checking if this method doesn’t belong the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class, as an abstraction.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The parent class</span>
<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// The children class</span>
<span class="k">class</span> <span class="nc">y1</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="c1">// foo is common to y1 and y2, so it shall be also a method in x</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
    <span class="c1">// fooY1 is specific to y1</span>
    <span class="k">function</span> <span class="nf">fooY1</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">y2</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
    <span class="c1">// fooY2 is specific to y1</span>
    <span class="k">function</span> <span class="nf">fooY2</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Only the name of the method is used is for gathering purposes. If the code has grown organically, the signature (default values, typehint, argument names) may have followed different path, and will require a refactorisation.</p>
<div class="section" id="id339">
<h3>9.130.1. Suggestions<a class="headerlink" href="#id339" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create an abstract method in the parent</li>
<li>Create an concrete method in the parent, and move default behavior there by removing it in children classes</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="12%" />
<col width="12%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>minChildren</td>
<td>4</td>
<td>integer</td>
<td>Minimal number of children using this method.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeParentMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-private-class-constant">
<span id="id340"></span><h2>9.131. Could Be Private Class Constant<a class="headerlink" href="#could-be-private-class-constant" title="Permalink to this headline">¶</a></h2>
<p>Class constant may use <code class="docutils literal notranslate"><span class="pre">private</span></code> visibility.</p>
<p>Since PHP 7.1, constants may also have a public/protected/private visibility. This restrict their usage to anywhere, class and children or class.</p>
<p>As a general rule, it is recommended to make constant <code class="docutils literal notranslate"><span class="pre">private</span></code> by default, and to relax this restriction as needed. PHP makes them public by default.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// pre-7.1 style</span>
    <span class="k">const</span> <span class="no">PRE_71_CONSTANT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// post-7.1 style</span>
    <span class="k">private</span> <span class="k">const</span> <span class="no">PRIVATE_CONSTANT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">PUBLIC_CONSTANT</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// PRIVATE CONSTANT may only be used in its class</span>
        <span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">PRIVATE_CONSTANT</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Other constants may be used anywhere</span>
<span class="k">function</span> <span class="nf">x</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="nx">foo</span><span class="o">::</span><span class="na">PUBLIC_CONSTANT</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$a</span><span class="o">.</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="nx">foo</span><span class="o">:</span><span class="nx">PRE_71_CONSTANT</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Constant shall stay <code class="docutils literal notranslate"><span class="pre">public</span></code> when the code has to be compatible with PHP 7.0 and older.</p>
<p>They also have to be public in the case of component : some of those constants have to be used by external actors, in order to configure the component.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.constants.php">Class Constants</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBePrivateConstante</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phinx-classes-couldbeprivateconstante"><span class="std std-ref">Phinx</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="could-be-protected-class-constant">
<span id="id342"></span><h2>9.132. Could Be Protected Class Constant<a class="headerlink" href="#could-be-protected-class-constant" title="Permalink to this headline">¶</a></h2>
<p>Class constant may use ‘protected’ visibility.</p>
<p>Since PHP 7.1, constants may also have a public/protected/private visibility. This restrict their usage to anywhere, class and children or class.</p>
<p>As a general rule, it is recommended to make constant ‘private’ by default, and to relax this restriction as needed. PHP makes them public by default.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// pre-7.1 style</span>
    <span class="k">const</span> <span class="no">PRE_71_CONSTANT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// post-7.1 style</span>
    <span class="k">protected</span> <span class="k">const</span> <span class="no">PROTECTED_CONSTANT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">PUBLIC_CONSTANT</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">foo2</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// PROTECTED_CONSTANT may only be used in its class or its children</span>
        <span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">PROTECTED_CONSTANT</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">foo3</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// PROTECTED_CONSTANT may only be used in its class or any of its children</span>
        <span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">PROTECTED_CONSTANT</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Other constants may be used anywhere</span>
<span class="k">function</span> <span class="nf">x</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="nx">foo</span><span class="o">::</span><span class="na">PUBLIC_CONSTANT</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$a</span><span class="o">.</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="nx">foo</span><span class="o">:</span><span class="nx">PRE_71_CONSTANT</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeProtectedConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="could-be-protected-method">
<span id="id343"></span><h2>9.133. Could Be Protected Method<a class="headerlink" href="#could-be-protected-method" title="Permalink to this headline">¶</a></h2>
<p>Those methods are declared public, but are never used publicly. They may be made protected.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// Public, and used publicly</span>
    <span class="k">public</span> <span class="nx">publicMethod</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// Public, but never used outside the class or its children</span>
    <span class="k">public</span> <span class="nx">protectedMethod</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">protectedMethod</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">publicMethod</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>These properties may even be made private.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeProtectedMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="could-be-protected-property">
<span id="id344"></span><h2>9.134. Could Be Protected Property<a class="headerlink" href="#could-be-protected-property" title="Permalink to this headline">¶</a></h2>
<p>Those properties are declared public, but are never used publicly. They may be made protected.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// Public, and used publicly</span>
    <span class="k">public</span> <span class="nv">$publicProperty</span><span class="p">;</span>
    <span class="c1">// Public, but never used outside the class or its children</span>
    <span class="k">public</span> <span class="nv">$protectedProperty</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">protectedProperty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">publicProperty</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This property may even be made private.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeProtectedProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="could-be-self">
<span id="id345"></span><h2>9.135. Could Be Self<a class="headerlink" href="#could-be-self" title="Permalink to this headline">¶</a></h2>
<p>Mark arguments, return types and properties that can be set to <code class="docutils literal notranslate"><span class="pre">self</span></code>.</p>
<p>This analysis works when typehints have already been configured.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="c1">// Accept a x object as input</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">x</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">:</span> <span class="nx">x</span> <span class="p">{</span>
        <span class="c1">// Returns a x object</span>
        <span class="k">return</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id346">
<h3>9.135.1. Suggestions<a class="headerlink" href="#id346" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add <cite>self</cite> typehint to the code.</li>
<li>Add the literal class/type typehint to the code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeSelf</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-static">
<span id="id347"></span><h2>9.136. Could Be Static<a class="headerlink" href="#could-be-static" title="Permalink to this headline">¶</a></h2>
<p>This global is only used in one function or method. It may be called ‘<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>’, instead of global. This allows you to keep the value between call to the function, but will not be accessible outside this function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">static</span> <span class="nv">$variableIsReservedForX</span><span class="p">;</span> <span class="c1">// only accessible within foo( ), even between calls.</span>
    <span class="k">global</span> <span class="nv">$variableIsGlobal</span><span class="p">;</span>       <span class="c1">//      accessible everywhere in the application</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CouldBeStatic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-structures-couldbestatic"><span class="std std-ref">Dolphin</span></a>, <a class="reference internal" href="Cases.html#contao-structures-couldbestatic"><span class="std std-ref">Contao</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="could-be-static-closure">
<span id="id349"></span><h2>9.137. Could Be Static Closure<a class="headerlink" href="#could-be-static-closure" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/class.closure.php">Closure</a> may be <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>, and prevent the import of <code class="docutils literal notranslate"><span class="pre">$this</span></code>.</p>
<p>By preventing the useless import of <code class="docutils literal notranslate"><span class="pre">$this</span></code>, you avoid useless work.</p>
<p>This also has the added value to prevent the usage of <code class="docutils literal notranslate"><span class="pre">$this</span></code> from the closure. This is a good security practice.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
    <span class="p">{</span>

        <span class="c1">// Not possible to use $this</span>
        <span class="nv">$func</span> <span class="o">=</span> <span class="k">static</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="p">};</span>
        <span class="nv">$func</span><span class="p">();</span>

        <span class="c1">// Normal import of $this</span>
        <span class="nv">$closure</span> <span class="o">=</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">};</span>
<span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is a micro-optimisation. Apply it in case of intensive usage.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.anonymous.php">Anonymous functions</a>, <a class="reference external" href="https://github.com/Ocramius/GeneratedHydrator/releases/tag/3.0.0">GeneratedHydrator</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static anonymous functions &lt;https://www.php.net/manual/en/functions.anonymous.php#functions.anonymous-functions.`static</a>&gt;`_.</p>
<div class="section" id="id353">
<h3>9.137.1. Suggestions<a class="headerlink" href="#id353" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the static keyword to the closure.</li>
<li>Make actual usage of $this in the closure.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/CouldBeStaticClosure</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#piwigo-functions-couldbestaticclosure"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-string">
<span id="id354"></span><h2>9.138. Could Be String<a class="headerlink" href="#could-be-string" title="Permalink to this headline">¶</a></h2>
<p>Mark arguments and return types that can be set to string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Accept a string as input</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Returns a string</span>
    <span class="k">return</span> <span class="nv">$a</span> <span class="o">.</span> <span class="s1">&#39;string&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id355">
<h3>9.138.1. Suggestions<a class="headerlink" href="#id355" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Choose the string typehint, and add it to the code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeString</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-stringable">
<span id="id356"></span><h2>9.139. Could Be Stringable<a class="headerlink" href="#could-be-stringable" title="Permalink to this headline">¶</a></h2>
<p>Stringable is an interface that mark classes as string-castable. It is introduced in PHP 8.0.</p>
<p>Classes that defined a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a> magic method may be turned into a string when the typehint, argument, return or property, requires it. This is not the case when strict_types is activated. Yet, until PHP 8.0, there was nothing to identify a class as such.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This class may implement Stringable</span>
<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__tostring</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;asd&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="p">(</span><span class="k">new</span> <span class="nx">x</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/stringable">PHP RFC: Add Stringable interface</a>.</p>
<div class="section" id="id357">
<h3>9.139.1. Suggestions<a class="headerlink" href="#id357" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeStringable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-be-void">
<span id="id358"></span><h2>9.140. Could Be Void<a class="headerlink" href="#could-be-void" title="Permalink to this headline">¶</a></h2>
<p>Mark return types that can be set to void.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// No return, this should be void.</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">++</span><span class="nv">$a</span><span class="p">;</span> <span class="c1">// Not useful</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>All abstract methods (in classes or in interfaces) are omitted here.</p>
<div class="section" id="id359">
<h3>9.140.1. Suggestions<a class="headerlink" href="#id359" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the void typehint to the code.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/CouldBeVoid</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-make-a-function">
<span id="id360"></span><h2>9.141. Could Make A Function<a class="headerlink" href="#could-make-a-function" title="Permalink to this headline">¶</a></h2>
<p>When a function is called across the code with the same arguments often enough, it should be turned into a local API.</p>
<p>This approach is similar to turning literals into constants : it centralize the value, it helps refactoring by updating it. It also makes the code more readable. Moreover, it often highlight common grounds between remote code locations.</p>
<p>The analysis looks for functions calls, and checks the arguments. When the calls occurs more than 4 times, it is reported.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// str_replace is used to clean &#39;&amp;&#39; from strings.</span>
<span class="c1">// It should be upgraded to a central function</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$arg</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$arg</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$arg</span><span class="p">);</span>
    <span class="c1">// do something with $arg</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">y</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$database</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$database</span><span class="o">-&gt;</span><span class="na">queryName</span><span class="p">();</span>
        <span class="nv">$value</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
        <span class="c1">// $value = removeAmpersand($value);</span>
        <span class="c1">// do something with $arg2</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// helper function</span>
<span class="k">function</span> <span class="nf">removeAmpersand</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">Don’t repeat yourself (DRY)</a>.</p>
<div class="section" id="id361">
<h3>9.141.1. Suggestions<a class="headerlink" href="#id361" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create a constant for common pieces of data</li>
<li>Create a function based on context-free repeated elements</li>
<li>Create a class based on repeated elements with dependent values</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="8%" />
<col width="8%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>centralizeThreshold</td>
<td>8</td>
<td>integer</td>
<td>Minimal number of calls of the function with one common argument.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/CouldCentralize</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-alias">
<span id="id362"></span><h2>9.142. Could Use Alias<a class="headerlink" href="#could-use-alias" title="Permalink to this headline">¶</a></h2>
<p>This long name may be reduced by using an available alias.</p>
<p>This applies to classes (as full name or prefix), and to constants and functions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">a\b\c</span><span class="p">;</span>
<span class="k">use</span> <span class="k">function</span> <span class="nf">a\b\c\foo</span><span class="p">;</span>
<span class="k">use</span> <span class="k">const</span> <span class="no">a\b\c\D</span><span class="p">;</span>

<span class="c1">// This may be reduced with the above alias to c\d()</span>
<span class="k">new</span> <span class="nx">a\b\c\d</span><span class="p">();</span>

<span class="c1">// This may be reduced to c\d\e\f</span>
<span class="k">new</span> <span class="nx">a\b\c\d\e\f</span><span class="p">();</span>

<span class="c1">// This may be reduced to c()</span>
<span class="k">new</span> <span class="nx">a\b\c</span><span class="p">();</span>

<span class="c1">// This may be reduced to D</span>
<span class="k">echo</span> <span class="nx">a\b\c\D</span><span class="p">;</span>

<span class="c1">// This may be reduced to D</span>
<span class="nx">a\b\c\foo</span><span class="p">();</span>

<span class="c1">// This can&#39;t be reduced : it is an absolute name</span>
<span class="nx">\a\b\c\foo</span><span class="p">();</span>

<span class="c1">// This can&#39;t be reduced : it is no an alias nor a prefix</span>
<span class="nx">a\b\d\foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id363">
<h3>9.142.1. Suggestions<a class="headerlink" href="#id363" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use all your aliases so as to make the code shorter and more readable</li>
<li>Add new aliases for missing path</li>
<li>Make class names absolute and drop the aliases</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/CouldUseAlias</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-compact">
<span id="id364"></span><h2>9.143. Could Use Compact<a class="headerlink" href="#could-use-compact" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/compact">Compact()</a> turns a group of variables into an array. It may be used to simplify expressions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// Compact call</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">compact</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span>

<span class="nv">$array</span> <span class="o">===</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>

<span class="c1">// Detailing all the keys and their value</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="nv">$a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="nv">$b</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that compact accepts any string, and any undefined variable is not set, without a warning.</p>
<p>See also <a class="reference external" href="http://www.php.net/compact">compact</a>.</p>
<div class="section" id="id367">
<h3>9.143.1. Suggestions<a class="headerlink" href="#id367" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the array() call with a compact() call.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CouldUseCompact</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-structures-couldusecompact"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-promoted-properties">
<span id="id368"></span><h2>9.144. Could Use Promoted Properties<a class="headerlink" href="#could-use-promoted-properties" title="Permalink to this headline">¶</a></h2>
<p>Promoted properties reduce PHP code at <a class="reference external" href="https://www.php.net/manual/en/language.oop5.decon.php">__construct()</a> time. This feature is available in PHP 8.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $a argument may be promoted to property $c</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>

        <span class="c1">// $b argument cannot be upgraded to property, as it is updated.</span>
        <span class="c1">// Move the addition to the new call, or keep the syntax below</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">d</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://stitcher.io/blog/constructor-promotion-in-php-8">PHP 8: Constructor property promotion</a> and <a class="reference external" href="https://wiki.php.net/rfc/constructor_promotion">PHP RFC: Constructor Property Promotion</a>.</p>
<div class="section" id="id370">
<h3>9.144.1. Suggestions<a class="headerlink" href="#id370" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Update the constructor syntax, and remove the property specification.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/CouldUsePromotedProperties</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-short-assignation">
<span id="id371"></span><h2>9.145. Could Use Short Assignation<a class="headerlink" href="#could-use-short-assignation" title="Permalink to this headline">¶</a></h2>
<p>Use short assignment operator, to speed up code, and keep syntax clear.</p>
<p>Some operators, like * or +, have a compact and fast ‘do-and-assign’ version. They looks like a compacted version for = and the operator. This syntax is good for readability, and saves some memory in the process.</p>
<p>Depending on the operator, not all permutations of arguments are possible.</p>
<p>Addition and short assignation of addition have a different set of features when applied to arrays. Do not exchange one another in that case.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">+</span> <span class="nv">$a</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">+=</span> <span class="mi">10</span><span class="p">;</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nv">$c</span> <span class="o">=</span> <span class="nv">$c</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$c</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>

<span class="nv">$d</span> <span class="o">=</span> <span class="nv">$d</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
<span class="nv">$d</span> <span class="o">/=</span> <span class="mi">3</span><span class="p">;</span>

<span class="nv">$e</span> <span class="o">=</span> <span class="nv">$e</span> <span class="o">%</span> <span class="mi">4</span><span class="p">;</span>
<span class="nv">$e</span> <span class="o">%=</span> <span class="mi">4</span><span class="p">;</span>

<span class="nv">$f</span> <span class="o">=</span> <span class="nv">$f</span> <span class="o">|</span> <span class="mi">5</span><span class="p">;</span>
<span class="nv">$f</span> <span class="o">|=</span> <span class="mi">5</span><span class="p">;</span>

<span class="nv">$g</span> <span class="o">=</span> <span class="nv">$g</span> <span class="o">&amp;</span> <span class="mi">6</span><span class="p">;</span>
<span class="nv">$g</span> <span class="o">&amp;=</span> <span class="mi">6</span><span class="p">;</span>

<span class="nv">$h</span> <span class="o">=</span> <span class="nv">$h</span> <span class="o">^</span> <span class="mi">7</span><span class="p">;</span>
<span class="nv">$h</span> <span class="o">^=</span> <span class="mi">7</span><span class="p">;</span>

<span class="nv">$i</span> <span class="o">=</span> <span class="nv">$i</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
<span class="nv">$i</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>

<span class="nv">$j</span> <span class="o">=</span> <span class="nv">$j</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">;</span>
<span class="nv">$j</span> <span class="o">&lt;&lt;=</span> <span class="mi">9</span><span class="p">;</span>

<span class="c1">// PHP 7.4 and more recent</span>
<span class="nv">$l</span> <span class="o">=</span> <span class="nv">$l</span> <span class="o">??</span> <span class="s1">&#39;value&#39;</span><span class="p">;</span>
<span class="nv">$l</span> <span class="o">??=</span> <span class="s1">&#39;value&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Short operators are faster than the extended version, though it is a micro-optimization.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.assignment.php">Assignation Operators</a>.</p>
<div class="section" id="id372">
<h3>9.145.1. Suggestions<a class="headerlink" href="#id372" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the expression to use the short assignation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CouldUseShortAssignation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/use-short-assignations.md">use-short-assignations</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-structures-coulduseshortassignation"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#thelia-structures-coulduseshortassignation"><span class="std std-ref">Thelia</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-try">
<span id="id373"></span><h2>9.146. Could Use Try<a class="headerlink" href="#could-use-try" title="Permalink to this headline">¶</a></h2>
<p>Some commands may raise exceptions. It is recommended to use the try/catch block to intercept those exceptions, and process them.</p>
<ul class="simple">
<li>/ : <code class="docutils literal notranslate"><span class="pre">DivisionByZeroError</span></code></li>
<li>% : <code class="docutils literal notranslate"><span class="pre">DivisionByZeroError</span></code></li>
<li><a class="reference external" href="https://www.php.net/intdiv">intdiv()</a> : <code class="docutils literal notranslate"><span class="pre">DivisionByZeroError</span></code></li>
<li>&lt;&lt; : <code class="docutils literal notranslate"><span class="pre">ArithmeticError</span></code></li>
<li>&gt;&gt; : <code class="docutils literal notranslate"><span class="pre">ArithmeticError</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Phar\:\:mungserver</span></code> : <code class="docutils literal notranslate"><span class="pre">PharException</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">Phar\:\:webphar</span></code> : <code class="docutils literal notranslate"><span class="pre">PharException</span></code></li>
</ul>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/reserved.exceptions.php">Predefined Exceptions</a>, <a class="reference external" href="https://www.php.net/manual/en/class.pharexception.php">PharException</a>.</p>
<div class="section" id="id374">
<h3>9.146.1. Suggestions<a class="headerlink" href="#id374" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a try/catch clause around those commands</li>
<li>Add a check on the values used with those operator : for example, check a dividend is not 0, or a bitshift is not negative</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/CouldUseTry</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#mautic-exceptions-couldusetry"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-dir">
<span id="id375"></span><h2>9.147. Could Use __DIR__<a class="headerlink" href="#could-use-dir" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__DIR__</a> constant to access the current file’s <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> directory.</p>
<p>Avoid using <a class="reference external" href="https://www.php.net/dirname">dirname()</a> on <a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__FILE__</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Better way</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/myfile.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>

<span class="c1">// compatible, but slow way</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;/myfile.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>

<span class="c1">// Since PHP 5.3</span>
<span class="nb">assert</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)</span> <span class="o">==</span> <span class="no">__DIR__</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__DIR__</a> has been introduced in PHP 5.3.0.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">Magic Constants</a>.</p>
<div class="section" id="id378">
<h3>9.147.1. Suggestions<a class="headerlink" href="#id378" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use __DIR__ instead of <code class="docutils literal notranslate"><span class="pre">dirname(__FILE__);</span></code></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CouldUseDir</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#woocommerce-structures-couldusedir"><span class="std std-ref">Woocommerce</span></a>, <a class="reference internal" href="Cases.html#piwigo-structures-couldusedir"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-array-fill-keys">
<span id="id379"></span><h2>9.148. Could Use array_fill_keys<a class="headerlink" href="#could-use-array-fill-keys" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/array_fill_keys">array_fill_keys()</a> is a native PHP function that creates an array from keys. It gets the list of keys, and a constant value to assign to each keys.</p>
<p>This is twice faster than doing the same with a loop.</p>
<p>Note that is possible to use an object as initializing value : every element of the final array will be pointing to the same value. And, also, using an object as initializing value means that the same object will be used for each key : the object will not be cloned for each value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">);</span>

<span class="c1">// Fast way to build the array</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">array_fill_keys</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="c1">// Fast way to build the array, but every element will be the same object</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">array_fill_keys</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="k">new</span> <span class="k">Stdclass</span><span class="p">());</span>

<span class="c1">// Slow way to build the array</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$b</span><span class="p">[</span><span class="nv">$a</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Setting everything to null, slowly</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="k">function</span><span class="p">()</span> <span class="p">{},</span> <span class="nv">$array</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/array_fill_keys">array_fill_keys</a>.</p>
<div class="section" id="id382">
<h3>9.148.1. Suggestions<a class="headerlink" href="#id382" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use array_fill_keys()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CouldUseArrayFillKeys</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-structures-couldusearrayfillkeys"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#phpipam-structures-couldusearrayfillkeys"><span class="std std-ref">PhpIPAM</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-array-unique">
<span id="id383"></span><h2>9.149. Could Use array_unique<a class="headerlink" href="#could-use-array-unique" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="https://www.php.net/array_unique">array_unique()</a> to collect unique elements from an array.</p>
<p>Always try to use native PHP functions, instead of rebuilding them with custom PHP code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="nv">$unique</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$unique</span><span class="p">))</span> <span class="p">{</span>
            <span class="cm">/*  May be more code */</span>
            <span class="nv">$unique</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/array_unique">array_unique</a>.</p>
<div class="section" id="id386">
<h3>9.149.1. Suggestions<a class="headerlink" href="#id386" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Turn the foreach() and its condition into a call to array_unique()</li>
<li>Extract the condition from the foreach() and add a separate call to array_unique()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CouldUseArrayUnique</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-structures-couldusearrayunique"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#openemr-structures-couldusearrayunique"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-self">
<span id="id387"></span><h2>9.150. Could Use self<a class="headerlink" href="#could-use-self" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">self</span></code> keyword refers to the current class, or any of its parents. Using it is just as fast as the full class name, it is as readable and it is will not be changed upon class or namespace change.</p>
<p>It is also routinely used in traits : there, <code class="docutils literal notranslate"><span class="pre">self</span></code> represents the class in which the trait is used, or the trait itself.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">FOO</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">FOO</span><span class="p">;</span>
<span class="c1">// same as return x::FOO;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">Scope Resolution Operator (::)</a>.</p>
<div class="section" id="id389">
<h3>9.150.1. Suggestions<a class="headerlink" href="#id389" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>replace the explicit name with self</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ShouldUseSelf</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-classes-shoulduseself"><span class="std std-ref">WordPress</span></a>, <a class="reference internal" href="Cases.html#livezilla-classes-shoulduseself"><span class="std std-ref">LiveZilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="could-use-str-repeat">
<span id="id390"></span><h2>9.151. Could Use str_repeat()<a class="headerlink" href="#could-use-str-repeat" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="https://www.php.net/str_repeat">str_repeat()</a> or <a class="reference external" href="https://www.php.net/str_pad">str_pad()</a> instead of making a loop.</p>
<p>Making a loop to repeat the same concatenation is actually much longer than using <a class="reference external" href="https://www.php.net/str_repeat">str_repeat()</a>. As soon as the loop repeats more than twice, <a class="reference external" href="https://www.php.net/str_repeat">str_repeat()</a> is much faster. With arrays of 30, the difference is significant, though the whole operation is short by itself.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This adds 7 &#39;e&#39; to $x</span>
<span class="nv">$x</span> <span class="o">.=</span> <span class="nb">str_repeat</span><span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>

<span class="c1">// This is the same as above,</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="o">.=</span> <span class="s1">&#39;e&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// here, $default must contains 7 elements to be equivalent to the previous code</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$default</span> <span class="k">as</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="o">.=</span> <span class="s1">&#39;e&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id393">
<h3>9.151.1. Suggestions<a class="headerlink" href="#id393" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use strrepeat() whenever possible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CouldUseStrrepeat</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-structures-couldusestrrepeat"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="crc32-might-be-negative">
<span id="id394"></span><h2>9.152. Crc32() Might Be Negative<a class="headerlink" href="#crc32-might-be-negative" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/crc32">crc32()</a> may return a negative number, on 32 bits platforms.</p>
<p>According to the manual : Because PHP’s integer type is signed many <code class="docutils literal notranslate"><span class="pre">CRC32</span></code> checksums will result in negative integers on 32 bits platforms. On 64 bits installations, all <a class="reference external" href="https://www.php.net/crc32">crc32()</a> results will be positive integers though.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// display the checksum with %u, to make it unsigned</span>
<span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;%u&#39;</span><span class="p">,</span> <span class="nb">crc32</span><span class="p">(</span><span class="nv">$str</span><span class="p">));</span>

<span class="c1">// turn the checksum into an unsigned hexadecimal</span>
<span class="k">echo</span> <span class="nb">dechex</span><span class="p">(</span><span class="nb">crc32</span><span class="p">(</span><span class="nv">$str</span><span class="p">));</span>

<span class="c1">// avoid concatenating crc32 to a string, as it may be negative on 32bits platforms</span>
<span class="k">echo</span> <span class="s1">&#39;prefix&#39;</span><span class="o">.</span><span class="nb">crc32</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/crc32">crc32()</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Crc32MightBeNegative</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cyclic-references">
<span id="id397"></span><h2>9.153. Cyclic References<a class="headerlink" href="#cyclic-references" title="Permalink to this headline">¶</a></h2>
<p>Avoid cyclic references.</p>
<p>Cyclic references happen when an object points to another object, which reciprocate. This is particularly possible with classes, when the child class has to keep a reference to the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$p</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b</span><span class="p">();</span>
        <span class="c1">// the current class is stored in the child class</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="o">-&gt;</span><span class="na">m</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">b</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$pb</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">n</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// the current class keeps a link to its parent</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pb</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Cyclic references, or circular references, are memory intensive : only the garbage collector can understand when they may be flushed from memory, which is a costly operation. On the other hand, in an acyclic reference code, the reference counter will know immediately know that an object is free or not.</p>
<p>See also <a class="reference external" href="https://johann.pardanaud.com/blog/about-circular-references-in-php">About circular references in PHP</a> and <a class="reference external" href="https://jolicode.com/blog/a-journey-to-find-a-memory-leak/">A Journey to find a memory leak</a>.</p>
<div class="section" id="id399">
<h3>9.153.1. Suggestions<a class="headerlink" href="#id399" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a different object when calling the child objects.</li>
<li>Refactor your code to avoid the cyclic reference.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CyclicReferences</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dangling-array-references">
<span id="id400"></span><h2>9.154. Dangling Array References<a class="headerlink" href="#dangling-array-references" title="Permalink to this headline">¶</a></h2>
<p>Always unset a referenced-variable used in a loop.</p>
<p>It is highly recommended to unset blind variables when they are set up as references after a loop.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// This only unset the reference, not the value</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>


<span class="c1">// Dangling array problem</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//$array === array(3,4,5,6);</span>

<span class="c1">// This does nothing (apparently)</span>
<span class="c1">// $a is already a reference, even if it doesn&#39;t show here.</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>
<span class="c1">//$array === array(3,4,5,5);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When omitting this step, the next loop that will also require this variable will deal with garbage values, and produce unexpected results.</p>
<p>See also : <a class="reference external" href="https://github.com/dseguy/clearPHP/blob/master/rules/no-dangling-reference.md">No Dangling Reference</a>, <a class="reference external" href="https://coderwall.com/p/qx3fpa/php-foreach-pass-by-reference-do-it-right-or-better-not-at-all">PHP foreach pass-by-reference: Do it right, or better not at all</a>, <a class="reference external" href="https://stackoverflow.com/questions/10057671/how-does-php-foreach-actually-work/14854568#14854568">How does PHP ‘foreach’ actually work?</a>, <a class="reference external" href="https://schlueters.de/blog/archives/141-references-and-foreach.html">References and foreach</a>.</p>
<div class="section" id="id401">
<h3>9.154.1. Suggestions<a class="headerlink" href="#id401" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using the reference altogether : sometimes, the reference is not needed.</li>
<li>Add unset() right after the loop, to avoid reusing the reference.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DanglingArrayReferences</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-dangling-reference.md">no-dangling-reference</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#typo3-structures-danglingarrayreferences"><span class="std std-ref">Typo3</span></a>, <a class="reference internal" href="Cases.html#sugarcrm-structures-danglingarrayreferences"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="deep-definitions">
<span id="id402"></span><h2>9.155. Deep Definitions<a class="headerlink" href="#deep-definitions" title="Permalink to this headline">¶</a></h2>
<p>Structures, such as functions, classes, interfaces, traits, etc. may be defined anywhere in the code, including inside functions. This is legit code for PHP.</p>
<p>Since the availability of autoload, with spl_register_autoload(), there is no need for that kind of code. Structures should be defined, and accessible to the autoloading. Inclusions and deep definitions should be avoided, as they compel code to load some definitions, while autoloading will only load them if needed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// myFunction is defined when and only if X::init() is called.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">&#39;myFunction&#39;</span><span class="p">){</span>
            <span class="k">function</span> <span class="nf">myFunction</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Functions are excluded from autoload, but shall be gathered in libraries, and not hidden inside other code.</p>
<p>Constants definitions are tolerated inside functions : they may be used for avoiding repeat, or noting the usage of such function.</p>
<p>Definitions inside a if/then statement, that include PHP version check are accepted here.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.autoload.php">Autoloading Classes</a>.</p>
<div class="section" id="id403">
<h3>9.155.1. Suggestions<a class="headerlink" href="#id403" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move function definitions to the global space : outside structures, and method.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/DeepDefinitions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-functions-deepdefinitions"><span class="std std-ref">Dolphin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="define-with-array">
<span id="id404"></span><h2>9.156. Define With Array<a class="headerlink" href="#define-with-array" title="Permalink to this headline">¶</a></h2>
<p>PHP 7.0 has the ability to define an array as a constant, using the <a class="reference external" href="https://www.php.net/define">define()</a> native call. This was not possible until that version, only with the const keyword.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//Defining an array as a constant</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;MY_PRIMES&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">]);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/DefineWithArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dependant-abstract-classes">
<span id="id406"></span><h2>9.157. Dependant Abstract Classes<a class="headerlink" href="#dependant-abstract-classes" title="Permalink to this headline">¶</a></h2>
<p>Abstract classes should be autonomous. It is recommended to avoid depending on methods, constant or properties that should be made available in inheriting classes, without explicitly abstracting them.</p>
<p>The following abstract classes make usage of constant, methods and properties, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> or not, that are not defined in the class. This means the inheriting classes must provide those constants, methods and properties, but there is no way to enforce this.</p>
<p>This may also lead to dead code : when the abstract class is removed, the host class have unused properties and methods.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// autonomous abstract class : all it needs is within the class</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">c</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">++</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// dependant abstract class : the inheriting classes needs to provide some properties or methods</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">c2</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// $p must be provided by the extending class</span>
        <span class="k">return</span> <span class="o">++</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">c3</span> <span class="k">extends</span> <span class="nx">c2</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="#dependant-trait"><span class="std std-ref">Dependant Trait</span></a>.</p>
<div class="section" id="id408">
<h3>9.157.1. Suggestions<a class="headerlink" href="#id408" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the class only use its own resources</li>
<li>Split the class in autonomous classes</li>
<li>Add local property definitions to make the class independent</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/DependantAbstractClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dependant-trait">
<span id="id409"></span><h2>9.158. Dependant Trait<a class="headerlink" href="#dependant-trait" title="Permalink to this headline">¶</a></h2>
<p>Traits should be autonomous. It is recommended to avoid depending on methods or properties that should be in the using class.</p>
<p>The following traits make usage of methods and properties, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> or not, that are not defined in the trait. This means the host class must provide those methods and properties, but there is no way to enforce this.</p>
<p>This may also lead to dead code : when the trait is removed, the host class have unused properties and methods.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// autonomous trait : all it needs is within the trait</span>
<span class="k">trait</span> <span class="nx">t</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">++</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// dependant trait : the host class needs to provide some properties or methods</span>
<span class="k">trait</span> <span class="nx">t2</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">++</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t2</span><span class="p">;</span>

    <span class="k">private</span> <span class="nv">$p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="#dependant-abstract-classes"><span class="std std-ref">Dependant Abstract Classes</span></a>.</p>
<div class="section" id="id411">
<h3>9.158.1. Suggestions<a class="headerlink" href="#id411" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add local property definitions to make the trait independent</li>
<li>Make the trait only use its own resources</li>
<li>Split the trait in autonomous traits</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/DependantTrait</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-traits-dependanttrait"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="deprecated-php-functions">
<span id="id412"></span><h2>9.159. Deprecated PHP Functions<a class="headerlink" href="#deprecated-php-functions" title="Permalink to this headline">¶</a></h2>
<p>The following functions are deprecated. It is recommended to stop using them now and replace them with a durable equivalent.</p>
<p>Note that these functions may be still usable : they generate warning that help tracking their usage in the log. To eradicate their usage, watch the logs, and update any deprecated warning. This way, the code won’t be stuck when the function is actually removed from PHP.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is the current function</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$day</span><span class="p">,</span> <span class="nv">$month</span><span class="p">,</span> <span class="nv">$year</span><span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;08/06/1995&#39;</span><span class="p">);</span>

<span class="c1">// This is deprecated</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$day</span><span class="p">,</span> <span class="nv">$month</span><span class="p">,</span> <span class="nv">$year</span><span class="p">)</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;08/06/1995&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id413">
<h3>9.159.1. Suggestions<a class="headerlink" href="#id413" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace those deprecated with modern syntax</li>
<li>Stop using deprecated syntax</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Deprecated</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-deprecated.md">no-deprecated</a></td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-php-deprecated"><span class="std std-ref">Dolphin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dereferencing-string-and-arrays">
<span id="id414"></span><h2>9.160. Dereferencing String And Arrays<a class="headerlink" href="#dereferencing-string-and-arrays" title="Permalink to this headline">¶</a></h2>
<p>PHP allows the direct dereferencing of strings and arrays.</p>
<p>This was added in PHP 5.5. There is no need anymore for an intermediate variable between a string and array (or any expression generating such value) and accessing an index.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">);</span>
<span class="nv">$y</span> <span class="o">=</span> <span class="nv">$x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">;</span> <span class="c1">// is 6</span>

<span class="nx">May</span> <span class="nx">be</span> <span class="nx">replaced</span> <span class="nx">by</span>
<span class="nv">$y</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)[</span><span class="mi">2</span><span class="p">];</span>
<span class="nv">$y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DereferencingAS</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.3 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="detect-current-class">
<span id="id415"></span><h2>9.161. Detect Current Class<a class="headerlink" href="#detect-current-class" title="Permalink to this headline">¶</a></h2>
<p>Detecting the current class should be done with <cite>self::class</cite> or <cite>static::class</cite> operator.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__CLASS__</a> may be replaced by <code class="docutils literal notranslate"><span class="pre">self\:\:class</span></code>.
<a class="reference external" href="https://www.php.net/get_called_class">get_called_class()</a> may be replaced by <code class="docutils literal notranslate"><span class="pre">static\:\:class</span></code>.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__CLASS__</a> and <a class="reference external" href="https://www.php.net/get_called_class">get_called_class()</a> are set to be deprecated in PHP 7.4.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="no">__CLASS__</span><span class="o">.</span><span class="nx">\n</span><span class="p">;</span>          <span class="c1">// X</span>
        <span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">class</span><span class="o">.</span><span class="nx">\n</span><span class="p">;</span>        <span class="c1">// X</span>

        <span class="k">echo</span> <span class="nb">get_called_class</span><span class="p">()</span><span class="o">.</span><span class="nx">\n</span><span class="p">;</span>  <span class="c1">// Y</span>
        <span class="k">echo</span> <span class="k">static</span><span class="o">::</span><span class="na">class</span><span class="o">.</span><span class="nx">\n</span><span class="p">;</span>       <span class="c1">// Y</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Y</span> <span class="k">extends</span> <span class="nx">X</span> <span class="p">{}</span>

<span class="nv">$y</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Y</span><span class="p">();</span>
<span class="nv">$y</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_4">PHP RFC: Deprecations for PHP 7.4</a>.</p>
<div class="section" id="id420">
<h3>9.161.1. Suggestions<a class="headerlink" href="#id420" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the self::class operator to detect the current class name, instead of __CLASS__ and get_class().</li>
<li>Use the static::class operator to detect the current called class name, instead of get_called_class().</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/DetectCurrentClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 8.0 and older</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="different-argument-counts">
<span id="id421"></span><h2>9.162. Different Argument Counts<a class="headerlink" href="#different-argument-counts" title="Permalink to this headline">¶</a></h2>
<p>Two methods with the same name shall have the same number of compulsory argument. PHP accepts different number of arguments between two methods, if the extra arguments have default values. Basically, they shall be called interchangeably with the same number of arguments.</p>
<p>The number of compulsory arguments is often mistaken for the same number of arguments. When this is the case, it leads to confusion between the two signatures. It will also create more difficulties when refactoring the signature.</p>
<p>While this code is legit, it is recommended to check if the two signatures could be synchronized, and reduce future surprises.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span> <span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">y</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="c1">// This method is compatible with the above, its signature is different</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id422">
<h3>9.162.1. Suggestions<a class="headerlink" href="#id422" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extract the extra arguments into other methods</li>
<li>Remove the extra arguments</li>
<li>Add the extra arguments to all the signatures</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/DifferentArgumentCounts</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="direct-call-to-clone">
<span id="id423"></span><h2>9.163. Direct Call To __clone()<a class="headerlink" href="#direct-call-to-clone" title="Permalink to this headline">¶</a></h2>
<p>Direct call to magic method <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__clone()</a> was forbidden. It is allowed since PHP 7.0.</p>
<p>From the RFC : <code class="docutils literal notranslate"><span class="pre">Doing</span> <span class="pre">calls</span> <span class="pre">like</span> <span class="pre">$obj-&gt;`__clone(</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.magic.php&gt;`_</span> <span class="pre">)</span> <span class="pre">is</span> <span class="pre">now</span> <span class="pre">allowed.</span> <span class="pre">This</span> <span class="pre">was</span> <span class="pre">the</span> <span class="pre">only</span> <span class="pre">magic</span> <span class="pre">method</span> <span class="pre">that</span> <span class="pre">had</span> <span class="pre">a</span> <span class="pre">compile-time</span> <span class="pre">check</span> <span class="pre">preventing</span> <span class="pre">some</span> <span class="pre">calls</span> <span class="pre">to</span> <span class="pre">it,</span> <span class="pre">which</span> <span class="pre">doesn't</span> <span class="pre">make</span> <span class="pre">sense.</span> <span class="pre">If</span> <span class="pre">we</span> <span class="pre">allow</span> <span class="pre">all</span> <span class="pre">other</span> <span class="pre">magic</span> <span class="pre">methods</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">called,</span> <span class="pre">there's</span> <span class="pre">no</span> <span class="pre">reason</span> <span class="pre">to</span> <span class="pre">forbid</span> <span class="pre">this</span> <span class="pre">one</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
        <span class="k">function</span> <span class="fm">__clone</span><span class="p">()</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">;</span>
    <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">__clone</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">Directly calling `__clone</a> is allowed &lt;<a class="reference external" href="https://wiki.php.net/rfc/abstract_syntax_tree#directly_calling_clone_is_allowed">https://wiki.php.net/rfc/abstract_syntax_tree#directly_calling_clone_is_allowed</a>&gt;`_.</p>
<div class="section" id="id424">
<h3>9.163.1. Suggestions<a class="headerlink" href="#id424" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the clone operator to call the __clone magic method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/DirectCallToClone</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="direct-injection">
<span id="id425"></span><h2>9.164. Direct Injection<a class="headerlink" href="#direct-injection" title="Permalink to this headline">¶</a></h2>
<p>The following code act directly upon PHP incoming variables like <code class="docutils literal notranslate"><span class="pre">$_GET</span></code> and <code class="docutils literal notranslate"><span class="pre">$_POST</span></code>. This makes those snippets very unsafe.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Direct injection</span>
<span class="k">echo</span> <span class="nx">Hello</span><span class="o">.</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span><span class="o">.</span><span class="p">,</span> <span class="nx">welcome</span><span class="o">.</span><span class="p">;</span>

<span class="c1">// less direct injection</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]);</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nx">Hello</span><span class="o">.</span><span class="nv">$user</span><span class="o">.</span><span class="p">,</span> <span class="nx">welcome</span><span class="o">.</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://phpsecurity.readthedocs.io/en/latest/Cross-Site-Scripting-(XSS).html">Cross-Site Scripting (XSS)</a></p>
<div class="section" id="id426">
<h3>9.164.1. Suggestions<a class="headerlink" href="#id426" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Validate input : make sure the incoming data are what you expect from them.</li>
<li>Escape output : prepare outgoing data for the next system to use.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/DirectInjection</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="directly-use-file">
<span id="id427"></span><h2>9.165. Directly Use File<a class="headerlink" href="#directly-use-file" title="Permalink to this headline">¶</a></h2>
<p>Some PHP functions have a close cousin that work directly on files : use them. This is faster and less code to write.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/md5">md5()</a> =&gt; <a class="reference external" href="https://www.php.net/md5_file">md5_file()</a></li>
<li><a class="reference external" href="https://www.php.net/highlight_string">highlight_string()</a> =&gt; <a class="reference external" href="https://www.php.net/highlight_file">highlight_file()</a>, <a class="reference external" href="https://www.php.net/show_source">show_source()</a></li>
<li><a class="reference external" href="https://www.php.net/parsekit_compile_string">parsekit_compile_string()</a> =&gt; <a class="reference external" href="https://www.php.net/parsekit_compile_file">parsekit_compile_file()</a></li>
<li><a class="reference external" href="https://www.php.net/parse_ini_string">parse_ini_string()</a> =&gt; <a class="reference external" href="https://www.php.net/parse_ini_file">parse_ini_file()</a></li>
<li><a class="reference external" href="https://www.php.net/sha1">sha1()</a> =&gt; <a class="reference external" href="https://www.php.net/sha1_file">sha1_file()</a></li>
<li><a class="reference external" href="https://www.php.net/simplexml_load_string">simplexml_load_string()</a> =&gt; <a class="reference external" href="https://www.php.net/simplexml_load_file">simplexml_load_file()</a></li>
<li><a class="reference external" href="https://www.php.net/yaml_parse">yaml_parse()</a> =&gt; <a class="reference external" href="https://www.php.net/yaml_parse_file">yaml_parse_file()</a></li>
<li><a class="reference external" href="https://www.php.net/hash">hash()</a> =&gt; <a class="reference external" href="https://www.php.net/hash_file">hash_file()</a></li>
<li><a class="reference external" href="https://www.php.net/hash_hmac">hash_hmac()</a> =&gt; hash_mac_file()</li>
<li><a class="reference external" href="https://www.php.net/hash_update">hash_update()</a> =&gt; <a class="reference external" href="https://www.php.net/hash_update_file">hash_update_file()</a></li>
<li><a class="reference external" href="https://www.php.net/recode">recode()</a> =&gt; <a class="reference external" href="https://www.php.net/recode_file">recode_file()</a></li>
<li><a class="reference external" href="https://www.php.net/recode_string">recode_string()</a> =&gt; <a class="reference external" href="https://www.php.net/recode_file">recode_file()</a></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Good way</span>
<span class="nv">$file_hash</span> <span class="o">=</span> <span class="nb">hash_file</span><span class="p">(</span><span class="s1">&#39;sha512&#39;</span><span class="p">,</span> <span class="s1">&#39;example.txt&#39;</span><span class="p">);</span>

<span class="c1">// Slow way</span>
<span class="nv">$file_hash</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha512&#39;</span><span class="p">,</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;example.txt&#39;</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.hash-file.php">hash_file</a>.</p>
<div class="section" id="id430">
<h3>9.165.1. Suggestions<a class="headerlink" href="#id430" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the _file() version of those functions</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DirectlyUseFile</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="disconnected-classes">
<span id="id431"></span><h2>9.166. Disconnected Classes<a class="headerlink" href="#disconnected-classes" title="Permalink to this headline">¶</a></h2>
<p>One class is extending the other, but they do not use any features from one another. Basically, those two classes are using extends, but they are completely independent and may be separated.</p>
<p>When using the ‘extends’ keyword, the newly created classes are now acting together and making one. This should be visible in calls from one class to the other, or simply by property usage : they can’t live without each other.</p>
<p>On the other hand, two completely independent classes that are merged, although they should be kept separated.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$pa</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">fooA</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pa</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// class B and Class A are totally independent</span>
<span class="k">class</span> <span class="nc">B</span> <span class="k">extends</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$pb</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">fooB</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pb</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1">// class C makes use of class A : it is dependent on the parent class</span>
<span class="k">class</span> <span class="nc">C</span> <span class="k">extends</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$pc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">fooB</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">pc</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">fooA</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id432">
<h3>9.166.1. Suggestions<a class="headerlink" href="#id432" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the extension</li>
<li>Make actual usage of the classes, at least from one of them</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/DisconnectedClasses</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-classes-disconnectedclasses"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="do-in-base">
<span id="id433"></span><h2>9.167. Do In Base<a class="headerlink" href="#do-in-base" title="Permalink to this headline">¶</a></h2>
<p>Use SQL expression to compute aggregates.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Efficient way</span>
<span class="nv">$res</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;SELECT sum(e) AS sumE FROM table WHERE condition&#39;</span><span class="p">);</span>

<span class="c1">// The sum is already done</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>
<span class="nv">$c</span> <span class="o">+=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;sumE&#39;</span><span class="p">];</span>

<span class="c1">// Slow way</span>
<span class="nv">$res</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;SELECT e FROM table WHERE condition&#39;</span><span class="p">);</span>

<span class="c1">// This aggregates the column e in a slow way</span>
<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">())</span> <span class="p">{</span>
    <span class="nv">$c</span> <span class="o">+=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;e&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id434">
<h3>9.167.1. Suggestions<a class="headerlink" href="#id434" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Rework the query to move the calculations in the database</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/DoInBase</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="don-t-be-too-manual">
<span id="id435"></span><h2>9.168. Don’t Be Too Manual<a class="headerlink" href="#don-t-be-too-manual" title="Permalink to this headline">¶</a></h2>
<p>Adapt the examples from the PHP manual to your code. Don’t reuse directly the same names in your code : be more specific about what to expect in those variables.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Search for phone numbers in a text</span>
<span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/((\d{3})-(\d{3})-(\d{4}))/&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$phoneNumber</span><span class="p">);</span>

<span class="c1">// Search for phone numbers in a text</span>
<span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/(\d{3})-(\d{3})-(\d{4})/&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id436">
<h3>9.168.1. Suggestions<a class="headerlink" href="#id436" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use precise name with your variables</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DontBeTooManual</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="don-t-change-incomings">
<span id="id437"></span><h2>9.169. Don’t Change Incomings<a class="headerlink" href="#don-t-change-incomings" title="Permalink to this headline">¶</a></h2>
<p>PHP hands over a lot of information using special variables like <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.get.php">$_GET</a>, <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.post.php">$_POST</a>, etc… Modifying those variables and those values inside variables means that the original content is lost, while it will still look like raw data, and, as such, will be untrustworthy.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// filtering and keeping the incoming value.</span>
<span class="nv">$_DATA</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>

<span class="c1">// filtering and changing the incoming value.</span>
<span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to put the modified values in another variable, and keep the original one intact.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoChangeIncomingVariables</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="don-t-echo-error">
<span id="id438"></span><h2>9.170. Don’t Echo Error<a class="headerlink" href="#don-t-echo-error" title="Permalink to this headline">¶</a></h2>
<p>It is recommended to avoid displaying error messages directly to the browser.</p>
<p>PHP’s uses the <code class="docutils literal notranslate"><span class="pre">display_errors</span></code> directive to control display of errors to the browser. This must be kept to <code class="docutils literal notranslate"><span class="pre">off</span></code> when in production.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Inside a &#39;or&#39; test</span>
<span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="nb">mysql_error</span><span class="p">());</span>

<span class="c1">// Inside a if test</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">pg_query</span><span class="p">(</span> <span class="nv">$db</span><span class="p">,</span> <span class="nv">$query</span> <span class="p">);</span>
<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nv">$result</span> <span class="p">)</span>
<span class="p">{</span>
     <span class="k">echo</span> <span class="nx">Erreur</span> <span class="nx">SQL</span><span class="o">:</span> <span class="o">.</span> <span class="nx">pg_error</span><span class="p">();</span>
     <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Changing PHP configuration</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1">// This is also a security error : &#39;false&#39; means actually true.</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;display_errors&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Error messages should be logged, but not displayed.</p>
<p>See also <a class="reference external" href="https://php.earth/docs/security/intro#error-reporting">Error reporting</a> and <a class="reference external" href="https://www.php.net/manual/en/ini.list.php">List of php.ini directives</a>.</p>
<div class="section" id="id439">
<h3>9.170.1. Suggestions<a class="headerlink" href="#id439" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove any echo, print, printf() call built with error messages from an exception, or external source.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/DontEchoError</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-security-dontechoerror"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#phpdocumentor-security-dontechoerror"><span class="std std-ref">Phpdocumentor</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="don-t-loop-on-yield">
<span id="id440"></span><h2>9.171. Don’t Loop On Yield<a class="headerlink" href="#don-t-loop-on-yield" title="Permalink to this headline">¶</a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code>, instead of looping on a generator with <code class="docutils literal notranslate"><span class="pre">yield</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> delegate the yielding to another generator, and keep calling that generator until it is finished. It also works with implicit generator datastructure, like arrays.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">generator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="nv">$i</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">delegatingGenerator</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nx">from</span> <span class="nx">generator</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Too much code here</span>
<span class="k">function</span> <span class="nf">generator2</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nx">generator</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$g</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="nv">$g</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>There is a performance gain when delegating, over looping manually on the generator. You may even consider writing the loop to store all values in an array, then <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> the array.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.generators.syntax.php#control-structures.yield.from">Generator delegation via yield from</a>.</p>
<div class="section" id="id441">
<h3>9.171.1. Suggestions<a class="headerlink" href="#id441" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use <cite>yield from</cite> instead of the whole foreach() loop</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DontLoopOnYield</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-structures-dontlooponyield"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#tikiwiki-structures-dontlooponyield"><span class="std std-ref">Tikiwiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="don-t-pollute-global-space">
<span id="id442"></span><h2>9.172. Don’t Pollute Global Space<a class="headerlink" href="#don-t-pollute-global-space" title="Permalink to this headline">¶</a></h2>
<p>Avoid creating definitions in the global name space.</p>
<p>The global namespace is the default namespace, where all functions, classes, constants, traits and interfaces live. The <a class="reference external" href="https://www.php.net/manual/en/language.namespaces.global.php">global namespace</a> is also known as the root namespace.</p>
<p>In particular, PHP native classes usually live in that namespace. By creating functions in that namespace, the code may encounter naming conflict, when the PHP group decides to use a name that the code also uses. This already happened in PHP version 5.1.1, where a <code class="docutils literal notranslate"><span class="pre">Date</span></code> native class was introduced, and had to be <a class="reference external" href="https://www.php.net/ChangeLog-5.php#5.1.1">disabled in the following minor version</a>.</p>
<p>Nowadays, conflicts appear between components, which claim the same name.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.namespaces.fallback.php">Using namespaces: fallback to global function/constant</a>.</p>
<div class="section" id="id443">
<h3>9.172.1. Suggestions<a class="headerlink" href="#id443" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create a namespace for your code, and store your definition there.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/DontPolluteGlobalSpace</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="don-t-read-and-write-in-one-expression">
<span id="id444"></span><h2>9.173. Don’t Read And Write In One Expression<a class="headerlink" href="#don-t-read-and-write-in-one-expression" title="Permalink to this headline">¶</a></h2>
<p>Avoid giving value and using it at the same time, in one expression. This is an undefined behavior of PHP, and may change without warning.</p>
<p>One of those changes happens between PHP 7.2 and 7.3 :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$ref</span> <span class="o">=&amp;</span> <span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="nv">$arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">));</span>
<span class="c1">// PHP 7.2: int(4)</span>
<span class="c1">// PHP 7.3: int(3)</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://github.com/php/php-src/blob/PHP-7.3/UPGRADING#L83-L95">UPGRADING 7.3</a>.</p>
<div class="section" id="id445">
<h3>9.173.1. Suggestions<a class="headerlink" href="#id445" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Split the expression in two separate expressions</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DontReadAndWriteInOneExpression</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="don-t-send-this-in-constructor">
<span id="id446"></span><h2>9.174. Don’t Send $this In Constructor<a class="headerlink" href="#don-t-send-this-in-constructor" title="Permalink to this headline">¶</a></h2>
<p>Don’t use <code class="docutils literal notranslate"><span class="pre">$this</span></code> as an argument while in the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.decon.php">__construct()</a>. Until the constructor is finished, the object is not finished, and may be in an unstable state. Providing it to another code may lead to error.</p>
<p>This is true when the receiving structure puts the incoming object immediately to work, and don’t store it for later use.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $this is only provided when Foo is constructed</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">build</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
        <span class="c1">// Can&#39;t build in one call. Must make it separate.</span>
        <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">finalize</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $this is provided too early</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">finalize</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// $this is provided too early, leading to error in Bar</span>
<span class="k">class</span> <span class="nc">Foo2</span> <span class="k">extends</span> <span class="nx">Foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $this is provided too early</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="o">=</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Foo</span> <span class="nv">$foo</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// the cache is now initialized with a wrong</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cache</span> <span class="o">=</span> <span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">getIt</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.javapractices.com/topic/TopicAction.do?Id=252">Don’t pass this out of a constructor</a>.</p>
<div class="section" id="id448">
<h3>9.174.1. Suggestions<a class="headerlink" href="#id448" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Finish the constructor first, then call an external object.</li>
<li>Sending $this should be made accessible in a separate method, so external objects may call it.</li>
<li>Sending the current may be the responsibility of the method creating the object.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/DontSendThisInConstructor</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#woocommerce-classes-dontsendthisinconstructor"><span class="std std-ref">Woocommerce</span></a>, <a class="reference internal" href="Cases.html#contao-classes-dontsendthisinconstructor"><span class="std std-ref">Contao</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="don-t-unset-properties">
<span id="id449"></span><h2>9.175. Don’t Unset Properties<a class="headerlink" href="#don-t-unset-properties" title="Permalink to this headline">¶</a></h2>
<p>Avoid unsetting properties. They would go undefined, and raise more warnings.</p>
<p>When getting rid of a property, assign it to null. This keeps the property in the object, yet allows existence check without errors.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>

<span class="nb">var_dump</span><span class="p">((</span><span class="k">array</span><span class="p">)</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">;</span>
<span class="c1">// la propriété est reportée, et null</span>
<span class="c1">// [&#39;a&#39; =&gt; null]</span>

<span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">);</span>

<span class="nb">var_dump</span><span class="p">((</span><span class="k">array</span><span class="p">)</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">;</span>
<span class="c1">//Empty []</span>

<span class="c1">// Check if a property exists</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">===</span> <span class="k">null</span><span class="p">);</span>

<span class="c1">// Same result as above, but with a warning</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">===</span> <span class="k">null</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis works on properties and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> properties. It also reports magic properties being unset.</p>
<p>Thanks for <a class="reference external" href="https://twitter.com/BenoitBurnichon">Benoit Burnichon</a> for the original idea.</p>
<div class="section" id="id451">
<h3>9.175.1. Suggestions<a class="headerlink" href="#id451" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Never unset properties : set it to null or its default value instead</li>
<li>Make the property an array, and set/unset its index</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/DontUnsetProperties</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#vanilla-classes-dontunsetproperties"><span class="std std-ref">Vanilla</span></a>, <a class="reference internal" href="Cases.html#typo3-classes-dontunsetproperties"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dont-change-the-blind-var">
<span id="id452"></span><h2>9.176. Dont Change The Blind Var<a class="headerlink" href="#dont-change-the-blind-var" title="Permalink to this headline">¶</a></h2>
<p>When using a <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>, the blind variables hold a copy of the original value. It is confusing to modify them, as it seems that the original value may be changed.</p>
<p>When actually changing the original value, use the reference in the foreach definition to make it obvious, and save the final reassignation.</p>
<p>When the value has to be prepared before usage, then save the filtered value in a separate variable. This makes the clean value obvious, and preserve the original value for a future usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $bar is duplicated and kept</span>
<span class="nv">$foo</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$foo</span> <span class="k">as</span> <span class="nv">$bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $bar is updated but its original value is kept</span>
    <span class="nv">$nextBar</span> <span class="o">=</span> <span class="nv">$bar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$bar</span> <span class="o">.</span> <span class="s1">&#39; =&gt; &#39;</span> <span class="o">.</span> <span class="p">(</span><span class="nv">$nextBar</span><span class="p">)</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="nx">foobar</span><span class="p">(</span><span class="nv">$nextBar</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// $bar is updated and lost</span>
<span class="nv">$foo</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$foo</span> <span class="k">as</span> <span class="nv">$bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $bar is updated but its final value is lost</span>
    <span class="k">print</span> <span class="nv">$bar</span> <span class="o">.</span> <span class="s1">&#39; =&gt; &#39;</span> <span class="o">.</span> <span class="p">(</span><span class="o">++</span><span class="nv">$bar</span><span class="p">)</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="c1">// Now that $bar is reused, it is easy to confuse its value</span>
    <span class="nx">foobar</span><span class="p">(</span><span class="nv">$bar</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// $bar is updated and kept</span>
<span class="nv">$foo</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$foo</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $bar is updated and keept</span>
    <span class="k">print</span> <span class="nv">$bar</span> <span class="o">.</span> <span class="s1">&#39; =&gt; &#39;</span> <span class="o">.</span> <span class="p">(</span><span class="o">++</span><span class="nv">$bar</span><span class="p">)</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="nx">foobar</span><span class="p">(</span><span class="nv">$bar</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DontChangeBlindKey</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dont-collect-void">
<span id="id454"></span><h2>9.177. Dont Collect Void<a class="headerlink" href="#dont-collect-void" title="Permalink to this headline">¶</a></h2>
<p>When a method returns void, there is no need to collect the result. The collected value will actually be <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="c1">// This is useless</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span>

<span class="c1">// This is useless. It looks like this is a left over from code refactoring</span>
<span class="k">echo</span> <span class="nx">foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id455">
<h3>9.177.1. Suggestions<a class="headerlink" href="#id455" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the call to the function to its own expression with a semi-colon.</li>
<li>Remove assignation of the result of such calls.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/DontUseVoid</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dont-compare-typed-boolean">
<span id="id456"></span><h2>9.178. Dont Compare Typed Boolean<a class="headerlink" href="#dont-compare-typed-boolean" title="Permalink to this headline">¶</a></h2>
<p>There is no need to compare explicitly a function call to a boolean, when the definition has a boolean return typehint.</p>
<p>The analysis checks for equality and identity comparisons. It doesn’t check for the not operator usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Sufficient check</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">foo</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Superfluous check</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">foo</span><span class="p">()</span> <span class="o">===</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">bool</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id457">
<h3>9.178.1. Suggestions<a class="headerlink" href="#id457" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Simplify the code and make it short</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DontCompareTypedBoolean</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dont-mix">
<span id="id458"></span><h2>9.179. Dont Mix ++<a class="headerlink" href="#dont-mix" title="Permalink to this headline">¶</a></h2>
<p>++ operators, pre and post, have two distinct behaviors, and should be used separately.</p>
<p>When mixed in a larger expression, they are difficult to read, and may lead to unwanted behaviors.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// Clear and defined behavior</span>
    <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
    <span class="nv">$a</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$i</span><span class="p">;</span>

    <span class="c1">// The index is also incremented, as it is used AFTP the incrementation</span>
    <span class="c1">// With $i = 2; $a is array(3 =&gt; 3)</span>
    <span class="nv">$a</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="o">++</span><span class="nv">$i</span><span class="p">;</span>

    <span class="c1">// $i is actually modified twice</span>
    <span class="nv">$i</span> <span class="o">=</span> <span class="o">--</span><span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.sei.cmu.edu/confluence/display/c/EXP30-C.+Do+not+depend+on+the+order+of+evaluation+for+side+effects">EXP30-C. Do not depend on the order of evaluation for side effects</a>.</p>
<div class="section" id="id459">
<h3>9.179.1. Suggestions<a class="headerlink" href="#id459" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extract the increment from the expression, and put it on a separate line.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DontMixPlusPlus</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#contao-structures-dontmixplusplus"><span class="std std-ref">Contao</span></a>, <a class="reference internal" href="Cases.html#typo3-structures-dontmixplusplus"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="double-assignation">
<span id="id460"></span><h2>9.180. Double Assignation<a class="headerlink" href="#double-assignation" title="Permalink to this headline">¶</a></h2>
<p>This happens when a container (variable, property, array index) is assigned with values twice in a row. One of them is probably a debug instruction, that was forgotten.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Normal assignation</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// Double assignation</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DoubleAssignation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="double-instructions">
<span id="id461"></span><h2>9.181. Double Instructions<a class="headerlink" href="#double-instructions" title="Permalink to this headline">¶</a></h2>
<p>Twice the same call in a row. This is worth a check.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// repetition of the same command, with the same effect each time.</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">);</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">);</span>

<span class="c1">// false positive : commands are identical, but the effect is compounded</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$c</span><span class="p">);</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$c</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id462">
<h3>9.181.1. Suggestions<a class="headerlink" href="#id462" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove double work</li>
<li>Avoid repetition by using loops, variadic or quantifiers <cite>(dirname($path, 2))</cite></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DoubleInstruction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="double-object-assignation">
<span id="id463"></span><h2>9.182. Double Object Assignation<a class="headerlink" href="#double-object-assignation" title="Permalink to this headline">¶</a></h2>
<p>Make sure that assigning the same object to two variables is the intended purpose.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $x and $y are the same object, as they both hold a reference to the same object.</span>
<span class="c1">// This means that changing $x, will also change $y.</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="nv">$y</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Z</span><span class="p">();</span>

<span class="c1">// $a and $b are distinct values, by default</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id464">
<h3>9.182.1. Suggestions<a class="headerlink" href="#id464" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DoubleObjectAssignation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="double-array-flip">
<span id="id465"></span><h2>9.183. Double array_flip()<a class="headerlink" href="#double-array-flip" title="Permalink to this headline">¶</a></h2>
<p>Avoid double <a class="reference external" href="https://www.php.net/array_flip">array_flip()</a> to gain speed. While <a class="reference external" href="https://www.php.net/array_flip">array_flip()</a> alone is usually useful, a double call to <a class="reference external" href="https://www.php.net/array_flip">array_flip()</a> is made to make values and keys unique.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// without array_flip</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$key</span> <span class="o">=</span> <span class="nb">array_search</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$key</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$array</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$array</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// double array_flip</span>
<span class="c1">// array_flip() usage means that $array&#39;s values are all unique</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$flipped</span> <span class="o">=</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$flipped</span><span class="p">[</span><span class="nv">$value</span><span class="p">]);</span>
    <span class="k">return</span> <span class="nb">array_flip</span><span class="p">(</span><span class="nv">$flipped</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id469">
<h3>9.183.1. Suggestions<a class="headerlink" href="#id469" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>use array_unique() or array_count_values</li>
<li>use array_flip() once, and let PHP garbage collect it later</li>
<li>Keep the original values in a separate variable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/DoubleArrayFlip</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#nextcloud-performances-doublearrayflip"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="drop-else-after-return">
<span id="id470"></span><h2>9.184. Drop Else After Return<a class="headerlink" href="#drop-else-after-return" title="Permalink to this headline">¶</a></h2>
<p>Avoid else clause when the then clause returns, but not the else. And vice-versa.</p>
<p>This way, the else block disappears, and is now the main sequence of the function.</p>
<p>This is also true if else has a return, and then not. When doing so, don’t forget to reverse the condition.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// drop the else</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// drop the then</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// return in else and then</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a3</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="nx">doSomething</span><span class="p">();</span>
    <span class="k">return</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id471">
<h3>9.184.1. Suggestions<a class="headerlink" href="#id471" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the else clause and move its code to the main part of the method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DropElseAfterReturn</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="drop-substr-last-arg">
<span id="id472"></span><h2>9.185. Drop Substr Last Arg<a class="headerlink" href="#drop-substr-last-arg" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/substr">Substr()</a> works till the end of the string when the last argument is omitted. There is no need to calculate string size to make this work.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;abcdef&#39;</span><span class="p">;</span>

<span class="c1">// Extract the end of the string</span>
<span class="nv">$cde</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// Too much work</span>
<span class="nv">$cde</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$string</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/substr">substr</a>.</p>
<div class="section" id="id475">
<h3>9.185.1. Suggestions<a class="headerlink" href="#id475" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use negative length</li>
<li>Omit the last argument to get the string till its end</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SubstrLastArg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#suitecrm-structures-substrlastarg"><span class="std std-ref">SuiteCrm</span></a>, <a class="reference internal" href="Cases.html#tine20-structures-substrlastarg"><span class="std std-ref">Tine20</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="duplicate-literal">
<span id="id476"></span><h2>9.186. Duplicate Literal<a class="headerlink" href="#duplicate-literal" title="Permalink to this headline">¶</a></h2>
<p>Report literals that are repeated across the code. The minimum replication is 5, and is configurable with <code class="docutils literal notranslate"><span class="pre">maxDuplicate</span></code>.</p>
<p>Repeated literals should be considered a prime candidate for constants.</p>
<p>Integer, reals and strings are considered here. Boolean, Null and Arrays are omitted. 0, 1, 2, 10 and the empty string are all omitted, as too common.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// array index are omitted</span>
    <span class="nv">$x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span>

    <span class="c1">// constanst are omitted</span>
    <span class="k">const</span> <span class="no">X</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>

    <span class="c1">// 0, 1, 2, 10 are omitted</span>
    <span class="nv">$x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id477">
<h3>9.186.1. Suggestions<a class="headerlink" href="#id477" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create a constant and use it in place of the literal</li>
<li>Create a class constant and use it in place of the literal</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="9%" />
<col width="9%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>minDuplicate</td>
<td>15</td>
<td>integer</td>
<td>Minimal number of duplication before the literal is reported.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/DuplicateLiteral</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="dynamic-library-loading">
<span id="id478"></span><h2>9.187. Dynamic Library Loading<a class="headerlink" href="#dynamic-library-loading" title="Permalink to this headline">¶</a></h2>
<p>Loading a variable dynamically requires a lot of care in the preparation of the library name.</p>
<p>In case of injection in the variable, the dynamic loading of a library gives a lot of power to an intruder.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// dynamically loading a library</span>
     <span class="nb">dl</span><span class="p">(</span><span class="nv">$library</span><span class="o">.</span> <span class="nx">PHP_SHLIB_SUFFIX</span><span class="p">);</span>

    <span class="c1">// dynamically loading ext/vips</span>
     <span class="nb">dl</span><span class="p">(</span><span class="s1">&#39;vips.&#39;</span> <span class="o">.</span> <span class="nx">PHP_SHLIB_SUFFIX</span><span class="p">);</span>

    <span class="c1">// static loading ext/vips (unix only)</span>
     <span class="nb">dl</span><span class="p">(</span><span class="s1">&#39;vips.so&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/dl">dl</a>.</p>
<div class="section" id="id479">
<h3>9.187.1. Suggestions<a class="headerlink" href="#id479" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a switch structure, to make the dl() calls static.</li>
<li>Avoid using dl() and make the needed extension always available in PHP binary.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/DynamicDl</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="echo-or-print">
<span id="id480"></span><h2>9.188. Echo Or Print<a class="headerlink" href="#echo-or-print" title="Permalink to this headline">¶</a></h2>
<p>Echo and print have the same functional use. &lt;?= and <a class="reference external" href="https://www.php.net/printf">printf()</a> are also considered in this analysis.</p>
<p>There seems to be a choice that is not enforced : one form is dominant, (&gt; 90%) while the others are rare.</p>
<p>The analyzed code has less than 10% of one of the three : for consistency reasons, it is recommended to make them all the same.</p>
<p>It happens that print, echo or &lt;?= are used depending on coding style and files. One file may be consistently using print, while the others are all using echo.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">echo</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;c&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;d&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;e&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;f&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;g&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;h&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;i&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;j&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="s1">&#39;k&#39;</span><span class="p">;</span>

<span class="c1">// This should probably be written &#39;echo&#39;;</span>
<span class="k">print</span> <span class="s1">&#39;l&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/EchoPrintConsistance</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="echo-with-concat">
<span id="id481"></span><h2>9.189. Echo With Concat<a class="headerlink" href="#echo-with-concat" title="Permalink to this headline">¶</a></h2>
<p>Optimize your <code class="docutils literal notranslate"><span class="pre">echo</span></code>’s by not concatenating at <code class="docutils literal notranslate"><span class="pre">echo</span></code> time, but serving all argument separated. This will save PHP a memory copy.</p>
<p>If values, literals and variables, are small enough, this won’t have visible impact. Otherwise, this is less work and less memory waste.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="k">echo</span> <span class="nv">$a</span><span class="p">,</span> <span class="s1">&#39; b &#39;</span><span class="p">,</span> <span class="nv">$c</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>instead of</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="k">echo</span>  <span class="nv">$a</span> <span class="o">.</span> <span class="s1">&#39; b &#39;</span> <span class="o">.</span> <span class="nv">$c</span><span class="p">;</span>
  <span class="k">echo</span> <span class="nv">$a</span> <span class="nx">b</span> <span class="nv">$c</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id482">
<h3>9.189.1. Suggestions<a class="headerlink" href="#id482" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Turn the concatenation into a list of argument, by replacing the dots by commas.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/EchoWithConcat</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-unnecessary-string-concatenation.md">no-unnecessary-string-concatenation</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpdocumentor-structures-echowithconcat"><span class="std std-ref">Phpdocumentor</span></a>, <a class="reference internal" href="Cases.html#teampass-structures-echowithconcat"><span class="std std-ref">TeamPass</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="ellipsis-usage">
<span id="id483"></span><h2>9.190. Ellipsis Usage<a class="headerlink" href="#ellipsis-usage" title="Permalink to this headline">¶</a></h2>
<p>Usage of the ellipsis keyword. The keyword is three dots : <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list">…</a> . It is also named variadic or splat operator.</p>
<p>It may be in function definitions, either in functioncalls.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list">…</a> allows for packing or unpacking arguments into an array.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$args</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="nx">foo</span><span class="p">(</span><span class="o">...</span><span class="nv">$args</span><span class="p">);</span>
<span class="c1">// Identical to foo(1,2,3);</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="o">...</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Identical to : $a = func_get_args();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/variadics">PHP RFC: Syntax for variadic functions</a>, <a class="reference external" href="https://lornajane.net/posts/2014/php-5-6-and-the-splat-operator">PHP 5.6 and the Splat Operator</a>, and <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list">Variable-length argument lists</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/EllipsisUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="else-if-versus-elseif">
<span id="id486"></span><h2>9.191. Else If Versus Elseif<a class="headerlink" href="#else-if-versus-elseif" title="Permalink to this headline">¶</a></h2>
<p>Always use elseif instead of else and if.</p>
<p>“The keyword elseif SHOULD be used instead of else if so that all control keywords look like single words”. Quoted from the PHP-FIG documentation</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Using elseif</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">elseif</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomethingElseIf</span><span class="p">();</span> <span class="p">}</span>
<span class="k">else</span> <span class="p">{</span> <span class="nx">doSomethingElse</span><span class="p">();</span> <span class="p">}</span>

<span class="c1">// Using else if</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomethingElseIf</span><span class="p">();</span> <span class="p">}</span>
<span class="k">else</span> <span class="p">{</span> <span class="nx">doSomethingElse</span><span class="p">();</span> <span class="p">}</span>

<span class="c1">// Using else if, no {}</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>  <span class="nx">doSomething</span><span class="p">();</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="nx">doSomethingElseIf</span><span class="p">();</span>
<span class="k">else</span>  <span class="nx">doSomethingElse</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.elseif.php">elseif/else if</a>.</p>
<div class="section" id="id487">
<h3>9.191.1. Suggestions<a class="headerlink" href="#id487" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge else and if into elseif</li>
<li>Turn the else expression into a block, and have more than the second if in this block</li>
<li>Turn the if / else if / else into a switch structure</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ElseIfElseif</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a>, <a class="reference internal" href="Rulesets.html#rector"><span class="std std-ref">Rector</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#teampass-structures-elseifelseif"><span class="std std-ref">TeamPass</span></a>, <a class="reference internal" href="Cases.html#phpdocumentor-structures-elseifelseif"><span class="std std-ref">Phpdocumentor</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-blocks">
<span id="id488"></span><h2>9.192. Empty Blocks<a class="headerlink" href="#empty-blocks" title="Permalink to this headline">¶</a></h2>
<p>Full empty block, part of a control structures.</p>
<p>It is recommended to remove those blocks, so as to reduce confusion in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$foo</span> <span class="k">as</span> <span class="nv">$bar</span><span class="p">)</span> <span class="p">;</span> <span class="c1">// This block seems erroneous</span>
    <span class="nv">$foobar</span><span class="o">++</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Empty block. Remove this</span>
<span class="p">}</span>

<span class="c1">// Blocks containing only empty expressions are also detected</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Although namespaces are not control structures, they are reported here</span>
<span class="k">namespace</span> <span class="nx">A</span><span class="p">;</span>
<span class="k">namespace</span> <span class="nx">B</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id489">
<h3>9.192.1. Suggestions<a class="headerlink" href="#id489" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fill the block with a command</li>
<li>Fill the block with a comment that explain the situation</li>
<li>Remove the block and its commanding operator</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/EmptyBlocks</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#cleverstyle-structures-emptyblocks"><span class="std std-ref">Cleverstyle</span></a>, <a class="reference internal" href="Cases.html#phpipam-structures-emptyblocks"><span class="std std-ref">PhpIPAM</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-classes">
<span id="id490"></span><h2>9.193. Empty Classes<a class="headerlink" href="#empty-classes" title="Permalink to this headline">¶</a></h2>
<p>Classes that do no define anything at all. This is probably dead code.</p>
<p>Classes that are directly derived from an exception are omitted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//Empty class</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="k">extends</span> <span class="nx">bar</span> <span class="p">{}</span>

<span class="c1">//Not an empty class</span>
<span class="k">class</span> <span class="nc">foo2</span> <span class="k">extends</span> <span class="nx">bar</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">FOO</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//Not an empty class, as derived from Exception</span>
<span class="k">class</span> <span class="nc">barException</span> <span class="k">extends</span> <span class="nx">\Exception</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id491">
<h3>9.193.1. Suggestions<a class="headerlink" href="#id491" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove an empty class :it is probably dead code.</li>
<li>Add some code to the class to make it concrete.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/EmptyClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-classes-emptyclass"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-function">
<span id="id492"></span><h2>9.194. Empty Function<a class="headerlink" href="#empty-function" title="Permalink to this headline">¶</a></h2>
<p>Function or method whose body is empty.</p>
<p>Such functions or methods are rarely useful. As a bare minimum, the function should return some useful value, even if constant.</p>
<p>A method is considered empty when it contains nothing, or contains expressions without impact.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// classic empty function</span>
<span class="k">function</span> <span class="nf">emptyFunction</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">class</span> <span class="nc">bar</span> <span class="p">{</span>
    <span class="c1">// classic empty method</span>
    <span class="k">function</span> <span class="nf">emptyMethod</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// classic empty function</span>
    <span class="k">function</span> <span class="nf">emptyMethodWithParent</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">barbar</span> <span class="k">extends</span> <span class="nx">bar</span> <span class="p">{</span>
    <span class="c1">// NOT an empty method : it overwrites the parent method</span>
    <span class="k">function</span> <span class="nf">emptyMethodWithParent</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Methods which overwrite another methods are omitted. Methods which are the concrete version of an abstract method are considered.</p>
<div class="section" id="id493">
<h3>9.194.1. Suggestions<a class="headerlink" href="#id493" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fill the function with actual code</li>
<li>Remove any usage of the function, then remove the function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/EmptyFunction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#contao-functions-emptyfunction"><span class="std std-ref">Contao</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-instructions">
<span id="id494"></span><h2>9.195. Empty Instructions<a class="headerlink" href="#empty-instructions" title="Permalink to this headline">¶</a></h2>
<p>Empty instructions are part of the code that have no instructions.</p>
<p>This may be trailing semi-colon or empty blocks for if-then structures.</p>
<p>Comments that explains the reason of the situation are not taken into account.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$condition</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;;;;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$condition</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id495">
<h3>9.195.1. Suggestions<a class="headerlink" href="#id495" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the empty lines</li>
<li>Fill the empty lines</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/EmptyLines</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-structures-emptylines"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#thinkphp-structures-emptylines"><span class="std std-ref">ThinkPHP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-interfaces">
<span id="id496"></span><h2>9.196. Empty Interfaces<a class="headerlink" href="#empty-interfaces" title="Permalink to this headline">¶</a></h2>
<p>Empty interfaces are a code smell. Interfaces should contains at least a method or a constant, and not be totally empty.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// an empty interface</span>
<span class="k">interface</span> <span class="k">empty</span> <span class="p">{}</span>

<span class="c1">// an normal interface</span>
<span class="k">interface</span> <span class="nx">normal</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">i</span><span class="p">()</span> <span class="p">;</span>
<span class="p">}</span>

<span class="c1">// a constants interface</span>
<span class="k">interface</span> <span class="nx">constantsOnly</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">FOO</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://r.je/empty-interfaces-bad-practice.html">Empty interfaces are bad practice</a> and <a class="reference external" href="https://hackernoon.com/are-interfaces-code-smell-bd19abc266d3">Blog : Are empty interfaces code smell?</a>.</p>
<div class="section" id="id497">
<h3>9.196.1. Suggestions<a class="headerlink" href="#id497" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the interface</li>
<li>Add some methods or constants to the interface</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/EmptyInterface</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-list">
<span id="id498"></span><h2>9.197. Empty List<a class="headerlink" href="#empty-list" title="Permalink to this headline">¶</a></h2>
<p>Empty <a class="reference external" href="https://www.php.net/list">list()</a> are not allowed anymore in PHP 7. There must be at least one variable in the list call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//Not accepted since PHP 7.0</span>
<span class="k">list</span><span class="p">()</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">//Still valid PHP code</span>
<span class="k">list</span><span class="p">(,</span><span class="nv">$x</span><span class="p">)</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id499">
<h3>9.197.1. Suggestions<a class="headerlink" href="#id499" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove empty list() calls</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/EmptyList</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-namespace">
<span id="id500"></span><h2>9.198. Empty Namespace<a class="headerlink" href="#empty-namespace" title="Permalink to this headline">¶</a></h2>
<p>Declaring a namespace in the code and not using it for structure declarations or global instructions is useless.</p>
<p>Using simple style :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">Y</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{}</span>


<span class="k">namespace</span> <span class="nx">X</span><span class="p">;</span>
<span class="c1">// This is useless</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Using bracket-style syntax :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">X</span> <span class="p">{</span>
    <span class="c1">// This is useless</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">Y</span> <span class="p">{</span>

    <span class="k">class</span> <span class="nc">foo</span> <span class="p">{}</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id501">
<h3>9.198.1. Suggestions<a class="headerlink" href="#id501" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the namespace</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/EmptyNamespace</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-empty-namespace.md">no-empty-namespace</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-slots-in-arrays">
<span id="id502"></span><h2>9.199. Empty Slots In Arrays<a class="headerlink" href="#empty-slots-in-arrays" title="Permalink to this headline">¶</a></h2>
<p>PHP tolerates the last element of an array to be empty.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">);</span>
    <span class="nv">$b</span> <span class="o">=</span>      <span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">];</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/EmptySlots</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="empty-traits">
<span id="id503"></span><h2>9.200. Empty Traits<a class="headerlink" href="#empty-traits" title="Permalink to this headline">¶</a></h2>
<p>List of all empty trait defined in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// empty trait</span>
<span class="k">trait</span> <span class="nx">t</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// Another empty trait</span>
<span class="k">trait</span> <span class="nx">t2</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Such traits may be reserved for future use. They may also be forgotten, and dead code.</p>
<div class="section" id="id504">
<h3>9.200.1. Suggestions<a class="headerlink" href="#id504" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add some code to the trait</li>
<li>Remove the trait</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/EmptyTrait</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-try-catch">
<span id="id505"></span><h2>9.201. Empty Try Catch<a class="headerlink" href="#empty-try-catch" title="Permalink to this headline">¶</a></h2>
<p>The code does try, then catch errors but do no act upon the error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ignore this</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>At worst, the error should be logged, so as to measure the actual usage of the catch expression.</p>
<p><code class="docutils literal notranslate"><span class="pre">catch(</span> <span class="pre">Exception</span> <span class="pre">$e)</span></code> (PHP 5) or <code class="docutils literal notranslate"><span class="pre">catch(`Throwable</span> <span class="pre">&lt;https://www.php.net/manual/en/class.throwable.php&gt;`_</span> <span class="pre">$e)</span></code> with empty catch block should be banned. They ignore any error and proceed as if nothing happened. At worst, the event should be logged for future analysis.</p>
<p>See also <a class="reference external" href="http://wiki.c2.com/?EmptyCatchClause">Empty Catch Clause</a>.</p>
<div class="section" id="id506">
<h3>9.201.1. Suggestions<a class="headerlink" href="#id506" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add some logging in the catch</li>
<li>Add a comment to mention why the catch is empty</li>
<li>Change the exception, chain it and throw again</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/EmptyTryCatch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#livezilla-structures-emptytrycatch"><span class="std std-ref">LiveZilla</span></a>, <a class="reference internal" href="Cases.html#mautic-structures-emptytrycatch"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="empty-with-expression">
<span id="id507"></span><h2>9.202. Empty With Expression<a class="headerlink" href="#empty-with-expression" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/empty">empty()</a> doesn’t accept expressions until PHP 5.5. Until then, it is necessary to store the result of the expression in a variable and then, test it with <a class="reference external" href="https://www.php.net/empty">empty()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 5.5+ empty() usage</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$b</span> <span class="o">.</span> <span class="nv">$c</span><span class="p">)))</span> <span class="p">{</span>
    <span class="nx">doSomethingWithoutA</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Compatible empty() usage</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$b</span> <span class="o">.</span> <span class="nv">$c</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomethingWithoutA</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/empty">empty</a>.</p>
<div class="section" id="id511">
<h3>9.202.1. Suggestions<a class="headerlink" href="#id511" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the compatible syntax, and store the result in a local variable before testing it with empty</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/EmptyWithExpression</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#humo-gen-structures-emptywithexpression"><span class="std std-ref">HuMo-Gen</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="encoded-simple-letters">
<span id="id512"></span><h2>9.203. Encoded Simple Letters<a class="headerlink" href="#encoded-simple-letters" title="Permalink to this headline">¶</a></h2>
<p>Some simple letters are written in escape sequence.</p>
<p>Usually, escape sequences are made to encode unusual characters. Using escape sequences for simple characters, like letters or numbers is suspicious.</p>
<p>This analysis also detects Unicode codepoint with superfluous leading zeros.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This escape sequence makes eval hard to spot</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">ev1l</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">(</span><span class="s1">&#39;php_info();&#39;</span><span class="p">);</span>

<span class="c1">// With a PHP 7.0 unicode code point sequence</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">ev\u</span><span class="p">{</span><span class="mo">000041</span><span class="p">}</span><span class="nx">l</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">(</span><span class="s1">&#39;php_info();&#39;</span><span class="p">);</span>

<span class="c1">// With a PHP 5.0+ hexadecimal sequence</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">ev\x41l</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">(</span><span class="s1">&#39;php_info();&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id513">
<h3>9.203.1. Suggestions<a class="headerlink" href="#id513" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make all simple letter appear clearly</li>
<li>Add comments about why this code is encoded</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/EncodedLetters</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-security-encodedletters"><span class="std std-ref">Zurmo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="eval-usage">
<span id="id514"></span><h2>9.204. Eval() Usage<a class="headerlink" href="#eval-usage" title="Permalink to this headline">¶</a></h2>
<p>Using <a class="reference external" href="https://www.php.net/eval">eval()</a> is evil.</p>
<p>Using <a class="reference external" href="https://www.php.net/eval">eval()</a> is bad for performances (compilation time), for caches (it won’t be compiled), and for security (if it includes external data).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// Avoid using incoming data to build the eval() expression : any filtering error leads to PHP injection</span>
    <span class="nv">$mathExpression</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;mathExpression&#39;</span><span class="p">];</span>
    <span class="nv">$mathExpression</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;#[^0-9+\-*/\(/)]#is&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$mathExpression</span><span class="p">);</span> <span class="c1">// expecting 1+2</span>
    <span class="nv">$literalCode</span> <span class="o">=</span> <span class="s1">&#39;$a = &#39;</span><span class="o">.</span><span class="nv">$mathExpression</span><span class="o">.</span><span class="s1">&#39;;&#39;</span><span class="p">;</span>
    <span class="k">eval</span><span class="p">(</span><span class="nv">$literalCode</span><span class="p">);</span>
    <span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>

    <span class="c1">// If the code code given to eval() is known at compile time, it is best to put it inline</span>
    <span class="nv">$literalCode</span> <span class="o">=</span> <span class="s1">&#39;phpinfo();&#39;</span><span class="p">;</span>
    <span class="k">eval</span><span class="p">(</span><span class="nv">$literalCode</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Most of the time, it is possible to replace the code by some standard PHP, like variable variable for accessing a variable for which you have the name.
At worse, including a pregenerated file is faster and cacheable.</p>
<p>There are several situations where <a class="reference external" href="https://www.php.net/eval">eval()</a> is actually the only solution :</p>
<p>For PHP 7.0 and later, it is important to put <a class="reference external" href="https://www.php.net/eval">eval()</a> in a try..catch expression.</p>
<p>See also <a class="reference external" href="http://www.php.net/eval">eval</a> and <a class="reference external" href="https://www.php.net/eval">The Land Where PHP Uses `eval()</a> &lt;<a class="reference external" href="https://www.exakat.io/land-where-php-uses-eval/">https://www.exakat.io/land-where-php-uses-eval/</a>&gt;`_.</p>
<div class="section" id="id519">
<h3>9.204.1. Suggestions<a class="headerlink" href="#id519" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a dynamic feature of PHP to replace the dynamic code</li>
<li>Store the code on the disk, and use include</li>
<li>Replace create_function() with a closure!</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/EvalUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-eval.md">no-eval</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xoops-structures-evalusage"><span class="std std-ref">XOOPS</span></a>, <a class="reference internal" href="Cases.html#mautic-structures-evalusage"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="exceeding-typehint">
<span id="id520"></span><h2>9.205. Exceeding Typehint<a class="headerlink" href="#exceeding-typehint" title="Permalink to this headline">¶</a></h2>
<p>The typehint is not fully used in the method. Some of the defined methods in the typehint are unused. A tighter typehint could be used, to avoid method pollution.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">i1</span><span class="p">();</span>
    <span class="k">function</span> <span class="nf">i2</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">j</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">j1</span><span class="p">();</span>
    <span class="k">function</span> <span class="nf">j2</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">i</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">j</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// the i typehint is totally used</span>
    <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">i1</span><span class="p">();</span>
    <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">i2</span><span class="p">();</span>

    <span class="c1">// the i typehint is not totally used : j2() is not used.</span>
    <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">j1</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Tight typehint prevents the argument from doing too much. They also require more maintenance : creation of dedicated interfaces, method management to keep all typehint tight.</p>
<p>See also <a class="reference internal" href="#insufficient-typehint"><span class="std std-ref">Insufficient Typehint</span></a>.</p>
<div class="section" id="id521">
<h3>9.205.1. Suggestions<a class="headerlink" href="#id521" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Keep the typehint tight, do not inject more than needed.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/ExceedingTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="exception-order">
<span id="id522"></span><h2>9.206. Exception Order<a class="headerlink" href="#exception-order" title="Permalink to this headline">¶</a></h2>
<p>When catching exception, the most specialized exceptions must be in the early catch, and the most general exceptions must be in the later catch. Otherwise, the general catches intercept the exception, and the more specialized will not be read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">A</span> <span class="k">extends</span> <span class="nx">\Exception</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">B</span> <span class="k">extends</span> <span class="nx">A</span> <span class="p">{}</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">A</span> <span class="nv">$a1</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">B</span> <span class="nv">$b2</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Never reached, as previous Catch is catching the early worm</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id523">
<h3>9.206.1. Suggestions<a class="headerlink" href="#id523" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove one of the catch clause</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/AlreadyCaught</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#woocommerce-exceptions-alreadycaught"><span class="std std-ref">Woocommerce</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="exit-usage">
<span id="id524"></span><h2>9.207. Exit() Usage<a class="headerlink" href="#exit-usage" title="Permalink to this headline">¶</a></h2>
<p>Using <a class="reference external" href="https://www.www.php.net/exit">exit</a> or <a class="reference external" href="https://www.php.net/die">die() &lt;https://www.php.net/`die</a>&gt;`_ in the code makes the code untestable (it will <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> unit tests). Moreover, if there is no reason or string to display, it may take a long time to spot where the application is stuck.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Throw an exception, that may be caught somewhere</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>

<span class="c1">// Dying with error message.</span>
<span class="k">die</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//exiting the function but not dying</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">somethingWrong</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Try exiting the function/class with return, or throw exception that may be caught later in the code.</p>
<div class="section" id="id526">
<h3>9.207.1. Suggestions<a class="headerlink" href="#id526" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid exit and die. Let the script finish.</li>
<li>Throw an exception and let it be handled before finishing</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ExitUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-exit.md">no-exit</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#traq-structures-exitusage"><span class="std std-ref">Traq</span></a>, <a class="reference internal" href="Cases.html#thinkphp-structures-exitusage"><span class="std std-ref">ThinkPHP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="exponent-usage">
<span id="id527"></span><h2>9.208. Exponent Usage<a class="headerlink" href="#exponent-usage" title="Permalink to this headline">¶</a></h2>
<p>Usage of the <a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">**</a> operator or **=, to make exponents.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$eight</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">3</span><span class="p">;</span>

<span class="nv">$sixteen</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="nv">$sixteen</span> <span class="nx">\</span><span class="o">*</span><span class="nx">\</span><span class="o">*</span><span class="nx">\</span><span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">Arithmetic Operators</a>.</p>
<div class="section" id="id530">
<h3>9.208.1. Suggestions<a class="headerlink" href="#id530" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the operator when no literal negative number is in the expression</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ExponentUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="failed-substr-comparison">
<span id="id531"></span><h2>9.209. Failed Substr Comparison<a class="headerlink" href="#failed-substr-comparison" title="Permalink to this headline">¶</a></h2>
<p>The extracted string must be of the size of the compared string.</p>
<p>This is also true for negative lengths.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Possible comparison</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// Always failing</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// Omitted in this analysis</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id532">
<h3>9.209.1. Suggestions<a class="headerlink" href="#id532" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the string</li>
<li>Fix the length of the string</li>
<li>Put the string in a constant, and use strlen() or mb_strlen()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/FailingSubstrComparison</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-structures-failingsubstrcomparison"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#mediawiki-structures-failingsubstrcomparison"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="fetch-one-row-format">
<span id="id533"></span><h2>9.210. Fetch One Row Format<a class="headerlink" href="#fetch-one-row-format" title="Permalink to this headline">¶</a></h2>
<p>When reading results with ext/Sqlite3, it is recommended to explicitly request SQLITE3_NUM or SQLITE3_ASSOC, while avoiding the default value and SQLITE3_BOTH.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$res</span> <span class="o">=</span> <span class="nv">$database</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

<span class="c1">// Fastest version, but less readable</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">(</span><span class="nx">\SQLITE3_NUM</span><span class="p">);</span>
<span class="c1">// Almost the fastest version, and more readable</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">(</span><span class="nx">\SQLITE3_ASSOC</span><span class="p">);</span>

<span class="c1">// Default version. Quite slow</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">();</span>

<span class="c1">// Worse case</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$res</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">(</span><span class="nx">\SQLITE3_BOTH</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is a micro-optimisation. The difference may be visible with 200k rows fetches, and measurable with 10k.</p>
<div class="section" id="id534">
<h3>9.210.1. Suggestions<a class="headerlink" href="#id534" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Specify the result format when reading rows from a Sqlite3 database</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/FetchOneRowFormat</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="filter-to-add-slashes">
<span id="id535"></span><h2>9.211. Filter To add_slashes()<a class="headerlink" href="#filter-to-add-slashes" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">FILTER_SANITIZE_MAGIC_QUOTES</span></code> is deprecated. In PHP 7.4, it should be replaced with <a class="reference external" href="https://www.php.net/addslashes">addslashes()</a></p>
<p>According to the migration RDFC : ‘Magic quotes were deprecated all the way back in PHP 5.3 and later removed in PHP 5.4. The filter extension implements a sanitization filter that mimics this behavior of magic_quotes by calling <a class="reference external" href="https://www.php.net/addslashes">addslashes()</a> on the input in question.’</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Deprecated way to filter input</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="nb">filter_input</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="nx">FILTER_SANITIZE_MAGIC_QUOTES</span><span class="p">);</span>

<span class="c1">// Alternative way to filter input</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="nb">addslashes</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/addslashes">addslashes()</a> used to filter data while building SQL queries, to prevent injections. Nowadays, prepared queries are a better option.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_4">Deprecations for PHP 7.4</a>.</p>
<div class="section" id="id538">
<h3>9.211.1. Suggestions<a class="headerlink" href="#id538" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace <code class="docutils literal notranslate"><span class="pre">FILTER_SANITIZE_MAGIC_QUOTES</span></code> with addslashes()</li>
<li>Replace <code class="docutils literal notranslate"><span class="pre">FILTER_SANITIZE_MAGIC_QUOTES</span></code> with an adapted escaping system</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/FilterToAddSlashes</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="final-class-usage">
<span id="id539"></span><h2>9.212. Final Class Usage<a class="headerlink" href="#final-class-usage" title="Permalink to this headline">¶</a></h2>
<p>List of all final classes being used.</p>
<p>final may be applied to classes and methods.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">class</span> <span class="nc">BaseClass</span> <span class="p">{</span>
   <span class="k">public</span> <span class="k">function</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">echo</span> <span class="s1">&#39;BaseClass::test() called&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">moreTesting</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">echo</span> <span class="s1">&#39;BaseClass::moreTesting() called&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ChildClass</span> <span class="k">extends</span> <span class="nx">BaseClass</span> <span class="p">{</span>
   <span class="k">public</span> <span class="k">function</span> <span class="nf">moreTesting</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">echo</span> <span class="s1">&#39;ChildClass::moreTesting() called&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Results in Fatal error: Cannot override final method BaseClass::moreTesting()</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.final.php">Final Keyword</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/Finalclass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="final-methods-usage">
<span id="id541"></span><h2>9.213. Final Methods Usage<a class="headerlink" href="#final-methods-usage" title="Permalink to this headline">¶</a></h2>
<p>List of all final methods being used.</p>
<p>final may be applied to classes and methods.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">class</span> <span class="nc">BaseClass</span> <span class="p">{</span>
   <span class="k">public</span> <span class="k">function</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">echo</span> <span class="s1">&#39;BaseClass::test() called&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
   <span class="p">}</span>

   <span class="k">final</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">moreTesting</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">echo</span> <span class="s1">&#39;BaseClass::moreTesting() called&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ChildClass</span> <span class="k">extends</span> <span class="nx">BaseClass</span> <span class="p">{</span>
   <span class="k">public</span> <span class="k">function</span> <span class="nf">moreTesting</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">echo</span> <span class="s1">&#39;ChildClass::moreTesting() called&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Results in Fatal error: Cannot override final method BaseClass::moreTesting()</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.final.php">Final Keyword</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/Finalmethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="flexible-heredoc">
<span id="id543"></span><h2>9.214. Flexible Heredoc<a class="headerlink" href="#flexible-heredoc" title="Permalink to this headline">¶</a></h2>
<p>Flexible syntax for Heredoc.</p>
<p>The new flexible syntax for heredoc and nowdoc enable the closing marker to be indented, and remove the new line requirement after the closing marker.</p>
<p>It was introduced in PHP 7.3.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7.3 and newer</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">END</span><span class="s"></span>

<span class="s">    flexible syntax</span>
<span class="s">    with extra indentation</span>

<span class="s">    END);</span>

<span class="s">// All PHP versions</span>
<span class="s">$a = &lt;&lt;&lt;END</span>

<span class="s">    Normal syntax</span>

<span class="dl">END</span><span class="p">;</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This syntax is backward incompatible : once adopted in the code, previous versions won’t compile it.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.string.php#language.types.string.syntax.heredoc">Heredoc</a> and <a class="reference external" href="https://wiki.php.net/rfc/flexible_heredoc_nowdoc_syntaxes">Flexible Heredoc and Nowdoc Syntaxes</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/FlexibleHeredoc</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="fn-argument-variable-confusion">
<span id="id544"></span><h2>9.215. Fn Argument Variable Confusion<a class="headerlink" href="#fn-argument-variable-confusion" title="Permalink to this headline">¶</a></h2>
<p>Avoid using local variables as arrow function arguments.</p>
<p>When a local variable name is used as an argument’s name in an arrow function, the local variable from the original scope is not imported. They are now two distinct variables.</p>
<p>When the local variable is not listed as argument, it is then imported in the arrow function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$locale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Actually ignores the argument, and returns the local variable ``$locale``.</span>
    <span class="nv">$fn2</span> <span class="o">=</span> <span class="nx">fn</span> <span class="p">(</span><span class="nv">$argument</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nv">$locale</span><span class="p">;</span>

    <span class="c1">// Seems similar to above, but returns the incoming argument</span>
    <span class="nv">$fn2</span> <span class="o">=</span> <span class="nx">fn</span> <span class="p">(</span><span class="nv">$locale</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nv">$locale</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arrow.php">Arrow functions</a>.</p>
<div class="section" id="id545">
<h3>9.215.1. Suggestions<a class="headerlink" href="#id545" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the name of the local variable</li>
<li>Change the name of the argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/FnArgumentVariableConfusion</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="for-using-functioncall">
<span id="id546"></span><h2>9.216. For Using Functioncall<a class="headerlink" href="#for-using-functioncall" title="Permalink to this headline">¶</a></h2>
<p>It is recommended to avoid functioncall in the <a class="reference external" href="https://www.php.net/manual/en/control-structures.for.php">for()</a> statement.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Fastest way</span>
<span class="nv">$nb</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$nb</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Same as above, but slow</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Same as above, but slow</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$portions</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$portion</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// here, array_sum() doesn&#39;t depends on the $grade. It should be out of the loop</span>
    <span class="nv">$portion</span> <span class="o">=</span> <span class="nv">$portion</span> <span class="o">/</span> <span class="nb">array_sum</span><span class="p">(</span><span class="nv">$portions</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$total</span> <span class="o">=</span> <span class="nb">array_sum</span><span class="p">(</span><span class="nv">$portion</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$portion</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$portion</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$portion</span> <span class="o">=</span> <span class="nv">$portion</span> <span class="o">/</span> <span class="nv">$total</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is true with any kind of functioncall that returns the same value throughout the loop.</p>
<div class="section" id="id548">
<h3>9.216.1. Suggestions<a class="headerlink" href="#id548" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Call the function once, before the loop</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ForWithFunctioncall</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-functioncall-in-loop.md">no-functioncall-in-loop</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="foreach-don-t-change-pointer">
<span id="id549"></span><h2>9.217. Foreach Don’t Change Pointer<a class="headerlink" href="#foreach-don-t-change-pointer" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a> loops use their own internal cursor.</p>
<p>A foreach loop won’t change the internal pointer of the array, as it works on a copy of the source. Hence, applying array pointer’s functions such as <a class="reference external" href="https://www.php.net/current">current()</a> or <a class="reference external" href="https://www.php.net/next">next()</a> to the source array won’t have the same behavior in PHP 5 than PHP 7.</p>
<p>This only applies when a <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> by reference is used.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$numbers</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="nb">next</span><span class="p">(</span><span class="nv">$numbers</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$numbers</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$number</span><span class="p">){</span>
    <span class="k">print</span> <span class="nv">$number</span><span class="p">;</span>
    <span class="k">print</span> <span class="nb">current</span><span class="p">(</span><span class="nv">$numbers</span><span class="p">)</span><span class="o">.</span><span class="nx">\n</span><span class="p">;</span> <span class="c1">// Always</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration70.incompatible.php#migration70.incompatible.foreach.array-pointer">foreach no longer changes the internal array pointer</a> and <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a>.</p>
<div class="section" id="id553">
<h3>9.217.1. Suggestions<a class="headerlink" href="#id553" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do not change the pointer on the source array while in the loop</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ForeachDontChangePointer</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="foreach-on-object">
<span id="id554"></span><h2>9.218. Foreach On Object<a class="headerlink" href="#foreach-on-object" title="Permalink to this headline">¶</a></h2>
<p>Foreach on object looks like a typo. This is particularly true when both object and member are variables.</p>
<p>Foreach on an object member is a legit PHP syntax, though it is very rare : blind variables rarely have to be securing in an object to be processed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Looks suspicious</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$o</span> <span class="o">-&gt;</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// This is the real thing</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$o</span> <span class="o">=&gt;</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ForeachObject</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="foreach-reference-is-not-modified">
<span id="id555"></span><h2>9.219. Foreach Reference Is Not Modified<a class="headerlink" href="#foreach-reference-is-not-modified" title="Permalink to this headline">¶</a></h2>
<p>Foreach statement may loop using a reference, especially when the loop has to change values of the array it is looping on.</p>
<p>In the spotted loop, reference are used but never modified. They may be removed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$letters</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">);</span>

<span class="c1">// $letter is not used here</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$letters</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$letter</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$alphabet</span> <span class="o">.=</span> <span class="nv">$letter</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// $letter is actually used here</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$letters</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$letter</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$letter</span> <span class="o">=</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$letter</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id556">
<h3>9.219.1. Suggestions<a class="headerlink" href="#id556" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the reference from the foreach</li>
<li>Actually modify the content of the reference</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ForeachReferenceIsNotModified</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-structures-foreachreferenceisnotmodified"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#vanilla-structures-foreachreferenceisnotmodified"><span class="std std-ref">Vanilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="foreach-with-list">
<span id="id557"></span><h2>9.220. Foreach With list()<a class="headerlink" href="#foreach-with-list" title="Permalink to this headline">¶</a></h2>
<p>Foreach loops have the ability to use <a class="reference external" href="https://www.php.net/list">list()</a> (or []) as blind variables. This syntax assign directly array elements to various variables.</p>
<p>PHP 5.5 introduced the usage of list in <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> loops. Until PHP 7.1, it was not possible to use non-numerical arrays as <a class="reference external" href="https://www.php.net/list">list()</a> wouldn’t support string-indexed arrays.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// PHP 5.5 and later, with numerically-indexed arrays</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// do something</span>
    <span class="p">}</span>


    <span class="c1">// PHP 7.1 and later, with arrays</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="k">list</span><span class="p">(</span><span class="s1">&#39;col1&#39;</span> <span class="o">=&gt;</span> <span class="nv">$a</span><span class="p">,</span> <span class="s1">&#39;col3&#39;</span> <span class="o">=&gt;</span> <span class="nv">$b</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// &#39;col2 is ignored&#39;</span>
        <span class="c1">// do something</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Previously, it was compulsory to <a class="reference external" href="https://www.php.net/extract">extract()</a> the data from the blind array :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$c</span><span class="p">;</span>
        <span class="c1">// do something</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://sebastiandedeyne.com/the-list-function-and-practical-uses-of-array-destructuring-in-php">The list function &amp; practical uses of array destructuring in PHP</a> and <a class="reference external" href="https://stitcher.io/blog/array-destructuring-with-list-in-php#in-loops">Array destructuring in PHP</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ForeachWithList</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="forgotten-interface">
<span id="id562"></span><h2>9.221. Forgotten Interface<a class="headerlink" href="#forgotten-interface" title="Permalink to this headline">¶</a></h2>
<p>The following classes have been found implementing an interface’s methods, though it doesn’t explicitly implements this interface. This may have been forgotten.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">i</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// i is not implemented and declared</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">i</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">function</span> <span class="nf">j</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// i is implemented and declared</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="k">implements</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">i</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">function</span> <span class="nf">j</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <span class="xref std std-ref">could-use-trait</span>.</p>
<div class="section" id="id563">
<h3>9.221.1. Suggestions<a class="headerlink" href="#id563" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Mention interfaces explicitly whenever possible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/CouldUseInterface</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="forgotten-thrown">
<span id="id564"></span><h2>9.222. Forgotten Thrown<a class="headerlink" href="#forgotten-thrown" title="Permalink to this headline">¶</a></h2>
<p>An exception is instantiated, but not thrown.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">MyException</span> <span class="k">extends</span> <span class="nx">\Exception</span> <span class="p">{</span> <span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$error</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This looks like &#39;throw&#39; was omitted</span>
    <span class="k">new</span> <span class="nx">MyException</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id565">
<h3>9.222.1. Suggestions<a class="headerlink" href="#id565" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the throw expression</li>
<li>Add the new to the throw expression</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/ForgottenThrown</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="forgotten-visibility">
<span id="id566"></span><h2>9.223. Forgotten Visibility<a class="headerlink" href="#forgotten-visibility" title="Permalink to this headline">¶</a></h2>
<p>Some classes elements (property, method, constant) are missing their explicit visibility.</p>
<p>By default, it is public. It should at least be mentioned as public, or may be reviewed as protected or private.</p>
<p>Class constants support also visibility since PHP 7.1.</p>
<p>final, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> and abstract are not counted as visibility. Only public, private and protected. The PHP 4 var keyword is counted as undefined.</p>
<p>Traits, classes and interfaces are checked.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Explicit visibility</span>
<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nx">sconst</span> <span class="nx">NO_VISIBILITY_CONST</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// For PHP 7.2 and later</span>

    <span class="k">private</span> <span class="nv">$noVisibilityProperty</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">Method</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Missing visibility</span>
<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">NO_VISIBILITY_CONST</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// For PHP 7.2 and later</span>

    <span class="k">var</span> <span class="nv">$noVisibilityProperty</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// Only with var</span>

    <span class="k">function</span> <span class="nf">NoVisibilityForMethod</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.visibility.php">Visibility</a> and <a class="reference external" href="https://torquemag.io/2016/05/understanding-concept-visibility-object-oriented-php/">Understanding The Concept Of Visibility In Object Oriented PHP</a>.</p>
<div class="section" id="id570">
<h3>9.223.1. Suggestions<a class="headerlink" href="#id570" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always add explicit visibility to methods and constants in a class</li>
<li>Always add explicit visibility to properties in a class, after PHP 7.4</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NonPpp</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/always-have-visibility.md">always-have-visibility</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#fuelcms-classes-nonppp"><span class="std std-ref">FuelCMS</span></a>, <a class="reference internal" href="Cases.html#livezilla-classes-nonppp"><span class="std std-ref">LiveZilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="forgotten-whitespace">
<span id="id571"></span><h2>9.224. Forgotten Whitespace<a class="headerlink" href="#forgotten-whitespace" title="Permalink to this headline">¶</a></h2>
<p>Forgotten whitespaces only bring misery to the code.</p>
<p>White spaces have been left at either end of a file : before the PHP opening tag, or after the closing tag.</p>
<p>Usually, such whitespaces are forgotten, and may end up summoning the infamous ‘headers already sent’ error. It is better to remove them.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// This script has no forgotten whitespace, not at the beginning</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// This script has no forgotten whitespace, not at the end</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://stackoverflow.com/questions/8028957/how-to-fix-headers-already-sent-error-in-php">How to fix Headers already sent error in PHP</a>.</p>
<div class="section" id="id572">
<h3>9.224.1. Suggestions<a class="headerlink" href="#id572" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove all whitespaces before and after a script. This doesn’t apply to template, which may need to use those spaces.</li>
<li>Remove the final tag, to prevent any whitespace to be forgotten at the end of the file. This doesn’t apply to the opening PHP tag, which is always necessary.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ForgottenWhiteSpace</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="fossilized-method">
<span id="id573"></span><h2>9.225. Fossilized Method<a class="headerlink" href="#fossilized-method" title="Permalink to this headline">¶</a></h2>
<p>A method is fossilized when it is overwritten so often that changing a default value, a return type or an argument type is getting difficult.</p>
<p>This happens when a class is extended. When a method is overwritten once, it may be easy to update the signature in two places. The more methods are overwriting a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> method, the more difficult it is to update it.</p>
<p>This analysis counts the number of times a method is overwritten, and report any method that is ovrewritten more than 6 times. This threshold may be configured.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x1</span> <span class="p">{</span>
    <span class="c1">// foo1() is never overwritten. It is easy to update.</span>
    <span class="k">function</span> <span class="nf">foo1</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// foo7() is overwritten seven times. It is hard to update.</span>
    <span class="k">function</span> <span class="nf">foo7</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// classes x2 to x7, all overwrite foo7();</span>
<span class="c1">// Only x2 is presente here.</span>
<span class="k">class</span> <span class="nc">x2</span> <span class="k">extends</span> <span class="nx">x1</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo7</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="7%" />
<col width="7%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>fossilizationThreshold</td>
<td>6</td>
<td>integer</td>
<td>Minimal number of overwriting methods to consider a method difficult to update.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/FossilizedMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="fully-qualified-constants">
<span id="id575"></span><h2>9.226. Fully Qualified Constants<a class="headerlink" href="#fully-qualified-constants" title="Permalink to this headline">¶</a></h2>
<p>Constants defined with their namespace.</p>
<p>When defining constants with <a class="reference external" href="https://www.php.net/define">define()</a> function, it is possible to include the actual namespace :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;a\b\c&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>However, the name should be fully qualified without the initial . Here, abc constant will never be accessible as a namespace constant, though it will be accessible via the <a class="reference external" href="https://www.php.net/constant">constant()</a> function.</p>
<p>Also, the namespace will be absolute, and not a relative namespace of the current one.</p>
<div class="section" id="id577">
<h3>9.226.1. Suggestions<a class="headerlink" href="#id577" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the initial when creating constants with define() : for example, use trim($x, ‘’), which removes anti-slashes before and after.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/ConstantFullyQualified</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="function-subscripting">
<span id="id578"></span><h2>9.227. Function Subscripting<a class="headerlink" href="#function-subscripting" title="Permalink to this headline">¶</a></h2>
<p>It is possible to use the result of a methodcall directly as an array, without storing the result in a temporary variable.</p>
<p>This works, given that the method actually returns an array.</p>
<p>This syntax was not possible until PHP 5.4. Until then, it was compulsory to store the result in a variable first. Although this is now superfluous, it has been a standard syntax in PHP, and is still being used.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nx">foo</span><span class="p">()[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// displays &#39;a&#39;;</span>

<span class="c1">// Function subscripting, the old way</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span>
<span class="k">echo</span> <span class="nv">$x</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// displays &#39;a&#39;;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Storing the result in a variable is still useful if the result is actually used more than once.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/FunctionSubscripting</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="function-subscripting-old-style">
<span id="id579"></span><h2>9.228. Function Subscripting, Old Style<a class="headerlink" href="#function-subscripting-old-style" title="Permalink to this headline">¶</a></h2>
<p>Since PHP 5.4, it is now possible use function results as an array, and access directly its element :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">echo</span> <span class="nx">foo</span><span class="p">()[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// displays &#39;a&#39;;</span>

<span class="c1">// Function subscripting, the old way</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span>
<span class="k">echo</span> <span class="nv">$x</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// displays &#39;a&#39;;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id580">
<h3>9.228.1. Suggestions<a class="headerlink" href="#id580" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Skip the local variable and directly use the return value from the function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/FunctionPreSubscripting</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openconf-structures-functionpresubscripting"><span class="std std-ref">OpenConf</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="functions-removed-in-php-5-4">
<span id="id581"></span><h2>9.229. Functions Removed In PHP 5.4<a class="headerlink" href="#functions-removed-in-php-5-4" title="Permalink to this headline">¶</a></h2>
<p>Those functions were removed in PHP 5.4.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Deprecated as of PHP 5.4.0</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql_user&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql_password&#39;</span><span class="p">);</span>
<span class="nv">$db_list</span> <span class="o">=</span> <span class="nb">mysql_list_dbs</span><span class="p">(</span><span class="nv">$link</span><span class="p">);</span>

<span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nb">mysql_fetch_object</span><span class="p">(</span><span class="nv">$db_list</span><span class="p">))</span> <span class="p">{</span>
     <span class="k">echo</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">Database</span> <span class="o">.</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration54.deprecated.php">Deprecated features in PHP 5.4.x</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php54RemovedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="functions-removed-in-php-5-5">
<span id="id582"></span><h2>9.230. Functions Removed In PHP 5.5<a class="headerlink" href="#functions-removed-in-php-5-5" title="Permalink to this headline">¶</a></h2>
<p>Those functions were removed in PHP 5.5.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/php_logo_guid">php_logo_guid()</a></li>
<li><a class="reference external" href="https://www.php.net/php_egg_logo_guid">php_egg_logo_guid()</a></li>
<li><a class="reference external" href="https://www.php.net/php_real_logo_guid">php_real_logo_guid()</a></li>
<li><a class="reference external" href="https://www.php.net/zend_logo_guid">zend_logo_guid()</a></li>
<li><a class="reference external" href="https://www.php.net/mcrypt_cbc">mcrypt_cbc()</a></li>
<li><a class="reference external" href="https://www.php.net/mcrypt_cfb">mcrypt_cfb()</a></li>
<li><a class="reference external" href="https://www.php.net/mcrypt_ecb">mcrypt_ecb()</a></li>
<li><a class="reference external" href="https://www.php.net/mcrypt_ofb">mcrypt_ofb()</a></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">echo</span> <span class="s1">&#39;&lt;img src=&quot;&#39;</span> <span class="o">.</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;PHP_SELF&#39;</span><span class="p">]</span> <span class="o">.</span>
     <span class="s1">&#39;?=&#39;</span> <span class="o">.</span> <span class="nb">php_logo_guid</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;&quot; alt=&quot;PHP Logo !&quot; /&gt;&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration55.deprecated.php">Deprecated features in PHP 5.5.x</a>.</p>
<div class="section" id="id583">
<h3>9.230.1. Suggestions<a class="headerlink" href="#id583" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Stop using those functions</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php55RemovedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="generator-cannot-return">
<span id="id584"></span><h2>9.231. Generator Cannot Return<a class="headerlink" href="#generator-cannot-return" title="Permalink to this headline">¶</a></h2>
<p>Generators could not use return and yield at the same time. In PHP 7.0, generator can now use both of them.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is not allowed until PHP 7.0</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id585">
<h3>9.231.1. Suggestions<a class="headerlink" href="#id585" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the return</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/GeneratorCannotReturn</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="getting-last-element">
<span id="id586"></span><h2>9.232. Getting Last Element<a class="headerlink" href="#getting-last-element" title="Permalink to this headline">¶</a></h2>
<p>Getting the last element of an array relies on array_key_last().</p>
<p>array_key_last() was added in PHP 7.3. Before that,</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>

<span class="c1">// Best solutions, by far</span>
<span class="nv">$last</span> <span class="o">=</span> <span class="nv">$array</span><span class="p">[</span><span class="nx">array_key_last</span><span class="p">(</span><span class="nv">$array</span><span class="p">)];</span>

<span class="c1">// Best solutions, just as fast as each other</span>
<span class="nv">$last</span> <span class="o">=</span> <span class="nv">$array</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
<span class="nv">$last</span> <span class="o">=</span> <span class="nb">end</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// Bad solutions</span>

<span class="c1">// popping, but restoring the value.</span>
<span class="nv">$last</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
<span class="nv">$array</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$last</span><span class="p">;</span>

<span class="c1">// array_unshift would be even worse</span>

<span class="c1">// reversing array</span>
<span class="nv">$last</span> <span class="o">=</span> <span class="nb">array_reverse</span><span class="p">(</span><span class="nv">$array</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>

<span class="c1">// slicing the array</span>
<span class="nv">$last</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="err">&#39;</span><span class="p">,</span>
<span class="nv">$last</span> <span class="o">=</span> <span class="nb">current</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
<span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id587">
<h3>9.232.1. Suggestions<a class="headerlink" href="#id587" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use PHP native function : array_key_last(), when using PHP 7.4 and later</li>
<li>Use PHP native function : array_pop()</li>
<li>Organise the code to put the last element in the first position (array_unshift() instead of append operator [])</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/GettingLastElement</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thelia-arrays-gettinglastelement"><span class="std std-ref">Thelia</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="global-inside-loop">
<span id="id588"></span><h2>9.233. Global Inside Loop<a class="headerlink" href="#global-inside-loop" title="Permalink to this headline">¶</a></h2>
<p>The global keyword must be used out of loops. Otherwise, it is evaluated each loop, slowing the whole process.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Here, global is used once</span>
<span class="k">global</span> <span class="nv">$total</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$total</span> <span class="o">+=</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Global is called each time : this is slow.</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$total</span><span class="p">;</span>
    <span class="nv">$total</span> <span class="o">+=</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id589">
<h3>9.233.1. Suggestions<a class="headerlink" href="#id589" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the global keyword outside the loop</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/GlobalOutsideLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="global-usage">
<span id="id590"></span><h2>9.234. Global Usage<a class="headerlink" href="#global-usage" title="Permalink to this headline">¶</a></h2>
<p>List usage of globals variables, with global keywords or direct access to $GLOBALS.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* global scope */</span>

<span class="k">function</span> <span class="nf">test</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span> <span class="cm">/* reference to local scope variable */</span>
<span class="p">}</span>

<span class="nx">test</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to avoid using global variables, at it makes it very difficult to track changes in values across the whole application.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.variables.scope.php">Variable scope</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/GlobalUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-global.md">no-global</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="group-use-declaration">
<span id="id591"></span><h2>9.235. Group Use Declaration<a class="headerlink" href="#group-use-declaration" title="Permalink to this headline">¶</a></h2>
<p>The group use declaration is used in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Adapted from the RFC documentation</span>
<span class="c1">// Pre PHP 7 code</span>
<span class="k">use</span> <span class="nx">some\name_space\ClassA</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">some\name_space\ClassB</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">some\name_space\ClassC</span> <span class="k">as</span> <span class="nx">C</span><span class="p">;</span>

<span class="k">use</span> <span class="k">function</span> <span class="nf">some\name_space\fn_a</span><span class="p">;</span>
<span class="k">use</span> <span class="k">function</span> <span class="nf">some\name_space\fn_b</span><span class="p">;</span>
<span class="k">use</span> <span class="k">function</span> <span class="nf">some\name_space\fn_c</span><span class="p">;</span>

<span class="k">use</span> <span class="k">const</span> <span class="no">some\name_space\ConstA</span><span class="p">;</span>
<span class="k">use</span> <span class="k">const</span> <span class="no">some\name_space\ConstB</span><span class="p">;</span>
<span class="k">use</span> <span class="k">const</span> <span class="no">some\name_space\ConstC</span><span class="p">;</span>

<span class="c1">// PHP 7+ code</span>
<span class="k">use</span> <span class="nx">some\name_space\</span><span class="p">{</span><span class="nx">ClassA</span><span class="p">,</span> <span class="nx">ClassB</span><span class="p">,</span> <span class="nx">ClassC</span> <span class="k">as</span> <span class="nx">C</span><span class="p">};</span>
<span class="k">use</span> <span class="k">function</span> <span class="nf">some\name_space\</span><span class="p">{</span><span class="nx">fn_a</span><span class="p">,</span> <span class="nx">fn_b</span><span class="p">,</span> <span class="nx">fn_c</span><span class="p">};</span>
<span class="k">use</span> <span class="k">const</span> <span class="no">some\name_space\</span><span class="p">{</span><span class="nx">ConstA</span><span class="p">,</span> <span class="nx">ConstB</span><span class="p">,</span> <span class="nx">ConstC</span><span class="p">};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/group_use_declarations">Group Use Declaration RFC</a> and <a class="reference external" href="https://www.php.net/manual/en/language.namespaces.importing.php">Using namespaces: Aliasing/Importing</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/GroupUseDeclaration</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="group-use-trailing-comma">
<span id="id592"></span><h2>9.236. Group Use Trailing Comma<a class="headerlink" href="#group-use-trailing-comma" title="Permalink to this headline">¶</a></h2>
<p>The usage of a final empty slot in <a class="reference external" href="https://www.php.net/array">array()</a> was allowed with use statements. This works in PHP 7.2 and more recent.</p>
<p>Although this empty instruction is ignored at execution, this allows for clean presentation of code, and short diff when committing in a VCS.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Valid in PHP 7.2 and more recent.</span>
<span class="k">use</span> <span class="nx">a\b\</span><span class="p">{</span><span class="nx">c</span><span class="p">,</span>
         <span class="nx">d</span><span class="p">,</span>
         <span class="nx">e</span><span class="p">,</span>
         <span class="nx">f</span><span class="p">,</span>
        <span class="p">};</span>

<span class="c1">// This won&#39;t compile in 7.1 and older.</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/list-syntax-trailing-commas">Trailing Commas In List Syntax</a> and <a class="reference external" href="https://www.mail-archive.com/internals&#64;lists.php.net/msg81138.html">Revisit trailing commas in function arguments</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/GroupUseTrailingComma</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hardcoded-passwords">
<span id="id594"></span><h2>9.237. Hardcoded Passwords<a class="headerlink" href="#hardcoded-passwords" title="Permalink to this headline">¶</a></h2>
<p>Hardcoded passwords in the code.</p>
<p>Hardcoding passwords is a bad idea. Not only it make the code difficult to change, but it is an information leak. It is better to hide this kind of information out of the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$ftp_server</span> <span class="o">=</span> <span class="s1">&#39;300.1.2.3&#39;</span><span class="p">;</span>   <span class="c1">// yes, this doesn&#39;t exists, it&#39;s an example</span>
<span class="nv">$conn_id</span> <span class="o">=</span> <span class="nb">ftp_connect</span><span class="p">(</span><span class="nv">$ftp_server</span><span class="p">);</span>

<span class="c1">// login with username and password</span>
<span class="nv">$login_result</span> <span class="o">=</span> <span class="nb">ftp_login</span><span class="p">(</span><span class="nv">$conn_id</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://snyk.io/blog/ten-git-hub-security-best-practices/">10 GitHub Security Best Practices</a> and <a class="reference external" href="https://davidverhasselt.com/git-how-to-remove-your-password-from-a-repository/">Git How-To: Remove Your Password from a Repository</a>.</p>
<div class="section" id="id595">
<h3>9.237.1. Suggestions<a class="headerlink" href="#id595" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove all passwords from the code. Also, check for history if you are using a VCS.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="14%" />
<col width="4%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>passwordsKeys</td>
<td>password_keys.json</td>
<td>data</td>
<td>List of array index and property names that shall be checked for potential secret key storages.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/HardcodedPasswords</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-hardcoded-credential.md">no-hardcoded-credential</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="hash-algorithms">
<span id="id596"></span><h2>9.238. Hash Algorithms<a class="headerlink" href="#hash-algorithms" title="Permalink to this headline">¶</a></h2>
<p>There is a long but limited list of hashing algorithm available to PHP. The one found doesn’t seem to be existing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This hash has existed in PHP. Check with hash_algos() if it is available on your system.</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;ripmed160&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="c1">// This hash doesn&#39;t exist</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;ripemd160&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/hash_algos">hash_algos</a>.</p>
<div class="section" id="id597">
<h3>9.238.1. Suggestions<a class="headerlink" href="#id597" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a hash algorithm that is available on several PHP versions</li>
<li>Fix the name of the hash algorithm</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="45%" />
<col width="55%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/HashAlgos</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="hash-algorithms-incompatible-with-php-5-3">
<span id="id598"></span><h2>9.239. Hash Algorithms Incompatible With PHP 5.3<a class="headerlink" href="#hash-algorithms-incompatible-with-php-5-3" title="Permalink to this headline">¶</a></h2>
<p>List of hash algorithms incompatible with PHP 5.3.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Compatible only with 5.3 and more recent</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;md2&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="c1">// Always compatible</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;ripemd320&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/hash_algos">hash_algos</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/HashAlgos53</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hash-algorithms-incompatible-with-php-5-4-5-5">
<span id="id600"></span><h2>9.240. Hash Algorithms Incompatible With PHP 5.4/5.5<a class="headerlink" href="#hash-algorithms-incompatible-with-php-5-4-5-5" title="Permalink to this headline">¶</a></h2>
<p>List of hash algorithms incompatible with PHP 5.4 and 5.5.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Compatible only with 5.4 and more recent</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;fnv132&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="c1">// Always compatible</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;ripemd320&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/hash_algos">hash_algos</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/HashAlgos54</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hash-algorithms-incompatible-with-php-7-1">
<span id="id602"></span><h2>9.241. Hash Algorithms Incompatible With PHP 7.1-<a class="headerlink" href="#hash-algorithms-incompatible-with-php-7-1" title="Permalink to this headline">¶</a></h2>
<p>List of hash algorithms incompatible with PHP 7.1 and more recent. At the moment of writing, this is compatible up to 7.3.</p>
<p>The hash algorithms were introduced in PHP 7.1.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Compatible only with 7.1 and more recent</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha512/224&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="c1">// Always compatible</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;ripemd320&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/hash_algos">hash_algos</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/HashAlgos71</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hash-algorithms-incompatible-with-php-7-4">
<span id="id604"></span><h2>9.242. Hash Algorithms Incompatible With PHP 7.4-<a class="headerlink" href="#hash-algorithms-incompatible-with-php-7-4" title="Permalink to this headline">¶</a></h2>
<p>List of hash algorithms incompatible with PHP 7.3 and older recent. At the moment of writing, this is compatible up to 7.4s.</p>
<p>The hash algorithms were introduced in PHP 7.4s.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Compatible only with 7.1 and more recent</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;crc32cs&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="c1">// Always compatible</span>
<span class="k">echo</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;ripemd320&#39;</span><span class="p">,</span> <span class="s1">&#39;The quick brown fox jumped over the lazy dog.&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/hash_algos">hash_algos</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/HashAlgos74</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hash-will-use-objects">
<span id="id606"></span><h2>9.243. Hash Will Use Objects<a class="headerlink" href="#hash-will-use-objects" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="http://www.php.net/manual/en/book.hash.php">ext/hash extension</a> used resources, and is being upgraded to use resources.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Post 7.2 code</span>
    <span class="nv">$hash</span> <span class="o">=</span> <span class="nb">hash_init</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$hash</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">trigger_error</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">hash_update</span><span class="p">(</span><span class="nv">$hash</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>

<span class="c1">// Pre-7.2 code</span>
    <span class="nv">$hash</span> <span class="o">=</span> <span class="nb">hash_init</span><span class="p">(</span><span class="s1">&#39;md5&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_resource</span><span class="p">(</span><span class="nv">$hash</span><span class="p">))</span> <span class="p">{</span>
        <span class="nb">trigger_error</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nb">hash_update</span><span class="p">(</span><span class="nv">$hash</span><span class="p">,</span> <span class="nv">$message</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration72.incompatible.php#migration72.incompatible.hash-ext-to-objects">Move ext/hash from resources to objects</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/HashUsesObjects</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="heredoc-delimiter">
<span id="id607"></span><h2>9.244. Heredoc Delimiter<a class="headerlink" href="#heredoc-delimiter" title="Permalink to this headline">¶</a></h2>
<p>Heredoc and Nowdoc expressions may use a variety of delimiters.</p>
<p>There seems to be a standard delimiter in the code, and some exceptions : one or several forms are dominant (&gt; 90%), while the others are rare.</p>
<p>The analyzed code has less than 10% of the rare delimiters. For consistency reasons, it is recommended to make them all the same.</p>
<p>Generally, one or two delimiters are used, with generic value. It is recommended to use a humanly readable delimiter : SQL, HTML, XML, GREMLIN, etc. This helps readability in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table1;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table2;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table3;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table4;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table5;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table11;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table12;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table13;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="c1">// Nowdoc</span>
<span class="k">echo</span> <span class="s">&lt;&lt;&lt;&#39;</span><span class="dl">SQL</span><span class="s">&#39;</span>
<span class="s">SELECT * FROM table14;</span>
<span class="dl">SQL</span><span class="p">;</span>

<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">SQL</span><span class="s"></span>
<span class="s">SELECT * FROM table15;</span>
<span class="dl">SQL</span><span class="p">;</span>


<span class="k">echo</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">HEREDOC</span><span class="s"></span>
<span class="s">SELECT * FROM table215;</span>
<span class="dl">HEREDOC</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/HeredocDelimiterFavorite</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hexadecimal-in-string">
<span id="id608"></span><h2>9.245. Hexadecimal In String<a class="headerlink" href="#hexadecimal-in-string" title="Permalink to this headline">¶</a></h2>
<p>Mark strings that may be confused with hexadecimal.</p>
<p>Until PHP 7.0, PHP recognizes hexadecimal numbers inside strings, and converts them accordingly.</p>
<p>PHP 7.0 and until 7.1, converts the string to 0, silently.</p>
<p>PHP 7.1 and later, emits a ‘A non-numeric value encountered’ warning, and convert the string to 0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;0x0030&#39;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Print 49</span>

    <span class="nv">$c</span> <span class="o">=</span> <span class="s1">&#39;0x0030zyc&#39;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Print 49</span>

    <span class="nv">$b</span> <span class="o">=</span> <span class="s1">&#39;b0x0030&#39;</span><span class="p">;</span>
    <span class="k">print</span> <span class="nv">$b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Print 0</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/HexadecimalString</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hidden-nullable">
<span id="id609"></span><h2>9.246. Hidden Nullable<a class="headerlink" href="#hidden-nullable" title="Permalink to this headline">¶</a></h2>
<p>Argument with default value of null are nullable. Even when the <code class="docutils literal notranslate"><span class="pre">null</span></code> typehint (PHP 8.0), or the <code class="docutils literal notranslate"><span class="pre">?</span></code> operator are not used, setting the default value to null is allowed, and makes the argument nullable.</p>
<p>This doesn’t happen with properties : they must be defined with the nullable type to accept a <a href="#id610"><span class="problematic" id="id611">``</span></a>null``value as default value.</p>
<p>This doesn’t happen with constant, which can’t be typehinted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// explicit nullable parameter $s</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="o">?</span><span class="nx">string</span> <span class="nv">$s</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>

<span class="c1">// implicit nullable parameter $s</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$s</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$s</span> <span class="o">??</span> <span class="s1">&#39;NULL-value&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// both display NULL-value</span>
<span class="nx">foo</span><span class="p">();</span>
<span class="nx">foo</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/nullable_types">Nullable types</a> and <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">Type declaration</a>.</p>
<div class="section" id="id612">
<h3>9.246.1. Suggestions<a class="headerlink" href="#id612" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the default value to a compatible literal : for example, <code class="docutils literal notranslate"><span class="pre">string</span> <span class="pre">$s</span> <span class="pre">=</span> <span class="pre">''</span></code></li>
<li>Add the explicit <code class="docutils literal notranslate"><span class="pre">?</span></code> nullable operator, or <a href="#id613"><span class="problematic" id="id614">``</span></a>null``with PHP 8.0</li>
<li>Remove the default value</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/HiddenNullable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="hidden-use-expression">
<span id="id615"></span><h2>9.247. Hidden Use Expression<a class="headerlink" href="#hidden-use-expression" title="Permalink to this headline">¶</a></h2>
<p>The use expression for namespaces should always be at the beginning of the namespace block.</p>
<p>It is where everyone expect them, and it is less confusing than having them at various levels.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is visible</span>
<span class="k">use</span> <span class="nx">A</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">B</span> <span class="p">{}</span>

<span class="c1">// This is hidden</span>
<span class="k">use</span> <span class="nx">C</span> <span class="k">as</span> <span class="nx">D</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">E</span> <span class="k">extends</span> <span class="nx">D</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">traitT</span><span class="p">;</span> <span class="c1">// This is a use for a trait</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This is a use for a closure</span>
        <span class="k">return</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id616">
<h3>9.247.1. Suggestions<a class="headerlink" href="#id616" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Group all uses together, at the beginning of the namespace or class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/HiddenUse</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tikiwiki-namespaces-hiddenuse"><span class="std std-ref">Tikiwiki</span></a>, <a class="reference internal" href="Cases.html#openemr-namespaces-hiddenuse"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="htmlentities-calls">
<span id="id617"></span><h2>9.248. Htmlentities Calls<a class="headerlink" href="#htmlentities-calls" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/htmlentities">htmlentities()</a> and <a class="reference external" href="https://www.php.net/htmlspecialchars">htmlspecialchars()</a> are used to prevent injecting special characters in HTML code. As a bare minimum, they take a string and encode it for HTML.</p>
<p>The second argument of the functions is the type of protection. The protection may apply to quotes or not, to HTML 4 or 5, etc. It is highly recommended to set it explicitly.</p>
<p>The third argument of the functions is the encoding of the string. In PHP 5.3, it is <code class="docutils literal notranslate"><span class="pre">ISO-8859-1</span></code>, in 5.4, was <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code>, and in 5.6, it is now default_charset, a <code class="docutils literal notranslate"><span class="pre">php.ini</span></code> configuration that has the default value of <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code>. It is highly recommended to set this argument too, to avoid distortions from the configuration.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$str</span> <span class="o">=</span> <span class="s1">&#39;A quote is &lt;b&gt;bold&lt;/b&gt;&#39;</span><span class="p">;</span>

<span class="c1">// Outputs, without depending on the php.ini: A &amp;#039;quote&amp;#039; is &amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;</span>
<span class="k">echo</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="nx">ENT_QUOTES</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">);</span>

<span class="c1">// Outputs, while depending on the php.ini: A quote is &amp;lt;b&amp;gt;bold&amp;lt;/b&amp;gt;</span>
<span class="k">echo</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Also, note that arguments 2 and 3 are constants and string, respectively, and should be issued from the list of values available in the manual. Other values than those will make PHP use the default values.</p>
<p>See also <a class="reference external" href="https://www.php.net/htmlentities">htmlentities</a> and <a class="reference external" href="https://www.php.net/htmlspecialchars">htmlspecialchars</a>.</p>
<div class="section" id="id620">
<h3>9.248.1. Suggestions<a class="headerlink" href="#id620" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use the third argument with htmlentities()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/Htmlentitiescall</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="identical-conditions">
<span id="id621"></span><h2>9.249. Identical Conditions<a class="headerlink" href="#identical-conditions" title="Permalink to this headline">¶</a></h2>
<p>These logical expressions contain members that are identical.</p>
<p>This means those expressions may be simplified.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// twice $a</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">||</span> <span class="nv">$b</span> <span class="o">||</span> <span class="nv">$c</span> <span class="o">||</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>  <span class="p">}</span>

<span class="c1">// Hiding in parenthesis is bad</span>
<span class="k">if</span> <span class="p">((</span><span class="nv">$a</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{}</span>

<span class="c1">// expressions may be large</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="mi">1</span> <span class="o">===</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id622">
<h3>9.249.1. Suggestions<a class="headerlink" href="#id622" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge the two structures into one unique test</li>
<li>Add extra expressions between the two structures</li>
<li>Nest the structures, to show that different attempts are made</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="92%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/IdenticalConditions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-structures-identicalconditions"><span class="std std-ref">WordPress</span></a>, <a class="reference internal" href="Cases.html#dolibarr-structures-identicalconditions"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#mautic-structures-identicalconditions"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="identical-consecutive-expression">
<span id="id623"></span><h2>9.250. Identical Consecutive Expression<a class="headerlink" href="#identical-consecutive-expression" title="Permalink to this headline">¶</a></h2>
<p>Identical consecutive expressions are worth being checked.</p>
<p>They may be a copy/paste with unmodified content. When the content has to be duplicated, it is recommended to avoid executing the expression again, and just access the cached result.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$current</span>  <span class="o">=</span> <span class="nv">$array</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
<span class="nv">$next</span>     <span class="o">=</span> <span class="nv">$array</span><span class="p">[</span><span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
<span class="nv">$nextnext</span> <span class="o">=</span> <span class="nv">$array</span><span class="p">[</span><span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span> <span class="c1">// OOps, nextnext is wrong.</span>

<span class="c1">// Initialization</span>
<span class="nv">$previous</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">(</span><span class="nv">$array</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// previous is initialized with the first value on purpose</span>
<span class="nv">$next</span>     <span class="o">=</span> <span class="nx">foo</span><span class="p">(</span><span class="nv">$array</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// the second call to foo() with the same arguments should be avoided</span>
<span class="c1">// the above can be rewritten as :</span>
<span class="nv">$next</span>     <span class="o">=</span> <span class="nv">$previous</span><span class="p">;</span> <span class="c1">// save the processing.</span>

<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$next</span> <span class="o">=</span> <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/IdenticalConsecutive</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="identical-on-both-sides">
<span id="id624"></span><h2>9.251. Identical On Both Sides<a class="headerlink" href="#identical-on-both-sides" title="Permalink to this headline">¶</a></h2>
<p>Operands should be different when comparing or making a logical combination. Of course, the value each operand holds may be identical. When the same operand appears on both sides of the expression, the result is know before execution.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Trying to confirm consistency</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$login</span> <span class="o">==</span> <span class="nv">$login</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Works with every operators</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$object</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span> <span class="p">)</span> <span class="o">!==</span> <span class="nv">$object</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$sum</span> <span class="o">&gt;=</span> <span class="nv">$sum</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$mask</span> <span class="o">&amp;&amp;</span> <span class="nv">$mask</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$mask</span> <span class="o">||</span> <span class="nv">$mask</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id625">
<h3>9.251.1. Suggestions<a class="headerlink" href="#id625" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove one of the alternative, and remove the logical link</li>
<li>Modify one of the alternative, and make it different from the other</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/IdenticalOnBothSides</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpmyadmin-structures-identicalonbothsides"><span class="std std-ref">phpMyAdmin</span></a>, <a class="reference internal" href="Cases.html#humo-gen-structures-identicalonbothsides"><span class="std std-ref">HuMo-Gen</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="if-with-same-conditions">
<span id="id626"></span><h2>9.252. If With Same Conditions<a class="headerlink" href="#if-with-same-conditions" title="Permalink to this headline">¶</a></h2>
<p>Successive If / then structures that have the same condition may be either merged or have one of the condition changed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// May be replaced by</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that if the values used in the condition have been modified in the first if/then structure, the two distinct conditions may be needed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// May not be merged</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Check that this is really the situation</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nx">checkSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id627">
<h3>9.252.1. Suggestions<a class="headerlink" href="#id627" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge the two conditions so the condition is used once.</li>
<li>Change one of the condition, so they are different</li>
<li>Make it obvious that the first condition is a try, preparing the normal conditions.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/IfWithSameConditions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpmyadmin-structures-ifwithsameconditions"><span class="std std-ref">phpMyAdmin</span></a>, <a class="reference internal" href="Cases.html#phpdocumentor-structures-ifwithsameconditions"><span class="std std-ref">Phpdocumentor</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="iffectations">
<span id="id628"></span><h2>9.253. Iffectations<a class="headerlink" href="#iffectations" title="Permalink to this headline">¶</a></h2>
<p>Affectations that appears in a condition.</p>
<p>Iffectations are a way to do both a test and an affectations.
They may also be typos, such as if ($x = 3) { <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list">…</a> }, leading to a constant condition.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// an iffectation : assignation in a If condition</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$connexion</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="nv">$host</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="nv">$connexion</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Iffectation may happen in while too.</span>
<span class="k">while</span><span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nx">mysql_fetch</span><span class="p">(</span><span class="nv">$res</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$store</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id630">
<h3>9.253.1. Suggestions<a class="headerlink" href="#id630" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the assignation inside the loop, and make an existence test in the condition.</li>
<li>Move the assignation before the if/then, make an existence test in the condition.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/Iffectation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="illegal-name-for-method">
<span id="id631"></span><h2>9.254. Illegal Name For Method<a class="headerlink" href="#illegal-name-for-method" title="Permalink to this headline">¶</a></h2>
<p>PHP has reserved usage of methods starting with <code class="docutils literal notranslate"><span class="pre">__</span></code> for magic methods. It is recommended to avoid using this prefix, to prevent confusions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span><span class="p">{</span>
    <span class="c1">// Constructor</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// Constructor&#39;s typo</span>
    <span class="k">function</span> <span class="nf">__constructor</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// Illegal function name, even as private</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">__bar</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">Magic Methods</a>.</p>
<div class="section" id="id632">
<h3>9.254.1. Suggestions<a class="headerlink" href="#id632" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid method names starting with a double underscore : <code class="docutils literal notranslate"><span class="pre">__</span></code></li>
<li>Use method visibilities to ensure that methods are only available to the current class or its children</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/WrongName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#prestashop-classes-wrongname"><span class="std std-ref">PrestaShop</span></a>, <a class="reference internal" href="Cases.html#magento-classes-wrongname"><span class="std std-ref">Magento</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="implement-is-for-interface">
<span id="id633"></span><h2>9.255. Implement Is For Interface<a class="headerlink" href="#implement-is-for-interface" title="Permalink to this headline">¶</a></h2>
<p>With class heritage, implements should be used for interfaces, and extends with classes.</p>
<p>PHP defers the implements check until execution : the code in example does lint, but won,t run.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">y</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Use implements with an interface</span>
<span class="k">class</span> <span class="nc">z</span> <span class="k">implements</span> <span class="nx">y</span> <span class="p">{}</span>

<span class="c1">// Implements is for an interface, not a class</span>
<span class="k">class</span> <span class="nc">z</span> <span class="k">implements</span> <span class="nx">x</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id634">
<h3>9.255.1. Suggestions<a class="headerlink" href="#id634" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create an interface from the class, and use it with the implements keyword</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ImplementIsForInterface</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="implemented-methods-are-public">
<span id="id635"></span><h2>9.256. Implemented Methods Are Public<a class="headerlink" href="#implemented-methods-are-public" title="Permalink to this headline">¶</a></h2>
<p>Class methods that are defined in an interface must be public. They cannot be either private, nor protected.</p>
<p>This error is not reported by lint, but is reported at execution time.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="c1">// This method is defined in the interface : it must be public</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// other methods may be private</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.interfaces.php">Interfaces</a> and <a class="reference external" href="https://phpenthusiast.com/object-oriented-php-tutorials/interfaces">Interfaces - the next level of abstraction</a>.</p>
<div class="section" id="id637">
<h3>9.256.1. Suggestions<a class="headerlink" href="#id637" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the implemented method public</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ImplementedMethodsArePublic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="implied-if">
<span id="id638"></span><h2>9.257. Implied If<a class="headerlink" href="#implied-if" title="Permalink to this headline">¶</a></h2>
<p>It is confusing to emulate if/then with boolean operators.</p>
<p>It is possible to emulate a if/then structure by using the operators ‘and’ and ‘or’. Since optimizations will be applied to them :
when the left operand of ‘and’ is false, the right one is not executed, as its result is useless;
when the left operand of ‘or’ is true, the right one is not executed, as its result is useless;</p>
<p>However, such structures are confusing. It is easy to misread them as conditions, and ignore an important logic step.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Either connect, or die</span>
<span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">();</span>

<span class="c1">// Defines a constant if not found.</span>
<span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;SOME_CONSTANT&#39;</span><span class="p">)</span> <span class="k">and</span> <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;SOME_CONSTANT&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// Defines a default value if provided is empty-ish</span>
<span class="c1">// Warning : this is</span>
<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;anonymous&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to use a real ‘if then’ structures, to make the condition readable.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ImpliedIf</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-implied-if.md">no-implied-if</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="implode-one-arg">
<span id="id639"></span><h2>9.258. Implode One Arg<a class="headerlink" href="#implode-one-arg" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/implode">implode()</a> may be called with one arg. It is recommended to avoid it.</p>
<p>Using two arguments makes it less surprising to new comers, and consistent with <a class="reference external" href="https://www.php.net/explode">explode()</a> syntax.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">);</span>

<span class="c1">// empty string is the glue</span>
<span class="k">print</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$array</span><span class="p">);</span>

<span class="c1">// only the array : PHP uses the empty string as glue.</span>
<span class="c1">// Avoid this</span>
<span class="k">print</span> <span class="nb">implode</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/implode">implode</a>.</p>
<div class="section" id="id642">
<h3>9.258.1. Suggestions<a class="headerlink" href="#id642" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add an empty string as first argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ImplodeOneArg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="implode-arguments-order">
<span id="id643"></span><h2>9.259. Implode() Arguments Order<a class="headerlink" href="#implode-arguments-order" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/implode">implode()</a> accepted two signatures, but is only recommending one. Both types orders of string then array, and array then string have been possible until PHP 7.4.</p>
<p>In PHP 7.4, the order array then string is deprecated, and emits a warning. It will be removed in PHP 8.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$glue</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">;</span>
<span class="nv">$pieces</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="c1">// documented argument order</span>
<span class="nv">$s</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="nv">$glue</span><span class="p">,</span> <span class="nv">$pieces</span><span class="p">);</span>

<span class="c1">// Pre 7.4 argument order</span>
<span class="nv">$s</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="nv">$pieces</span><span class="p">,</span> <span class="nv">$glue</span><span class="p">);</span>

<span class="c1">// both produces 0,1,2,3,4</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/implode">implode()</a>.</p>
<div class="section" id="id646">
<h3>9.259.1. Suggestions<a class="headerlink" href="#id646" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use the array as the second argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ImplodeArgsOrder</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="inclusion-wrong-case">
<span id="id647"></span><h2>9.260. Inclusion Wrong Case<a class="headerlink" href="#inclusion-wrong-case" title="Permalink to this headline">¶</a></h2>
<p>Inclusion should follow exactly the case of included files and path. This prevents the infamous case-sensitive filesystem bug, where files are correctly included in a case-insensitive system, and failed to be when moved to production.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// There must exist a path called path/to and a file library.php with this case</span>
<span class="k">include</span> <span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">library</span><span class="o">.</span><span class="nx">php</span><span class="p">;</span>

<span class="c1">// Error on the case, while the file does exist</span>
<span class="k">include</span> <span class="nx">path</span><span class="o">/</span><span class="nx">to</span><span class="o">/</span><span class="nx">LIBRARY</span><span class="o">.</span><span class="nx">php</span><span class="p">;</span>

<span class="c1">// Error on the case, on the PATH</span>
<span class="k">include</span> <span class="nx">path</span><span class="o">/</span><span class="nx">TO</span><span class="o">/</span><span class="nx">library</span><span class="o">.</span><span class="nx">php</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.include-once.php">include_once</a>, about case sensitivity and inclusions.</p>
<div class="section" id="id648">
<h3>9.260.1. Suggestions<a class="headerlink" href="#id648" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the inclusion string identical to the file name.</li>
<li>Change the name of the file to reflect the actual inclusion. This is the best way when a naming convention has been set up for the project, and the file doesn’t adhere to it. Remember to change all other inclusion.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Files/InclusionWrongCase</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="incompatible-signature-methods">
<span id="id649"></span><h2>9.261. Incompatible Signature Methods<a class="headerlink" href="#incompatible-signature-methods" title="Permalink to this headline">¶</a></h2>
<p>Methods should have the same signature when being overwritten.</p>
<p>The same signatures means the children class must have :
+ the same name
+ the same visibility or less restrictive
+ the same typehint or removed
+ the same default value or removed
+ a reference like its <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a></p>
<p>This problem emits a fatal error, for abstract methods, or a warning error, for normal methods. Yet, it is difficult to lint, because classes are often stored in different files. As such, PHP do lint each file independently, as unknown <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> classes are not checked if not present. Yet, when executing the code, PHP lint the actual code and may encounter a fatal error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ab</span> <span class="k">extends</span> <span class="nx">a</span> <span class="p">{</span>
    <span class="c1">// foo is overloaded and now includes a default value for $a</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/manual/en/language.oop5.inheritance.php">Object Inheritance</a>.</p>
<div class="section" id="id652">
<h3>9.261.1. Suggestions<a class="headerlink" href="#id652" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make signatures compatible again</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/IncompatibleSignature</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#suitecrm-classes-incompatiblesignature"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="incompatible-signature-methods-with-covariance">
<span id="id653"></span><h2>9.262. Incompatible Signature Methods With Covariance<a class="headerlink" href="#incompatible-signature-methods-with-covariance" title="Permalink to this headline">¶</a></h2>
<p>Methods should have the compatible signature when being overwritten.</p>
<p>The same signatures means the children class must have :
+ the same name
+ the same visibility or less restrictive
+ the same contravariant typehint or removed
+ the same covariant return typehint or removed
+ the same default value or removed
+ a reference like its <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a></p>
<p>This problem emits a fatal error, for abstract methods, or a warning error, for normal methods. Yet, it is difficult to lint, because classes are often stored in different files. As such, PHP do lint each file independently, as unknown <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> classes are not checked if not present. Yet, when executing the code, PHP lint the actual code and may encounter a fatal error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ab</span> <span class="k">extends</span> <span class="nx">a</span> <span class="p">{</span>
    <span class="c1">// foo is overloaded and now includes a default value for $a</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<dl class="docutils">
<dt>See also <a class="reference external" href="http://www.php.net/manual/en/language.oop5.inheritance.php">Object Inheritance</a>,</dt>
<dd><a class="reference external" href="https://wiki.php.net/rfc/covariant-returns-and-contravariant-parameters">PHP RFC: Covariant Returns and Contravariant Parameters</a> and
<a class="reference internal" href="#incompatible-signature-methods"><span class="std std-ref">Incompatible Signature Methods</span></a>.</dd>
</dl>
<div class="section" id="id657">
<h3>9.262.1. Suggestions<a class="headerlink" href="#id657" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make signatures compatible again</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/IncompatibleSignature74</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#suitecrm-classes-incompatiblesignature74"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="incompilable-files">
<span id="id658"></span><h2>9.263. Incompilable Files<a class="headerlink" href="#incompilable-files" title="Permalink to this headline">¶</a></h2>
<p>Files that cannot be compiled, and, as such, be run by PHP. Scripts are linted against various versions of PHP.</p>
<p>This is usually undesirable, as all code must compile before being executed. It may be that such files are not compilable because they are not yet ready for an upcoming PHP version.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Can&#39;t compile this : Print only accepts one argument</span>
<span class="k">print</span> <span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Code that is not compilable with older PHP versions means that the code is breaking backward compatibility : good or bad is project decision.</p>
<p>When the code is used as a template for PHP code generation, for example at installation time, it is recommended to use a distinct file extension, so as to distinguish them from actual PHP code.</p>
<div class="section" id="id659">
<h3>9.263.1. Suggestions<a class="headerlink" href="#id659" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>If this file is a template for PHP code, change the extension to something else than .php</li>
<li>Fix the syntax so it works with various versions of PHP</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Incompilable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-incompilable.md">no-incompilable</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-php-incompilable"><span class="std std-ref">xataface</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="inconsistent-elseif">
<span id="id660"></span><h2>9.264. Inconsistent Elseif<a class="headerlink" href="#inconsistent-elseif" title="Permalink to this headline">¶</a></h2>
<p>Chaining if/elseif requires a consistent string of conditions. The conditions are executed one after the other, and the conditions shouldn’t overlap.</p>
<p>This analysis reports chains of elseif that don’t share a common variable (or array, or property, etc.. ). As such, testing different conditions are consistent.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $a is always common, so situations are mutually exclusive</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">doSomethingDefault</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// $a is always common, so situations are mutually exclusive</span>
<span class="c1">// although, it may be worth checking the consistency here</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">doSomethingDefault</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// if $a === 1, then $c doesn&#39;t matter?</span>
<span class="c1">// This happens, but then logic doesn&#39;t appear in the code.</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">doSomethingDefault</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/InconsistentElseif</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="indices-are-int-or-string">
<span id="id661"></span><h2>9.265. Indices Are Int Or String<a class="headerlink" href="#indices-are-int-or-string" title="Permalink to this headline">¶</a></h2>
<p>Indices in an array notation such as <code class="docutils literal notranslate"><span class="pre">$array['indice']</span></code> may only be integers or string.</p>
<p>Boolean, Null or float will be converted to their integer or string equivalent.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="k">true</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
          <span class="mf">1.0</span>  <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
          <span class="mf">1.2</span>  <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
          <span class="mi">1</span>    <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
          <span class="s1">&#39;1&#39;</span>  <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
          <span class="mf">0.8</span>  <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span>
          <span class="mh">0x1</span>  <span class="o">=&gt;</span> <span class="mi">7</span><span class="p">,</span>
          <span class="mo">01</span>   <span class="o">=&gt;</span> <span class="mi">8</span><span class="p">,</span>

          <span class="k">null</span>  <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s1">&#39;&#39;</span>    <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>

          <span class="k">false</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
          <span class="mi">0</span>     <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>

          <span class="s1">&#39;0.8&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
          <span class="s1">&#39;01&#39;</span>  <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
          <span class="s1">&#39;2a&#39;</span>  <span class="o">=&gt;</span> <span class="mi">5</span>
          <span class="p">];</span>

    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">The above displays</span>
<span class="cm">Array</span>
<span class="cm">(</span>
<span class="cm">    [1] =&gt; 8</span>
<span class="cm">    [0] =&gt; 2</span>
<span class="cm">    [] =&gt; 2</span>
<span class="cm">    [0.8] =&gt; 3</span>
<span class="cm">    [01] =&gt; 4</span>
<span class="cm">    [2a] =&gt; 5</span>
<span class="cm">)</span>
<span class="cm">*/</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Decimal numbers are rounded to the closest integer; Null is transtyped to ‘’ (empty string); true is 1 and false is 0; Integers in strings are transtyped, while partial numbers or decimals are not analyzed in strings.</p>
<p>As a general rule of thumb, only use integers or strings that don’t look like integers.</p>
<p>This analyzer may find constant definitions, when available.</p>
<p>Note also that PHP detects integer inside strings, and silently turn them into integers. Partial and octal numbers are not transformed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s1">&#39;2&#39;</span>    <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
          <span class="s1">&#39;011&#39;</span>  <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">,</span> <span class="c1">// octal number</span>
          <span class="s1">&#39;11d&#39;</span>  <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">,</span> <span class="c1">// partial number</span>
          <span class="p">];</span>

    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">The above displays</span>
<span class="cm">array(4) {</span>
<span class="cm">  [1]=&gt;</span>
<span class="cm">  int(1)</span>
<span class="cm">  [2]=&gt;</span>
<span class="cm">  int(2)</span>
<span class="cm">  [011]=&gt;</span>
<span class="cm">  int(9)</span>
<span class="cm">  [11d]=&gt;</span>
<span class="cm">  int(11)</span>
<span class="cm">}*/</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.array.php">Arrays syntax</a>.</p>
<div class="section" id="id662">
<h3>9.265.1. Suggestions<a class="headerlink" href="#id662" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do not use any type but string or integer</li>
<li>Force typecast the keys when building an array</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/IndicesAreIntOrString</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-structures-indicesareintorstring"><span class="std std-ref">Zencart</span></a>, <a class="reference internal" href="Cases.html#mautic-structures-indicesareintorstring"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="indirect-injection">
<span id="id663"></span><h2>9.266. Indirect Injection<a class="headerlink" href="#indirect-injection" title="Permalink to this headline">¶</a></h2>
<p>Look for injections through indirect usage for GPRC values (<a class="reference external" href="https://www.php.net/manual/en/reserved.variables.get.php">$_GET</a>, <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.post.php">$_POST</a>, <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.request.php">$_REQUEST</a>, $_COOKIE).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">];</span>
<span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id666">
<h3>9.266.1. Suggestions<a class="headerlink" href="#id666" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always validate incoming values before using them.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/IndirectInjection</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="infinite-recursion">
<span id="id667"></span><h2>9.267. Infinite Recursion<a class="headerlink" href="#infinite-recursion" title="Permalink to this headline">¶</a></h2>
<p>A method is calling itself, with unchanged arguments. This will probably repeat indefinitely.</p>
<p>This applies to recursive functions without any condition. This also applies to function which inject the incoming arguments, without modifications.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">foo2</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">++</span><span class="nv">$a</span><span class="p">;</span>   <span class="c1">// $a is modified</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">foo2</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id668">
<h3>9.267.1. Suggestions<a class="headerlink" href="#id668" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Modify arguments before injecting them again in the same method</li>
<li>Use different values when calling the same method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/InfiniteRecursion</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="instantiating-abstract-class">
<span id="id669"></span><h2>9.268. Instantiating Abstract Class<a class="headerlink" href="#instantiating-abstract-class" title="Permalink to this headline">¶</a></h2>
<p>PHP cannot instantiate an abstract class.</p>
<p>The classes are actually abstract classes, and should be derived into a concrete class to be instantiated.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">abstract</span> <span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Bar</span> <span class="k">extends</span> <span class="nx">Foo</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// instantiating a concrete class.</span>
<span class="k">new</span> <span class="nx">Bar</span><span class="p">();</span>

<span class="c1">// instantiating an abstract class.</span>
<span class="c1">// In real life, this is not possible also because the definition and the instantiation are in the same file</span>
<span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/abstract">Class Abstraction</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/InstantiatingAbstractClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="insufficient-property-typehint">
<span id="id671"></span><h2>9.269. Insufficient Property Typehint<a class="headerlink" href="#insufficient-property-typehint" title="Permalink to this headline">¶</a></h2>
<p>The typehint used for a class property doesn’t cover all it usage.</p>
<p>The typehint is insufficient when a undefined method is called, or if members are access while the typehint is an interface.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">a1</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// PHP 7.4 and more recent</span>
<span class="k">class</span> <span class="nc">B</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">A</span> <span class="nv">$a</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">b2</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// this method is available in A</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="o">-&gt;</span><span class="na">a1</span><span class="p">();</span>
        <span class="c1">// this method is NOT available in A</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="o">-&gt;</span><span class="na">a2</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Supported by all PHP versions</span>
<span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$a</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">A</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">b2</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// this method is available in A</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="o">-&gt;</span><span class="na">a1</span><span class="p">();</span>
        <span class="c1">// this method is NOT available in A</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="o">-&gt;</span><span class="na">a2</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis relies on typehinted properties, as introduced in PHP 7.4. It also relies on typehinted assignations at construct time : the typehint of the assigned argument will be used as the property typehint. Getters and setters are not considered here.</p>
<div class="section" id="id672">
<h3>9.269.1. Suggestions<a class="headerlink" href="#id672" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the typehint to match the actual usage of the object in the class.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/InsufficientPropertyTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="insufficient-typehint">
<span id="id673"></span><h2>9.270. Insufficient Typehint<a class="headerlink" href="#insufficient-typehint" title="Permalink to this headline">¶</a></h2>
<p>An argument is typehinted, but it actually calls methods that are not listed in the interface.</p>
<p>Classes may be implementing more methods than the one that are listed in the interface they also implements. This means that filtering objects with a typehint, but calling other methods will be solved at execution time : if the method is available, it will be used; if it is not, a fatal error is reported.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="k">implements</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">methodI</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">function</span> <span class="nf">notInI</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">methodI</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">i</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">methodI</span><span class="p">();</span> <span class="c1">// this call is valid</span>
    <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">notInI</span><span class="p">();</span>  <span class="c1">// this call is not garanteed</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Inspired by discussion with <a class="reference external" href="https://twitter.com/BrandonSavage">Brandon Savage</a>.</p>
<div class="section" id="id674">
<h3>9.270.1. Suggestions<a class="headerlink" href="#id674" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extend the interface with the missing called methods</li>
<li>Change the body of the function to use only the methods that are available in the interface</li>
<li>Change the used objects so they don’t depend on extra methods</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/InsufficientTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="integer-as-property">
<span id="id675"></span><h2>9.271. Integer As Property<a class="headerlink" href="#integer-as-property" title="Permalink to this headline">¶</a></h2>
<p>It is backward incompatible to use integers are property names. This feature was introduced in PHP 7.2.</p>
<p>If the code must be compatible with previous versions, avoid casting arrays to object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// array to object</span>
<span class="nv">$arr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">];</span>
<span class="nv">$obj</span> <span class="o">=</span> <span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="nv">$arr</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span>
    <span class="nv">$obj</span><span class="p">,</span>
    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">},</span> <span class="c1">// PHP 7.2+ accessible</span>
    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="p">{</span><span class="mi">0</span><span class="p">}</span> <span class="c1">// PHP 7.2+ accessible</span>

    <span class="nv">$obj</span><span class="o">-&gt;</span><span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">},</span> <span class="c1">// always been accessible</span>
<span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/convert_numeric_keys_in_object_array_casts">PHP RFC: Convert numeric keys in object/array casts</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/IntegerAsProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="integer-conversion">
<span id="id676"></span><h2>9.272. Integer Conversion<a class="headerlink" href="#integer-conversion" title="Permalink to this headline">¶</a></h2>
<p>Comparing incoming variables to integer may lead to injection.</p>
<p>When comparing a variable to an integer, PHP applies type juggling, and transform the variable in an integer too. When the value converts smoothly to an integer, this means the validation may pass and yet, the value may carry an injection.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is safer</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// Using (int) for validation and display</span>
<span class="k">if</span> <span class="p">((</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// This is an injection</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// This is unsafe, as $_GET[&#39;x&#39;]  is tester as an integer, but echo&#39;ed raw</span>
<span class="k">if</span> <span class="p">((</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis spots situations where an incoming value is compared to an integer. The usage of the validated value is not considered.</p>
<p>See also <a class="reference external" href="https://www.netsparker.com/blog/web-security/type-juggling-authentication-bypass-cms-made-simple/">Type Juggling Authentication Bypass Vulnerability in CMS Made Simple</a>, <a class="reference external" href="https://hydrasky.com/network-security/php-string-comparison-vulnerabilities/">PHP STRING COMPARISON VULNERABILITIES</a> and <a class="reference external" href="https://www.owasp.org/images/6/6b/PHPMagicTricks-TypeJuggling.pdf">PHP Magic Tricks: Type Juggling</a>.</p>
<div class="section" id="id677">
<h3>9.272.1. Suggestions<a class="headerlink" href="#id677" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/IntegerConversion</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="interfaces-don-t-ensure-properties">
<span id="id678"></span><h2>9.273. Interfaces Don’t Ensure Properties<a class="headerlink" href="#interfaces-don-t-ensure-properties" title="Permalink to this headline">¶</a></h2>
<p>When using an interface as a typehint, properties are not enforced, nor available.</p>
<p>An interface is a template for a class, which specify the minimum amount of methods and constants. Properties are never defined in an interface, and should not be relied upon.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">m</span> <span class="p">()</span> <span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">x</span> <span class="k">implements</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">m</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">i</span> <span class="nv">$i</span><span class="p">,</span> <span class="nx">x</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// this is invalid, as $p is not defined in i, so it may be not available</span>
    <span class="k">echo</span> <span class="nv">$i</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>

    <span class="c1">// this is valid, as $p is defined in $x</span>
    <span class="k">echo</span> <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id679">
<h3>9.273.1. Suggestions<a class="headerlink" href="#id679" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use classes for typehint when properties are accessed</li>
<li>Only use methods and constants which are available in the interface</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/NoGaranteeForPropertyConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="interfaces-is-not-implemented">
<span id="id680"></span><h2>9.274. Interfaces Is Not Implemented<a class="headerlink" href="#interfaces-is-not-implemented" title="Permalink to this headline">¶</a></h2>
<p>Classes that implements interfaces, must implements each of the interface’s methods.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="k">implements</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="c1">// This method implements the foo method from the i interface</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// The method bar is missing, yet is requested by interface i</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">();</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This problem tends to occur in code that splits interfaces and classes by file. This means that PHP’s linting will skip the definitions and not find the problem. At execution time, the definitions will be checked, and a Fatal error will occur.</p>
<p>This situation usually detects code that was forgotten during a refactorisation of the interface or the class and its sibblings.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.interfaces.php">Interfaces</a>.</p>
<div class="section" id="id682">
<h3>9.274.1. Suggestions<a class="headerlink" href="#id682" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Implements all the methods from the interfaces</li>
<li>Remove the class</li>
<li>Make the class abstract</li>
<li>Make the missing methods abstract</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/IsNotImplemented</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="interpolation">
<span id="id683"></span><h2>9.275. Interpolation<a class="headerlink" href="#interpolation" title="Permalink to this headline">¶</a></h2>
<p>The following strings contain variables that are will be replaced. However, the following characters are ambiguous, and may lead to confusion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">b</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$b</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">;</span>
    <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="no">__CLASS__</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">B</span><span class="p">());</span>

<span class="c1">// -&gt; after the $x[1] looks like a 2nd dereferencing, but it is not.</span>
<span class="k">print</span> <span class="nv">$x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">;</span>
<span class="c1">// displays : b-&gt;b</span>

<span class="k">print</span> <span class="p">{</span><span class="nv">$x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">};</span>
<span class="c1">// displays : c</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is advised to add curly brackets around those structures to make them non-ambiguous.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.string.php#language.types.string.syntax.double">Double quoted</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/StringInterpolation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="invalid-constant-name">
<span id="id684"></span><h2>9.276. Invalid Constant Name<a class="headerlink" href="#invalid-constant-name" title="Permalink to this headline">¶</a></h2>
<p>There is a naming convention for PHP constants names.</p>
<p>According to PHP’s manual, constant names, ‘ A valid constant name starts with a letter or underscore, followed by any number of letters, numbers, or underscores.’.</p>
<p>Constant, must follow this regex : <code class="docutils literal notranslate"><span class="pre">/[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/</span></code>.</p>
<p>In particular when defined using <a class="reference external" href="https://www.php.net/define">define()</a> function, no error is produced. When using <code class="docutils literal notranslate"><span class="pre">const</span></code>, on the other hand, the</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;+3&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// wrong constant!</span>

<span class="k">echo</span> <span class="nb">constant</span><span class="p">(</span><span class="s1">&#39;+3&#39;</span><span class="p">);</span> <span class="c1">// invalid constant access</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.constants.php">Constants</a>.</p>
<div class="section" id="id687">
<h3>9.276.1. Suggestions<a class="headerlink" href="#id687" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change constant name</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/InvalidName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openemr-constants-invalidname"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="invalid-octal-in-string">
<span id="id688"></span><h2>9.277. Invalid Octal In String<a class="headerlink" href="#invalid-octal-in-string" title="Permalink to this headline">¶</a></h2>
<p>Any octal sequence inside a string can’t be go 7. Those will be a fatal error at parsing time.</p>
<p>The check is applied to the string, starting with PHP 7.1. In PHP 7.0 and older, those sequences were silently adapted (modulo/% 0).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// A valid octal in a PHP string</span>
<span class="k">echo</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// @</span>

<span class="c1">// Emit a warning in PHP 7.1</span>
<span class="c1">//Octal escape sequence overflow 0 is greater than 7</span>
<span class="k">echo</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// @</span>

<span class="c1">// Silent conversion</span>
<span class="k">echo</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// 8</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.integer.php">Integers</a>.</p>
<div class="section" id="id689">
<h3>9.277.1. Suggestions<a class="headerlink" href="#id689" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a double slash to avoid the sequence to be an octal sequence</li>
<li>Use a function call, such as decoct() to convert larger number to octal notation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/OctalInString</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="invalid-pack-format">
<span id="id690"></span><h2>9.278. Invalid Pack Format<a class="headerlink" href="#invalid-pack-format" title="Permalink to this headline">¶</a></h2>
<p>Some characters are invalid in a <a class="reference external" href="https://www.php.net/pack">pack()</a> format string.</p>
<p><a class="reference external" href="https://www.php.net/pack">pack()</a> and <a class="reference external" href="https://www.php.net/unpack">unpack()</a> accept the following format specifiers : <code class="docutils literal notranslate"><span class="pre">aAhHcCsSnviIlLNVqQJPfgGdeExXZ</span></code>.</p>
<p><a class="reference external" href="https://www.php.net/unpack">unpack()</a> also accepts a name after the format specifier and an optional quantifier.</p>
<p>All other situations is not a valid, and produces a warning : <code class="docutils literal notranslate"><span class="pre">pack():</span> <span class="pre">Type</span> <span class="pre">t:</span> <span class="pre">unknown</span> <span class="pre">format</span> <span class="pre">code</span></code></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$binarydata</span> <span class="o">=</span> <span class="nb">pack</span><span class="p">(</span><span class="nx">nvc</span><span class="o">*</span><span class="p">,</span> <span class="mh">0x1234</span><span class="p">,</span> <span class="mh">0x5678</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">);</span>

    <span class="c1">// the first unsigned short is stored as &#39;first&#39;. The next matches are names with numbers.</span>
    <span class="nv">$res</span> <span class="o">=</span> <span class="nb">unpack</span><span class="p">(</span><span class="s1">&#39;nfirst/vc*&#39;</span><span class="p">,</span> <span class="nv">$binarydata</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Check <a class="reference external" href="https://www.php.net/pack">pack()</a> documentation for format specifiers that were introduced in various PHP version, namely 7.0, 7.1 and 7.2.</p>
<p>See also <a class="reference external" href="https://www.php.net/pack">pack</a> and <a class="reference external" href="https://www.php.net/pack">unpack</a>.</p>
<div class="section" id="id696">
<h3>9.278.1. Suggestions<a class="headerlink" href="#id696" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the packing format with correct values</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/InvalidPackFormat</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="invalid-regex">
<span id="id697"></span><h2>9.279. Invalid Regex<a class="headerlink" href="#invalid-regex" title="Permalink to this headline">¶</a></h2>
<p>The PCRE regex doesn’t compile. It isn’t a valid regex.</p>
<p>Several reasons may lead to this situation : syntax error, Unknown modifier, missing parenthesis or reference.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// valid regex</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/[abc]/&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="c1">// invalid regex (missing terminating ] for character class</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/[abc/&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Regex are check with the Exakat version of PHP.</p>
<p>Dynamic regex are only checked for simple values. Dynamic values may eventually generate a compilation error.</p>
<div class="section" id="id698">
<h3>9.279.1. Suggestions<a class="headerlink" href="#id698" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the regex before running it</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/InvalidRegex</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#sugarcrm-structures-invalidregex"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="is-actually-zero">
<span id="id699"></span><h2>9.280. Is Actually Zero<a class="headerlink" href="#is-actually-zero" title="Permalink to this headline">¶</a></h2>
<p>This addition actually may be simplified because one term is actually negated by another.</p>
<p>This kind of error happens when the expression is very large : the more terms are included, the more chances are that some auto-annihilation happens.</p>
<p>This error may also be a simple typo : for example, calculating the difference between two consecutive terms.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is quite obvious</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// This is obvious too. This may be a typo-ed difference between two consecutive terms.</span>
<span class="c1">// Could have been $c = $fx[3][4] - $fx[3][3] or $c = $fx[3][5] - $fx[3][4];</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nv">$fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$fx</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">];</span>

<span class="c1">// This is less obvious</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="nv">$c</span> <span class="o">+</span> <span class="nv">$d</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="nv">$c</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id700">
<h3>9.280.1. Suggestions<a class="headerlink" href="#id700" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Clean the code and remove the null sum</li>
<li>Fix one of the variable : this expression needs another variable here</li>
<li>When adding differences, calculate the difference in a temporary variable first.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/IsZero</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-structures-iszero"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#suitecrm-structures-iszero"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="is-a-with-string">
<span id="id701"></span><h2>9.281. Is_A() With String<a class="headerlink" href="#is-a-with-string" title="Permalink to this headline">¶</a></h2>
<p>When using <a class="reference external" href="https://www.php.net/is_a">is_a()</a> with a string as first argument, the third argument is compulsory.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// is_a() works with string as first argument, when the third argument is &#39;true&#39;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">is_s</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{}</span>

<span class="c1">// is_a() works with object as first argument</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">is_s</span><span class="p">(</span><span class="k">new</span> <span class="nx">A</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">))</span> <span class="p">{}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/is_a">is_a()</a>.</p>
<div class="section" id="id703">
<h3>9.281.1. Suggestions<a class="headerlink" href="#id703" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the third argument, and set it to true</li>
<li>Use an object as a first argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/IsAWithString</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#rector"><span class="std std-ref">Rector</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="isset-multiple-arguments">
<span id="id704"></span><h2>9.282. Isset Multiple Arguments<a class="headerlink" href="#isset-multiple-arguments" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.www.php.net/isset">isset()</a> may be used with multiple arguments and acts as a AND.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// isset without and</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="c1">// isset with and</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$c</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.www.php.net/isset">Isset &lt;http://www.php.net/`isset</a>&gt;`_.</p>
<div class="section" id="id705">
<h3>9.282.1. Suggestions<a class="headerlink" href="#id705" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge all isset() calls into one</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/IssetMultipleArgs</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thinkphp-php-issetmultipleargs"><span class="std std-ref">ThinkPHP</span></a>, <a class="reference internal" href="Cases.html#livezilla-php-issetmultipleargs"><span class="std std-ref">LiveZilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="isset-on-the-whole-array">
<span id="id706"></span><h2>9.283. Isset() On The Whole Array<a class="headerlink" href="#isset-on-the-whole-array" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.www.php.net/isset">Isset()</a> works quietly on a whole array. There is no need to test all previous index before testing for the target index.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Straight to the point</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// Do something with $a[1][&#39;source&#39;]</span>
<span class="p">}</span>

<span class="c1">// Doing too much work</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// Do something with $a[1][&#39;source&#39;]</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>There is a gain in readability, by avoiding long and hard to read logical expression, and reducing them in one simple <a class="reference external" href="https://www.www.php.net/isset">isset</a> call.</p>
<p>There is a gain in performances by using one call to <a class="reference external" href="https://www.www.php.net/isset">isset</a>, instead of several, but it is a micro-optimization.</p>
<p>See also <a class="reference external" href="https://www.www.php.net/isset">Isset &lt;http://www.php.net/`isset</a>&gt;`_.</p>
<div class="section" id="id711">
<h3>9.283.1. Suggestions<a class="headerlink" href="#id711" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove all unnecessary calls to isset()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/IssetWholeArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-performances-issetwholearray"><span class="std std-ref">Tine20</span></a>, <a class="reference internal" href="Cases.html#expressionengine-performances-issetwholearray"><span class="std std-ref">ExpressionEngine</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="joining-file">
<span id="id712"></span><h2>9.284. Joining file()<a class="headerlink" href="#joining-file" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="https://www.php.net/file">file()</a> to read lines separately.</p>
<p>Applying join(‘’, ) or implode(‘’, ) to the result of <a class="reference external" href="https://www.php.net/file">file()</a> provides the same results than using <a class="reference external" href="https://www.php.net/file_get_contents">file_get_contents()</a>, but at a higher cost of memory and processing.</p>
<p>If the delimiter is not ‘’, then <a class="reference external" href="https://www.php.net/implode">implode()</a> and <a class="reference external" href="https://www.php.net/file">file()</a> are a better solution than <a class="reference external" href="https://www.php.net/file_get_contents">file_get_contents()</a> and <a class="reference external" href="https://www.php.net/str_replace">str_replace()</a> or <a class="reference external" href="https://www.php.net/nl2br">nl2br()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// memory intensive</span>
<span class="nv">$content</span> <span class="o">=</span> <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;path/to/file.txt&#39;</span><span class="p">);</span>

<span class="c1">// memory and CPU intensive</span>
<span class="nv">$content</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="p">(</span><span class="s1">&#39;path/to/file.txt&#39;</span><span class="p">));</span>

<span class="c1">// Consider reading the data line by line and processing it along the way,</span>
<span class="c1">// to save memory</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;path/to/file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="nv">$line</span> <span class="o">=</span> <span class="nx">fget</span><span class="p">(</span><span class="nv">$fp</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// process a line</span>
<span class="p">}</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Always use <a class="reference external" href="https://www.php.net/file_get_contents">file_get_contents()</a> to get the content of a file as a string. Consider using <a class="reference external" href="https://www.php.net/readfile">readfile()</a> to echo the content directly to the output.</p>
<p>See also <a class="reference external" href="https://www.php.net/file_get_contents">file_get_contents</a> and <a class="reference external" href="https://www.php.net/file">file</a>.</p>
<div class="section" id="id721">
<h3>9.284.1. Suggestions<a class="headerlink" href="#id721" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use file_get_contents() instead of implode(file()) to read the whole file at once.</li>
<li>Use readfile() to echo the content to stdout at once.</li>
<li>Use fopen() to read the lines one by one, generator style.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/JoinFile</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-performances-joinfile"><span class="std std-ref">WordPress</span></a>, <a class="reference internal" href="Cases.html#spip-performances-joinfile"><span class="std std-ref">SPIP</span></a>, <a class="reference internal" href="Cases.html#expressionengine-performances-joinfile"><span class="std std-ref">ExpressionEngine</span></a>, <a class="reference internal" href="Cases.html#prestashop-performances-joinfile"><span class="std std-ref">PrestaShop</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="keep-files-access-restricted">
<span id="id722"></span><h2>9.285. Keep Files Access Restricted<a class="headerlink" href="#keep-files-access-restricted" title="Permalink to this headline">¶</a></h2>
<p>Avoid using 0777 as file or directory mode. In particular, setting a file or a directory to 0777 (or universal read-write-execute) may lead to security vulnerabilities, as anything on the server may read, write and even execute</p>
<p>File mode may be changed using the <a class="reference external" href="https://www.php.net/chmod">chmod()</a> function, or at directory creation, with <a class="reference external" href="https://www.php.net/mkdir">mkdir()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nb">file_put_contents</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

<span class="c1">// this file is accessible to the current user, and to his group, for reading and writing.</span>
<span class="nb">chmod</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="mo">0550</span><span class="p">);</span>

<span class="c1">// this file is accessible to everyone</span>
<span class="nb">chmod</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="mo">0777</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>By default, this analysis report universal access (0777). It is possible to make this analysis more restrictive, by providing more forbidden modes in the <code class="docutils literal notranslate"><span class="pre">filePrivileges</span></code> parameter. For example : <code class="docutils literal notranslate"><span class="pre">511,510,489</span></code>. Only use a decimal representation.</p>
<p>See also <a class="reference internal" href="#mkdir-default"><span class="std std-ref">Mkdir Default</span></a> and <a class="reference external" href="https://owasp.org/www-community/vulnerabilities/Least_Privilege_Violation">Least Privilege Violation</a>.</p>
<div class="section" id="id723">
<h3>9.285.1. Suggestions<a class="headerlink" href="#id723" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Set the file mode to a level of restriction as low as possible.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="11%" />
<col width="10%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>filePrivileges</td>
<td>0777</td>
<td>string</td>
<td>List of forbidden file modes (comma separated).</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/KeepFilesRestricted</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="large-try-block">
<span id="id724"></span><h2>9.286. Large Try Block<a class="headerlink" href="#large-try-block" title="Permalink to this headline">¶</a></h2>
<p>Try block should enclosing only the expression that may emit an exception.</p>
<p>When writing large blocks of code in a try, it becomes difficult to understand where the expression is coming from. Large blocks may also lead to catch multiples exceptions, with a long list of catch clause.</p>
<p>In particular, the catch clause will resume the execution without knowing where the try was interrupted : there are no indication of achievement, even partial. In fact, catching an exception signals a very dirty situation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// try is one expression only</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$database</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">DatabaseException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// process exception</span>
<span class="p">}</span>

<span class="c1">// Too many expressions around the one that may actually emit the exception</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$SQL</span> <span class="o">=</span> <span class="nx">build_query</span><span class="p">(</span><span class="nv">$arguments</span><span class="p">);</span>
    <span class="nv">$database</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Database</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">);</span>
    <span class="nv">$database</span><span class="o">-&gt;</span><span class="na">setOption</span><span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
    <span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$database</span><span class="o">-&gt;</span><span class="na">prepareQuery</span><span class="p">(</span><span class="nv">$SQL</span><span class="p">);</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$statement</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">DatabaseException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// process exception</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis reports try blocks that are 5 lines or more. This threshold may be configured with the directive <code class="docutils literal notranslate"><span class="pre">tryBlockMaxSize</span></code>. Catch clause, and finally are not considered here.</p>
<div class="section" id="id725">
<h3>9.286.1. Suggestions<a class="headerlink" href="#id725" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Reduce the amount of code in the block, by moving it before and after</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="11%" />
<col width="11%" />
<col width="58%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>tryBlockMaxSize</td>
<td>5</td>
<td>integer</td>
<td>Maximal number of expressions in the try block.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/LargeTryBlock</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="list-short-syntax">
<span id="id726"></span><h2>9.287. List Short Syntax<a class="headerlink" href="#list-short-syntax" title="Permalink to this headline">¶</a></h2>
<p>Usage of short syntax version of <a class="reference external" href="https://www.php.net/list">list()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7.1 short list syntax</span>
<span class="c1">// PHP 7.1 may also use key =&gt; value structures with list</span>
<span class="p">[</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">];</span>

<span class="c1">// PHP 7.0 list syntax</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ListShortSyntax</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="list-with-appends">
<span id="id728"></span><h2>9.288. List With Appends<a class="headerlink" href="#list-with-appends" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/list">List()</a> behavior has changed in PHP 7.0 and it has impact on the indexing when list is used with the [] operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$x</span><span class="p">[],</span> <span class="nv">$x</span><span class="p">[],</span> <span class="nv">$x</span><span class="p">[])</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>In PHP 7.0, results are ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">2</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">3</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In PHP 5.6, results are ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">2</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id730">
<h3>9.288.1. Suggestions<a class="headerlink" href="#id730" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Refactor code to avoid using append in a list() call</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ListWithAppends</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="list-with-keys">
<span id="id731"></span><h2>9.289. List With Keys<a class="headerlink" href="#list-with-keys" title="Permalink to this headline">¶</a></h2>
<p>Setting keys when using <a class="reference external" href="https://www.php.net/list">list()</a> is a PHP 7.1 feature.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7.1 and later only</span>
<span class="k">list</span><span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="nv">$a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ListWithKeys</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="list-with-reference">
<span id="id733"></span><h2>9.290. List With Reference<a class="headerlink" href="#list-with-reference" title="Permalink to this headline">¶</a></h2>
<p>Support for references in list calls is not backward compatible with older versions of PHP. The support was introduced in PHP 7.3.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>

<span class="p">[</span><span class="nv">$c</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$d</span><span class="p">,</span> <span class="nv">$e</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>

<span class="nv">$d</span><span class="o">++</span><span class="p">;</span>
<span class="nv">$c</span><span class="o">++</span><span class="p">;</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">displays</span>
<span class="cm">Array</span>
<span class="cm">(</span>
<span class="cm">    [0] =&gt; 1  // Not a reference to $c, unchanged</span>
<span class="cm">    [1] =&gt; 3  // Reference from $d</span>
<span class="cm">    [2] =&gt; 3</span>
<span class="cm">)</span>
<span class="cm">*/</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/list_reference_assignment">list() Reference Assignment</a>.</p>
<div class="section" id="id734">
<h3>9.290.1. Suggestions<a class="headerlink" href="#id734" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using references in list for backward compatibility</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ListWithReference</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="locally-unused-property">
<span id="id735"></span><h2>9.291. Locally Unused Property<a class="headerlink" href="#locally-unused-property" title="Permalink to this headline">¶</a></h2>
<p>Those properties are defined in a class, and this class doesn’t have any method that makes use of them.</p>
<p>While this is syntactically correct, it is unusual that defined resources are used in a child class. It may be worth moving the definition to another class, or to move accessing methods to the class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$unused</span><span class="p">,</span> <span class="nv">$used</span><span class="p">;</span><span class="c1">// property $unused is never used in this class</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">used</span><span class="o">++</span><span class="p">;</span> <span class="c1">// property $used is used in this method</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">foofoo</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unused</span><span class="o">++</span><span class="p">;</span> <span class="c1">// property $unused is used in this method, but defined in the parent class</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id736">
<h3>9.291.1. Suggestions<a class="headerlink" href="#id736" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the property definition to the child classes</li>
<li>Move some of the child method, using the property, to the parent class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/LocallyUnusedProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="logical-mistakes">
<span id="id737"></span><h2>9.292. Logical Mistakes<a class="headerlink" href="#logical-mistakes" title="Permalink to this headline">¶</a></h2>
<p>Avoid logical mistakes within long expressions.</p>
<p>Sometimes, the logic is not what it seems. It is important to check the actual impact of every part of the logical expression. Do not hesitate to make a table with all possible cases. If those cases are too numerous, it may be time to rethink the whole expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Always true</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// $a == 1 is useless</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// Always false</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// $a != 2 is useless</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$a</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Based on article from <code class="docutils literal notranslate"><span class="pre">Andrey</span> <span class="pre">Karpov</span></code>  <a class="reference external" href="http://www.viva64.com/en/b/0390/">Logical Expressions in C/C++. Mistakes Made by Professionals</a></p>
<div class="section" id="id738">
<h3>9.292.1. Suggestions<a class="headerlink" href="#id738" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the expressions for them to have a real meaning</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/LogicalMistakes</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-structures-logicalmistakes"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#cleverstyle-structures-logicalmistakes"><span class="std std-ref">Cleverstyle</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="logical-operators-favorite">
<span id="id739"></span><h2>9.293. Logical Operators Favorite<a class="headerlink" href="#logical-operators-favorite" title="Permalink to this headline">¶</a></h2>
<p>PHP has two sets of logical operators : letters (and, or, xor) and chars (&amp;&amp;, ||, ^).</p>
<p>The analyzed code has less than 10% of one of the two sets : for consistency reasons, it is recommended to make them all the same.</p>
<p>Warning : the two sets of operators have different precedence levels. Using and or &amp;&amp; is not exactly the same, especially and not only, when assigning the results to a variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">or</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">OR</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">or</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">OR</span> <span class="nv">$c</span><span class="p">;</span>
<span class="nv">$a1</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">^</span> <span class="nv">$c</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Using and or &amp;&amp; are also the target of other analysis.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.logical.php">Logical Operators</a> and <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operators Precedence</a>.</p>
<div class="section" id="id741">
<h3>9.293.1. Suggestions<a class="headerlink" href="#id741" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Pick a favorite, and enforce it</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/LetterCharsLogicalFavorite</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="logical-should-use-symbolic-operators">
<span id="id742"></span><h2>9.294. Logical Should Use Symbolic Operators<a class="headerlink" href="#logical-should-use-symbolic-operators" title="Permalink to this headline">¶</a></h2>
<p>Logical operators come in two flavors :  and / &amp;&amp;, || / or, ^ / xor. However, they are not exchangeable, as &amp;&amp; and and have different precedence.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Avoid lettered operator, as they have lower priority than expected</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">;</span>
<span class="c1">// $a === 3 because equivalent to ($a = $b) and $c;</span>

<span class="c1">// safe way to write the above :</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$b</span> <span class="k">and</span> <span class="nv">$c</span><span class="p">);</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">&amp;&amp;</span> <span class="nv">$c</span><span class="p">;</span>
<span class="c1">// $a === 1</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to use the symbol operators, rather than the letter ones.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.logical.php">Logical Operators</a>.</p>
<div class="section" id="id744">
<h3>9.294.1. Suggestions<a class="headerlink" href="#id744" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the letter operators to the symbol one : and =&gt; &amp;&amp;, or =&gt; ||, xor =&gt; ^. Review the new expressions as processing order may have changed.</li>
<li>Add parenthesis to make sure that the order is the expected one</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/LogicalInLetters</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-letter-logical.md">no-letter-logical</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#cleverstyle-php-logicalinletters"><span class="std std-ref">Cleverstyle</span></a>, <a class="reference internal" href="Cases.html#openconf-php-logicalinletters"><span class="std std-ref">OpenConf</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="logical-to-in-array">
<span id="id745"></span><h2>9.295. Logical To in_array<a class="headerlink" href="#logical-to-in-array" title="Permalink to this headline">¶</a></h2>
<p>Multiples exclusive comparisons may be replaced by <a class="reference external" href="https://www.php.net/in_array">in_array()</a>.</p>
<p><a class="reference external" href="https://www.php.net/in_array">in_array()</a> makes the alternatives more readable, especially when the number of alternatives is large. In fact, the list of alternative may even be set in a variable, and centralized for easier management.</p>
<p>Even two ‘or’ comparisons are slower than using a <a class="reference external" href="https://www.php.net/in_array">in_array()</a> call. More calls are even slower than just two. This is a micro-optimisation : speed gain is low, and marginal. Code centralisation is a more significant advantage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Set the list of alternative in a variable, property or constant.</span>
<span class="nv">$valid_values</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$valid_values</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="c1">// in_array also works with strict comparisons</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$valid_values</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/in_array">in_array()</a>.</p>
<div class="section" id="id749">
<h3>9.295.1. Suggestions<a class="headerlink" href="#id749" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the list of comparisons with a in_array() call on an array filled with the various values</li>
<li>Replace the list of comparisons with a isset() call on a hash whose keys are the various values</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/LogicalToInArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-performances-logicaltoinarray"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="lone-blocks">
<span id="id750"></span><h2>9.296. Lone Blocks<a class="headerlink" href="#lone-blocks" title="Permalink to this headline">¶</a></h2>
<p>Any grouped code without a commanding structure is useless.</p>
<p>Blocks are compulsory when defining a structure, such as a class or a function. They are most often used with flow control instructions, like if then or switch.</p>
<p>Blocks are also valid syntax that group several instructions together, though they have no effect at all, except confuse the reader. Most often, it is a ruin from a previous flow control instruction, whose condition was removed or commented. They should be removed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// Lone block</span>
    <span class="c1">//foreach($a as $b)</span>
    <span class="p">{</span>
        <span class="nv">$b</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id751">
<h3>9.296.1. Suggestions<a class="headerlink" href="#id751" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the useless curly brackets</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/LoneBlock</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thinkphp-structures-loneblock"><span class="std std-ref">ThinkPHP</span></a>, <a class="reference internal" href="Cases.html#tine20-structures-loneblock"><span class="std std-ref">Tine20</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="long-arguments">
<span id="id752"></span><h2>9.297. Long Arguments<a class="headerlink" href="#long-arguments" title="Permalink to this headline">¶</a></h2>
<p>Long arguments should be put in variable, to preserve readability.</p>
<p>When literal arguments are too long, they <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> the hosting structure by moving the next argument too far on the right. Whenever possible, long arguments should be set in a local variable to keep the readability.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Now the call to foo() is easier to read.</span>
<span class="nv">$reallyBigNumber</span> <span class="o">=</span> <span class="s">&lt;&lt;&lt;</span><span class="dl">BIGNUMBER</span><span class="s"></span>
<span class="s">123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890</span>
<span class="dl">BIGNUMBER</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$reallyBigNumber</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;12345678901234567890123456789012345678901234567890&#39;</span><span class="p">);</span>

<span class="c1">// where are the next arguments ?</span>
<span class="nx">foo</span><span class="p">(</span><span class="s1">&#39;123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;123456789012345678901234567890123456789012345678901234567890&#39;</span><span class="p">);</span>

<span class="c1">// This is still difficult to read</span>
<span class="nx">foo</span><span class="p">(</span><span class="s">&lt;&lt;&lt;</span><span class="dl">BIGNUMBER</span><span class="s"></span>
<span class="s">123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890</span>
<span class="dl">BIGNUMBER</span>
<span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;123456789012345678901234567890123456789012345678901234567890&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Literal strings and heredoc strings, including variables, that are over 50 chars longs are reported here.</p>
<div class="section" id="id754">
<h3>9.297.1. Suggestions<a class="headerlink" href="#id754" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Put the long arguments in a separate variable, and use the variable in the second expression, reducing its total length</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="8%" />
<col width="8%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>codeTooLong</td>
<td>100</td>
<td>integer</td>
<td>Minimum size of a functioncall or a methodcall to be considered too long.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/LongArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#cleverstyle-structures-longarguments"><span class="std std-ref">Cleverstyle</span></a>, <a class="reference internal" href="Cases.html#contao-structures-longarguments"><span class="std std-ref">Contao</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="lost-references">
<span id="id755"></span><h2>9.298. Lost References<a class="headerlink" href="#lost-references" title="Permalink to this headline">¶</a></h2>
<p>Either avoid references, or propagate them correctly.</p>
<p>When assigning a referenced variable with another reference, the initial reference is lost, while the intend was to transfer the content.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$lostReference</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$keptReference</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">;</span>

    <span class="c1">// $lostReference was a reference, but now, it is another</span>
    <span class="nv">$lostReference</span> <span class="o">=&amp;</span> <span class="nv">$c</span><span class="p">;</span>
    <span class="c1">// $keptReference was a reference : now it contains the actual value</span>
    <span class="nv">$keptReference</span> <span class="o">=</span> <span class="nv">$c</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$bar</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$bar2</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$bar</span><span class="p">,</span> <span class="nv">$bar2</span><span class="p">);</span>

<span class="c1">//displays bar c, instead of bar bar</span>
<span class="k">print</span> <span class="nv">$bar</span><span class="o">.</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="nv">$bar2</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Do not reassign a reference with another reference. Assign new content to the reference to change its value.</p>
<div class="section" id="id756">
<h3>9.298.1. Suggestions<a class="headerlink" href="#id756" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always assign new value to an referenced argument, and don’t reassign a new reference</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/LostReferences</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-variables-lostreferences"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="magic-visibility">
<span id="id757"></span><h2>9.299. Magic Visibility<a class="headerlink" href="#magic-visibility" title="Permalink to this headline">¶</a></h2>
<p>The class magic methods must have public visibility and cannot be <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span><span class="p">{</span>
    <span class="c1">// magic method must bt public and non-static</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="fm">__clone</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>    <span class="p">}</span>

    <span class="c1">// magic method can&#39;t be private</span>
    <span class="k">private</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>    <span class="p">}</span>

    <span class="c1">// magic method can&#39;t be protected</span>
    <span class="k">private</span> <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>    <span class="p">}</span>

    <span class="c1">// magic method can&#39;t be static</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="fm">__isset</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">Magic methods</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/toStringPss</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="make-global-a-property">
<span id="id760"></span><h2>9.300. Make Global A Property<a class="headerlink" href="#make-global-a-property" title="Permalink to this headline">¶</a></h2>
<p>Calling global (or $GLOBALS) in methods is slower and less testable than setting the global to a property, and using this property.</p>
<p>Using properties is slightly faster than calling global or $GLOBALS, though the gain is not important.</p>
<p>Setting the property in the constructor (or in a factory), makes the class easier to test, as there is now a single point of configuration.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Wrong way</span>
<span class="k">class</span> <span class="nc">fooBad</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">x</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$a</span><span class="p">;</span>
        <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">do</span><span class="p">();</span>
        <span class="c1">// Or $GLOBALS[&#39;a&#39;]-&gt;do();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">fooGood</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$bar</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">=</span> <span class="nv">$bar</span><span class="p">;</span>
        <span class="c1">// Even better, do this via arguments</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">x</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="o">-&gt;</span><span class="na">do</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id761">
<h3>9.300.1. Suggestions<a class="headerlink" href="#id761" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using global variables, and use properties instead</li>
<li>Remove the usage of these global variables</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MakeGlobalAProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="make-magic-concrete">
<span id="id762"></span><h2>9.301. Make Magic Concrete<a class="headerlink" href="#make-magic-concrete" title="Permalink to this headline">¶</a></h2>
<p>Speed up execution by replacing magic calls by concrete properties.</p>
<p>Magic properties are managed dynamically, with <code class="docutils literal notranslate"><span class="pre">__get``and</span> <span class="pre">``__set</span></code>. They replace property access by a methodcall, and they are much slower than the first.</p>
<p>When a property name is getting used more often, it is worth creating a concrete property, and skip the method call. The threshold for ‘magicMemberUsage’ is 1, by default.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$values</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">);</span>

    <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span><span class="p">[</span><span class="nv">$name</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">x</span><span class="p">();</span>
<span class="c1">// Access to &#39;a&#39; is repeated in the code, at least &#39;magicMemberUsage&#39; time (cf configuration below)</span>
<span class="k">echo</span> <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference internal" href="#memoize-magiccall"><span class="std std-ref">Memoize MagicCall</span></a>.</p>
<div class="section" id="id763">
<h3>9.301.1. Suggestions<a class="headerlink" href="#id763" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make frequently used properties concrete; keep the highly dynamic as magic</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="7%" />
<col width="7%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>magicMemberUsage</td>
<td>1</td>
<td>integer</td>
<td>Minimal number of magic member usage across the code, to trigger a concrete property.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MakeMagicConcrete</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="make-one-call-with-array">
<span id="id764"></span><h2>9.302. Make One Call With Array<a class="headerlink" href="#make-one-call-with-array" title="Permalink to this headline">¶</a></h2>
<p>Avoid calling the same function several times by batching the calls with arrays.</p>
<p>Calling the same function to chain modifications tends to be slower than calling the same function with all the transformations at the same time. Some PHP functions accept scalars or arrays, and using the later is more efficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;abcdef&#39;</span><span class="p">;</span>

<span class="c1">//str_replace() accepts arrays as arguments</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
                       <span class="nv">$string</span><span class="p">);</span>

<span class="c1">// Too many calls to str_replace</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="c1">// Too many nested calls to str_replace</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">)));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Potential replacements :</p>
<table border="1" class="docutils">
<colgroup>
<col width="47%" />
<col width="53%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Function</td>
<td>Replacement</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://www.php.net/str_replace">str_replace()</a>
<a class="reference external" href="https://www.php.net/str_ireplace">str_ireplace()</a>
<a class="reference external" href="https://www.php.net/substr_replace">substr_replace()</a>
<a class="reference external" href="https://www.php.net/preg_replace">preg_replace()</a>
<a class="reference external" href="https://www.php.net/preg_replace_callback">preg_replace_callback()</a></td>
<td><a class="reference external" href="https://www.php.net/str_replace">str_replace()</a>
<a class="reference external" href="https://www.php.net/str_replace">str_replace()</a>
<a class="reference external" href="https://www.php.net/substr_replace">substr_replace()</a>
<a class="reference external" href="https://www.php.net/preg_replace">preg_replace()</a>
<a class="reference external" href="https://www.php.net/preg_replace_callback_array">preg_replace_callback_array()</a></td>
</tr>
</tbody>
</table>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$subject</span> <span class="o">=</span> <span class="s1">&#39;Aaaaaa Bbb&#39;</span><span class="p">;</span>


<span class="c1">//preg_replace_callback_array() is better than multiple preg_replace_callback :</span>
<span class="nx">preg_replace_callback_array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="s1">&#39;~[a]+~i&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$match</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39; matches for a found&#39;</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="s1">&#39;~[b]+~i&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$match</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39; matches for b found&#39;</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">],</span>
    <span class="nv">$subject</span>
<span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nb">preg_replace_callback</span><span class="p">(</span><span class="s1">&#39;~[a]+~i&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$match</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39; matches for a found&#39;</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="p">},</span> <span class="nv">$subject</span><span class="p">);</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nb">preg_replace_callback</span><span class="p">(</span><span class="s1">&#39;~[b]+~i&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$match</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$match</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39; matches for b found&#39;</span><span class="p">,</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="p">},</span> <span class="nv">$subject</span><span class="p">);</span>

<span class="c1">//str_replace() accepts arrays as arguments</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">],</span>
                       <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
                       <span class="nv">$string</span><span class="p">);</span>

<span class="c1">// Too many calls to str_replace</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">);</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">);</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id770">
<h3>9.302.1. Suggestions<a class="headerlink" href="#id770" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>use str_replace() with arrays as arguments.</li>
<li>use preg_replace() with arrays as arguments.</li>
<li>use preg_replace_callback() for merging multiple complex calls.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/MakeOneCall</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#humo-gen-performances-makeonecall"><span class="std std-ref">HuMo-Gen</span></a>, <a class="reference internal" href="Cases.html#edusoho-performances-makeonecall"><span class="std std-ref">Edusoho</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="malformed-octal">
<span id="id771"></span><h2>9.303. Malformed Octal<a class="headerlink" href="#malformed-octal" title="Permalink to this headline">¶</a></h2>
<p>Those numbers starts with a 0, so they are using the PHP octal convention. Therefore, one can’t use 8 or 9 figures in those numbers, as they don’t belong to the octal base. The resulting number will be truncated at the first erroneous figure. For example, 090 is actually 0, and 02689 is actually 22.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// A long way to write 0 in PHP 5</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">0890</span><span class="p">;</span>

<span class="c1">// A fatal error since PHP 7</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Also, note that very large octal, usually with more than 21 figures, will be turned into a real number and undergo a reduction in precision.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.integer.php">Integers</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/MalformedOctal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="max-level-of-nesting">
<span id="id773"></span><h2>9.304. Max Level Of Nesting<a class="headerlink" href="#max-level-of-nesting" title="Permalink to this headline">¶</a></h2>
<p>Avoid nesting structures too deep, as it hurts readability.</p>
<p>Nesting structures are : if/then, switch, for, foreach, while, do…while. Ternary operator, try/catch are not considered a nesting structures.</p>
<p>Closures, and more generally, functions definitions are counted separatedly.</p>
<p>This analysis checks for 4 levels of nesting, by default. This may be changed by configuration.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// 5 levels of indentation</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
                        <span class="mi">51</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="mi">5</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="mi">4</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="mi">3</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 2 levels of indentation</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 3 levels of indentation</span>
            <span class="k">return</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
                            <span class="mi">51</span><span class="p">;</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="mi">5</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="mi">4</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="mi">3</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id774">
<h3>9.304.1. Suggestions<a class="headerlink" href="#id774" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Refactor code to avoid nesting</li>
<li>Export some nested blocks to an external method or function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="9%" />
<col width="9%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>maxLevel</td>
<td>4</td>
<td>integer</td>
<td>Maximum level of nesting for control flow structures in one scope.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MaxLevelOfIdentation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="maybe-missing-new">
<span id="id775"></span><h2>9.305. Maybe Missing New<a class="headerlink" href="#maybe-missing-new" title="Permalink to this headline">¶</a></h2>
<p>This functioncall looks like a class instantiation that is missing the new keyword.</p>
<p>Any function definition was found for that function, but a class with that name was. New is probably missing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Functioncall</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Class definition</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{}</span>
<span class="c1">// Function definition</span>
<span class="k">function</span> <span class="nf">foo</span> <span class="p">{}</span>


<span class="c1">// Functioncall</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">BAR</span><span class="p">;</span>

<span class="c1">// Function definition</span>
<span class="k">class</span> <span class="nc">bar</span> <span class="p">{}</span>
<span class="c1">// Constant definition</span>
<span class="k">const</span> <span class="no">BAR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id776">
<h3>9.305.1. Suggestions<a class="headerlink" href="#id776" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the new</li>
<li>Rename the class to distinguish it from the function</li>
<li>Rename the function to distinguish it from the class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MissingNew</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mbstring-third-arg">
<span id="id777"></span><h2>9.306. Mbstring Third Arg<a class="headerlink" href="#mbstring-third-arg" title="Permalink to this headline">¶</a></h2>
<p>Some mbstring functions use the third argument for offset, not for encoding.</p>
<p>Those are the following functions :</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/mb_strrichr">mb_strrichr()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_stripos">mb_stripos()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_strrpos">mb_strrpos()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_strstr">mb_strstr()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_stristr">mb_stristr()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_strpos">mb_strpos()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_strripos">mb_strripos()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_strrchr">mb_strrchr()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_strrichr">mb_strrichr()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_substr">mb_substr()</a></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Display BC</span>
<span class="k">echo</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="s1">&#39;ABC&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;UTF8&#39;</span><span class="p">);</span>

<span class="c1">// Yields Warning: mb_substr() expects parameter 3 to be int, string given</span>
<span class="c1">// Display 0 (aka, substring from 0, for length (int) &#39;UTF8&#39; =&gt; 0)</span>
<span class="k">echo</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="s1">&#39;ABC&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span><span class="s1">&#39;UTF8&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/mb_substr">mb_substr()</a> manual pages.</p>
<div class="section" id="id781">
<h3>9.306.1. Suggestions<a class="headerlink" href="#id781" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a third argument</li>
<li>Use the default encoding (aka, omit both third AND fourth argument)</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MbstringThirdArg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mbstring-unknown-encoding">
<span id="id782"></span><h2>9.307. Mbstring Unknown Encoding<a class="headerlink" href="#mbstring-unknown-encoding" title="Permalink to this headline">¶</a></h2>
<p>The encoding used is not known to the ext/mbstring extension.</p>
<p>This analysis takes in charge all <code class="docutils literal notranslate"><span class="pre">mbstring</span></code> encoding and aliases. The full list of supported mbstring encoding is available with <a class="reference external" href="https://www.php.net/mb_list_encodings">mb_list_encodings()</a>. Each encoding alias is available with <a class="reference external" href="https://www.php.net/mb_encoding_aliases">mb_encoding_aliases()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Invalid encoding</span>
<span class="nv">$str</span> <span class="o">=</span> <span class="nb">mb_strtolower</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="s1">&#39;utf_8&#39;</span><span class="p">);</span>

<span class="c1">// Valid encoding</span>
<span class="nv">$str</span> <span class="o">=</span> <span class="nb">mb_strtolower</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="nv">$str</span> <span class="o">=</span> <span class="nb">mb_strtolower</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="s1">&#39;UTF8&#39;</span><span class="p">);</span>
<span class="nv">$str</span> <span class="o">=</span> <span class="nb">mb_strtolower</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/manual/en/book.mbstring.php">ext/mbstring</a>.</p>
<div class="section" id="id783">
<h3>9.307.1. Suggestions<a class="headerlink" href="#id783" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a valid mbstring encoding</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MbstringUnknownEncoding</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="memoize-magiccall">
<span id="id784"></span><h2>9.308. Memoize MagicCall<a class="headerlink" href="#memoize-magiccall" title="Permalink to this headline">¶</a></h2>
<p>Cache calls to magic methods in local variable. Local cache is faster than calling again the magic method as soon as the second call, provided that the value hasn’t changed.</p>
<p><code class="docutils literal notranslate"><span class="pre">__get</span></code> is slower, as it turns a simple member access into a full method call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$values</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">values</span><span class="p">[</span><span class="nv">$name</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="c1">// more code to set values to this class</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">x</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">c</span><span class="p">;</span>

    <span class="nv">$d</span> <span class="o">=</span> <span class="nv">$c</span><span class="p">;</span>     <span class="c1">// using local cache, no new access to $b-&gt;__get($name)</span>
    <span class="nv">$e</span> <span class="o">=</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>  <span class="c1">// Second access to $b-&gt;a, through __get</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">x</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">c</span><span class="p">;</span>

    <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">bar2</span><span class="p">();</span> <span class="c1">// this changes $b-&gt;a and $b-&gt;c, but we don&#39;t see it</span>

    <span class="nv">$d</span> <span class="o">=</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">c</span><span class="p">;</span>
    <span class="nv">$e</span> <span class="o">=</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>  <span class="c1">// Second access to $b-&gt;a, through __get</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The caching is not possible if the processing of the object changes the value of the property.</p>
<p>See also <a class="reference external" href="https://stackoverflow.com/questions/3330852/get-set-call-performance-questions-with-php">__get performance questions with PHP</a>, <a class="reference internal" href="#make-magic-concrete"><span class="std std-ref">Make Magic Concrete</span></a> and <a class="reference external" href="https://www.garfieldtech.com/blog/benchmarking-magic">Benchmarking magic</a>.</p>
<div class="section" id="id785">
<h3>9.308.1. Suggestions<a class="headerlink" href="#id785" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Cache the value in a local variable, and reuse that variable</li>
<li>Make the property concrete in the class, so as to avoid __get() altogether</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="8%" />
<col width="8%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>minMagicCallsToGet</td>
<td>2</td>
<td>integer</td>
<td>Minimal number of calls of a magic property to make it worth locally caching.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/MemoizeMagicCall</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="merge-if-then">
<span id="id786"></span><h2>9.309. Merge If Then<a class="headerlink" href="#merge-if-then" title="Permalink to this headline">¶</a></h2>
<p>Two successive if/then into one, by merging the two conditions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// two merge conditions</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="c1">// two distinct conditions</span>
<span class="c1">// two nesting</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// doSomething()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id787">
<h3>9.309.1. Suggestions<a class="headerlink" href="#id787" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge the two structures into one</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MergeIfThen</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="method-collision-traits">
<span id="id788"></span><h2>9.310. Method Collision Traits<a class="headerlink" href="#method-collision-traits" title="Permalink to this headline">¶</a></h2>
<p>Two or more traits are included in the same class, and they have methods collisions.</p>
<p>Those collisions should be solved with a <code class="docutils literal notranslate"><span class="pre">use</span></code> expression. When they are not, PHP stops execution with a fatal error : <code class="docutils literal notranslate"><span class="pre">Trait</span> <span class="pre">method</span> <span class="pre">M</span> <span class="pre">has</span> <span class="pre">not</span> <span class="pre">been</span> <span class="pre">applied,</span> <span class="pre">because</span> <span class="pre">there</span> <span class="pre">are</span> <span class="pre">collisions</span> <span class="pre">with</span> <span class="pre">other</span> <span class="pre">trait</span> <span class="pre">methods</span> <span class="pre">on</span> <span class="pre">C</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">trait</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">A</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">M</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">trait</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">B</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">M</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
    <span class="k">use</span>  <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">D</span> <span class="p">{</span>
    <span class="k">use</span>  <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">{</span>
        <span class="nx">B</span><span class="o">::</span><span class="na">M</span> <span class="nx">insteadof</span> <span class="nx">A</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The code above lints, but doesn’t execute.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.traits.php">Traits</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/MethodCollisionTraits</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="method-could-be-private-method">
<span id="id790"></span><h2>9.311. Method Could Be Private Method<a class="headerlink" href="#method-could-be-private-method" title="Permalink to this headline">¶</a></h2>
<p>The following methods are never used outside their class of definition. Given the analyzed code, they could be set as private.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">couldBePrivate</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">cantdBePrivate</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// couldBePrivate is used internally.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">couldBePrivate</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">foo2</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar2</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// cantdBePrivate is used in a child class.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cantdBePrivate</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//couldBePrivate() is not used outside</span>
<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">foo</span><span class="p">();</span>

<span class="c1">//cantdBePrivate is used outside the class</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">cantdBePrivate</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that dynamic properties (such as $x-&gt;$y) are not taken into account.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBePrivateMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="method-could-be-static">
<span id="id791"></span><h2>9.312. Method Could Be Static<a class="headerlink" href="#method-could-be-static" title="Permalink to this headline">¶</a></h2>
<p>A method that doesn’t make any usage of <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> could be turned into a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method.</p>
<p>While <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods are usually harder to handle, recognizing the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> status is a first step before turning the method into a standalone function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">static</span> <span class="nv">$property</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// legit static method</span>
    <span class="k">static</span> <span class="k">function</span> <span class="nf">staticMethod</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$property</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This is not using $this, and could be static</span>
    <span class="k">function</span> <span class="nf">nonStaticMethod</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$property</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This is not using $this nor self, could be a standalone function</span>
    <span class="k">function</span> <span class="nf">nonStaticMethod</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$property</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id796">
<h3>9.312.1. Suggestions<a class="headerlink" href="#id796" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the method static</li>
<li>Make the method a standalone function</li>
<li>Make use of $this in the method : may be it was forgotten.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBeStatic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#fuelcms-classes-couldbestatic"><span class="std std-ref">FuelCMS</span></a>, <a class="reference internal" href="Cases.html#expressionengine-classes-couldbestatic"><span class="std std-ref">ExpressionEngine</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="method-signature-must-be-compatible">
<span id="id797"></span><h2>9.313. Method Signature Must Be Compatible<a class="headerlink" href="#method-signature-must-be-compatible" title="Permalink to this headline">¶</a></h2>
<p>Make sure methods signature are compatible.</p>
<p>PHP generates the infamous Fatal error at execution : <code class="docutils literal notranslate"><span class="pre">Declaration</span> <span class="pre">of</span> <span class="pre">FooParent\:\:Bar()</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">compatible</span> <span class="pre">with</span> <span class="pre">FooChildren\:\:Bar()</span></code></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">xa</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">xxx</span> <span class="k">extends</span> <span class="nx">xx</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">xa</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id798">
<h3>9.313.1. Suggestions<a class="headerlink" href="#id798" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the child class method() signature.</li>
<li>Fix the parent class method() signature, after checking that it won’t affect the other children.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MethodSignatureMustBeCompatible</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="methodcall-on-new">
<span id="id799"></span><h2>9.314. Methodcall On New<a class="headerlink" href="#methodcall-on-new" title="Permalink to this headline">¶</a></h2>
<p>It is possible to call a method right at object instantiation.</p>
<p>This syntax was added in PHP 5.4+. Before, this was not possible : the object had to be stored in a variable first.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Data is collected</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nx">data_source</span><span class="p">();</span>

<span class="c1">// Data is saved, but won&#39;t be reused from this databaseRow object. It may be ignored.</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">databaseRow</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

<span class="c1">// The actual result of the save() is collected and tested.</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">!==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">processSaveError</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This syntax is interesting when the object is not reused, and may be discarded</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/MethodCallOnNew</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.4 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="methods-without-return">
<span id="id800"></span><h2>9.315. Methods Without Return<a class="headerlink" href="#methods-without-return" title="Permalink to this headline">¶</a></h2>
<p>List of all the function, closures, methods that have no explicit return.</p>
<p>Functions that hold the <code class="docutils literal notranslate"><span class="pre">void</span></code> return type are omitted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// With return null : Explicitly not returning</span>
<span class="k">function</span> <span class="nf">withExplicitReturn</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Without indication</span>
<span class="k">function</span> <span class="nf">withoutExplicitReturn</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// With return type void : Explicitly not returning</span>
<span class="k">function</span> <span class="nf">withExplicitReturnType</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.return.php">return</a>.</p>
<div class="section" id="id801">
<h3>9.315.1. Suggestions<a class="headerlink" href="#id801" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the returntype ‘void’ to make this explicit behavior</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/WithoutReturn</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="minus-one-on-error">
<span id="id802"></span><h2>9.316. Minus One On Error<a class="headerlink" href="#minus-one-on-error" title="Permalink to this headline">¶</a></h2>
<p>Some PHP native functions return -1 on error. They also return 1 in case of success, and 0 in case of failure. This leads to confusions.</p>
<p>In case the native function is used as a condition without explicit comparison, PHP type cast the return value to a boolean. In this case, -1 and 1 are both converted to true, and the condition applies. This means that an error situation is mistaken for a successful event.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Proper check of the return value</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">openssl_verify</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$signature</span><span class="p">,</span> <span class="nv">$public</span><span class="p">)</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loginAsUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// if this call fails, it returns -1, and is confused with true</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">openssl_verify</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$signature</span><span class="p">,</span> <span class="nv">$public</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loginAsUser</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis searches for if/then structures, ternary operators inside <a class="reference external" href="https://www.php.net/manual/en/control-structures.while.php">while()</a> / do…`while() &lt;<a class="reference external" href="https://www.php.net/manual/en/control-structures.while.php">https://www.php.net/manual/en/control-structures.while.php</a>&gt;`_ loops.</p>
<p>See also <a class="reference external" href="https://twitter.com/ripstech/status/1124325237967994880">Can you spot the vulnerability? (openssl_verify)</a> and <a class="reference external" href="https://snyk.io/vuln/SNYK-PHP-SIMPLESAMLPHPSIMPLESAMLPHPMODULEINFOCARD-70167">Incorrect Signature Verification</a>.</p>
<div class="section" id="id804">
<h3>9.316.1. Suggestions<a class="headerlink" href="#id804" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Compare explicitly the return value to 1</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/MinusOneOnError</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mismatch-parameter-and-type">
<span id="id805"></span><h2>9.317. Mismatch Parameter And Type<a class="headerlink" href="#mismatch-parameter-and-type" title="Permalink to this headline">¶</a></h2>
<p>When the name of the parameter contradicts the type of the parameter.</p>
<p>This is mostly semantics, so it will affect the coder and the auditor of the code. PHP is immune to those errors.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// There is a discrepancy between the typehint and the name of the variable</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$string</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// The parameter name is practising coding convention typehints</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$int</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id806">
<h3>9.317.1. Suggestions<a class="headerlink" href="#id806" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Synch the name of the parameter and the typehint.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/MismatchParameterAndType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mismatch-parameter-name">
<span id="id807"></span><h2>9.318. Mismatch Parameter Name<a class="headerlink" href="#mismatch-parameter-name" title="Permalink to this headline">¶</a></h2>
<p>Parameter name change in overwritten method. This may lead to errors when using PHP 8.0 named arguments.</p>
<p>PHP use the name of the parameter in the method whose code is executed. When the name change between the method and the overwritten method, the consistency is broken.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">getValue</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">y</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="c1">// consistent with the method above</span>
    <span class="k">function</span> <span class="nf">getValue</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">z</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="c1">// inconsistent with the method above</span>
    <span class="k">function</span> <span class="nf">getValue</span><span class="p">(</span><span class="nv">$label</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Here is another example, in early PHP 8.0 (courtesy of <a class="reference external" href="https://twitter.com/giveupalready">Carnage</a>).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">Pager</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">fetch</span><span class="p">(</span><span class="nv">$page</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="nv">$categories</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">DbPager</span> <span class="k">implements</span> <span class="nx">Pager</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">fetch</span><span class="p">(</span><span class="nv">$seite</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">...</span><span class="nv">$kategorien</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$kategorien</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$dbPager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DbPager</span><span class="p">();</span>
<span class="nv">$dbPager</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">page</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">categories</span><span class="o">:</span> <span class="mi">2</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id808">
<h3>9.318.1. Suggestions<a class="headerlink" href="#id808" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make sure all the names are the same, between methods</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/MismatchParameterName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mismatch-properties-typehints">
<span id="id809"></span><h2>9.319. Mismatch Properties Typehints<a class="headerlink" href="#mismatch-properties-typehints" title="Permalink to this headline">¶</a></h2>
<p>Properties must match within the same family.</p>
<p>When a property is declared both in a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class, and a child class, they must have the same type. The same type includes a possible null value.</p>
<p>This doesn’t apply to private properties, which are only visible locally.</p>
<p>&lt;?php</p>
<p>// property $p is declared as an object of type a
class x {</p>
<blockquote>
<div>protected A $p;</div></blockquote>
<p>}</p>
<p>// property $p is declared again, this time without a type
class a extends x {</p>
<blockquote>
<div>protected $p;</div></blockquote>
<p>}</p>
<p>This code will lint, but not execute.</p>
<div class="section" id="id811">
<h3>9.319.1. Suggestions<a class="headerlink" href="#id811" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove some of the property declarations, and only keep it in the highest ranking parent</li>
<li>Match the typehints of the property declarations</li>
<li>Make the properties private</li>
<li>Remove the child class (or the parent class)</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MismatchProperties</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mismatch-type-and-default">
<span id="id812"></span><h2>9.320. Mismatch Type And Default<a class="headerlink" href="#mismatch-type-and-default" title="Permalink to this headline">¶</a></h2>
<p>The argument typehint and its default value don’t match.</p>
<p>The code may lint and load, and even work when the arguments are provided. Though, PHP won’t eventually execute it.</p>
<p>Most of the mismatch problems are caught by PHP at linting time. It displays the following error message : ‘Argument 1 passed to foo() must be of the type integer, string given’.</p>
<p>The default value may be a constant (normal or class constant) : as such, PHP might find its value only at execution time, from another include. As such, PHP doesn’t report anything about the situation at compile time.</p>
<p>The default value may also be a constant scalar expression : since PHP 7, some of the simple operators such as +, -, <em>, %, `*</em> &lt;<a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">https://www.php.net/manual/en/language.operators.arithmetic.php</a>&gt;`_, etc. are available to build default values. Among them, the ternary operator and Coalesce. Again, those expression may be only evaluated at execution time, when the value of the constants are known.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// bad definition : the string is actually an integer</span>
<span class="k">const</span> <span class="no">STRING</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$s</span> <span class="o">=</span> <span class="nx">STRING</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$s</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// works without problem</span>
<span class="nx">foo</span><span class="p">(</span><span class="s1">&#39;string&#39;</span><span class="p">);</span>

<span class="c1">// Fatal error at compile time</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// Fail only at execution time (missing D), and when default is needed</span>
<span class="k">function</span> <span class="nf">foo2</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$s</span> <span class="o">=</span> <span class="nx">D</span> <span class="o">?</span> <span class="k">null</span> <span class="o">:</span> <span class="k">array</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$s</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>PHP reports typehint and default mismatch at compilation time, unless there is a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> expression that can’t be resolved within the compiled file : then it is checked only at runtime, leading to a Fatal error.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">Type declarations</a>.</p>
<div class="section" id="id815">
<h3>9.320.1. Suggestions<a class="headerlink" href="#id815" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Match the typehint with the default value</li>
<li>Do not rely on PHP type juggling to change the type on the fly</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/MismatchTypeAndDefault</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mismatched-default-arguments">
<span id="id816"></span><h2>9.321. Mismatched Default Arguments<a class="headerlink" href="#mismatched-default-arguments" title="Permalink to this headline">¶</a></h2>
<p>Arguments are relayed from one method to the other, and the arguments have different default values.</p>
<p>Although it is possible to have different default values, it is worth checking why this is actually the case.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="k">null</span><span class="p">,</span> <span class="nv">$b</span> <span class="o">=</span> <span class="k">array</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
    <span class="c1">// foo method calls directly bar.</span>
    <span class="c1">// When argument are provided, it&#39;s OK</span>
    <span class="c1">// When argument are omited, the default value is not the same as the next method</span>
    <span class="nx">bar</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$d</span> <span class="o">=</span> <span class="k">array</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id817">
<h3>9.321.1. Suggestions<a class="headerlink" href="#id817" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Synchronize default values to avoid surprises</li>
<li>Drop some of the default values</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/MismatchedDefaultArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#spip-functions-mismatcheddefaultarguments"><span class="std std-ref">SPIP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mismatched-ternary-alternatives">
<span id="id818"></span><h2>9.322. Mismatched Ternary Alternatives<a class="headerlink" href="#mismatched-ternary-alternatives" title="Permalink to this headline">¶</a></h2>
<p>A ternary operator should yield the same type on both branches.</p>
<p>Ternary operator applies a condition, and yield two different results. Those results will then be processed by code that expects the same types. It is recommended to match the types on both branches of the ternary operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $object may end up in a very unstable state</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">==</span> <span class="s1">&#39;Type&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="k">new</span> <span class="nv">$type</span><span class="p">()</span> <span class="o">:</span> <span class="k">null</span><span class="p">;</span>

<span class="c1">//same result are provided by both alternative, though process is very different</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$type</span> <span class="o">==</span> <span class="s1">&#39;Addition&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span> <span class="o">:</span> <span class="nv">$a</span> <span class="o">*</span> <span class="nv">$b</span><span class="p">;</span>

<span class="c1">//Currently, this is omitted</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$condition</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$a</span> <span class="o">:</span> <span class="s1">&#39;default value&#39;</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="k">empty</span><span class="p">(</span><span class="nv">$condition</span><span class="p">)</span> <span class="o">?</span> <span class="nv">$a</span> <span class="o">:</span> <span class="nx">getDefaultValue</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id819">
<h3>9.322.1. Suggestions<a class="headerlink" href="#id819" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use compatible data type in both branch of the alternative</li>
<li>Turn the ternary into a if/then, with different processing</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MismatchedTernary</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpadsnew-structures-mismatchedternary"><span class="std std-ref">phpadsnew</span></a>, <a class="reference internal" href="Cases.html#openemr-structures-mismatchedternary"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mismatched-typehint">
<span id="id820"></span><h2>9.323. Mismatched Typehint<a class="headerlink" href="#mismatched-typehint" title="Permalink to this headline">¶</a></h2>
<p>Relayed arguments don’t have the same typehint.</p>
<p>Typehint acts as a filter method. When an object is checked with a first class, and then checked again with a second distinct class, the whole process is always false : $a can’t be of two different classes at the same time.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Foo() calls bar()</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">A</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">B</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">bar</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// $a is of A typehint in both methods, but</span>
<span class="c1">// $b is of B then BB typehing</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">A</span> <span class="nv">$a</span><span class="p">,</span> <span class="nx">BB</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note : This analysis currently doesn’t check generalisation of classes : for example, when B is a child of BB, it is still reported as a mismatch.</p>
<div class="section" id="id821">
<h3>9.323.1. Suggestions<a class="headerlink" href="#id821" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Ensure that the default value match the expected typehint.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/MismatchedTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-functions-mismatchedtypehint"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="missing-abstract-method">
<span id="id822"></span><h2>9.324. Missing Abstract Method<a class="headerlink" href="#missing-abstract-method" title="Permalink to this headline">¶</a></h2>
<p>Abstract methods must have a non-abstract version for the class to be complete. A class that is missing one abstract definition cannot be instantiated.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is a valid definition</span>
<span class="k">class</span> <span class="nc">b</span> <span class="k">extends</span> <span class="nx">a</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// This compiles, but will emit a fatal error if instantiated</span>
<span class="k">class</span> <span class="nc">c</span> <span class="k">extends</span> <span class="nx">a</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// This illustration lint but doesn&#39;t run.</span>
<span class="c1">// moving this class at the beginning of the code will make lint fail</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">abstract</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.abstract.php">Classes Abstraction</a>.</p>
<div class="section" id="id823">
<h3>9.324.1. Suggestions<a class="headerlink" href="#id823" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Implement the missing methods</li>
<li>Remove the partially implemented class</li>
<li>Mark the partially implemented class abstract</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MissingAbstractMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="missing-cases-in-switch">
<span id="id824"></span><h2>9.325. Missing Cases In Switch<a class="headerlink" href="#missing-cases-in-switch" title="Permalink to this headline">¶</a></h2>
<p>It seems that some cases are missing in this switch structure.</p>
<p>When comparing two different <a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a> structures, it appears that some cases are missing in one of them. The set of cases are almost identical, but one of the values are missing.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">Switch()</a> structures using strings as literals are compared in this analysis. When the discrepancy between two lists is below 25%, both switches are reported.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This switch operates on a, b, c, d and default</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;a&#39;</span><span class="o">:</span> <span class="nx">doSomethingA</span><span class="p">();</span> <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;b&#39;</span><span class="o">:</span> <span class="nx">doSomethingB</span><span class="p">();</span> <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;c&#39;</span><span class="o">:</span> <span class="nx">doSomethingC</span><span class="p">();</span> <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;d&#39;</span><span class="o">:</span> <span class="nx">doSomethingD</span><span class="p">();</span> <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span> <span class="nx">doNothing</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// This switch operates on a, b, d and default</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$o</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;a&#39;</span><span class="o">:</span> <span class="nx">doSomethingA</span><span class="p">();</span> <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">case</span> <span class="s1">&#39;b&#39;</span><span class="o">:</span> <span class="nx">doSomethingB</span><span class="p">();</span> <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">case</span> <span class="s1">&#39;d&#39;</span><span class="o">:</span> <span class="nx">doSomethingD</span><span class="p">();</span> <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span> <span class="nx">doNothing</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>In the example, one may argue that the ‘c’ case is actually handled by the ‘default’ case. Otherwise, business logic may request that omission.</p>
<div class="section" id="id827">
<h3>9.325.1. Suggestions<a class="headerlink" href="#id827" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the missing cases</li>
<li>Add comments to mention that missing cases are processed in the default case</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MissingCases</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tikiwiki-structures-missingcases"><span class="std std-ref">Tikiwiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="missing-include">
<span id="id828"></span><h2>9.326. Missing Include<a class="headerlink" href="#missing-include" title="Permalink to this headline">¶</a></h2>
<p>The included files doesn’t exists in the repository. The inclusions target a files that doesn’t exist.</p>
<p>The analysis works with every type of inclusion : include(), require(), include_once() and require_once(). It also works with parenthesis when used as parameter delimiter.</p>
<p>The analysis doesn’t take into account <code class="docutils literal notranslate"><span class="pre">include_path</span></code>. This may yield false positives.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">include</span> <span class="s1">&#39;non_existent.php&#39;</span><span class="p">;</span>

<span class="c1">// variables are not resolved. This won&#39;t be reported.</span>
<span class="k">require</span> <span class="p">(</span><span class="nv">$path</span><span class="o">.</span><span class="s1">&#39;non_existent.php&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Missing included files may lead to a fatal error, a warning or other error later in the execution.</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="2%" />
<col width="2%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>constant_or_variable_name</td>
<td>100</td>
<td>string</td>
<td>Literal value to be used when including files. For example, by configuring ‘Files_MissingInclude[“HOME_DIR”] = “/tmp/myDir/”;’, then ‘include HOME_DIR . “my_class.php”; will be actually be used as ‘/tmp/myDir/my_class.php’. Constants must be configured with their correct case. Variable must be configured with their initial ‘$’. Configure any number of variable and constant names.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Files/MissingInclude</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="missing-parenthesis">
<span id="id829"></span><h2>9.327. Missing Parenthesis<a class="headerlink" href="#missing-parenthesis" title="Permalink to this headline">¶</a></h2>
<p>Add parenthesis to those expression to prevent bugs.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Missing some parenthesis!!</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$a</span> <span class="nx">instanceof</span> <span class="k">Stdclass</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="k">Not</span><span class="nx">\n</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nx">Is\n</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Could this addition be actually</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="o">-</span><span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>

<span class="c1">// This one ?</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operators Precedence</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MissingParenthesis</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="missing-some-returntype">
<span id="id831"></span><h2>9.328. Missing Some Returntype<a class="headerlink" href="#missing-some-returntype" title="Permalink to this headline">¶</a></h2>
<p>The specified typehints are not compatible with the returned values.</p>
<p>The code of the method may return other types, which are not specified and will lead to a PHP fatal error. It is the case for insufficient typehints, when a typehint is missing, or inconsistent typehints, when the method returns varied types.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// correct return typehint</span>
<span class="k">function</span> <span class="nf">fooSN</span><span class="p">()</span> <span class="o">:</span> <span class="o">?</span><span class="nx">string</span>  <span class="p">{</span>
    <span class="k">return</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="s1">&#39;ls -hla&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// insufficient return typehint</span>
<span class="c1">// shell_exec() may return null or string. Here, only string in specified for fooS, and that may lead to a Fatal error</span>
<span class="k">function</span> <span class="nf">fooS</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span>  <span class="p">{</span>
    <span class="k">return</span> <span class="nb">shell_exec</span><span class="p">(</span><span class="s1">&#39;ls -hla&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// inconsistent return typehint</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The analysis reports a method when it finds other return types than the one expected. In the case of multiple typehints, as for the last example, the PHP code may require an upgrade to PHP 8.0.</p>
<div class="section" id="id832">
<h3>9.328.1. Suggestions<a class="headerlink" href="#id832" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Update the typehint to accept more types</li>
<li>Update the code of the method to fit the expected returntype</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Typehints/MissingReturntype</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="missing-typehint">
<span id="id833"></span><h2>9.329. Missing Typehint<a class="headerlink" href="#missing-typehint" title="Permalink to this headline">¶</a></h2>
<p>No typehint was found for this parameter, or as a return type for the function.</p>
<p>void is considered a specified typehint, and is not reported here.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$no_typehint</span><span class="p">)</span> <span class="o">:</span> <span class="nx">void</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nf">no_return_type</span><span class="p">()</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">Type Declaration</a>.</p>
<div class="section" id="id835">
<h3>9.329.1. Suggestions<a class="headerlink" href="#id835" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/MissingTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mistaken-concatenation">
<span id="id836"></span><h2>9.330. Mistaken Concatenation<a class="headerlink" href="#mistaken-concatenation" title="Permalink to this headline">¶</a></h2>
<p>A unexpected structure is built for initialization. It may be a typo that creates an unwanted expression.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This &#39;cd&#39; is unexpected. Isn&#39;t it &#39;c&#39;, &#39;d&#39; ?</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="o">.</span> <span class="s1">&#39;d&#39;</span><span class="p">);</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">);</span>

<span class="c1">// This 4.5 is unexpected. Isn&#39;t it 4, 5 ?</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">);</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/MistakenConcatenation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mixed-concat-and-interpolation">
<span id="id837"></span><h2>9.331. Mixed Concat And Interpolation<a class="headerlink" href="#mixed-concat-and-interpolation" title="Permalink to this headline">¶</a></h2>
<p>Mixed usage of concatenation and string interpolation is error prone. It is harder to read, and leads to overlooking the concatenation or the interpolation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Concatenation string</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">.</span> <span class="s1">&#39;c&#39;</span> <span class="o">.</span> <span class="nv">$d</span><span class="p">;</span>

<span class="c1">// Interpolation strings</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">{</span><span class="nv">$b</span><span class="p">}</span><span class="nx">c</span><span class="p">{</span><span class="nv">$d</span><span class="p">};</span>   <span class="c1">// regular form</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">{</span><span class="nv">$b</span><span class="p">}</span><span class="nx">c</span><span class="nv">$d</span><span class="p">;</span>     <span class="c1">// irregular form</span>

<span class="c1">// Mixed Concatenation and Interpolation string</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">{</span><span class="nv">$b</span><span class="p">}</span><span class="nx">c</span> <span class="o">.</span> <span class="nv">$d</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">.</span> <span class="nx">c</span><span class="nv">$d</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">.</span> <span class="nx">c</span><span class="p">{</span><span class="nv">$d</span><span class="p">};</span>

<span class="c1">// Mixed Concatenation and Interpolation string with constant</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">{</span><span class="nv">$b</span><span class="p">}</span><span class="nx">c</span> <span class="o">.</span> <span class="nx">CONSTANT</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Fixing this issue has no impact on the output. It makes code less error prone.</p>
<p>There are some situations where using concatenation are compulsory : when using a constant, calling a function, running a complex expression or make use of the escape sequence. You may also consider pushing the storing of such expression in a local variable.</p>
<div class="section" id="id838">
<h3>9.331.1. Suggestions<a class="headerlink" href="#id838" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Only use one type of variable usage : either interpolation, or concatenation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MixedConcatInterpolation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#suitecrm-structures-mixedconcatinterpolation"><span class="std std-ref">SuiteCrm</span></a>, <a class="reference internal" href="Cases.html#edusoho-structures-mixedconcatinterpolation"><span class="std std-ref">Edusoho</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mixed-keys-arrays">
<span id="id839"></span><h2>9.332. Mixed Keys Arrays<a class="headerlink" href="#mixed-keys-arrays" title="Permalink to this headline">¶</a></h2>
<p>Avoid mixing constants and literals in array keys.</p>
<p>When defining default values in arrays, it is recommended to avoid mixing constants and literals, as PHP may mistake them and overwrite the previous with the latter.</p>
<p>Either switch to a newer version of PHP (5.5 or newer), or make sure the resulting array hold the expected data. If not, reorder the definitions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">const</span> <span class="no">ONE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span>   <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
       <span class="nx">ONE</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id840">
<h3>9.332.1. Suggestions<a class="headerlink" href="#id840" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use only literals or constants when building the array</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/MixedKeys</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mkdir-default">
<span id="id841"></span><h2>9.333. Mkdir Default<a class="headerlink" href="#mkdir-default" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/mkdir">mkdir()</a> gives universal access to created folders, by default. It is recommended to gives limited set of rights (0755, 0700), or to explicitly set the rights to 0777.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// By default, this dir is 777</span>
<span class="nb">mkdir</span><span class="p">(</span><span class="s1">&#39;/path/to/dir&#39;</span><span class="p">);</span>

<span class="c1">// Explicitely, this is wanted. It may also be audited easily</span>
<span class="nb">mkdir</span><span class="p">(</span><span class="s1">&#39;/path/to/dir&#39;</span><span class="p">,</span> <span class="mo">0777</span><span class="p">);</span>

<span class="c1">// This dir is limited to the current user.</span>
<span class="nb">mkdir</span><span class="p">(</span><span class="s1">&#39;/path/to/dir&#39;</span><span class="p">,</span> <span class="mo">0700</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.spiralscripts.co.uk/Blog/why-777-folder-permissions-are-a-security-risk.html">Why 777 Folder Permissions are a Security Risk</a>.</p>
<div class="section" id="id843">
<h3>9.333.1. Suggestions<a class="headerlink" href="#id843" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use the lowest possible privileges on folders</li>
<li>Don’t use the PHP default : at least, make it explicit that the ‘universal’ rights are voluntary</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/MkdirDefault</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#mautic-security-mkdirdefault"><span class="std std-ref">Mautic</span></a>, <a class="reference internal" href="Cases.html#openemr-security-mkdirdefault"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="modernize-empty-with-expression">
<span id="id844"></span><h2>9.334. Modernize Empty With Expression<a class="headerlink" href="#modernize-empty-with-expression" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/empty">empty()</a> accepts expressions as argument. This feature was added in PHP 5.5.</p>
<p>There is no need to store the expression in a variable before testing, unless it is reused later.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 5.5+ empty() usage</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nx">foo</span><span class="p">(</span><span class="nv">$b</span> <span class="o">.</span> <span class="nv">$c</span><span class="p">)))</span> <span class="p">{</span>
    <span class="nx">doSomethingWithoutA</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Compatible empty() usage</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">(</span><span class="nv">$b</span> <span class="o">.</span> <span class="nv">$c</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomethingWithoutA</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// $a2 is reused, storage is legit</span>
<span class="nv">$a2</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$b</span> <span class="o">.</span> <span class="nv">$c</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$a2</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$a2</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/empty">empty()</a> and <a class="reference external" href="https://www.php.net/manual/en/migration55.new-features.php#migration55.new-features.empty">empty() supports arbitrary expressions</a>.</p>
<div class="section" id="id847">
<h3>9.334.1. Suggestions<a class="headerlink" href="#id847" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid the temporary variable, and use directly empty()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ModernEmpty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="modified-typed-parameter">
<span id="id848"></span><h2>9.335. Modified Typed Parameter<a class="headerlink" href="#modified-typed-parameter" title="Permalink to this headline">¶</a></h2>
<p>Reports modified parameters, which have a non-scalar typehint. Such variables should not be changed within the body of the method. Unlike typed properties, which always hold the expected type, typed parameters are only garanteed type at the beginning of the method block.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">Y</span> <span class="nv">$y</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $y is type Y</span>

        <span class="c1">// A cast version of $y is stored into $yAsString. $y is untouched.</span>
        <span class="nv">$yAsString</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$y</span><span class="p">;</span>

        <span class="c1">// $y is of type &#39;int&#39;, now.</span>
        <span class="nv">$y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="c1">// Some more code</span>

        <span class="c1">// display the string version.</span>
        <span class="k">echo</span> <span class="nv">$yAsString</span><span class="p">;</span>
        <span class="c1">// so, Y $y is now raising an error</span>
        <span class="k">echo</span> <span class="nv">$y</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This problem doesn’t apply to scalar types : by default, PHP pass scalar parameters by value, not by reference. Class types are always passed by reference.</p>
<p>This problem is similar to <a href="#id2266"><span class="problematic" id="id2267">`Classes/DontUnsetProperties`_</span></a> : the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> specification of the property may be unset, leading to confusing ‘undefined property’, while the class hold the property definition.</p>
<div class="section" id="id850">
<h3>9.335.1. Suggestions<a class="headerlink" href="#id850" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use different variable names when convertir a parameter to a different type.</li>
<li>Only use methods and properties calls on a typed parameter.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/ModifyTypedParameter</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-alias-definitions">
<span id="id851"></span><h2>9.336. Multiple Alias Definitions<a class="headerlink" href="#multiple-alias-definitions" title="Permalink to this headline">¶</a></h2>
<p>Some aliases are representing different classes across the repository. This leads to potential confusion.</p>
<p>Across an application, it is recommended to use the same namespace for one alias. Failing to do this lead to the same keyword to represent different values in different files, with different behavior. Those are hard to find bugs.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">d\d</span><span class="p">;</span> <span class="c1">// aka D</span>
<span class="p">}</span>

<span class="c1">// Those are usually in different files, rather than just different namespaces.</span>

<span class="k">namespace</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">b\c</span> <span class="k">as</span> <span class="nx">D</span><span class="p">;</span> <span class="c1">// also D. This could be named something else</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id852">
<h3>9.336.1. Suggestions<a class="headerlink" href="#id852" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Give more specific names to classes</li>
<li>Use an alias ‘use AB ac BC’ to give locally another name</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/MultipleAliasDefinitions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-namespaces-multiplealiasdefinitions"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#phinx-namespaces-multiplealiasdefinitions"><span class="std std-ref">Phinx</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-alias-definitions-per-file">
<span id="id853"></span><h2>9.337. Multiple Alias Definitions Per File<a class="headerlink" href="#multiple-alias-definitions-per-file" title="Permalink to this headline">¶</a></h2>
<p>Avoid aliasing the same name with different aliases. This leads to confusion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// first occurrence</span>
<span class="k">use</span> <span class="nx">name\space\ClasseName</span><span class="p">;</span>

<span class="c1">// when this happens, several other uses are mentionned</span>

<span class="c1">// name\space\ClasseName has now two names</span>
<span class="k">use</span> <span class="nx">name\space\ClasseName</span> <span class="k">as</span> <span class="nx">anotherName</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also Namespaces/MultipleAliasDefinition.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/MultipleAliasDefinitionPerFile</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="multiple-class-declarations">
<span id="id854"></span><h2>9.338. Multiple Class Declarations<a class="headerlink" href="#multiple-class-declarations" title="Permalink to this headline">¶</a></h2>
<p>It is possible to declare several times the same class in the code. PHP will not mention it until execution time, since declarations may be conditional.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// Conditional declaration</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
        <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="p">{</span> <span class="k">echo</span> <span class="s1">&#39;class 1&#39;</span><span class="p">;}</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
        <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="p">{</span> <span class="k">echo</span> <span class="s1">&#39;class 2&#39;</span><span class="p">;}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">(</span><span class="k">new</span> <span class="nx">foo</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to avoid declaring several times the same class in the code. The best practice is to separate them with namespaces, they are for here for that purpose. In case those two classes are to be used interchangeably, the best is to use an abstract class or an interface.</p>
<div class="section" id="id855">
<h3>9.338.1. Suggestions<a class="headerlink" href="#id855" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Store classes with different names in different namespaces</li>
<li>Change the name of the classes and give them a common interface to allow from common behavior</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MultipleDeclarations</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-classes-in-one-file">
<span id="id856"></span><h2>9.339. Multiple Classes In One File<a class="headerlink" href="#multiple-classes-in-one-file" title="Permalink to this headline">¶</a></h2>
<p>It is regarded as a bad practice to store several classes in the same file. This is usually done to make life of __autoload() easier.</p>
<p>It is often unexpected to find class <code class="docutils literal notranslate"><span class="pre">foo</span></code> in the <code class="docutils literal notranslate"><span class="pre">bar.php</span></code> file. This is also the case for interfaces and traits.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// three classes in the same file</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">bar</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">foobar</span><span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>One good reason to have multiple classes in one file is to reduce include time by providing everything into one nice include.</p>
<p>See also <a class="reference external" href="https://stackoverflow.com/questions/360643/is-it-a-bad-practice-to-have-multiple-classes-in-the-same-file">Is it a bad practice to have multiple classes in the same file?</a>.</p>
<div class="section" id="id857">
<h3>9.339.1. Suggestions<a class="headerlink" href="#id857" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Split the file into smaller files, one for each class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MultipleClassesInFile</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-constant-definition">
<span id="id858"></span><h2>9.340. Multiple Constant Definition<a class="headerlink" href="#multiple-constant-definition" title="Permalink to this headline">¶</a></h2>
<p>Some constants are defined several times in your code. This will lead to a fatal error, if they are defined during the same execution.</p>
<p>Multiple definitions may happens at bootstrap, when the application code is collecting information about the current environment. It may also happen at inclusion time, which one set of constant being loaded, while other definition are not, avoiding conflict. Both are false positive.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// OS is defined twice.</span>
<span class="k">if</span> <span class="p">(</span><span class="k">PHP_OS</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OS&#39;</span><span class="p">,</span> <span class="s1">&#39;Win&#39;</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;OS&#39;</span><span class="p">,</span> <span class="s1">&#39;Other&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id859">
<h3>9.340.1. Suggestions<a class="headerlink" href="#id859" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the constants to a class, and include the right class based on control flow.</li>
<li>Give different names to the constants, and keep the condition close to utilisation.</li>
<li>Move the constants to an external configuration file : it will be easier to identify that those constants may change.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/MultipleConstantDefinition</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-constants-multipleconstantdefinition"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#openconf-constants-multipleconstantdefinition"><span class="std std-ref">OpenConf</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-declaration-of-strict-types">
<span id="id860"></span><h2>9.341. Multiple Declaration Of Strict_types<a class="headerlink" href="#multiple-declaration-of-strict-types" title="Permalink to this headline">¶</a></h2>
<p>At least two declare() commands are declaring <cite>strict_types</cite> in one file. Only one is sufficient, and should be the first expression in the file.</p>
<p>Indeed, any <cite>strict_types</cite> set to 1 will have the final word. Setting <cite>strict_types</cite> to 0 will not revert the configuration, wherever is this call made.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
<span class="k">declare</span><span class="p">(</span><span class="nx">strict_types</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// rest of the code</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.declare.php">Declare</a>.</p>
<div class="section" id="id861">
<h3>9.341.1. Suggestions<a class="headerlink" href="#id861" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Just remove all but one of them.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/MultipleDeclareStrict</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-definition-of-the-same-argument">
<span id="id862"></span><h2>9.342. Multiple Definition Of The Same Argument<a class="headerlink" href="#multiple-definition-of-the-same-argument" title="Permalink to this headline">¶</a></h2>
<p>A method’s signature is holding twice (or more) the same argument. For example, function x ($a, $a) { <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list">…</a> }.</p>
<p>This is accepted as is by PHP 5, and the last parameter’s value will be assigned to the variable. PHP 7.0 and more recent has dropped this feature, and reports a fatal error when linting the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="k">function</span> <span class="nf">x</span> <span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="nv">$a</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">x</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="o">=&gt;</span> <span class="nx">display</span> <span class="mi">2</span>

    <span class="c1">// special case with a closure :</span>
  <span class="k">function</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span> <span class="k">print</span> <span class="nv">$a</span><span class="p">;</span> <span class="p">};</span>
  <span class="nx">x</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span> <span class="o">=&gt;</span> <span class="nx">display</span> <span class="mi">2</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>However, this is not common programming practise : all arguments should be named differently.</p>
<p>See also <a class="reference external" href="https://www.exakat.io/prepare-for-php-7-error-messages-part-3/">Prepare for PHP 7 error messages (part 3)</a>.</p>
<div class="section" id="id864">
<h3>9.342.1. Suggestions<a class="headerlink" href="#id864" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Give different names to different parameters</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/MultipleSameArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/all-unique-arguments.md">all-unique-arguments</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-exceptions-catch">
<span id="id865"></span><h2>9.343. Multiple Exceptions Catch()<a class="headerlink" href="#multiple-exceptions-catch" title="Permalink to this headline">¶</a></h2>
<p>It is possible to have several distinct exceptions class caught by the same catch, preventing code repetition.</p>
<p>This is a new feature since PHP 7.1.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7.1 and more recent</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">someException</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Single</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">oneType</span> <span class="o">|</span> <span class="nx">anotherType</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">processIdentically</span><span class="p">();</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// PHP 7.0 and older</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">someException</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Single</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">oneType</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">processIdentically</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">anotherType</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">processIdentically</span><span class="p">();</span>
<span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is a backward incompatible feature of PHP 7.1.</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/MultipleCatch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="multiple-identical-trait-or-interface">
<span id="id866"></span><h2>9.344. Multiple Identical Trait Or Interface<a class="headerlink" href="#multiple-identical-trait-or-interface" title="Permalink to this headline">¶</a></h2>
<p>There is no need to use the same trait, or implements the same interface more than once.</p>
<p>Up to PHP 7.1 (at least), this doesn’t raise any warning. Traits are only imported once, and interfaces may be implemented as many times as wanted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t3</span><span class="p">,</span><span class="nx">t3</span><span class="p">,</span><span class="nx">t3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">bar</span> <span class="k">implements</span> <span class="nx">i</span><span class="p">,</span><span class="nx">i</span><span class="p">,</span><span class="nx">i</span> <span class="p">{</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id867">
<h3>9.344.1. Suggestions<a class="headerlink" href="#id867" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the duplicate trait or interfaces</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/MultipleTraitOrInterface</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-index-definition">
<span id="id868"></span><h2>9.345. Multiple Index Definition<a class="headerlink" href="#multiple-index-definition" title="Permalink to this headline">¶</a></h2>
<p>Indexes that are defined multiple times in the same array.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// Multiple identical keys</span>
    <span class="nv">$x</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
               <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
               <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">);</span>

    <span class="c1">// Multiple identical keys (sneaky version)</span>
    <span class="nv">$x</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
               <span class="mf">1.1</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
               <span class="k">true</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">);</span>

    <span class="c1">// Multiple identical keys (automated version)</span>
    <span class="nv">$x</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
               <span class="mi">3</span><span class="p">,</span>        <span class="c1">// This will be index 2</span>
               <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">);</span>  <span class="c1">// this index is overwritten</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>They are indeed overwriting each other. This is most probably a typo.</p>
<div class="section" id="id869">
<h3>9.345.1. Suggestions<a class="headerlink" href="#id869" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Review your code and check that arrays only have keys defined once.</li>
<li>Review carefully your code and check indirect values, like constants, static constants.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/MultipleIdenticalKeys</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#magento-arrays-multipleidenticalkeys"><span class="std std-ref">Magento</span></a>, <a class="reference internal" href="Cases.html#mediawiki-arrays-multipleidenticalkeys"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-type-variable">
<span id="id870"></span><h2>9.346. Multiple Type Variable<a class="headerlink" href="#multiple-type-variable" title="Permalink to this headline">¶</a></h2>
<p>Avoid using the same variable with different types of data.</p>
<p>It is recommended to use different names for differently typed data, while processing them. This prevents errors where one believe the variable holds the former type, while it has already been cast to the later.</p>
<p>Incrementing variables, with math operations or concatenation, is OK : the content changes, but not the type. And casting the variable without storing it in itself is OK.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $x is an array</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">);</span>
<span class="c1">// $x is now a string</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$x</span><span class="p">);</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span> <span class="c1">// $x is not an array anymore</span>


<span class="c1">// $letters is an array</span>
<span class="nv">$letters</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">);</span>
<span class="c1">// $alphabet is a string</span>
<span class="nv">$alphabet</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$letters</span><span class="p">);</span>

<span class="c1">// Here, $letters is cast by PHP, but the variable is changed.</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$letters</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$count</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$letters</span><span class="p">);</span> <span class="c1">// $letters is still an array</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id871">
<h3>9.346.1. Suggestions<a class="headerlink" href="#id871" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a class that accepts one type of argument, and exports another type of argument.</li>
<li>Use different variable for each type of data format : $rows (for array), $list (for implode(‘’, $rows))</li>
<li>Pass the final result as argument to another method, avoiding the temporary variable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MultipleTypeVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#typo3-structures-multipletypevariable"><span class="std std-ref">Typo3</span></a>, <a class="reference internal" href="Cases.html#vanilla-structures-multipletypevariable"><span class="std std-ref">Vanilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-unset">
<span id="id872"></span><h2>9.347. Multiple Unset()<a class="headerlink" href="#multiple-unset" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/unset">Unset()</a> accepts multiple arguments, unsetting them one after each other. It is more efficient to call <a class="reference external" href="https://www.php.net/unset">unset()</a> once, than multiple times.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// One call to unset only</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">,</span> <span class="nv">$d</span><span class="p">);</span>

<span class="c1">// Too many calls to unset</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$d</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/unset">unset</a>.</p>
<div class="section" id="id875">
<h3>9.347.1. Suggestions<a class="headerlink" href="#id875" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge all unset into one call</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MultipleUnset</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiple-usage-of-same-trait">
<span id="id876"></span><h2>9.348. Multiple Usage Of Same Trait<a class="headerlink" href="#multiple-usage-of-same-trait" title="Permalink to this headline">¶</a></h2>
<p>The same trait is used several times. One trait usage is sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// C is used twice, and could be dropped from B</span>
<span class="k">trait</span> <span class="nx">A</span> <span class="p">{</span> <span class="k">use</span> <span class="nx">B</span><span class="p">,</span> <span class="nx">C</span><span class="p">;}</span>
<span class="k">trait</span> <span class="nx">B</span> <span class="p">{</span> <span class="k">use</span> <span class="nx">C</span><span class="p">;}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>PHP doesn’t raise any error when traits are included multiple times.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.traits.php">Traits</a>.</p>
<div class="section" id="id878">
<h3>9.348.1. Suggestions<a class="headerlink" href="#id878" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove any multiple traits from use expressions</li>
<li>Review the class tree, and remove any trait mentioned multiple times</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/MultipleUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#nextcloud-traits-multipleusage"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiples-identical-case">
<span id="id879"></span><h2>9.349. Multiples Identical Case<a class="headerlink" href="#multiples-identical-case" title="Permalink to this headline">¶</a></h2>
<p>Some cases are defined multiple times, but only one will be processed. Check the list of cases, and remove the extra one.</p>
<p>Exakat tries to find the value of the case as much as possible, and ignore any dynamic cases (using variables).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">const</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">case</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span> <span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="k">true</span><span class="o">:</span>    <span class="c1">// This is a duplicate of the previous</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">0</span><span class="o">:</span>   <span class="c1">// This is a duplicate of the previous</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mf">1.0</span> <span class="o">:</span>    <span class="c1">// This is a duplicate of the previous</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">A</span> <span class="o">:</span>      <span class="c1">// The A constant is actually 1</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nv">$y</span>  <span class="o">:</span>    <span class="c1">// This is not reported.</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id880">
<h3>9.349.1. Suggestions<a class="headerlink" href="#id880" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the double case</li>
<li>Change the case to another and rightful value</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MultipleDefinedCase</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-duplicate-case.md">no-duplicate-case</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#sugarcrm-structures-multipledefinedcase"><span class="std std-ref">SugarCrm</span></a>, <a class="reference internal" href="Cases.html#expressionengine-structures-multipledefinedcase"><span class="std std-ref">ExpressionEngine</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="multiply-by-one">
<span id="id881"></span><h2>9.350. Multiply By One<a class="headerlink" href="#multiply-by-one" title="Permalink to this headline">¶</a></h2>
<p>Multiplying by 1 is a fancy type cast.</p>
<p>If it is used to type cast a value to number, then casting (integer) or (real) is clearer. This behavior may change with PHP 7.1, which has unified the behavior of all hidden casts.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Still the same value than $m, but now cast to integer or real</span>
<span class="nv">$m</span> <span class="o">=</span> <span class="nv">$m</span> <span class="o">*</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// Still the same value than $m, but now cast to integer or real</span>
<span class="nv">$n</span> <span class="o">*=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// make typecasting clear, and merge it with the producing call.</span>
<span class="nv">$n</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$n</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.type-juggling.php">Type Juggling</a></p>
<div class="section" id="id882">
<h3>9.350.1. Suggestions<a class="headerlink" href="#id882" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Typecast to (int) or (float) for better readability</li>
<li>Skip useless math operation altogether</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/MultiplyByOne</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-useless-math.md">no-useless-math</a></td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#sugarcrm-structures-multiplybyone"><span class="std std-ref">SugarCrm</span></a>, <a class="reference internal" href="Cases.html#edusoho-structures-multiplybyone"><span class="std std-ref">Edusoho</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="must-call-parent-constructor">
<span id="id883"></span><h2>9.351. Must Call Parent Constructor<a class="headerlink" href="#must-call-parent-constructor" title="Permalink to this headline">¶</a></h2>
<p>Some PHP native classes require a call to <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a>::<a class="reference external" href="https://www.php.net/manual/en/language.oop5.decon.php">__construct()</a> to be stable.</p>
<p>As of PHP 7.3, two classes currently need that call : SplTempFileObject and SplFileObject.</p>
<p>The error is only emitted if the class is instantiated, and a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class is called.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">mySplFileObject</span> <span class="k">extends</span> <span class="nx">\SplFileObject</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>    <span class="p">{</span>
        <span class="c1">// Forgottent call to parent::__construct()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">(</span><span class="k">new</span> <span class="nx">mySplFileObject</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">passthru</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://gist.github.com/everzet/4215537">Why, php? WHY???</a>.</p>
<div class="section" id="id887">
<h3>9.351.1. Suggestions<a class="headerlink" href="#id887" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a call to the parent’s constructor</li>
<li>Remove the extension of the parent class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/MustCallParentConstructor</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="must-return-methods">
<span id="id888"></span><h2>9.352. Must Return Methods<a class="headerlink" href="#must-return-methods" title="Permalink to this headline">¶</a></h2>
<p>The following methods are expected to return a value that will be used later. Without return, they are useless.</p>
<p>Methods that must return are : <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__get()</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__isset()</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__sleep()</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__set_state()</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__invoke()</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__debugInfo()</a>.
Methods that may not return, but are often expected to : <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__call()</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__callStatic()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__isset</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// returning something useful</span>
        <span class="k">return</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$var</span><span class="p">[</span><span class="nv">$a</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
        <span class="c1">// not returning...</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$name</span><span class="p">(</span><span class="o">...</span><span class="nv">$args</span><span class="p">);</span>
        <span class="c1">// not returning anything, but that&#39;s OK</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id894">
<h3>9.352.1. Suggestions<a class="headerlink" href="#id894" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a return expression, with a valid data type</li>
<li>Remove the return typehint</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/MustReturn</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="named-regex">
<span id="id895"></span><h2>9.353. Named Regex<a class="headerlink" href="#named-regex" title="Permalink to this headline">¶</a></h2>
<p>Captured subpatterns may be named, for easier reference.</p>
<p>From the manual : It is possible to name a subpattern using the syntax <code class="docutils literal notranslate"><span class="pre">(?P&lt;name&gt;pattern)</span></code>. This subpattern will then be indexed in the matches array by its normal numeric position and also by name. PHP 5.2.2 introduced two alternative syntaxes <code class="docutils literal notranslate"><span class="pre">(?&lt;name&gt;pattern)</span></code> and <code class="docutils literal notranslate"><span class="pre">(?'name'pattern)</span></code>.</p>
<p>Naming subpatterns makes it easier to know what is read from the results of the subpattern : for example, <code class="docutils literal notranslate"><span class="pre">$r['name']</span></code> has more meaning than <code class="docutils literal notranslate"><span class="pre">$r[1]</span></code>.</p>
<p>Named subpatterns may also be shifted in the regex without impact on the resulting array.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>
<span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/(?&lt;name&gt;a)/&#39;</span><span class="p">,</span> <span class="nv">$x</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>

<span class="nb">preg_match</span><span class="p">(</span><span class="s2">&quot;/(?&lt;name&gt;a)(?&#39;sub&#39;b)/&quot;</span><span class="p">,</span> <span class="nv">$x</span><span class="p">,</span> <span class="nv">$s</span><span class="p">);</span>
<span class="k">print</span> <span class="nv">$s</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="k">print</span> <span class="nv">$s</span><span class="p">[</span><span class="s1">&#39;sub&#39;</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/regexp.reference.subpatterns.php">Subpatterns</a>.</p>
<div class="section" id="id896">
<h3>9.353.1. Suggestions<a class="headerlink" href="#id896" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use named regex, and stop using integer-named subpatterns</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NamedRegex</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phinx-structures-namedregex"><span class="std std-ref">Phinx</span></a>, <a class="reference internal" href="Cases.html#shopware-structures-namedregex"><span class="std std-ref">shopware</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="negative-power">
<span id="id897"></span><h2>9.354. Negative Power<a class="headerlink" href="#negative-power" title="Permalink to this headline">¶</a></h2>
<p>The power operator <a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">**</a> has higher precedence than the sign operators + and -.</p>
<p>This means that -2 <a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">**</a> 2 == -4. It is in fact, -(2 <a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">**</a> 2).</p>
<p>When using negative power, it is clearer to add parenthesis or to use the <a class="reference external" href="https://www.php.net/pow">pow()</a> function, which has no such ambiguity :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// -2 to the power of 2 (a square)</span>
<span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">;</span>

<span class="c1">// minus 2 to the power of 2 (a negative square)</span>
<span class="o">-</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">==</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id902">
<h3>9.354.1. Suggestions<a class="headerlink" href="#id902" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid negative number, as operands of **</li>
<li>Use parenthesis with negative numbers and **</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NegativePow</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="negative-start-index-in-array">
<span id="id903"></span><h2>9.355. Negative Start Index In Array<a class="headerlink" href="#negative-start-index-in-array" title="Permalink to this headline">¶</a></h2>
<p>Negative starting index in arrays changed in PHP 8.0. Until then, they were ignored, and automatic index started always at 0. Since PHP 8.0, the next index is calculated.</p>
<p>The behavior will <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> code that relies on automatic index in arrays, when a negative index is used for a starter.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">];</span>
<span class="nv">$x</span><span class="p">[]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">PHP 7.4 and older</span>
<span class="cm">Array</span>
<span class="cm">(</span>
<span class="cm">    [-5] =&gt; 2</span>
<span class="cm">    [0] =&gt; 3</span>
<span class="cm">)</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm">PHP 8.0 and more recent</span>
<span class="cm">Array</span>
<span class="cm">(</span>
<span class="cm">    [-5] =&gt; 2</span>
<span class="cm">    [-4] =&gt; 3</span>
<span class="cm">)</span>
<span class="cm">*/</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/negative_array_index">PHP RFC: Arrays starting with a negative index</a>.</p>
<div class="section" id="id905">
<h3>9.355.1. Suggestions<a class="headerlink" href="#id905" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Explicitely create the index, instead of using the automatic indexing</li>
<li>Add an explicit index of 0 in the initial array, to set the automatic process in the right track</li>
<li>Avoid using specified index in array, conjointly with automatic indexing.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/NegativeStart</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="nested-ifthen">
<span id="id906"></span><h2>9.356. Nested Ifthen<a class="headerlink" href="#nested-ifthen" title="Permalink to this headline">¶</a></h2>
<p>Three levels of ifthen is too much. The method should be split into smaller functions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Second level, possibly too much already</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>

        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Second level.</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Third level level.</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Too much</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="10%" />
<col width="10%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>nestedIfthen</td>
<td>3</td>
<td>integer</td>
<td>Maximal number of acceptable nesting of if-then structures</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NestedIfthen</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#livezilla-structures-nestedifthen"><span class="std std-ref">LiveZilla</span></a>, <a class="reference internal" href="Cases.html#mediawiki-structures-nestedifthen"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="nested-ternary">
<span id="id907"></span><h2>9.357. Nested Ternary<a class="headerlink" href="#nested-ternary" title="Permalink to this headline">¶</a></h2>
<p>Ternary operators should not be nested too deep.</p>
<p>They are a convenient instruction to apply some condition, and avoid a if() structure. It works best when it is simple, like in a one liner.</p>
<p>However, ternary operators tends to make the syntax very difficult to read when they are nested. It is then recommended to use an if() structure, and make the whole code readable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Simple ternary expression</span>
<span class="k">echo</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="nv">$b</span> <span class="o">:</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">;</span>

<span class="c1">// Nested ternary expressions</span>
<span class="k">echo</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="nv">$d</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">?</span> <span class="nv">$b</span> <span class="o">:</span> <span class="nv">$d</span> <span class="o">:</span> <span class="nv">$d</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">?</span> <span class="nv">$e</span> <span class="o">:</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">;</span>
<span class="k">echo</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="nv">$d</span> <span class="o">===</span> <span class="mi">2</span> <span class="o">?</span> <span class="nv">$f</span> <span class="o">===</span><span class="mi">4</span> <span class="o">?</span> <span class="nv">$g</span> <span class="o">:</span> <span class="nv">$h</span> <span class="o">:</span> <span class="nv">$d</span> <span class="o">:</span> <span class="nv">$d</span> <span class="o">===</span> <span class="mi">3</span> <span class="o">?</span> <span class="nv">$e</span> <span class="o">:</span> <span class="nv">$i</span> <span class="o">===</span> <span class="mi">5</span> <span class="o">?</span> <span class="nv">$j</span> <span class="o">:</span> <span class="nv">$k</span><span class="p">)</span> <span class="p">;</span>

<span class="c1">//Previous expressions, written as a if / Then expression</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$d</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$d</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$d</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$e</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$c</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$d</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$f</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$g</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$h</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$d</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$d</span> <span class="o">===</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$e</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">===</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$j</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$k</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://medium.com/javascript-scene/nested-ternaries-are-great-361bddd0f340">Nested Ternaries are Great</a>.</p>
<div class="section" id="id908">
<h3>9.357.1. Suggestions<a class="headerlink" href="#id908" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace ternaries by if/then structures.</li>
<li>Replace ternaries by a functioncall : this provides more readability, offset the actual code, and gives room for making it different.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NestedTernary</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-nested-ternary.md">no-nested-ternary</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#spip-structures-nestedternary"><span class="std std-ref">SPIP</span></a>, <a class="reference internal" href="Cases.html#zencart-structures-nestedternary"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="nested-ternary-without-parenthesis">
<span id="id909"></span><h2>9.358. Nested Ternary Without Parenthesis<a class="headerlink" href="#nested-ternary-without-parenthesis" title="Permalink to this headline">¶</a></h2>
<p>It is not allowed to nest ternary operator within itself, without parenthesis. This has been implemented in PHP 7.4.</p>
<p>The reason behind this feature is to keep the code expressive. See the Warning message for more explanations</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">3</span><span class="p">);</span>

<span class="c1">// Still valid, as not ambiguous</span>
<span class="nv">$a</span> <span class="o">?</span> <span class="nv">$b</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>

<span class="c1">// Produces a warning</span>
<span class="c1">//Unparenthesized `a ? b : c ? d : e` is deprecated. Use either `(a ? b : c) ? d : e` or `a ? b : (c ? d : e)`</span>
<span class="nv">$a</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="nv">$b</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/ternary_associativity">PHP RFC: Deprecate left-associative ternary operator</a>.</p>
<div class="section" id="id910">
<h3>9.358.1. Suggestions<a class="headerlink" href="#id910" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add parenthesis to nested ternary calls</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NestedTernaryWithoutParenthesis</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="never-used-parameter">
<span id="id911"></span><h2>9.359. Never Used Parameter<a class="headerlink" href="#never-used-parameter" title="Permalink to this headline">¶</a></h2>
<p>When a parameter is never used at calltime, it may be turned into a local variable.</p>
<p>It seems that the parameter was set up initially, but never found its practical usage. It is never mentioned, and always fall back on its default value.</p>
<p>Parameter without a default value are reported by PHP, and are usually always filled.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $b may be turned into a local var, it is unused</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// whenever foo is called, the 2nd arg is not mentionned</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id912">
<h3>9.359.1. Suggestions<a class="headerlink" href="#id912" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the unused argument in the method definition</li>
<li>Actually use the argument when calling the method</li>
<li>Drop the default value, and check warnings that mention usage of this parameter</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/NeverUsedParameter</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#piwigo-functions-neverusedparameter"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="never-used-properties">
<span id="id913"></span><h2>9.360. Never Used Properties<a class="headerlink" href="#never-used-properties" title="Permalink to this headline">¶</a></h2>
<p>Properties that are never used. They are defined in a class or a trait, but they never actually used.</p>
<p>Properties are considered used when they are used locally, in the same class as their definition, or in a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class : a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class is always included with the current class.</p>
<p>On the other hand, properties which are defined in a class, but only used in children classes is considered unused, since children may also avoid using it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$usedProperty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Never used anywhere</span>
    <span class="k">public</span> <span class="nv">$unusedProperty</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Used internally</span>
        <span class="o">++</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">usedProperty</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">foo2</span>  <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar2</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Used in child class</span>
        <span class="o">++</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">usedProperty</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Used externally</span>
<span class="o">++</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">usedProperty</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id916">
<h3>9.360.1. Suggestions<a class="headerlink" href="#id916" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop unused properties</li>
<li>Change the name of the unused properties</li>
<li>Move the properties to children classes</li>
<li>Find usage for unused properties</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/PropertyNeverUsed</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-classes-propertyneverused"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="new-constants-in-php-7-2">
<span id="id917"></span><h2>9.361. New Constants In PHP 7.2<a class="headerlink" href="#new-constants-in-php-7-2" title="Permalink to this headline">¶</a></h2>
<p>The following constants are now native in PHP 7.2. It is advised to avoid using such names for constant before moving to this new version.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">PHP_OS_FAMILY</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">PHP_FLOAT_DIG</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">PHP_FLOAT_EPSILON</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">PHP_FLOAT_MAX</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">PHP_FLOAT_MIN</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SQLITE3_DETERMINISTIC</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURLSSLOPT_NO_REVOKE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURLOPT_DEFAULT_PROTOCOL</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURLOPT_STREAM_WEIGHT</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURLMOPT_PUSHFUNCTION</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURL_PUSH_OK</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURL_PUSH_DENY</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURL_HTTP_VERSION_2TLS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURLOPT_TFTP_NO_OPTIONS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURL_HTTP_VERSION_2_PRIOR_KNOWLEDGE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURLOPT_CONNECT_TO</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">CURLOPT_TCP_FASTOPEN</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DNS_CAA</span></code></li>
</ul>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration72.constants.php">New global constants in 7.2</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php72NewConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="new-constants-in-php-7-4">
<span id="id918"></span><h2>9.362. New Constants In PHP 7.4<a class="headerlink" href="#new-constants-in-php-7-4" title="Permalink to this headline">¶</a></h2>
<p>The following constants are now native in PHP 7.4. It is advised to avoid using such names for constant before moving to this new version.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">MB_ONIGURUMA_VERSION</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SO_LABEL</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SO_PEERLABEL</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SO_LISTENQLIMIT</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SO_LISTENQLEN</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SO_USER_COOKIE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">PHP_WINDOWS_EVENT_CTRL_C</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">PHP_WINDOWS_EVENT_CTRL_BREAK</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_ARTICLE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_ASIDE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_AUDIO</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_BDI</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_CANVAS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_COMMAND</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_DATALIST</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_DETAILS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_DIALOG</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_FIGCAPTION</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_FIGURE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_FOOTER</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_HEADER</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_HGROUP</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_MAIN</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_MARK</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_MENUITEM</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_METER</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_NAV</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_OUTPUT</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_PROGRESS</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_SECTION</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_SOURCE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_SUMMARY</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_TEMPLATE</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_TIME</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_TRACK</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TIDY_TAG_VIDEO</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">STREAM_CRYPTO_METHOD_TLSv1_3_CLIENT</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">STREAM_CRYPTO_METHOD_TLSv1_3_SERVER</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">STREAM_CRYPTO_PROTO_TLSv1_3</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">T_COALESCE_EQUAL</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">T_FN</span></code></li>
</ul>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration74.constants.php">New global constants in 7.4</a>.</p>
<div class="section" id="id919">
<h3>9.362.1. Suggestions<a class="headerlink" href="#id919" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the constants to a new namespace</li>
<li>Remove the old constants</li>
<li>Rename the old constants</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74NewConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="new-functions-in-php-5-4">
<span id="id920"></span><h2>9.363. New Functions In PHP 5.4<a class="headerlink" href="#new-functions-in-php-5-4" title="Permalink to this headline">¶</a></h2>
<p>PHP introduced new functions in PHP 5.4. If there are defined functions with such names, there will be a conflict when upgrading. It is advised to change those functions’ name.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php54NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.3 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="new-functions-in-php-5-5">
<span id="id921"></span><h2>9.364. New Functions In PHP 5.5<a class="headerlink" href="#new-functions-in-php-5-5" title="Permalink to this headline">¶</a></h2>
<p>PHP introduced new functions in PHP 5.5. If you have already defined functions with such names, you will get a conflict when trying to upgrade. It is advised to change those functions’ name.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php55NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="new-functions-in-php-5-6">
<span id="id922"></span><h2>9.365. New Functions In PHP 5.6<a class="headerlink" href="#new-functions-in-php-5-6" title="Permalink to this headline">¶</a></h2>
<p>PHP introduced new functions in PHP 5.6. If you have already defined functions with such names, you will get a conflict when trying to upgrade. It is advised to change those functions’ name.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php56NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="new-functions-in-php-7-0">
<span id="id923"></span><h2>9.366. New Functions In PHP 7.0<a class="headerlink" href="#new-functions-in-php-7-0" title="Permalink to this headline">¶</a></h2>
<p>The following functions are now native functions in PHP 7.0. It is advised to change them before moving to this new version.</p>
<ul class="simple">
<li>get_resources()</li>
<li><a class="reference external" href="https://www.php.net/gc_mem_caches">gc_mem_caches()</a></li>
<li><a class="reference external" href="https://www.php.net/preg_replace_callback_array">preg_replace_callback_array()</a></li>
<li>posix_setrlimit()</li>
<li><a class="reference external" href="https://www.php.net/random_bytes">random_bytes()</a></li>
<li><a class="reference external" href="https://www.php.net/random_int">random_int()</a></li>
<li><a class="reference external" href="https://www.php.net/intdiv">intdiv()</a></li>
<li><a class="reference external" href="https://www.php.net/error_clear_last">error_clear_last()</a></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php70NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="new-functions-in-php-7-1">
<span id="id927"></span><h2>9.367. New Functions In PHP 7.1<a class="headerlink" href="#new-functions-in-php-7-1" title="Permalink to this headline">¶</a></h2>
<p>The following functions are now native functions in PHP 7.1. It is advised to change them before moving to this new version.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/curl_share_strerror">curl_share_strerror()</a></li>
<li><a class="reference external" href="https://www.php.net/curl_multi_errno">curl_multi_errno()</a></li>
<li><a class="reference external" href="https://www.php.net/curl_share_errno">curl_share_errno()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_ord">mb_ord()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_chr">mb_chr()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_scrub">mb_scrub()</a></li>
<li><a class="reference external" href="https://www.php.net/is_iterable">is_iterable()</a></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php71NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="new-functions-in-php-7-2">
<span id="id929"></span><h2>9.368. New Functions In PHP 7.2<a class="headerlink" href="#new-functions-in-php-7-2" title="Permalink to this headline">¶</a></h2>
<p>The following functions are now native functions in PHP 7.2. It is advised to change custom functions that are currently created, and using those names, before moving to this new version.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/mb_ord">mb_ord()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_chr">mb_chr()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_scrub">mb_scrub()</a></li>
<li><a class="reference external" href="https://www.php.net/stream_isatty">stream_isatty()</a></li>
<li><a class="reference external" href="https://www.php.net/proc_nice">proc_nice()</a> (Windows only)</li>
</ul>
<div class="section" id="id933">
<h3>9.368.1. Suggestions<a class="headerlink" href="#id933" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move custom functions with the same name to a new namespace</li>
<li>Change the name of any custom functions with the same name</li>
<li>Add a condition to the functions definition to avoid conflict</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php72NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="new-functions-in-php-7-3">
<span id="id934"></span><h2>9.369. New Functions In PHP 7.3<a class="headerlink" href="#new-functions-in-php-7-3" title="Permalink to this headline">¶</a></h2>
<p>New functions are added to new PHP version.</p>
<p>The following functions are now native functions in PHP 7.3. It is compulsory to rename any custom function that was created in older versions. One alternative is to move the function to a custom namespace, and update the <code class="docutils literal notranslate"><span class="pre">use</span></code> list at the beginning of the script.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/net_get_interfaces">net_get_interfaces</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_binomial">gmp_binomial</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_lcm">gmp_lcm</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_perfect_power">gmp_perfect_power</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_kronecker">gmp_kronecker</a></li>
<li><a class="reference external" href="https://www.php.net/openssl_pkey_derive">openssl_pkey_derive</a></li>
<li><a class="reference external" href="https://www.php.net/is_countable">is_countable</a></li>
<li><a class="reference external" href="https://www.php.net/ldap_exop_refresh">ldap_exop_refresh</a></li>
</ul>
<p>Note : At the moment of writing, all links to the manual are not working.</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php73NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="new-functions-in-php-7-4">
<span id="id935"></span><h2>9.370. New Functions In PHP 7.4<a class="headerlink" href="#new-functions-in-php-7-4" title="Permalink to this headline">¶</a></h2>
<p>New functions are added to new PHP version.</p>
<p>The following functions are now native functions in PHP 7.3. It is compulsory to rename any custom function that was created in older versions. One alternative is to move the function to a custom namespace, and update the <code class="docutils literal notranslate"><span class="pre">use</span></code> list at the beginning of the script.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/mb_str_split">mb_str_split</a></li>
<li><a class="reference external" href="https://www.php.net/password_algos">password_algos</a></li>
</ul>
<p>Note : At the moment of writing, all links to the manual are not working.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="new-functions-in-php-8-0">
<span id="id936"></span><h2>9.371. New Functions In PHP 8.0<a class="headerlink" href="#new-functions-in-php-8-0" title="Permalink to this headline">¶</a></h2>
<p>New functions are added to new PHP version.</p>
<p>The following functions are now native functions in PHP 7.3. It is compulsory to rename any custom function that was created in older versions. One alternative is to move the function to a custom namespace, and update the <code class="docutils literal notranslate"><span class="pre">use</span></code> list at the beginning of the script.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/str_contains">str_contains</a></li>
<li><a class="reference external" href="https://www.php.net/fdiv">fdiv</a></li>
<li><a class="reference external" href="https://www.php.net/preg_last_error_msg">preg_last_error_msg</a></li>
</ul>
<p>Note : At the moment of writing, all links to the manual are not working.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80NewFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 8.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="next-month-trap">
<span id="id937"></span><h2>9.372. Next Month Trap<a class="headerlink" href="#next-month-trap" title="Permalink to this headline">¶</a></h2>
<p>Avoid using +1 month with <a class="reference external" href="https://www.php.net/strtotime">strtotime()</a>.</p>
<p><a class="reference external" href="https://www.php.net/strtotime">strtotime()</a> calculates the next month by incrementing the month number. For day number that do not exist from one month to the next, <a class="reference external" href="https://www.php.net/strtotime">strtotime()</a> fixes them by setting them in the next-next month.</p>
<p>This happens to January, March, May, July, August and October. January is also vulnerable for 29 (not every year), 30 and 31.</p>
<p>Avoid using ‘+1 month’, and rely on ‘first day of next month’ or ‘last day of next month’ to extract the next month’s name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Base date is October 31 =&gt; 10/31</span>
<span class="c1">// +1 month adds +1 to 10 =&gt; 11/31</span>
<span class="c1">// Since November 31rst doesn&#39;t exists, it is corrected to 12/01.</span>
<span class="k">echo</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;+1 month&#39;</span><span class="p">,</span><span class="nb">mktime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">$i</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">2017</span><span class="p">)))</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="c1">// Base date is October 31 =&gt; 10/31</span>
<span class="k">echo</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;first day of next month&#39;</span><span class="p">,</span><span class="nb">mktime</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nv">$i</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">2017</span><span class="p">)))</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://twitter.com/rasmus/status/925431734128197632">It is the 31st again</a>.</p>
<div class="section" id="id940">
<h3>9.372.1. Suggestions<a class="headerlink" href="#id940" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Review strtotime() usage for month additions</li>
<li>Use datetime() and other classes, not PHP native functions</li>
<li>Use a external library, like carbon, to handle dates</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NextMonthTrap</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#contao-structures-nextmonthtrap"><span class="std std-ref">Contao</span></a>, <a class="reference internal" href="Cases.html#edusoho-structures-nextmonthtrap"><span class="std std-ref">Edusoho</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-append-on-source">
<span id="id941"></span><h2>9.373. No Append On Source<a class="headerlink" href="#no-append-on-source" title="Permalink to this headline">¶</a></h2>
<p>Do not append new elements to an array in a foreach loop. Since PHP 7.0, the array is still used as a source, and will be augmented, and used again.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Relying on the initial copy</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$initial</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$initial</span> <span class="k">as</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Keep new results aside</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="nv">$tmp</span> <span class="o">=</span> <span class="p">[];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$tmp</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$tmp</span><span class="p">);</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$tmp</span><span class="p">);</span>

<span class="c1">// Example, courtesy of Frederic Bouchery</span>
<span class="c1">// This is an infinite loop</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$v</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Thanks to <a class="reference external" href="https://twitter.com/FredBouchery/">Frederic Bouchery</a> for the reminder.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a> and <a class="reference external" href="https://twitter.com/FredBouchery/status/1135480412703211520">What will this code return? #PHP</a>.</p>
<div class="section" id="id943">
<h3>9.373.1. Suggestions<a class="headerlink" href="#id943" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a copy of the source, to avoid modifying it during the loop</li>
<li>Store the new values in a separate storage</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoAppendOnSource</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-boolean-as-default">
<span id="id944"></span><h2>9.374. No Boolean As Default<a class="headerlink" href="#no-boolean-as-default" title="Permalink to this headline">¶</a></h2>
<p>Default values should always be set up with a constant name.</p>
<p>Class constants and constants improve readability when calling the methods or comparing values and statuses.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">const</span> <span class="no">CASE_INSENSITIVE</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="k">const</span> <span class="no">CASE_SENSITIVE</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$case_insensitive</span> <span class="o">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="c1">// Readable code</span>
<span class="nx">foo</span><span class="p">(</span><span class="nx">CASE_INSENSITIVE</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="nx">CASE_SENSITIVE</span><span class="p">);</span>


<span class="c1">// unreadable code  : is true case insensitive or case sensitive ?</span>
<span class="nx">foo</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.martinfowler.com/bliki/FlagArgument.html">FlagArgument</a> and <a class="reference external" href="https://medium.com/&#64;amlcurran/clean-code-the-curse-of-a-boolean-parameter-c237a830b7a3">Clean code: The curse of a boolean parameter</a>.</p>
<div class="section" id="id945">
<h3>9.374.1. Suggestions<a class="headerlink" href="#id945" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use constants or class constants to give value to a boolean literal</li>
<li>When constants have been defined, use them when calling the code</li>
<li>Split the method into two methods, one for each case</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/NoBooleanAsDefault</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openconf-functions-nobooleanasdefault"><span class="std std-ref">OpenConf</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-choice">
<span id="id946"></span><h2>9.375. No Choice<a class="headerlink" href="#no-choice" title="Permalink to this headline">¶</a></h2>
<p>A conditional structure is being used, but both alternatives are the same, leading to the illusion of choice.</p>
<p>Either the condition is useless, and may be removed, or the alternatives need to be distinguished.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$condition</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="nv">$condition</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">?</span>     <span class="nx">doSomething</span><span class="p">()</span> <span class="o">:</span>     <span class="nx">doSomething</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id947">
<h3>9.375.1. Suggestions<a class="headerlink" href="#id947" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the conditional, and call the expression directly</li>
<li>Replace one of the alternative with a distinct call</li>
<li>Remove the whole conditional : it may end up being useless</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoChoice</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#nextcloud-structures-nochoice"><span class="std std-ref">NextCloud</span></a>, <a class="reference internal" href="Cases.html#zencart-structures-nochoice"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-class-as-typehint">
<span id="id948"></span><h2>9.376. No Class As Typehint<a class="headerlink" href="#no-class-as-typehint" title="Permalink to this headline">¶</a></h2>
<p>Avoid using classes as typehint : always use interfaces. This way, different classes, or versions of classes may be passed as argument. The typehint is not linked to an implementation, but to signatures.</p>
<p>A class is needed when the object is with properties : interfaces do not allow the specifications of properties.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$p</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// X is a class : any update in the code requires changing / subclassing X or the rest of the code.</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">X</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// I is an interface : X may implements this interface without refactoring and pass</span>
<span class="c1">// later, newer versions of X may get another name, but still implement I, and still pass</span>
<span class="k">function</span> <span class="nf">bar2</span><span class="p">(</span><span class="nx">I</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar3</span><span class="p">(</span><span class="nx">I</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://phpenthusiast.com/object-oriented-php-tutorials/type-hinting-for-interfaces">Type hinting for interfaces</a>.</p>
<div class="section" id="id949">
<h3>9.376.1. Suggestions<a class="headerlink" href="#id949" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create an interface with the important methods, and use that interface</li>
<li>Create an abstract class, when public properties are also needed</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/NoClassAsTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#vanilla-functions-noclassastypehint"><span class="std std-ref">Vanilla</span></a>, <a class="reference internal" href="Cases.html#phpmyadmin-functions-noclassastypehint"><span class="std std-ref">phpMyAdmin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-class-in-global">
<span id="id950"></span><h2>9.377. No Class In Global<a class="headerlink" href="#no-class-in-global" title="Permalink to this headline">¶</a></h2>
<p>Avoid defining structures in Global namespace. Always prefer using a namespace. This will come handy later, either when publishing the code, or when importing a library, or even if PHP reclaims that name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Code prepared for later</span>
<span class="k">namespace</span> <span class="nx">Foo</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">Bar</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// Code that may conflict with other names.</span>
<span class="k">namespace</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">Bar</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id951">
<h3>9.377.1. Suggestions<a class="headerlink" href="#id951" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a specific namespace for your classes</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NoClassInGlobal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-php-noclassinglobal"><span class="std std-ref">Dolphin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-count-with-0">
<span id="id952"></span><h2>9.378. No Count With 0<a class="headerlink" href="#no-count-with-0" title="Permalink to this headline">¶</a></h2>
<p>Comparing <a class="reference external" href="https://www.php.net/count">count()</a>, <a class="reference external" href="https://www.php.net/strlen">strlen()</a> or <a class="reference external" href="https://www.php.net/mb_strlen">mb_strlen()</a> to 0 is a waste of resources. There are three distinct situations.</p>
<p>When comparing <a class="reference external" href="https://www.php.net/count">count()</a> with 0, with ===, ==, !==, !=, it is more efficient to use <a class="reference external" href="https://www.php.net/empty">empty()</a>. <a class="reference external" href="https://www.php.net/empty">empty()</a> is a language construct that checks if a value is present, while <a class="reference external" href="https://www.php.net/count">count()</a> actually load the number of element.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Checking if an array is empty</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething();</span>
<span class="p">}</span>
<span class="c1">// This may be replaced with</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$array</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// doSomething();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When comparing <a class="reference external" href="https://www.php.net/count">count()</a> strictly with 0 and <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, it is more efficient to use <code class="docutils literal notranslate"><span class="pre">!(empty(</span>&#160; <span class="pre">))</span></code></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Checking if an array is empty</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething();</span>
<span class="p">}</span>
<span class="c1">// This may be replaced with</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$array</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// doSomething();</span>
<span class="p">}</span>

<span class="nx">Of</span> <span class="nx">course</span> <span class="nx">comparing</span> <span class="nb">count</span><span class="p">()</span> <span class="nx">with</span> <span class="nx">negative</span> <span class="nx">values</span><span class="p">,</span> <span class="k">or</span> <span class="nx">with</span> <span class="o">&gt;=</span> <span class="nx">is</span> <span class="nx">useless</span><span class="o">.</span>

<span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Checking if an array is empty</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This never happens</span>
    <span class="c1">// doSomething();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Comparing <a class="reference external" href="https://www.php.net/count">count()</a>, <a class="reference external" href="https://www.php.net/strlen">strlen()</a> or <a class="reference external" href="https://www.php.net/mb_strlen">mb_strlen()</a> with other values than 0 cannot be replaced with a comparison with <a class="reference external" href="https://www.php.net/empty">empty()</a>.</p>
<p>Note that this is a micro-optimisation : since PHP keeps track of the number of elements in arrays (or number of chars in strings), the total computing time of both operations is often lower than a ms. However, both functions tends to be heavily used, and may even be used inside loops.</p>
<p>See also <a class="reference external" href="https://www.php.net/count">count</a>, <a class="reference external" href="https://www.php.net/strlen">strlen</a> and <a class="reference external" href="https://www.php.net/mb_strlen">mb_strlen</a>.</p>
<div class="section" id="id967">
<h3>9.378.1. Suggestions<a class="headerlink" href="#id967" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use empty() on the data</li>
<li>Compare the variable with a default value, such as an empty array</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/NotCountNull</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#contao-performances-notcountnull"><span class="std std-ref">Contao</span></a>, <a class="reference internal" href="Cases.html#wordpress-performances-notcountnull"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-direct-call-to-magic-method">
<span id="id968"></span><h2>9.379. No Direct Call To Magic Method<a class="headerlink" href="#no-direct-call-to-magic-method" title="Permalink to this headline">¶</a></h2>
<p>PHP features magic methods, which are methods related to operators.</p>
<p>Magic methods, such as <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__get()</a>, related to =, or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__clone()</a>, related to <code class="docutils literal notranslate"><span class="pre">clone</span></code>, are supposed to be used in an object environment, and not with direct call.</p>
<p>It is recommended to use the magic method with its intended usage, and not to call it directly. For example, typecast to <code class="docutils literal notranslate"><span class="pre">string</span></code> instead of calling the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a> method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Write</span>
  <span class="k">print</span> <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>
<span class="c1">// instead of</span>
  <span class="k">print</span> <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">__get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nx">secret</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$bar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="k">echo</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$bar</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Accessing those methods in a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> way is also discouraged.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">Magic Methods</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">Magical PHP: `__call</a> &lt;<a class="reference external" href="https://www.garfieldtech.com/blog/magical-php-call">https://www.garfieldtech.com/blog/magical-php-call</a>&gt;`_.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/DirectCallToMagicMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="no-direct-usage">
<span id="id974"></span><h2>9.380. No Direct Usage<a class="headerlink" href="#no-direct-usage" title="Permalink to this headline">¶</a></h2>
<p>The results of the following functions shouldn’t be used directly, but checked first.</p>
<p>For example, <a class="reference external" href="https://www.php.net/glob">glob()</a> returns an array, unless some error happens, in which case it returns a boolean (false). In such case, however rare it is, plugging <a class="reference external" href="https://www.php.net/glob">glob()</a> directly in a <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> loops will yield errors.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// Used without check :</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* do Something */</span> <span class="p">}</span><span class="o">.</span>

    <span class="c1">// Used without check :</span>
    <span class="nv">$files</span> <span class="o">=</span> <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$files</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">foreach</span><span class="p">(</span><span class="nv">$files</span> <span class="k">as</span> <span class="nv">$file</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* do Something */</span> <span class="p">}</span><span class="o">.</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id978">
<h3>9.380.1. Suggestions<a class="headerlink" href="#id978" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check the return of the function before using it, in particular for false, or array().</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoDirectUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#edusoho-structures-nodirectusage"><span class="std std-ref">Edusoho</span></a>, <a class="reference internal" href="Cases.html#xoops-structures-nodirectusage"><span class="std std-ref">XOOPS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-ent-ignore">
<span id="id979"></span><h2>9.381. No ENT_IGNORE<a class="headerlink" href="#no-ent-ignore" title="Permalink to this headline">¶</a></h2>
<p>Certain characters have special significance in HTML, and should be represented by HTML entities if they are to preserve their meanings.</p>
<p>ENT_IGNORE is a configuration option for <a class="reference external" href="https://www.php.net/htmlspecialchars">htmlspecialchars()</a>, that ignore any needed character replacement. This mean the raw input will now be processed by PHP, or a target browser.</p>
<p>It is recommended to use the other configuration options : <code class="docutils literal notranslate"><span class="pre">ENT_COMPAT</span></code>, <code class="docutils literal notranslate"><span class="pre">ENT_QUOTES</span></code>, <code class="docutils literal notranslate"><span class="pre">ENT_NOQUOTES</span></code>, <code class="docutils literal notranslate"><span class="pre">ENT_SUBSTITUTE</span></code>, <code class="docutils literal notranslate"><span class="pre">ENT_DISALLOWED</span></code>, <code class="docutils literal notranslate"><span class="pre">ENT_HTML401</span></code>, <code class="docutils literal notranslate"><span class="pre">ENT_XML1</span></code>, <code class="docutils literal notranslate"><span class="pre">ENT_XHTML</span></code> or <code class="docutils literal notranslate"><span class="pre">ENT_HTML5</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This produces a valid HTML tag</span>
<span class="nv">$new</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="s2">&quot;&lt;a href=&#39;test&#39;&gt;Test&lt;/a&gt;&quot;</span><span class="p">,</span> <span class="nx">ENT_IGNORE</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$new</span><span class="p">;</span> <span class="c1">// &amp;lt;a href=&amp;#039;test&amp;#039;&amp;gt;Test&amp;lt;/a&amp;gt;</span>

<span class="c1">// This produces a valid string, without any HTML special value</span>
<span class="nv">$new</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="s2">&quot;&lt;a href=&#39;test&#39;&gt;Test&lt;/a&gt;&quot;</span><span class="p">,</span> <span class="nx">ENT_QUOTES</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$new</span><span class="p">;</span> <span class="c1">// &amp;lt;a href=&amp;#039;test&amp;#039;&amp;gt;Test&amp;lt;/a&amp;gt;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/htmlspecialchars">htmlspecialchars</a> and <a class="reference external" href="http://unicode.org/reports/tr36/#Deletion_of_Noncharacters">Deletion of Code Points</a>.</p>
<div class="section" id="id982">
<h3>9.381.1. Suggestions<a class="headerlink" href="#id982" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use of the the other options</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/NoEntIgnore</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-empty-regex">
<span id="id983"></span><h2>9.382. No Empty Regex<a class="headerlink" href="#no-empty-regex" title="Permalink to this headline">¶</a></h2>
<p>PHP regex don’t accept empty regex, nor regex with alphanumeric delimiter.</p>
<p>Most of those errors happen at execution time, when the regex is build dynamically, but still may end empty. At compile time, such error are made when the code is not tested before commit.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// No empty regex</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>

<span class="c1">// Delimiter must be non-alphanumerical</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;1abc1&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>

<span class="c1">// Delimiter must be non-alphanumerical</span>
<span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="o">.</span><span class="nv">$regex</span><span class="o">.</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/pcre">PCRE</a> and <a class="reference external" href="https://www.php.net/manual/en/regexp.reference.delimiters.php">Delimiters</a>.</p>
<div class="section" id="id984">
<h3>9.382.1. Suggestions<a class="headerlink" href="#id984" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the regex by adding regex delimiters</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoEmptyRegex</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tikiwiki-structures-noemptyregex"><span class="std std-ref">Tikiwiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-hardcoded-hash">
<span id="id985"></span><h2>9.383. No Hardcoded Hash<a class="headerlink" href="#no-hardcoded-hash" title="Permalink to this headline">¶</a></h2>
<p>Hash should never be hardcoded.</p>
<p>Hashes may be MD5, SHA1, SHA512, Bcrypt or any other. Such values must be easily changed, for security reasons, and the source code is not the safest place to hide it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// Those strings may be sha512 hashes.</span>
    <span class="c1">// it is recomemdned to check if they are static or should be put into configuration</span>
    <span class="nv">$init512</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="c1">// initial values for SHA512</span>
        <span class="s1">&#39;6a09e667f3bcc908&#39;</span><span class="p">,</span> <span class="s1">&#39;bb67ae8584caa73b&#39;</span><span class="p">,</span> <span class="s1">&#39;3c6ef372fe94f82b&#39;</span><span class="p">,</span> <span class="s1">&#39;a54ff53a5f1d36f1&#39;</span><span class="p">,</span>
    <span class="p">);</span>

    <span class="c1">// strings which are obvious conversion are ignored</span>
    <span class="nv">$decimal</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="s1">&#39;87878877&#39;</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://crackstation.net/hashing-security.htm">Salted Password Hashing - Doing it Right</a> and <a class="reference external" href="https://github.com/s0md3v/Hash-Buster">Hash-Buster</a>.</p>
<div class="section" id="id986">
<h3>9.383.1. Suggestions<a class="headerlink" href="#id986" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Put any hardcoded hash in a configuration file, a database or a environment variable. An external source.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoHardcodedHash</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#shopware-structures-nohardcodedhash"><span class="std std-ref">shopware</span></a>, <a class="reference internal" href="Cases.html#sugarcrm-structures-nohardcodedhash"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-hardcoded-ip">
<span id="id987"></span><h2>9.384. No Hardcoded Ip<a class="headerlink" href="#no-hardcoded-ip" title="Permalink to this headline">¶</a></h2>
<p>Do not leave hard coded IP in your code.</p>
<p>It is recommended to move such configuration in external files or databases, for each update.
This may also come handy when testing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This IPv4 is hardcoded.</span>
<span class="nv">$ip</span> <span class="o">=</span> <span class="s1">&#39;183.207.224.50&#39;</span><span class="p">;</span>
<span class="c1">// This IPv6 is hardcoded.</span>
<span class="nv">$ip</span> <span class="o">=</span> <span class="s1">&#39;2001:0db8:85a3:0000:0000:8a2e:0370:7334&#39;</span><span class="p">;</span>

<span class="c1">// This looks like an IP</span>
<span class="nv">$thisIsNotAnIP</span> <span class="o">=</span> <span class="s1">&#39;213.187.99.50&#39;</span><span class="p">;</span>
<span class="nv">$thisIsNotAnIP</span> <span class="o">=</span> <span class="s1">&#39;2133:1387:9393:5330&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">127.0.0.1</span></code>, <code class="docutils literal notranslate"><span class="pre">\:\:1</span></code> and <code class="docutils literal notranslate"><span class="pre">\:\:0</span></code> are omitted, and not considered as a violation.</p>
<p>See also <a class="reference external" href="https://docs.microsoft.com/en-us/windows/desktop/winsock/use-of-hardcoded-ipv4-addresses-2">Use of Hardcoded IPv4 Addresses</a> and <a class="reference external" href="https://wiki.sei.cmu.edu/confluence/display/java/MSC03-J.+Never+hard+code+sensitive+information">Never hard code sensitive information</a>.</p>
<div class="section" id="id988">
<h3>9.384.1. Suggestions<a class="headerlink" href="#id988" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the hardcoded IP to an external source : environment variable, configuration file, database.</li>
<li>Remove the hardcoded IP and ask for it at execution.</li>
<li>Use a literal value for default messages in form.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoHardcodedIp</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openemr-structures-nohardcodedip"><span class="std std-ref">OpenEMR</span></a>, <a class="reference internal" href="Cases.html#nextcloud-structures-nohardcodedip"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-hardcoded-path">
<span id="id989"></span><h2>9.385. No Hardcoded Path<a class="headerlink" href="#no-hardcoded-path" title="Permalink to this headline">¶</a></h2>
<p>It is not recommended to use hardcoded literals when designating files. Full paths are usually tied to one file system organization. As soon as the organisation changes or must be adapted to any external constraint, the path is not valid anymore.</p>
<p>Either use <a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__FILE__</a> and <a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__DIR__</a> to make the path relative to the current file; use a <code class="docutils literal notranslate"><span class="pre">DOC_ROOT</span></code> as a configuration constant that will allow the moving of the script to another folder; finally functions like <a class="reference external" href="https://www.php.net/sys_get_temp_dir">sys_get_temp_dir()</a> produce a viable temporary folder.</p>
<p>Relative paths are relative to the current execution directory, and not the current file. This means they may differ depending on the location of the start of the application, and are sensitive to <a class="reference external" href="https://www.php.net/chdir">chdir()</a> and <a class="reference external" href="https://www.php.net/chroot">chroot()</a> usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// This depends on the current executed script</span>
    <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;token.txt&#39;</span><span class="p">);</span>

    <span class="c1">// Exotic protocols are ignored</span>
    <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;jackalope://file.txt&#39;</span><span class="p">);</span>

    <span class="c1">// Some protocols are ignored : http, https, ftp, ssh2, php (with memory)</span>
    <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;http://www.php.net/&#39;</span><span class="p">);</span>
    <span class="nb">file_get_contents</span><span class="p">(</span><span class="s1">&#39;php://memory/&#39;</span><span class="p">);</span>

    <span class="c1">// glob() with special chars * and ? are not reported</span>
    <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;./*/foo/bar?.txt&#39;</span><span class="p">);</span>
    <span class="c1">// glob() without special chars * and ? are reported</span>
    <span class="nb">glob</span><span class="p">(</span><span class="s1">&#39;/foo/bar/&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id992">
<h3>9.385.1. Suggestions<a class="headerlink" href="#id992" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add __DIR__ before the path to make it relative to the current file</li>
<li>Add a configured prefix before the path to point to any file in the system</li>
<li>Use sys_get_temp_dir() for temporary data</li>
<li>Use <code class="docutils literal notranslate"><span class="pre">include_path</span></code> argument function, such as fie_get_contents(), to have the file located in configurable directories.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoHardcodedPath</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-hardcoded-path.md">no-hardcoded-path</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-structures-nohardcodedpath"><span class="std std-ref">Tine20</span></a>, <a class="reference internal" href="Cases.html#thelia-structures-nohardcodedpath"><span class="std std-ref">Thelia</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-hardcoded-port">
<span id="id993"></span><h2>9.386. No Hardcoded Port<a class="headerlink" href="#no-hardcoded-port" title="Permalink to this headline">¶</a></h2>
<p>When connecting to a remove server, port is an important information. It is recommended to make this configurable (with constant or configuration), to as to be able to change this value without changing the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// Both configurable IP and hostname</span>
    <span class="nv">$connection</span> <span class="o">=</span> <span class="nb">ssh2_connect</span><span class="p">(</span><span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;SSH_HOST&#39;</span><span class="p">],</span> <span class="nv">$_ENV</span><span class="p">[</span><span class="s1">&#39;SSH_PORT&#39;</span><span class="p">],</span> <span class="nv">$methods</span><span class="p">,</span> <span class="nv">$callbacks</span><span class="p">);</span>

    <span class="c1">// Both hardcoded IP and hostname</span>
    <span class="nv">$connection</span> <span class="o">=</span> <span class="nb">ssh2_connect</span><span class="p">(</span><span class="s1">&#39;shell.example.com&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="nv">$methods</span><span class="p">,</span> <span class="nv">$callbacks</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$connection</span><span class="p">)</span> <span class="k">die</span><span class="p">(</span><span class="s1">&#39;Connection failed&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id994">
<h3>9.386.1. Suggestions<a class="headerlink" href="#id994" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the port to a configuration file, an environment variable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoHardcodedPort</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-structures-nohardcodedport"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-list-with-string">
<span id="id995"></span><h2>9.387. No List With String<a class="headerlink" href="#no-list-with-string" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/list">list()</a> can’t be used anymore to access particular offset in a string. This should be done with <a class="reference external" href="https://www.php.net/substr">substr()</a> or $string[$offset] syntax.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$x</span><span class="p">;</span>

<span class="c1">//list($a, $b, $c) = &#39;abc&#39;; Never works</span>

<span class="k">print</span> <span class="nv">$c</span><span class="p">;</span>
<span class="c1">// PHP 5.6- displays &#39;c&#39;</span>
<span class="c1">// PHP 7.0+ displays nothing</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration70.incompatible.php">PHP 7.0 Backward incompatible changes</a> : <a class="reference external" href="https://www.php.net/list">list()</a> can no longer unpack string variables .</p>
<div class="section" id="id999">
<h3>9.387.1. Suggestions<a class="headerlink" href="#id999" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use str_split() to break a string into bytes</li>
<li>Use substr() or $string[$offset] syntax to access specific bytes in the string</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NoListWithString</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-literal-for-reference">
<span id="id1000"></span><h2>9.388. No Literal For Reference<a class="headerlink" href="#no-literal-for-reference" title="Permalink to this headline">¶</a></h2>
<p>Method arguments and return values may be by reference. Then, they need to be a valid variable.</p>
<p>Objects are always passed by reference, so there is no need to explicitly declare it.</p>
<p>Expressions, including ternary operator, produce value, and can’t be used by reference directly. This is also the case for expression that include one or more reference.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// variables, properties, static properties, array items are all possible</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="c1">//This is not possible, as a literal can&#39;t be a reference</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$int</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$int</span><span class="p">;</span> <span class="p">}</span>


<span class="c1">// This is not a valid reference</span>
<span class="k">function</span> <span class="o">&amp;</span><span class="nf">bar</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="k">function</span> <span class="o">&amp;</span><span class="nf">bar2</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">2</span> <span class="o">+</span> <span class="nv">$r</span><span class="p">;</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Wrongly passing a value as a reference leads to a PHP Notice.</p>
<p>See also <a class="reference external" href="https://www.php.net/references">References</a>.</p>
<div class="section" id="id1001">
<h3>9.388.1. Suggestions<a class="headerlink" href="#id1001" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the reference in the method signature (argument or return value)</li>
<li>Make the argument an object, by using a typehint (non-scalar)</li>
<li>Put the value into a variable prior to call (or return) the method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/NoLiteralForReference</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-magic-method-with-array">
<span id="id1002"></span><h2>9.389. No Magic Method With Array<a class="headerlink" href="#no-magic-method-with-array" title="Permalink to this headline">¶</a></h2>
<p>Magic method <code class="docutils literal notranslate"><span class="pre">__set()</span></code> doesn’t work for array syntax.</p>
<p>When overloading properties, they can only be used for scalar values, excluding arrays. Under the hood, PHP uses <code class="docutils literal notranslate"><span class="pre">__get()</span></code> to reach for the name of the property, and doesn’t recognize the following index as an array. It yields an error : Indirect modification of overloaded property.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">c</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$o</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">o</span><span class="p">[</span><span class="nv">$name</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// property b doesn&#39;t exists</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

        <span class="nb">print_r</span><span class="p">(</span><span class="nv">$this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// This method has no impact on the issue</span>
    <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">o</span><span class="p">[</span><span class="nv">$name</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$c</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">c</span><span class="p">();</span>
<span class="nv">$c</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is possible to use the array syntax with a magic property : by making the <code class="docutils literal notranslate"><span class="pre">__get</span></code> returns an array, the syntax will actually extract the expected item in the array.</p>
<p>This is not reported by linting.</p>
<p>In this analysis, only properties that are found to be magic are reported. For example, using the b property outside the class scope is not reported, as it would yield too many false-positives.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.overloading.php#object.get">Overload</a>.</p>
<div class="section" id="id1003">
<h3>9.389.1. Suggestions<a class="headerlink" href="#id1003" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a distinct method to append a new value to that property</li>
<li>Assign the whole array, and not just one of its elements</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NoMagicWithArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-more-curly-arrays">
<span id="id1004"></span><h2>9.390. No More Curly Arrays<a class="headerlink" href="#no-more-curly-arrays" title="Permalink to this headline">¶</a></h2>
<p>Only use square brackets to access array elements. The usage of curly brackets for array access is deprecated since PHP 7.4.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>

<span class="c1">// always valid</span>
<span class="k">echo</span> <span class="nv">$array</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

<span class="c1">// deprecated in PHP 7.4</span>
<span class="k">echo</span> <span class="nv">$array</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://derickrethans.nl/phpinternalsnews-19.html">Deprecate curly brace syntax</a> and <a class="reference external" href="https://wiki.php.net/rfc/deprecate_curly_braces_array_access">Deprecate curly brace syntax for accessing array elements and string offsets</a>.</p>
<div class="section" id="id1005">
<h3>9.390.1. Suggestions<a class="headerlink" href="#id1005" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use square brackets to access particular index in an array</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NoMoreCurlyArrays</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-need-for-else">
<span id="id1006"></span><h2>9.391. No Need For Else<a class="headerlink" href="#no-need-for-else" title="Permalink to this headline">¶</a></h2>
<p>Else is not needed when the Then ends with a <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a>. A <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> may be the following keywords : <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a>, <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a>, return, goto. Any of these send the execution somewhere in the code. The else block is then executed as the main sequence, only if the condition fails.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Else may be in the main sequence.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Same as above, but negate the condition : if (!$a2) { return $a2; }</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This is OK</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a3</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This has no break</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a4</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$b</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// This has no else</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a5</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://williamdurand.fr/2013/06/03/object-calisthenics/">Object Calisthenics, rule # 2</a>.</p>
<div class="section" id="id1011">
<h3>9.391.1. Suggestions<a class="headerlink" href="#id1011" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove else block, but keep the code</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoNeedForElse</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thelia-structures-noneedforelse"><span class="std std-ref">Thelia</span></a>, <a class="reference internal" href="Cases.html#thinkphp-structures-noneedforelse"><span class="std std-ref">ThinkPHP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-need-for-triple-equal">
<span id="id1012"></span><h2>9.392. No Need For Triple Equal<a class="headerlink" href="#no-need-for-triple-equal" title="Permalink to this headline">¶</a></h2>
<p>There is no need for the identity comparison when the methods returns the proper type.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// foo() returns a string.</span>
<span class="k">if</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span> <span class="o">===</span> <span class="nx">foo</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>


<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1013">
<h3>9.392.1. Suggestions<a class="headerlink" href="#id1013" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoNeedForTriple</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-need-for-get-class">
<span id="id1014"></span><h2>9.393. No Need For get_class()<a class="headerlink" href="#no-need-for-get-class" title="Permalink to this headline">¶</a></h2>
<p>There is no need to call <a class="reference external" href="https://www.php.net/get_class">get_class()</a> to build a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> call. The argument of <a class="reference external" href="https://www.php.net/get_class">get_class()</a> may be used directly.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//</span>
<span class="nv">$a</span><span class="o">-&gt;</span><span class="na">b</span><span class="o">::</span><span class="nv">$c</span>

<span class="c1">// This is too much code</span>
<span class="nb">get_class</span><span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">)</span><span class="o">::</span><span class="nv">$c</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">Scope Resolution Operator (::)</a>.</p>
<div class="section" id="id1019">
<h3>9.393.1. Suggestions<a class="headerlink" href="#id1019" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use get_called_class(), which may carry different class names</li>
<li>Use self, static or parent keywords, if you are already in the current class</li>
<li>Use the argument of get_class() directly</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoNeedGetClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-net-for-xml-load">
<span id="id1020"></span><h2>9.394. No Net For Xml Load<a class="headerlink" href="#no-net-for-xml-load" title="Permalink to this headline">¶</a></h2>
<p>Simplexml and ext/DOM load all external entities from the web, by default. This is dangerous, in particular when loading unknown XML code.</p>
<p>Look at this XML code below : it is valid. It defines an entity <code class="docutils literal notranslate"><span class="pre">xxe</span></code>, that is filled with a file, read on the system and base64 encoded.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&amp;lt;!DOCTYPE replace [&amp;lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=index.php&quot;&amp;gt; ]&amp;gt;
&lt;replace&gt;&amp;xxe;&lt;/replace&gt;
</pre></div>
</div>
<p>This file could be processed with the following code : note, you can replace ‘index.php’ in the above entity by any valid filepath.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$dom</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DOMDocument</span><span class="p">();</span>
    <span class="nv">$dom</span><span class="o">-&gt;</span><span class="na">loadXML</span><span class="p">(</span><span class="nv">$xml</span><span class="p">,</span> <span class="nx">LIBXML_NOENT</span> <span class="o">|</span> <span class="nx">LIBXML_DTDLOAD</span><span class="p">);</span>
    <span class="nv">$info</span> <span class="o">=</span> <span class="nb">simplexml_import_dom</span><span class="p">(</span><span class="nv">$dom</span><span class="p">);</span>

    <span class="k">print</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$info</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Here, PHP tries to load the XML file, finds the entity, then solves the entity by encoding a file called <code class="docutils literal notranslate"><span class="pre">index.php</span></code>. The source code of the file is not used as data in the XML file.</p>
<p>At that point, the example illustrates how a XXE works : by using the XML engine to load external resources, and preprocessing the XML code. in fact, there is only one change to make this XML code arbitrarily injected ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&amp;lt;!DOCTYPE replace [&amp;lt;!ENTITY writer SYSTEM https://www.example.com/entities.dtd&amp;gt; ]&amp;gt;
&lt;replace&gt;&amp;xxe;&lt;/replace&gt;
</pre></div>
</div>
<p>With the above example, the XML code is <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> (as, it never changes), but the ‘xxe’ definitions are loaded from a remove website, and are completely under the attacker control.</p>
<p>See also <a class="reference external" href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection">XML External Entity</a>, <a class="reference external" href="https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing">XML External Entity (XXE) Processing</a> and <a class="reference external" href="https://web-in-security.blogspot.nl/2014/11/detecting-and-exploiting-xxe-in-saml.html">Detecting and exploiting XXE in SAML Interfaces</a>.</p>
<div class="section" id="id1022">
<h3>9.394.1. Suggestions<a class="headerlink" href="#id1022" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Strip out any entity when using external XML</li>
<li>Forbid any network to the XML engine, by configuring the XML engine without network access</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/NoNetForXmlLoad</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-parenthesis-for-language-construct">
<span id="id1023"></span><h2>9.395. No Parenthesis For Language Construct<a class="headerlink" href="#no-parenthesis-for-language-construct" title="Permalink to this headline">¶</a></h2>
<p>Some PHP language constructs, such are <code class="docutils literal notranslate"><span class="pre">include</span></code>, <code class="docutils literal notranslate"><span class="pre">print</span></code>, <code class="docutils literal notranslate"><span class="pre">echo</span></code> don’t need parenthesis. They accept parenthesis, but it is may lead to strange situations.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is an attempt to load &#39;foo.inc&#39;, or kill the script</span>
<span class="k">include</span><span class="p">(</span><span class="s1">&#39;foo.inc&#39;</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">();</span>
<span class="c1">// in fact, this is read by PHP as : include 1</span>
<span class="c1">// include  &#39;foo.inc&#39; or die();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It it better to avoid using parenthesis with <code class="docutils literal notranslate"><span class="pre">echo</span></code>, <code class="docutils literal notranslate"><span class="pre">print</span></code>, <code class="docutils literal notranslate"><span class="pre">return</span></code>, <code class="docutils literal notranslate"><span class="pre">throw</span></code>, <code class="docutils literal notranslate"><span class="pre">yield</span></code>, <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code>, <code class="docutils literal notranslate"><span class="pre">include</span></code>, <code class="docutils literal notranslate"><span class="pre">require</span></code>, <code class="docutils literal notranslate"><span class="pre">include_once</span></code>, <code class="docutils literal notranslate"><span class="pre">require_once</span></code>.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.include.php">include</a>.</p>
<div class="section" id="id1024">
<h3>9.395.1. Suggestions<a class="headerlink" href="#id1024" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove parenthesis</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoParenthesisForLanguageConstruct</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-parenthesis-for-language-construct.md">no-parenthesis-for-language-construct</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpdocumentor-structures-noparenthesisforlanguageconstruct"><span class="std std-ref">Phpdocumentor</span></a>, <a class="reference internal" href="Cases.html#phpmyadmin-structures-noparenthesisforlanguageconstruct"><span class="std std-ref">phpMyAdmin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-plus-one">
<span id="id1025"></span><h2>9.396. No Plus One<a class="headerlink" href="#no-plus-one" title="Permalink to this headline">¶</a></h2>
<p>Incrementing a variable should be done with the ++ or – operators. Any other way, may be avoided.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Best way to increment</span>
<span class="o">++</span><span class="nv">$x</span><span class="p">;</span> <span class="o">--</span><span class="nv">$y</span><span class="p">;</span>

<span class="c1">// Second best way to increment, if the current value is needed :</span>
<span class="k">echo</span> <span class="nv">$x</span><span class="o">++</span><span class="p">,</span> <span class="nv">$y</span><span class="o">--</span><span class="p">;</span>

<span class="c1">// Good but slow</span>
<span class="nv">$x</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$x</span> <span class="o">-=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

<span class="nv">$y</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="nv">$y</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>

<span class="c1">// even slower</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="nv">$x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$y</span> <span class="o">=</span> <span class="nv">$y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PlusEgalOne</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="no-public-access">
<span id="id1026"></span><h2>9.397. No Public Access<a class="headerlink" href="#no-public-access" title="Permalink to this headline">¶</a></h2>
<p>The properties below are declared with public access, but are never used publicly. They can be made protected or private.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>            <span class="c1">// Public, and used in public space</span>
    <span class="k">public</span> <span class="nv">$neverInPublic</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">// Public, but never used in outside the class</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$neverInPublic</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">foo</span><span class="p">();</span>
<span class="nv">$x</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nv">$x</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NoPublicAccess</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="no-real-comparison">
<span id="id1027"></span><h2>9.398. No Real Comparison<a class="headerlink" href="#no-real-comparison" title="Permalink to this headline">¶</a></h2>
<p>Avoid comparing decimal numbers with ==, ===, !==, !=. Real numbers have an error margin which is random, and makes it very difficult to match even if the compared value is a literal.</p>
<p>PHP uses an internal representation in base 2 : any number difficult to represent with this base (like 0.1 or 0.7) will have a margin of error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">7</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">;</span>

<span class="c1">// 7 * $a is a real, not an integer</span>
<span class="nb">var_dump</span><span class="p">(</span> <span class="mi">7</span> <span class="o">*</span> <span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">// rounding error leads to wrong comparison</span>
<span class="nb">var_dump</span><span class="p">(</span> <span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">8</span><span class="p">);</span>
<span class="c1">// although</span>
<span class="nb">var_dump</span><span class="p">(</span> <span class="p">(</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">);</span>
<span class="c1">// displays 8</span>

<span class="c1">// precision formula to use with reals. Adapt 0.0001 to your precision needs</span>
<span class="nb">var_dump</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(((</span><span class="mf">0.1</span> <span class="o">+</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Use precision formulas with <a class="reference external" href="https://www.php.net/abs">abs()</a> to approximate values with a given precision, or avoid reals altogether.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.float.php#language.types.float">Floating point numbers</a>.</p>
<div class="section" id="id1029">
<h3>9.398.1. Suggestions<a class="headerlink" href="#id1029" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Cast the values to integer before comparing</li>
<li>Compute the difference, and keep it below a threshold</li>
<li>Use the gmp or the bc extension to handle high precision numbers</li>
<li>Change the ‘precision’ directive of PHP : ini_set(‘precision’, 30) to make number larger</li>
<li>Multiply by a power of ten, before casting to integer for the comparison</li>
<li>Use floor(), ceil() or round() to compare the numbers, with a specific precision</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/NoRealComparison</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-real-comparison.md">no-real-comparison</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#magento-type-norealcomparison"><span class="std std-ref">Magento</span></a>, <a class="reference internal" href="Cases.html#spip-type-norealcomparison"><span class="std std-ref">SPIP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-reference-for-static-property">
<span id="id1030"></span><h2>9.399. No Reference For Static Property<a class="headerlink" href="#no-reference-for-static-property" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> properties used to behave independently when set to a reference value. This was fixed in PHP 7.3.</p>
<p>According to the PHP 7.3 changelog : <code class="docutils literal notranslate"><span class="pre">In</span> <span class="pre">PHP,</span> <span class="pre">`static</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.static.php&gt;`_</span> <span class="pre">properties</span> <span class="pre">are</span> <span class="pre">shared</span> <span class="pre">between</span> <span class="pre">inheriting</span> <span class="pre">classes,</span> <span class="pre">unless</span> <span class="pre">the</span> <span class="pre">`static</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.static.php&gt;`_</span> <span class="pre">property</span> <span class="pre">is</span> <span class="pre">explicitly</span> <span class="pre">overridden</span> <span class="pre">in</span> <span class="pre">a</span> <span class="pre">child</span> <span class="pre">class.</span> <span class="pre">However,</span> <span class="pre">due</span> <span class="pre">to</span> <span class="pre">an</span> <span class="pre">implementation</span> <span class="pre">artifact</span> <span class="pre">it</span> <span class="pre">was</span> <span class="pre">possible</span> <span class="pre">to</span> <span class="pre">separate</span> <span class="pre">the</span> <span class="pre">`static</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.static.php&gt;`_</span> <span class="pre">properties</span> <span class="pre">by</span> <span class="pre">assigning</span> <span class="pre">a</span> <span class="pre">reference.</span> <span class="pre">This</span> <span class="pre">loophole</span> <span class="pre">has</span> <span class="pre">been</span> <span class="pre">fixed.</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

        <span class="k">class</span> <span class="nc">Test</span> <span class="p">{</span>
            <span class="k">public</span> <span class="k">static</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">class</span> <span class="nc">Test2</span> <span class="k">extends</span> <span class="nx">Test</span> <span class="p">{</span> <span class="p">}</span>

        <span class="nx">Test2</span><span class="o">::</span><span class="nv">$x</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$x</span><span class="p">;</span>
        <span class="nv">$x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="nb">var_dump</span><span class="p">(</span><span class="nx">Test</span><span class="o">::</span><span class="nv">$x</span><span class="p">,</span> <span class="nx">Test2</span><span class="o">::</span><span class="nv">$x</span><span class="p">);</span>
        <span class="c1">// Previously: int(0), int(1)</span>
        <span class="c1">// Now: int(1), int(1)</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://github.com/php/php-src/blob/3b6e1ee4ee05678b5d717cd926a35ffdc1335929/UPGRADING#L66-L81">PHP 7.3 UPGRADE NOTES</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NoReferenceForStaticProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="no-reference-for-ternary">
<span id="id1032"></span><h2>9.400. No Reference For Ternary<a class="headerlink" href="#no-reference-for-ternary" title="Permalink to this headline">¶</a></h2>
<p>The ternary operator and the null coalescing operator are both expressions that only return values, and not a variable.</p>
<p>This means that any provided reference will be turned into its value. While this is usually invisible, it will raise a warning when a reference is expected. This is the case with methods returning a reference.</p>
<p>A PHP notice is generated when using a ternary operator or the null coalesce operator : <code class="docutils literal notranslate"><span class="pre">Only</span> <span class="pre">variable</span> <span class="pre">references</span> <span class="pre">should</span> <span class="pre">be</span> <span class="pre">returned</span> <span class="pre">by</span> <span class="pre">reference</span></code>. The notice is also emitted when returning objects.</p>
<p>This applies to methods, functions and closures.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This works</span>
<span class="k">function</span> <span class="o">&amp;</span><span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// This raises a warning, as the operator returns a value</span>
<span class="k">function</span> <span class="o">&amp;</span><span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$a</span> <span class="o">===</span> <span class="mi">1</span> <span class="o">?</span> <span class="nv">$b</span> <span class="o">:</span> <span class="nv">$a</span><span class="p">;</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.comparison.php#language.operators.comparison.coalesce">Null Coalescing Operator</a>, <a class="reference external" href="https://www.php.net/manual/en/language.operators.comparison.php#language.operators.comparison.ternary">Ternary Operator</a>.</p>
<div class="section" id="id1034">
<h3>9.400.1. Suggestions<a class="headerlink" href="#id1034" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the reference at assignation time</li>
<li>Drop the reference in the argument definition</li>
<li>Drop the reference in the function return definition</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NoReferenceForTernary</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpadsnew-php-noreferenceforternary"><span class="std std-ref">phpadsnew</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-reference-on-left-side">
<span id="id1035"></span><h2>9.401. No Reference On Left Side<a class="headerlink" href="#no-reference-on-left-side" title="Permalink to this headline">¶</a></h2>
<p>Do not use references as the right element in an assignation.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$b</span> <span class="o">+</span> <span class="nv">$c</span><span class="p">;</span>
<span class="c1">// $a === 2 === $b;</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">+</span> <span class="nv">$c</span><span class="p">;</span>
<span class="c1">// $a === 5</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is the case for most situations : addition, multiplication, bitshift, logical, power, concatenation.
Note that PHP won’t compile the code if the operator is a short operator (+=, .=, etc.), nor if the &amp; is on the right side of the operator.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoReferenceOnLeft</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="no-return-for-generator">
<span id="id1036"></span><h2>9.402. No Return For Generator<a class="headerlink" href="#no-return-for-generator" title="Permalink to this headline">¶</a></h2>
<p>Return is not allowed in generator. In PHP versions older than 5.6 and older, they yield a fatal Error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">generatorWithReturn</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.generators.overview.php">Generators overview</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NoReturnForGenerator</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="no-return-or-throw-in-finally">
<span id="id1037"></span><h2>9.403. No Return Or Throw In Finally<a class="headerlink" href="#no-return-or-throw-in-finally" title="Permalink to this headline">¶</a></h2>
<p>Avoid using return and throw in a finally block. Both command will interrupt the processing of the try catch block, and any exception that was emitted will not be processed. This leads to unprocessed exceptions, leaving the application in an unstable state.</p>
<p>Note that PHP prevents the usage of goto, <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> and <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a> within the finally block at linting phase. This is categorized as a Security problem.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// Exception is thrown here</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// This is executed AFTER finally</span>
            <span class="k">return</span> <span class="s1">&#39;Exception&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="c1">// This is executed BEFORE catch</span>
            <span class="k">return</span> <span class="s1">&#39;Finally&#39;</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Displays &#39;Finally&#39;. No exception</span>
<span class="k">echo</span> <span class="nx">foo</span><span class="p">();</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// Exception is thrown here</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">\Exception</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Process the exception.</span>
            <span class="k">return</span> <span class="s1">&#39;Exception&#39;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="c1">// clean the current situation</span>
            <span class="c1">// Keep running the current function</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s1">&#39;Finally&#39;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Displays &#39;Exception&#39;, with processed Exception</span>
<span class="k">echo</span> <span class="nx">bar</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.owasp.org/index.php/Return_Inside_Finally_Block">Return Inside Finally Block</a>.</p>
<div class="section" id="id1040">
<h3>9.403.1. Suggestions<a class="headerlink" href="#id1040" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the return right after the try/catch/finally call</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoReturnInFinally</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-return-used">
<span id="id1041"></span><h2>9.404. No Return Used<a class="headerlink" href="#no-return-used" title="Permalink to this headline">¶</a></h2>
<p>The return value of the following functions are never used. The return argument may be dropped from the code, as it is dead code.</p>
<p>This analysis supports functions and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods, when a definition may be found. It doesn’t support method calls.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="nx">foo</span><span class="p">();</span>
<span class="nx">foo</span><span class="p">();</span>
<span class="nx">foo</span><span class="p">();</span>
<span class="nx">foo</span><span class="p">();</span>
<span class="nx">foo</span><span class="p">();</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// This function doesn&#39;t return anything.</span>
<span class="k">function</span> <span class="nf">foo2</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// The following function are used in an expression, thus the return is important</span>
<span class="k">function</span> <span class="nf">foo3</span><span class="p">()</span> <span class="p">{</span>  <span class="k">return</span> <span class="mi">1</span><span class="p">;}</span>
<span class="k">function</span> <span class="nf">foo4</span><span class="p">()</span> <span class="p">{</span>  <span class="k">return</span> <span class="mi">1</span><span class="p">;}</span>
<span class="k">function</span> <span class="nf">foo5</span><span class="p">()</span> <span class="p">{</span>  <span class="k">return</span> <span class="mi">1</span><span class="p">;}</span>

<span class="nx">foo3</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">foo4</span><span class="p">();</span>
<span class="nx">foo</span><span class="p">(</span><span class="nx">foo5</span><span class="p">());</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1043">
<h3>9.404.1. Suggestions<a class="headerlink" href="#id1043" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the return statement in the function</li>
<li>Actually use the value returned by the method, for test or combination with other values</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/NoReturnUsed</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#spip-functions-noreturnused"><span class="std std-ref">SPIP</span></a>, <a class="reference internal" href="Cases.html#livezilla-functions-noreturnused"><span class="std std-ref">LiveZilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-self-referencing-constant">
<span id="id1044"></span><h2>9.405. No Self Referencing Constant<a class="headerlink" href="#no-self-referencing-constant" title="Permalink to this headline">¶</a></h2>
<p>It is not possible to use a constant to define itself in a class. It yields a fatal error at runtime.</p>
<p>The PHP error reads : <code class="docutils literal notranslate"><span class="pre">Cannot</span> <span class="pre">declare</span> <span class="pre">`self</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php&gt;`_-referencing</span> <span class="pre">constant</span> <span class="pre">'`self</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php&gt;`_\:\:C2'</span></code>. Unlike PHP which is <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a>-referencing, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> referencing variables can’t have a value : just don’t use that.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
        <span class="k">const</span> <span class="no">C1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>         <span class="c1">// fully defined constant</span>
        <span class="k">const</span> <span class="no">C2</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">C2</span><span class="p">;</span>  <span class="c1">// self referencing constant</span>
        <span class="k">const</span> <span class="no">C3</span> <span class="o">=</span> <span class="nx">a</span><span class="o">::</span><span class="na">C3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// self referencing constant</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The code may access an already declared constant with <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> or with its class name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
        <span class="k">const</span> <span class="no">C1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">const</span> <span class="no">C2</span> <span class="o">=</span> <span class="nx">a</span><span class="o">::</span><span class="na">C1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This error is not detected by linting. It is only detected at instantiation time : if the class is not used, it won’t appear.</p>
<div class="section" id="id1048">
<h3>9.405.1. Suggestions<a class="headerlink" href="#id1048" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Give a literal value to this constant</li>
<li>Give a constant value to this constant : other class constants or constant are allowed here.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NoSelfReferencingConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-spread-for-hash">
<span id="id1049"></span><h2>9.406. No Spread For Hash<a class="headerlink" href="#no-spread-for-hash" title="Permalink to this headline">¶</a></h2>
<p>The spread operator <code class="docutils literal notranslate"><span class="pre">...</span></code> only works on integer-indexed arrays.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is valid, as ``-33`` is cast to integer by PHP automagically</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="o">...</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">33</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="c1">// This is not valid</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="o">...</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="nx">C</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list">Variable-length argument lists</a>.</p>
<div class="section" id="id1051">
<h3>9.406.1. Suggestions<a class="headerlink" href="#id1051" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a call to array_values() instead of the hash</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/NoSpreadForHash</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-string-with-append">
<span id="id1052"></span><h2>9.407. No String With Append<a class="headerlink" href="#no-string-with-append" title="Permalink to this headline">¶</a></h2>
<p>PHP 7 doesn’t allow the usage of [] with strings. [] is an array-only operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>

<span class="c1">// Not possible in PHP 7</span>
<span class="nv">$string</span><span class="p">[]</span> <span class="o">=</span> <span class="s1">&#39;d&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This was possible in PHP 5, but is now forbidden in PHP 7.</p>
<div class="section" id="id1053">
<h3>9.407.1. Suggestions<a class="headerlink" href="#id1053" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the concatenation operator <code class="docutils literal notranslate"><span class="pre">.</span></code> to append strings.</li>
<li>Use the concatenation short assignement <code class="docutils literal notranslate"><span class="pre">.=</span></code> to append strings.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NoStringWithAppend</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-substr-minus-one">
<span id="id1054"></span><h2>9.408. No Substr Minus One<a class="headerlink" href="#no-substr-minus-one" title="Permalink to this headline">¶</a></h2>
<p>Negative index were introduced in PHP 7.1. This syntax is not compatible with PHP 7.0 and older.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">;</span>

<span class="k">echo</span> <span class="nv">$string</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// c</span>

<span class="k">echo</span> <span class="nv">$string</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// a</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/negative-string-offsets">Generalize support of negative string offsets</a>.</p>
<div class="section" id="id1055">
<h3>9.408.1. Suggestions<a class="headerlink" href="#id1055" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the -1 index in a string, instead of a call to substr()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NoSubstrMinusOne</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-weak-ssl-crypto">
<span id="id1056"></span><h2>9.409. No Weak SSL Crypto<a class="headerlink" href="#no-weak-ssl-crypto" title="Permalink to this headline">¶</a></h2>
<p>When enabling PHP’s stream SSL, it is important to use a safe protocol.</p>
<p>All the SSL protocols (1.0, 2.0, 3.0), and TLS (1.0 are unsafe. The best is to use the most recent TLS, version 1.2.</p>
<p>stream_socket_enable_crypto() and <a class="reference external" href="https://www.php.net/curl_setopt">curl_setopt()</a> are checked.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This socket will use SSL v2, which</span>
<span class="nv">$socket</span> <span class="o">=</span> <span class="s1">&#39;sslv2://www.example.com&#39;</span><span class="p">;</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fsockopen</span><span class="p">(</span><span class="nv">$socket</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="nv">$errno</span><span class="p">,</span> <span class="nv">$errstr</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Using the TLS transport protocol of PHP will choose the version by itself.</p>
<p>See also <a class="reference external" href="https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/insecure-transportation-security-protocol-supported-tls-10/">Insecure Transportation Security Protocol Supported (TLS 1.0)</a>, <a class="reference external" href="https://paragonie.com/blog/2017/12/2018-guide-building-secure-php-software">The 2018 Guide to Building Secure PHP Software</a> and <a class="reference external" href="https://www.php.net/manual/en/transports.inet.php">Internet Domain: TCP, UDP, SSL, and TLS</a>.</p>
<div class="section" id="id1057">
<h3>9.409.1. Suggestions<a class="headerlink" href="#id1057" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use TLS transport, with version 1.2</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/NoWeakSSLCrypto</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-array-merge-in-loops">
<span id="id1058"></span><h2>9.410. No array_merge() In Loops<a class="headerlink" href="#no-array-merge-in-loops" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/array_merge">array_merge()</a> is memory intensive : every call will duplicate the arguments in memory, before merging them.</p>
<p>To handle arrays that may be quite big, it is recommended to avoid using <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a> in a loop. Instead, one should use <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a> with as many arguments as possible, making the merge a on time call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// A large multidimensional array</span>
<span class="nv">$source</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">],</span>
           <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="cm">/*...*/</span><span class="p">],</span>
           <span class="cm">/*...*/</span>
           <span class="p">];</span>

<span class="c1">// Faster way</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$source</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$values</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Collect in an array</span>
    <span class="nv">$b</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$values</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// One call to array_merge</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">call_user_func_array</span><span class="p">(</span><span class="s1">&#39;array_merge&#39;</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>
<span class="c1">// or with variadic</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">call_user_func</span><span class="p">(</span><span class="s1">&#39;array_merge&#39;</span><span class="p">,</span> <span class="o">..</span><span class="nv">$b</span><span class="p">);</span>

<span class="c1">// Fastest way (with above example, without checking nor data pulling)</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">call_user_func_array</span><span class="p">(</span><span class="s1">&#39;array_merge&#39;</span><span class="p">,</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$source</span><span class="p">))</span>
<span class="c1">// or</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">call_user_func</span><span class="p">(</span><span class="s1">&#39;array_merge&#39;</span><span class="p">,</span> <span class="o">...</span><span class="nb">array_values</span><span class="p">(</span><span class="nv">$source</span><span class="p">))</span>

<span class="c1">// Slow way to merge it all</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$source</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$values</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$values</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that <a class="reference external" href="https://www.php.net/array_merge_recursive">array_merge_recursive()</a> and <a class="reference external" href="https://www.php.net/file_put_contents">file_put_contents()</a> are affected and reported the same way.</p>
<div class="section" id="id1062">
<h3>9.410.1. Suggestions<a class="headerlink" href="#id1062" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Store all intermediate arrays in a temporary variable, and use array_merge() once, with ellipsis or call_user_func_array().</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/ArrayMergeInLoops</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-array_merge-in-loop.md">no-array_merge-in-loop</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-performances-arraymergeinloops"><span class="std std-ref">Tine20</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-get-class-with-null">
<span id="id1063"></span><h2>9.411. No get_class() With Null<a class="headerlink" href="#no-get-class-with-null" title="Permalink to this headline">¶</a></h2>
<p>It is not possible to pass explicitly null to <a class="reference external" href="https://www.php.net/get_class">get_class()</a> to get the current’s class name. Since PHP 7.2, one must call <a class="reference external" href="https://www.php.net/get_class">get_class()</a> without arguments to achieve that result.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
  <span class="k">public</span> <span class="k">function</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Gets the classname</span>
    <span class="nv">$classname</span> <span class="o">=</span> <span class="nb">get_class</span><span class="p">();</span>

    <span class="c1">// Gets the classname and a warning</span>
    <span class="nv">$classname</span> <span class="o">=</span> <span class="nb">get_class</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>
<span class="nv">$a</span><span class="o">-&gt;</span><span class="na">f</span><span class="p">(</span><span class="s1">&#39;get_class&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoGetClassNull</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="no-isset-with-empty">
<span id="id1066"></span><h2>9.412. No isset() With empty()<a class="headerlink" href="#no-isset-with-empty" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/empty">empty()</a> actually does the job of <a class="reference external" href="https://www.www.php.net/isset">isset()</a> too.</p>
<p>From the manual : <code class="docutils literal notranslate"><span class="pre">No</span> <span class="pre">warning</span> <span class="pre">is</span> <span class="pre">generated</span> <span class="pre">if</span> <span class="pre">the</span> <span class="pre">variable</span> <span class="pre">does</span> <span class="pre">not</span> <span class="pre">exist.</span> <span class="pre">That</span> <span class="pre">means</span> <span class="pre">`empty()</span> <span class="pre">&lt;https://www.php.net/empty&gt;`_</span> <span class="pre">is</span> <span class="pre">essentially</span> <span class="pre">the</span> <span class="pre">concise</span> <span class="pre">equivalent</span> <span class="pre">to</span> <span class="pre">!`isset(</span> <span class="pre">&lt;https://www.www.php.net/isset&gt;`_$var)</span> <span class="pre">||</span> <span class="pre">$var</span> <span class="pre">==</span> <span class="pre">false.</span></code> The main difference is that <a class="reference external" href="https://www.www.php.net/isset">isset()</a> only works with variables, while <a class="reference external" href="https://www.php.net/empty">empty()</a> works with other structures, such as constants.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>


<span class="c1">// Enough validation</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// Too many tests</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.www.php.net/isset">Isset &lt;http://www.php.net/`isset</a>&gt;`_ and <a class="reference external" href="http://www.php.net/empty">empty</a>.</p>
<div class="section" id="id1073">
<h3>9.412.1. Suggestions<a class="headerlink" href="#id1073" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Only use isset(), just drop the empty()</li>
<li>Only use empty(), just drop the empty()</li>
<li>Use a null value, so the variable is always set</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoIssetWithEmpty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xoops-structures-noissetwithempty"><span class="std std-ref">XOOPS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="no-mb-substr-in-loop">
<span id="id1074"></span><h2>9.413. No mb_substr In Loop<a class="headerlink" href="#no-mb-substr-in-loop" title="Permalink to this headline">¶</a></h2>
<p>Do not use loops on <a class="reference external" href="https://www.php.net/mb_substr">mb_substr()</a>.</p>
<p><a class="reference external" href="https://www.php.net/mb_substr">mb_substr()</a> always starts at the beginning of the string ot search for the nth char, and recalculate everything. This means that the first iterations are as fast as <a class="reference external" href="https://www.php.net/substr">substr()</a> (for comparison), while the longer the string, the slower <a class="reference external" href="https://www.php.net/mb_substr">mb_substr()</a>.</p>
<p>The recommendation is to use <a class="reference external" href="https://www.php.net/preg_split">preg_split()</a> with the <cite>u</cite> option, to split the string into an array. This save multiple recalculations.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Split the string by characters</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">preg_split</span><span class="p">(</span><span class="s1">&#39;//u&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">PREG_SPLIT_NO_EMPTY</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Slow version</span>
<span class="nv">$nb</span> <span class="o">=</span> <span class="nb">mb_strlen</span><span class="p">(</span><span class="nv">$mb</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$nb</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Fetch a character</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="nb">mb_substr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://mike42.me/blog/2018-06-how-i-made-my-php-code-run-100-times-faster">Optimization: How I made my PHP code run 100 times faster</a> and <a class="reference external" href="https://stackoverflow.com/questions/3666306/how-to-iterate-utf-8-string-in-php">How to iterate UTF-8 string in PHP?</a>.</p>
<div class="section" id="id1079">
<h3>9.413.1. Suggestions<a class="headerlink" href="#id1079" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use preg_split() and loop on its results.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/MbStringInLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="non-ascii-variables">
<span id="id1080"></span><h2>9.414. Non Ascii Variables<a class="headerlink" href="#non-ascii-variables" title="Permalink to this headline">¶</a></h2>
<p>PHP allows certain characters in variable names. The variable name must only include letters, figures, underscores and ASCII characters from 128 to 255.</p>
<p>In practice, letters outside the scope of <code class="docutils literal notranslate"><span class="pre">a-zA-Z0-9</span></code> are rare, and require more care when editing the code or passing it from OS to OS.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">人</span> <span class="p">{</span>
    <span class="c1">// An actual working class in PHP.</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="no">__CLASS__</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$人民</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">人</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.variables.basics.php">Variables</a>.</p>
<div class="section" id="id1081">
<h3>9.414.1. Suggestions<a class="headerlink" href="#id1081" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make sure those special chars have actual meaning.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/VariableNonascii</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#magento-variables-variablenonascii"><span class="std std-ref">Magento</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="non-nullable-getters">
<span id="id1082"></span><h2>9.415. Non Nullable Getters<a class="headerlink" href="#non-nullable-getters" title="Permalink to this headline">¶</a></h2>
<p>A getter needs to be nullable when a property is injected.</p>
<p>In particular, if the injection happens with a separate method, there is a time where the object is not consistent, and the property holds a default non-object value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Consistent</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$db</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">Db</span> <span class="nv">$db</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span> <span class="o">=</span> <span class="nv">$db</span><span class="p">;</span>
        <span class="c1">// Object is immediately consistent</span>
    <span class="p">}</span>

    <span class="c1">// Db might be null</span>
    <span class="k">function</span> <span class="nf">getDb</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Inconsistent</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$db</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// No initialisation</span>
    <span class="p">}</span>

    <span class="c1">// This might be called on time, or not</span>
    <span class="c1">// This typehint cannot be nullable, nor use null as default</span>
    <span class="k">function</span> <span class="nf">setDb</span><span class="p">(</span><span class="nx">DB</span> <span class="nv">$db</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Db might be null</span>
    <span class="k">function</span> <span class="nf">getDb</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">db</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1083">
<h3>9.415.1. Suggestions<a class="headerlink" href="#id1083" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the nullable option and the tests on <code class="docutils literal notranslate"><span class="pre">null</span></code>.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NonNullableSetters</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="non-static-methods-called-in-a-static">
<span id="id1084"></span><h2>9.416. Non Static Methods Called In A Static<a class="headerlink" href="#non-static-methods-called-in-a-static" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> methods have to be declared as such (using the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> keyword). Then, one may call them without instantiating the object.</p>
<p>PHP 7.0, and more recent versions, yield a deprecated error : <code class="docutils literal notranslate"><span class="pre">Non-`static</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.static.php&gt;`_</span> <span class="pre">method</span> <span class="pre">A\:\:B()</span> <span class="pre">should</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">called</span> <span class="pre">statically</span></code>.</p>
<p>PHP 5 and older doesn’t check that a method is <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> or not : at any point, the code may call one method statically.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
        <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">sm</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="no">__METHOD__</span><span class="o">.</span><span class="nx">\n</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">public</span> <span class="k">public</span> <span class="nx">sm</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="no">__METHOD__</span><span class="o">.</span><span class="nx">\n</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">x</span><span class="o">::</span><span class="na">sm</span><span class="p">(</span> <span class="p">);</span> <span class="c1">// echo x::sm</span>

    <span class="c1">// Dynamic call</span>
    <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;sm&#39;</span><span class="p">]();</span>
    <span class="p">[</span><span class="nx">\x</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;sm&#39;</span><span class="p">]();</span>

    <span class="nv">$s</span> <span class="o">=</span> <span class="s1">&#39;x::sm&#39;</span><span class="p">;</span>
    <span class="nv">$s</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is a bad idea to call non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method statically. Such method may make use of special
variable <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a>, which will be undefined. PHP will not check those calls at compile time,
nor at running time.</p>
<p>It is recommended to update this situation : make the method actually <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>, or use it only
in object context.</p>
<p>Note that this analysis reports all <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method call made on a non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method,
even within the same class or class hierarchy. PHP silently accepts <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> call to any
in-family method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span> <span class="nx">self</span><span class="o">::</span><span class="na">bar</span><span class="p">()</span> <span class="p">}</span>
        <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="no">__METHOD__</span><span class="o">.</span><span class="nx">\n</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static Keyword &lt;https://www.php.net/manual/en/language.oop5.`static</a>.php&gt;`_.</p>
<div class="section" id="id1095">
<h3>9.416.1. Suggestions<a class="headerlink" href="#id1095" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Call the method the correct way</li>
<li>Define the method as static</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="92%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NonStaticMethodsCalledStatic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-classes-nonstaticmethodscalledstatic"><span class="std std-ref">Dolphin</span></a>, <a class="reference internal" href="Cases.html#magento-classes-nonstaticmethodscalledstatic"><span class="std std-ref">Magento</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="non-constant-index-in-array">
<span id="id1096"></span><h2>9.417. Non-constant Index In Array<a class="headerlink" href="#non-constant-index-in-array" title="Permalink to this headline">¶</a></h2>
<p>Undefined constants revert as strings in Arrays. They are also called <code class="docutils literal notranslate"><span class="pre">barewords</span></code>.</p>
<p>In <code class="docutils literal notranslate"><span class="pre">$array[index]</span></code>, PHP cannot find index as a constant, but, as a default behavior, turns it into the string <code class="docutils literal notranslate"><span class="pre">index</span></code>.</p>
<p>This default behavior raise concerns when a corresponding constant is defined, either using <a class="reference external" href="https://www.php.net/define">define()</a> or the const keyword (outside a class). The definition of the index constant will modify the behavior of the index, as it will now use the constant definition, and not the ‘index’ string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// assign 1 to the element index in $array</span>
<span class="c1">// index will fallback to string</span>
<span class="nv">$array</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">//PHP Notice:  Use of undefined constant index - assumed &#39;index&#39;</span>

<span class="k">echo</span> <span class="nv">$array</span><span class="p">[</span><span class="nx">index</span><span class="p">];</span>      <span class="c1">// display 1 and the above error</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$array[index]</span><span class="s2">&quot;</span><span class="p">;</span>    <span class="c1">// display 1</span>
<span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$array[&#39;index&#39;]</span><span class="s2">&quot;</span><span class="p">;</span>  <span class="c1">// Syntax error</span>


<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

 <span class="c1">// now 1 to the element 2 in $array</span>
 <span class="nv">$array</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to make index a real string (with ‘ or “), or to define the corresponding constant to avoid any future surprise.</p>
<p>Note that PHP 7.2 removes the support for this feature.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/deprecate-bareword-strings">PHP RFC: Deprecate and Remove Bareword (Unquoted) Strings</a> and <a class="reference external" href="https://www.php.net/manual/en/language.constants.syntax.php">Syntax</a>.</p>
<div class="section" id="id1098">
<h3>9.417.1. Suggestions<a class="headerlink" href="#id1098" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Declare the constant to give it an actual value</li>
<li>Turn the constant name into a string</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/NonConstantArray</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-arrays-nonconstantarray"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#zencart-arrays-nonconstantarray"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="non-lowercase-keywords">
<span id="id1099"></span><h2>9.418. Non-lowercase Keywords<a class="headerlink" href="#non-lowercase-keywords" title="Permalink to this headline">¶</a></h2>
<p>The usual convention is to write PHP keywords (like <code class="docutils literal notranslate"><span class="pre">as</span></code>, <code class="docutils literal notranslate"><span class="pre">foreach</span></code>, <code class="docutils literal notranslate"><span class="pre">switch</span></code>, <code class="docutils literal notranslate"><span class="pre">case</span></code>, <code class="docutils literal notranslate"><span class="pre">break</span></code>, etc.) all in lowercase.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// usual PHP convention</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$element</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// unusual PHP conventions</span>
<span class="k">Foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">AS</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">eCHo</span> <span class="nv">$element</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>PHP understands them in lowercase, UPPERCASE or WilD Case, so there is nothing compulsory here. Although, it will look strange to many.</p>
<p>Some keywords are missing from this analysis : <code class="docutils literal notranslate"><span class="pre">extends</span></code>, <code class="docutils literal notranslate"><span class="pre">implements</span></code>, <code class="docutils literal notranslate"><span class="pre">as</span></code>. This is due to the internal engine, which doesn’t keep track of them in its AST representation.</p>
<div class="section" id="id1100">
<h3>9.418.1. Suggestions<a class="headerlink" href="#id1100" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use lowercase only PHP keywords, except for constants such as __CLASS__.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UpperCaseKeyword</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="not-a-scalar-type">
<span id="id1101"></span><h2>9.419. Not A Scalar Type<a class="headerlink" href="#not-a-scalar-type" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">int</span></code> is the actual PHP scalar type, not <code class="docutils literal notranslate"><span class="pre">integer</span></code>.</p>
<p>PHP 7 introduced several scalar types, in particular <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">bool</span></code> and <code class="docutils literal notranslate"><span class="pre">float</span></code>. Those three types are easily mistaken with <code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">boolean</span></code>, <code class="docutils literal notranslate"><span class="pre">real</span></code> and <code class="docutils literal notranslate"><span class="pre">double</span></code>.</p>
<p>Unless those classes actually exists, PHP emits some strange error messages.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This expects a scalar of type &#39;integer&#39;</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// This expects a object of class &#39;integer&#39;</span>
<span class="k">function</span> <span class="nf">abr</span><span class="p">(</span><span class="nx">integer</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Thanks to <code class="docutils literal notranslate"><span class="pre">Benoit</span> <span class="pre">Viguier</span></code> for the <a class="reference external" href="https://twitter.com/b_viguier/status/940173951908700161">original idea</a> for this analysis.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">Type declarations</a>.</p>
<div class="section" id="id1103">
<h3>9.419.1. Suggestions<a class="headerlink" href="#id1103" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do not use <code class="docutils literal notranslate"><span class="pre">int</span></code> as a class name, an interface name or a trait name.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/NotScalarType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="not-equal-is-not">
<span id="id1104"></span><h2>9.420. Not Equal Is Not !==<a class="headerlink" href="#not-equal-is-not" title="Permalink to this headline">¶</a></h2>
<p>Not and Equal operators, used separately, don’t amount to the different operator <code class="docutils literal notranslate"><span class="pre">!==</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">!$a</span> <span class="pre">==</span> <span class="pre">$b</span></code> first turns <code class="docutils literal notranslate"><span class="pre">$a``into</span> <span class="pre">the</span> <span class="pre">opposite</span> <span class="pre">boolean,</span> <span class="pre">then</span> <span class="pre">compares</span> <span class="pre">this</span> <span class="pre">boolean</span> <span class="pre">value</span> <span class="pre">to</span> <span class="pre">``$b</span></code>. On the other hand, <code class="docutils literal notranslate"><span class="pre">$a</span> <span class="pre">!==</span> <span class="pre">$b</span></code> compares the two variables for type and value, and returns a boolean.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$string</span> <span class="o">!=</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="c1">// Here, string will be an boolean, leading</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$string</span> <span class="o">==</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="c1">// operator priority may be confusing</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$object</span> <span class="nx">instanceof</span> <span class="nx">OneClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> operator may be use with this syntax, due to operator precedence.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operator Precedence</a>.</p>
<div class="section" id="id1106">
<h3>9.420.1. Suggestions<a class="headerlink" href="#id1106" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the != or !==</li>
<li>Use parenthesis</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NotEqual</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="not-not">
<span id="id1107"></span><h2>9.421. Not Not<a class="headerlink" href="#not-not" title="Permalink to this headline">¶</a></h2>
<p>Double not makes a boolean, not a <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>This is a wrong casting to boolean. PHP supports <code class="docutils literal notranslate"><span class="pre">(boolean)</span></code> to do the same, faster and cleaner.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// Explicit code</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boolean</span><span class="p">)</span> <span class="nv">$x</span><span class="p">;</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="nv">$x</span><span class="p">;</span>

    <span class="c1">// Wrong type casting</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="o">!!</span><span class="nv">$x</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.logical.php">Logical Operators</a> and <a class="reference external" href="https://www.php.net/manual/en/language.types.type-juggling.php">Type Juggling</a>.</p>
<div class="section" id="id1110">
<h3>9.421.1. Suggestions<a class="headerlink" href="#id1110" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use <code class="docutils literal notranslate"><span class="pre">(bool)</span></code> casting operator for that</li>
<li>Don’t typecast, and let PHP handle it. This works in situations where the boolean is immediately used.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NotNot</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-implied-cast.md">no-implied-cast</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#cleverstyle-structures-notnot"><span class="std std-ref">Cleverstyle</span></a>, <a class="reference internal" href="Cases.html#tine20-structures-notnot"><span class="std std-ref">Tine20</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="null-on-new">
<span id="id1111"></span><h2>9.422. Null On New<a class="headerlink" href="#null-on-new" title="Permalink to this headline">¶</a></h2>
<p>Until PHP 7, some classes instantiation could yield null, instead of throwing an exception.</p>
<p>After issuing a ‘new’ with those classes, it was important to check if the returned object were null or not. No exception were thrown.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Example extracted from the wiki below</span>
<span class="nv">$mf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageFormatter</span><span class="p">(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;{this was made intentionally incorrect}&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$mf</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;Surprise!&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This inconsistency has been cleaned in PHP 7 : see See <a class="reference external" href="https://wiki.php.net/rfc/internal_constructor_behaviour">Internal Constructor Behavior</a></p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/internal_constructor_behaviour">PHP RFC: Constructor behaviour of internal classes</a>.</p>
<div class="section" id="id1112">
<h3>9.422.1. Suggestions<a class="headerlink" href="#id1112" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the check on null after a new instantiation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NullOnNew</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="null-or-boolean-arrays">
<span id="id1113"></span><h2>9.423. Null Or Boolean Arrays<a class="headerlink" href="#null-or-boolean-arrays" title="Permalink to this headline">¶</a></h2>
<p>Null and booleans are valid PHP array base. Yet, they only produces <code class="docutils literal notranslate"><span class="pre">null</span></code> values. They also did not emits any warning until PHP 7.4.</p>
<p>This analysis has been upgraded to cover int and float types too.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// outputs NULL</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="k">null</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="k">const</span> <span class="no">MY_CONSTANT</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="c1">// outputs NULL</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nx">MY_CONSTANT</span><span class="p">[</span><span class="mi">10</span><span class="p">]);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://twitter.com/Chemaclass/status/1144588647464951808">Null and True</a>.</p>
<div class="section" id="id1114">
<h3>9.423.1. Suggestions<a class="headerlink" href="#id1114" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using the array syntax on null and boolean</li>
<li>Avoid using null and boolean on constant that are expecting arrays</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/NullBoolean</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="nullable-with-constant">
<span id="id1115"></span><h2>9.424. Nullable With Constant<a class="headerlink" href="#nullable-with-constant" title="Permalink to this headline">¶</a></h2>
<p>Arguments are automatically nullable with a literal null. They used to also be nullable with a constant null, before PHP 8.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Extracted from https://github.com/php/php-src/blob/master/UPGRADING</span>

<span class="c1">// Replace</span>
<span class="k">function</span> <span class="nf">test</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$arg</span> <span class="o">=</span> <span class="nx">CONST_RESOLVING_TO_NULL</span><span class="p">)</span> <span class="p">{}</span>
<span class="c1">// With</span>
<span class="k">function</span> <span class="nf">test</span><span class="p">(</span><span class="o">?</span><span class="nx">int</span> <span class="nv">$arg</span> <span class="o">=</span> <span class="nx">CONST_RESOLVING_TO_NULL</span><span class="p">)</span> <span class="p">{}</span>
<span class="c1">// Or</span>
<span class="k">function</span> <span class="nf">test</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$arg</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1116">
<h3>9.424.1. Suggestions<a class="headerlink" href="#id1116" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the valid syntax</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/NullableWithConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="nullable-without-check">
<span id="id1117"></span><h2>9.425. Nullable Without Check<a class="headerlink" href="#nullable-without-check" title="Permalink to this headline">¶</a></h2>
<p>Nullable typehinted argument should be checked before usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This will emit a fatal error when $a = null</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">?</span><span class="nx">A</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">m</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// This is stable</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">?</span><span class="nx">A</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">42</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">m</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1118">
<h3>9.425.1. Suggestions<a class="headerlink" href="#id1118" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/NullableWithoutCheck</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="numeric-literal-separator">
<span id="id1119"></span><h2>9.426. Numeric Literal Separator<a class="headerlink" href="#numeric-literal-separator" title="Permalink to this headline">¶</a></h2>
<p>Integer and floats may be written with internal underscores. This way, it is possible to separate large number into smaller groups, and make them more readable.</p>
<p>Numeric Literal Separators were introduced in PHP 7.4 and are not backward compatible.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="nx">_000_000_000</span><span class="p">;</span>   <span class="c1">// A billion</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1000000000</span><span class="p">;</span>      <span class="c1">// A billion too...</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="mi">107</span><span class="nx">_925_284</span><span class="o">.</span><span class="mi">88</span><span class="p">;</span><span class="nx">‬</span> <span class="c1">// 6 light minute to kilometers = 107925284.88 kilometers</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mf">107925284.88</span><span class="p">;</span><span class="nx">‬</span>   <span class="c1">// Same as above</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/numeric_literal_separator">PHP RFC: Numeric Literal Separator</a>.</p>
<div class="section" id="id1120">
<h3>9.426.1. Suggestions<a class="headerlink" href="#id1120" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/IntegerSeparatorUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="objects-don-t-need-references">
<span id="id1121"></span><h2>9.427. Objects Don’t Need References<a class="headerlink" href="#objects-don-t-need-references" title="Permalink to this headline">¶</a></h2>
<p>There is no need to create references for objects, as those are always passed by reference when used as arguments.</p>
<p>Note that when the argument is assigned another value, including another object, then the reference is needed : PHP forgets about reference when they are replaced.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">();</span>
    <span class="nv">$object</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>

    <span class="nx">foo</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>
    <span class="k">print</span> <span class="nv">$object</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span> <span class="c1">// Name is &#39;b&#39;</span>

    <span class="c1">// No need to make $o a reference</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$o</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="c1">// $o is assigned inside the function : it must be called with a &amp;, or the object won&#39;t make it out of the foo3 scope</span>
    <span class="k">function</span> <span class="nf">foo3</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$o</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="k">stdClass</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$o</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// No need to make this a reference</span>
        <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;c&#39;</span><span class="p">;</span>
    <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.references.pass.php">Passing by reference</a>.</p>
<div class="section" id="id1122">
<h3>9.427.1. Suggestions<a class="headerlink" href="#id1122" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the reference</li>
<li>Assign the argument with a new value</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ObjectReferences</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-references-on-objects.md">no-references-on-objects</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-structures-objectreferences"><span class="std std-ref">Zencart</span></a>, <a class="reference internal" href="Cases.html#xoops-structures-objectreferences"><span class="std std-ref">XOOPS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="old-style-constructor">
<span id="id1123"></span><h2>9.428. Old Style Constructor<a class="headerlink" href="#old-style-constructor" title="Permalink to this headline">¶</a></h2>
<p>PHP classes used to have the method bearing the same name as the class acts as the constructor. That was PHP 4, and early PHP 5.</p>
<p>The manual issues a warning about this syntax : <code class="docutils literal notranslate"><span class="pre">Old</span> <span class="pre">style</span> <span class="pre">constructors</span> <span class="pre">are</span> <span class="pre">DEPRECATED</span> <span class="pre">in</span> <span class="pre">PHP</span> <span class="pre">7.0,</span> <span class="pre">and</span> <span class="pre">will</span> <span class="pre">be</span> <span class="pre">removed</span> <span class="pre">in</span> <span class="pre">a</span> <span class="pre">future</span> <span class="pre">version.</span> <span class="pre">You</span> <span class="pre">should</span> <span class="pre">always</span> <span class="pre">use</span> <span class="pre">`__construct()</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.decon.php&gt;`_</span> <span class="pre">in</span> <span class="pre">new</span> <span class="pre">code.</span></code></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="p">{</span>
    <span class="c1">// Global namespace is important</span>
    <span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
        <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// This acts as the old-style constructor, and is reported by PHP</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="nc">bar</span> <span class="p">{</span>
        <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
        <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// This doesn&#39;t act as constructor, as bar has a __construct() method</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">Foo\Bar</span><span class="p">{</span>
    <span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
        <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// This doesn&#39;t act as constructor, as bar is not in the global namespace</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is no more the case in PHP 5, which relies on <code class="docutils literal notranslate"><span class="pre">__construct()</span></code> to do so. Having this old style constructor may bring in confusion, unless you are also supporting old time PHP 4.</p>
<p>Note that classes with methods bearing the class name, but inside a namespace are not following this convention, as this is not breaking backward compatibility. Those are excluded from the analyze.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.decon.php">Constructors and Destructors</a>.</p>
<div class="section" id="id1124">
<h3>9.428.1. Suggestions<a class="headerlink" href="#id1124" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove old style constructor and make it <code class="docutils literal notranslate"><span class="pre">__construct()</span></code></li>
<li>Remove old libraries and use a modern component</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/OldStyleConstructor</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-php4-class-syntax.md">no-php4-class-syntax</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="old-style-autoload">
<span id="id1125"></span><h2>9.429. Old Style __autoload()<a class="headerlink" href="#old-style-autoload" title="Permalink to this headline">¶</a></h2>
<p>Avoid __autoload(), only use spl_register_autoload().</p>
<p>__autoload() is deprecated since PHP 7.2 and possibly removed in later versions. spl_register_autoload() was introduced in PHP 5.1.0.</p>
<p>__autoload() may only be declared once, and cannot be modified later. This creates potential conflicts between libraries that try to set up their own autoloading schema.</p>
<p>On the other hand, spl_register_autoload() allows registering and de-registering multiple autoloading functions or methods.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Modern autoloading.</span>
<span class="k">function</span> <span class="nf">myAutoload</span><span class="p">(</span><span class="nv">$class</span><span class="p">){}</span>
<span class="nx">spl_register_autoload</span><span class="p">(</span><span class="s1">&#39;myAutoload&#39;</span><span class="p">);</span>

<span class="c1">// Old style autoloading.</span>
<span class="k">function</span> <span class="nf">__autoload</span><span class="p">(</span><span class="nv">$class</span><span class="p">){}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Do not use the old __autoload() function, but rather the new spl_register_autoload() function.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.autoload.php">Autoloading Classe</a>.</p>
<div class="section" id="id1126">
<h3>9.429.1. Suggestions<a class="headerlink" href="#id1126" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move to spl_register_autoload()</li>
<li>Remove usage of the old __autoload() function</li>
<li>Modernize usage of old libraries</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/oldAutoloadUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/use-smart-autoload.md">use-smart-autoload</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#piwigo-php-oldautoloadusage"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="one-if-is-sufficient">
<span id="id1127"></span><h2>9.430. One If Is Sufficient<a class="headerlink" href="#one-if-is-sufficient" title="Permalink to this headline">¶</a></h2>
<p>Nested conditions may be written another way, and reduce the amount of code.</p>
<p>Nested conditions are equivalent to a <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> condition. As such, they may be switched. When one of the condition has no explicit else, then it is lighter to write it as the first condition. This way, it is written once, and not repeated.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Less conditions are written here.</span>
     <span class="k">if</span><span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
             <span class="o">++</span><span class="nv">$c</span><span class="p">;</span>
     <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
             <span class="o">++</span><span class="nv">$d</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="p">}</span>

<span class="c1">// ($b == 2) is double here</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
             <span class="o">++</span><span class="nv">$c</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
     <span class="k">if</span><span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
             <span class="o">++</span><span class="nv">$d</span><span class="p">;</span>
     <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1128">
<h3>9.430.1. Suggestions<a class="headerlink" href="#id1128" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Switch the if…then conditions, to reduce the amount of conditions to read.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/OneIfIsSufficient</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tikiwiki-structures-oneifissufficient"><span class="std std-ref">Tikiwiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="one-letter-functions">
<span id="id1129"></span><h2>9.431. One Letter Functions<a class="headerlink" href="#one-letter-functions" title="Permalink to this headline">¶</a></h2>
<p>One letter functions seems to be really short for a meaningful name. This may happens for very high usage functions, so as to keep code short, but such functions should be rare.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Always use a meaningful name</span>
<span class="k">function</span> <span class="nf">addition</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// One letter functions are rarely meaningful</span>
<span class="k">function</span> <span class="nf">f</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1130">
<h3>9.431.1. Suggestions<a class="headerlink" href="#id1130" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use full names for functions</li>
<li>Remove the function name altogether : use a closure</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/OneLetterFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a>, <a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thinkphp-functions-oneletterfunctions"><span class="std std-ref">ThinkPHP</span></a>, <a class="reference internal" href="Cases.html#cleverstyle-functions-oneletterfunctions"><span class="std std-ref">Cleverstyle</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="one-variable-string">
<span id="id1131"></span><h2>9.432. One Variable String<a class="headerlink" href="#one-variable-string" title="Permalink to this headline">¶</a></h2>
<p>These strings only contains one variable or property or array.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">$a</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// This is a one-variable string</span>

<span class="c1">// Better way to write the above</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nv">$a</span><span class="p">;</span>

<span class="c1">// Alternatives :</span>
<span class="nv">$b2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">$a[1]</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// This is a one-variable string</span>
<span class="nv">$b3</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">$a-&gt;b</span><span class="s2">&quot;</span><span class="p">;</span> <span class="c1">// This is a one-variable string</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="s2">&quot;d&quot;</span><span class="p">;</span>
<span class="nv">$d</span> <span class="o">=</span> <span class="s2">&quot;D&quot;</span><span class="p">;</span>
<span class="nv">$b4</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$$c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="nv">$b5</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When the goal is to convert a variable to a string, it is recommended to use the type casting (string) operator : it is then clearer to understand the conversion. It is also marginally faster, though very little.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.string.php">Strings</a> and <a class="reference external" href="https://www.php.net/manual/en/language.types.type-juggling.php">Type Juggling</a>.</p>
<div class="section" id="id1133">
<h3>9.432.1. Suggestions<a class="headerlink" href="#id1133" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the surrounding string, keep the variable (or property…)</li>
<li>Include in the string any concatenation that comes unconditionaly after or before</li>
<li>Convert the variable to a string with the (type) operator</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/OneVariableStrings</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tikiwiki-type-onevariablestrings"><span class="std std-ref">Tikiwiki</span></a>, <a class="reference internal" href="Cases.html#nextcloud-type-onevariablestrings"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="only-variable-for-reference">
<span id="id1134"></span><h2>9.433. Only Variable For Reference<a class="headerlink" href="#only-variable-for-reference" title="Permalink to this headline">¶</a></h2>
<p>When a method is requesting an argument to be a reference, it cannot be called with a literal value.</p>
<p>The call must be made with a variable, or any assimilated data container : array, property or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> property.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is not possible</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">// This is working</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that PHP may detect this error at linting time, if the method is defined after being called : at that point, PHP will only check the problem during execution. This is definitely the case for methods, compared to functions or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.by-reference">Passing arguments by reference</a>.</p>
<div class="section" id="id1137">
<h3>9.433.1. Suggestions<a class="headerlink" href="#id1137" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Put the literal value in a variable before calling the method.</li>
<li>Put the literal value in the default value of the reference argument.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/OnlyVariableForReference</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="only-variable-passed-by-reference">
<span id="id1138"></span><h2>9.434. Only Variable Passed By Reference<a class="headerlink" href="#only-variable-passed-by-reference" title="Permalink to this headline">¶</a></h2>
<p>When an argument is expected by reference, it is compulsory to provide a container. A container may be a variable, an array, a property or a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> property.</p>
<p>This may be linted by PHP, when the function definition is in the same file as the function usage. This is silently linted if definition and usage are separated, if the call is dynamical or made as a method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$bar</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>

<span class="k">function</span> <span class="o">&amp;</span><span class="nf">bar</span><span class="p">()</span> <span class="p">{</span> <span class="cm">/**/</span> <span class="p">}</span>

<span class="c1">// This is not possible : strtolower() returns a value</span>
<span class="nx">foo</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$string</span><span class="p">));</span>

<span class="c1">// This is valid : bar() returns a reference</span>
<span class="nx">foo</span><span class="p">(</span><span class="nx">bar</span><span class="p">(</span><span class="nv">$string</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis currently covers functioncalls and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methodcalls, but omits methodcalls.</p>
<div class="section" id="id1141">
<h3>9.434.1. Suggestions<a class="headerlink" href="#id1141" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Store the previous result in a variable, and then call the function.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/OnlyVariablePassedByReference</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-functions-onlyvariablepassedbyreference"><span class="std std-ref">Dolphin</span></a>, <a class="reference internal" href="Cases.html#phpipam-functions-onlyvariablepassedbyreference"><span class="std std-ref">PhpIPAM</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="only-variable-returned-by-reference">
<span id="id1142"></span><h2>9.435. Only Variable Returned By Reference<a class="headerlink" href="#only-variable-returned-by-reference" title="Permalink to this headline">¶</a></h2>
<p>Function can’t return literals by reference.</p>
<p>When a function returns a reference, it is only possible to return variables, properties or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> properties.</p>
<p>Anything else, like literals or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> expressions, yield a warning at execution time.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Can&#39;t return a literal number</span>
<span class="k">function</span> <span class="o">&amp;</span><span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">3</span> <span class="o">+</span> <span class="nb">rand</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// bar must return values that are stored in a</span>
<span class="k">function</span> <span class="o">&amp;</span><span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="nb">rand</span><span class="p">();</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/OnlyVariableReturnedByReference</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="optimize-explode">
<span id="id1145"></span><h2>9.436. Optimize Explode()<a class="headerlink" href="#optimize-explode" title="Permalink to this headline">¶</a></h2>
<p>Limit <a class="reference external" href="https://www.php.net/explode">explode()</a> results at call time. <a class="reference external" href="https://www.php.net/explode">explode()</a> returns a string, after breaking it into smaller strings, with a delimiter.</p>
<p>By default, <a class="reference external" href="https://www.php.net/explode">explode()</a> breaks the whole string into smaller strings, and returns the array. When not all the elements of the returned array are necessary, using the third argument of <a class="reference external" href="https://www.php.net/explode">explode()</a> speeds up the process, by removing unnecessary work.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;1,2,3,4,5,&#39;</span><span class="p">;</span>

<span class="c1">// explode() returns 2 elements, which are then assigned to the list() call.</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// explode() returns 6 elements, only two of which are then assigned to the list() call. The rest are discarded.</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// it is not possible to skip the first elements, but it is possible to skip the last ones.</span>
<span class="k">echo</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>

<span class="c1">// This protects PHP, in case $string ends up with a lot of commas</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">();</span> <span class="c1">// usually &#39;1,2&#39; but not known</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Limiting <a class="reference external" href="https://www.php.net/explode">explode()</a> has no effect when the operation is already exact : it simply prevents <a class="reference external" href="https://www.php.net/explode">explode()</a> to cut more than needed if the argument is unexpectedly large.</p>
<p>This optimisation applies to <a class="reference external" href="https://www.php.net/preg_split">preg_split()</a> and <a class="reference external" href="https://www.php.net/mb_split">mb_split()</a> too.</p>
<p>This is a micro optimisation, unless the exploded string is large.</p>
<div class="section" id="id1153">
<h3>9.436.1. Suggestions<a class="headerlink" href="#id1153" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a limit to explode() call</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/OptimizeExplode</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="or-die">
<span id="id1154"></span><h2>9.437. Or Die<a class="headerlink" href="#or-die" title="Permalink to this headline">¶</a></h2>
<p>Classic old style failed error management.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In case the connexion fails, this kills the current script</span>
<span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">)</span> <span class="k">or</span> <span class="k">die</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Interrupting a script will leave the application with a blank page, will make your life miserable for testing. Just don’t do that.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.pg-last-error.php">pg_last_error</a> or <a class="reference external" href="https://www.php.net/manual/en/pdo.exec.php">PDO::exec</a>.</p>
<div class="section" id="id1155">
<h3>9.437.1. Suggestions<a class="headerlink" href="#id1155" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Throw an exception</li>
<li>Trigger an error with trigger_error()</li>
<li>Use your own error mechanism</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/OrDie</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-implied-if.md">no-implied-if</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-structures-ordie"><span class="std std-ref">Tine20</span></a>, <a class="reference internal" href="Cases.html#openconf-structures-ordie"><span class="std std-ref">OpenConf</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="order-of-declaration">
<span id="id1156"></span><h2>9.438. Order Of Declaration<a class="headerlink" href="#order-of-declaration" title="Permalink to this headline">¶</a></h2>
<p>The order used to declare members and methods has a great impact on readability and maintenance. However, practices varies greatly. As usual, being consistent is the most important and useful.</p>
<p>The suggested order is the following : traits, constants, properties, methods.
Optional characteristics, like final, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>… are not specified. Special methods names are not specified.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">traits</span><span class="p">;</span>

    <span class="k">const</span> <span class="no">CONSTANTS</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">CONSTANTS2</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">CONSTANTS3</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">private</span> <span class="nv">$property</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$property2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$property3</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo2</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo3</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">foo4</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/OrderOfDeclaration</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="overwritten-exceptions">
<span id="id1158"></span><h2>9.439. Overwritten Exceptions<a class="headerlink" href="#overwritten-exceptions" title="Permalink to this headline">¶</a></h2>
<p>In catch blocks, it is good practice to avoid overwriting the incoming exception, as information about the exception will be lost.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">SomeException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $e is overwritten</span>
    <span class="nv">$e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">anotherException</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
    <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">SomeOtherException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $e is chained with the next exception</span>
    <span class="nv">$e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$e</span><span class="p">);</span>
    <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1159">
<h3>9.439.1. Suggestions<a class="headerlink" href="#id1159" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use another variable name to create new values inside the catch</li>
<li>Use anonymous catch clause (no variable caught) in PHP 8.0, to make this explicit</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/OverwriteException</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="overwritten-literals">
<span id="id1160"></span><h2>9.440. Overwritten Literals<a class="headerlink" href="#overwritten-literals" title="Permalink to this headline">¶</a></h2>
<p>The same variable is assigned a literal twice. It is possible that one of the assignation is too much.</p>
<p>This analysis doesn’t take into account the distance between two assignations : it may report false positives when the variable is actually used for several purposes, and, as such, assigned twice with different values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Two assignations in a short sequence : one is too many.</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$a</span> <span class="o">+=</span> <span class="nv">$i</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>

    <span class="c1">// New assignation. $a is now used as an array.</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/OverwrittenLiterals</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="overwritten-source-and-value">
<span id="id1161"></span><h2>9.441. Overwritten Source And Value<a class="headerlink" href="#overwritten-source-and-value" title="Permalink to this headline">¶</a></h2>
<p>In a <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>, it is best to keep source and values distinct. Otherwise, they overwrite each other.</p>
<p>Since PHP 7.0, PHP makes a copy of the original source, then works on it. This makes possible to use the same name for the source and the values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// displays 0-1-2-3-3</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$array</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nv">$array</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>


<span class="cm">/* displays 0-1-2-3-Array</span>
<span class="cm">(</span>
<span class="cm">    [0] =&gt; 0</span>
<span class="cm">    [1] =&gt; 1</span>
<span class="cm">    [2] =&gt; 2</span>
<span class="cm">    [3] =&gt; 3</span>
<span class="cm">)</span>
<span class="cm">*/</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nv">$v</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When the source is used as the value, the elements in the array are successively assigned to itself. After the loop, the original array has been replaced by its last element.</p>
<p>The same applies to the index, or to any variable in a <a class="reference external" href="https://www.php.net/list">list()</a> structure, used in a <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>.</p>
<div class="section" id="id1165">
<h3>9.441.1. Suggestions<a class="headerlink" href="#id1165" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Keep the source, the index and the values distinct</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ForeachSourceValue</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-structures-foreachsourcevalue"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#expressionengine-structures-foreachsourcevalue"><span class="std std-ref">ExpressionEngine</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-7-0-new-classes">
<span id="id1166"></span><h2>9.442. PHP 7.0 New Classes<a class="headerlink" href="#php-7-0-new-classes" title="Permalink to this headline">¶</a></h2>
<p>Those classes are now declared natively in PHP 7.0 and should not be declared in custom code.</p>
<p>There are 8 new classes :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">Error</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ParseError</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">TypeError</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ArithmeticError</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">DivisionByZeroError</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ClosedGeneratorException</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ReflectionGenerator</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ReflectionType</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">AssertionError</span></code></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="p">{</span>
    <span class="c1">// Global namespace</span>
    <span class="k">class</span> <span class="nc">Error</span> <span class="p">{</span>
        <span class="c1">// Move to a namespace</span>
        <span class="c1">// or, remove this class</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">Error</span> <span class="p">{</span>
        <span class="c1">// This is OK : in a namespace</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration70.classes.php">New Classes and Interfaces</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php70NewClasses</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-0-new-interfaces">
<span id="id1167"></span><h2>9.443. PHP 7.0 New Interfaces<a class="headerlink" href="#php-7-0-new-interfaces" title="Permalink to this headline">¶</a></h2>
<p>The following interfaces are introduced in PHP 7.0. They shouldn’t be defined in custom code.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php70NewInterfaces</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-0-removed-directives">
<span id="id1168"></span><h2>9.444. PHP 7.0 Removed Directives<a class="headerlink" href="#php-7-0-removed-directives" title="Permalink to this headline">¶</a></h2>
<p>List of directives that are removed in PHP 7.0.</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php70RemovedDirective</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-0-removed-functions">
<span id="id1169"></span><h2>9.445. PHP 7.0 Removed Functions<a class="headerlink" href="#php-7-0-removed-functions" title="Permalink to this headline">¶</a></h2>
<p>The following PHP native functions were removed in PHP 7.0.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/ereg">ereg()</a></li>
<li><a class="reference external" href="https://www.php.net/ereg_replace">ereg_replace()</a></li>
<li><a class="reference external" href="https://www.php.net/eregi">eregi()</a></li>
<li><a class="reference external" href="https://www.php.net/eregi_replace">eregi_replace()</a></li>
<li><a class="reference external" href="https://www.php.net/split">split()</a></li>
<li><a class="reference external" href="https://www.php.net/spliti">spliti()</a></li>
<li><a class="reference external" href="https://www.php.net/sql_regcase">sql_regcase()</a></li>
<li><a class="reference external" href="https://www.php.net/magic_quotes_runtime">magic_quotes_runtime()</a></li>
<li><a class="reference external" href="https://www.php.net/set_magic_quotes_runtime">set_magic_quotes_runtime()</a></li>
<li><a class="reference external" href="https://www.php.net/call_user_method">call_user_method()</a></li>
<li><a class="reference external" href="https://www.php.net/call_user_method_array">call_user_method_array()</a></li>
<li><a class="reference external" href="https://www.php.net/set_socket_blocking">set_socket_blocking()</a></li>
<li><a class="reference external" href="https://www.php.net/mcrypt_ecb">mcrypt_ecb()</a></li>
<li><a class="reference external" href="https://www.php.net/mcrypt_cbc">mcrypt_cbc()</a></li>
<li><a class="reference external" href="https://www.php.net/mcrypt_cfb">mcrypt_cfb()</a></li>
<li><a class="reference external" href="https://www.php.net/mcrypt_ofb">mcrypt_ofb()</a></li>
<li>datefmt_set_timezone_id()</li>
<li><a class="reference external" href="https://www.php.net/imagepsbbox">imagepsbbox()</a></li>
<li><a class="reference external" href="https://www.php.net/imagepsencodefont">imagepsencodefont()</a></li>
<li><a class="reference external" href="https://www.php.net/imagepsextendfont">imagepsextendfont()</a></li>
<li><a class="reference external" href="https://www.php.net/imagepsfreefont">imagepsfreefont()</a></li>
<li><a class="reference external" href="https://www.php.net/imagepsloadfont">imagepsloadfont()</a></li>
<li><a class="reference external" href="https://www.php.net/imagepsslantfont">imagepsslantfont()</a></li>
<li><a class="reference external" href="https://www.php.net/imagepstext">imagepstext()</a></li>
</ul>
<p>This analysis skips redefined PHP functions : when a replacement for a removed PHP function was created, with condition on the PHP version, then its usage is considered valid.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration70.incompatible.php#migration70.incompatible.removed-functions">PHP 7.0 Removed Functions</a>.</p>
<div class="section" id="id1175">
<h3>9.445.1. Suggestions<a class="headerlink" href="#id1175" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the old functions with modern functions</li>
<li>Remove the usage of the old functions</li>
<li>Create an alternative function by wiring the old name to a new feature</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php70RemovedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-7-0-scalar-typehints">
<span id="id1176"></span><h2>9.446. PHP 7.0 Scalar Typehints<a class="headerlink" href="#php-7-0-scalar-typehints" title="Permalink to this headline">¶</a></h2>
<p>New scalar typehints were introduced : <code class="docutils literal notranslate"><span class="pre">bool</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p>
<p>They cannot be used before PHP 7.0, and will be confused with classes or interfaces.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nx">Hello</span> <span class="nv">$name</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">foo</span><span class="p">(</span><span class="nx">Damien</span><span class="p">);</span>
<span class="c1">// display &#39;Hello Damien&#39;</span>

<span class="nx">foo</span><span class="p">(</span><span class="mi">33</span><span class="p">);</span>
<span class="c1">// displays an error</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.scalar-type-declarations">Scalar type declarations</a>, and <a class="reference external" href="https://tutorials.kode-blog.com/php-7-scalar-type-declarations">PHP 7 SCALAR TYPE DECLARATIONS</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/PHP70scalartypehints</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-1-microseconds">
<span id="id1177"></span><h2>9.447. PHP 7.1 Microseconds<a class="headerlink" href="#php-7-1-microseconds" title="Permalink to this headline">¶</a></h2>
<p>PHP supports microseconds in <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> class and <a class="reference external" href="https://www.php.net/date_create">date_create()</a> function. This was introduced in PHP 7.1.</p>
<p>In previous PHP versions, those dates only used seconds, leading to lazy comparisons :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$now</span> <span class="o">=</span> <span class="nb">date_create</span><span class="p">();</span>
<span class="nb">usleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>              <span class="c1">// wait for 0.001 ms</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$now</span> <span class="o">==</span> <span class="nb">date_create</span><span class="p">());</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This code displays true in PHP 7.0 and older, (unless the code was run too close from the next second). In PHP 7.1, this is always false.</p>
<p>This is also true with <code class="docutils literal notranslate"><span class="pre">DateTime</span></code> :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">();</span>
<span class="nb">usleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>              <span class="c1">// wait for 0.001 ms</span>
<span class="nb">var_dump</span><span class="p">((</span><span class="k">new</span> <span class="nx">DateTime</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$now</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This evolution impacts mostly exact comparisons (== and ===). Non-equality (!= and !==) will probably be always true, and should be reviewed.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration71.incompatible.php">Backward incompatible changes</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php71microseconds</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-1-removed-directives">
<span id="id1178"></span><h2>9.448. PHP 7.1 Removed Directives<a class="headerlink" href="#php-7-1-removed-directives" title="Permalink to this headline">¶</a></h2>
<p>List of directives that are removed in PHP 7.1.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php71RemovedDirective</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-1-scalar-typehints">
<span id="id1179"></span><h2>9.449. PHP 7.1 Scalar Typehints<a class="headerlink" href="#php-7-1-scalar-typehints" title="Permalink to this headline">¶</a></h2>
<p>A new scalar typehint was introduced : iterable.</p>
<p>It can’t be used before PHP 7.1, and will be confused with classes or interfaces.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">iterable</span> <span class="nv">$iterable</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$iterable</span> <span class="k">as</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$value</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">foo</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">));</span>
<span class="c1">// works with array</span>

<span class="nx">foo</span><span class="p">(</span><span class="k">new</span> <span class="nx">ArrayIterator</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]));</span>
<span class="c1">// works with an iterator</span>

<span class="nx">foo</span><span class="p">((</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">yield</span> <span class="mi">1</span><span class="p">;</span> <span class="p">})()</span> <span class="p">);</span>
<span class="c1">// works with a generator</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration71.new-features.php#migration71.new-features.iterable-pseudo-type">iterable pseudo-type</a>, and <a class="reference external" href="https://knpuniversity.com/screencast/php7/iterable-type">The iterable Pseudo-Type</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/PHP71scalartypehints</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-2-deprecations">
<span id="id1180"></span><h2>9.450. PHP 7.2 Deprecations<a class="headerlink" href="#php-7-2-deprecations" title="Permalink to this headline">¶</a></h2>
<p>Several functions are deprecated in PHP 7.2.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/parse_str">parse_str()</a> with no second argument</li>
<li><a class="reference external" href="https://www.php.net/assert">assert()</a> on strings</li>
<li>Usage of <a class="reference external" href="https://www.php.net/gmp_random">gmp_random()</a>, <a class="reference external" href="https://www.php.net/create_function">create_function()</a>, <a class="reference external" href="https://www.php.net/each">each()</a></li>
<li>Usage of (unset)</li>
<li>Usage of <code class="docutils literal notranslate"><span class="pre">$php_errormsg</span></code></li>
<li>directive <code class="docutils literal notranslate"><span class="pre">mbstring.func_overload</span></code> (not supported yet)</li>
</ul>
<p>Deprecated functions and extensions are reported in a separate analysis.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_2">Deprecations for PHP 7.2</a>.</p>
<div class="section" id="id1182">
<h3>9.450.1. Suggestions<a class="headerlink" href="#id1182" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the deprecated functions, and replace them with a new feature</li>
<li>Use a replacement function to emulate this old behavior</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php72Deprecation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-7-2-object-keyword">
<span id="id1183"></span><h2>9.451. PHP 7.2 Object Keyword<a class="headerlink" href="#php-7-2-object-keyword" title="Permalink to this headline">¶</a></h2>
<p>‘object’ is a PHP keyword. It can’t be used for class, interface or trait name.</p>
<p>This is the case since PHP 7.2.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Valid until PHP 7.2</span>
<span class="k">class</span> <span class="nc">object</span> <span class="p">{}</span>

<span class="c1">// Altough it is really weird anyway...</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/reserved.keywords.php">List of Keywords</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php72ObjectKeyword</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-2-removed-functions">
<span id="id1184"></span><h2>9.452. PHP 7.2 Removed Functions<a class="headerlink" href="#php-7-2-removed-functions" title="Permalink to this headline">¶</a></h2>
<p>The following PHP native functions were removed in PHP 7.2.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/png2wbmp">png2wbmp()</a></li>
<li><a class="reference external" href="https://www.php.net/jpeg2wbmp">jpeg2wbmp()</a></li>
<li><a class="reference external" href="https://www.php.net/create_function">create_function()</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_random">gmp_random()</a></li>
<li><a class="reference external" href="https://www.php.net/each">each()</a></li>
</ul>
<p>This analysis skips redefined PHP functions : when a replacement for a removed PHP function was created, with condition on the PHP version, then its usage is considered valid.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration72.deprecated.php">Deprecated features in PHP 7.2.x</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php72RemovedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-2-scalar-typehints">
<span id="id1188"></span><h2>9.453. PHP 7.2 Scalar Typehints<a class="headerlink" href="#php-7-2-scalar-typehints" title="Permalink to this headline">¶</a></h2>
<p>A new scalar typehint was introduced : object.</p>
<p>It can’t be used before PHP 7.2, and will be confused with classes or interfaces.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">test</span><span class="p">(</span><span class="nx">object</span> <span class="nv">$obj</span><span class="p">)</span> <span class="o">:</span> <span class="nx">object</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">SplQueue</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">test</span><span class="p">(</span><span class="k">new</span> <span class="k">StdClass</span><span class="p">());</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration72.new-features.php#migration72.new-features.iterable-pseudo-type">New object type</a>, and <a class="reference external" href="http://blog.tekmi.nl/php-7-2-and-object-typehint/">PHP 7.2 and Object Typehint</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/PHP72scalartypehints</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-3-last-empty-argument">
<span id="id1189"></span><h2>9.454. PHP 7.3 Last Empty Argument<a class="headerlink" href="#php-7-3-last-empty-argument" title="Permalink to this headline">¶</a></h2>
<p>PHP allows the last element of any functioncall to be empty. The argument is then not send.</p>
<p>This was introduced in PHP 7.3, and is not backward compatible.</p>
<p>The last empty line is easier on the VCS, allowing clearer text diffs.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">print_r</span><span class="p">(</span><span class="nb">func_get_args</span><span class="p">());</span>
<span class="p">}</span>


<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">,</span>
    <span class="p">);</span>

<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/trailing-comma-function-calls">Allow a trailing comma in function calls</a> and <a class="reference external" href="https://www.puppetcookbook.com/posts/trailing-commas.html">Trailing commas</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/PHP73LastEmptyArgument</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-3-removed-functions">
<span id="id1190"></span><h2>9.455. PHP 7.3 Removed Functions<a class="headerlink" href="#php-7-3-removed-functions" title="Permalink to this headline">¶</a></h2>
<p>The following PHP native functions were removed in PHP 7.3.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/image2wbmp">image2wbmp()</a></li>
</ul>
<p>This analysis skips redefined PHP functions : when a replacement for a removed PHP function was created, with condition on the PHP version, then its usage is considered valid.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration73.incompatible.php#migration70.incompatible.removed-functions">PHP 7.3 Removed Functions</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php73RemovedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-4-constant-deprecation">
<span id="id1192"></span><h2>9.456. PHP 7.4 Constant Deprecation<a class="headerlink" href="#php-7-4-constant-deprecation" title="Permalink to this headline">¶</a></h2>
<p>One constant is deprecated in PHP 7.4.</p>
<ul class="simple">
<li>CURLPIPE_HTTP1</li>
</ul>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_2">Deprecations for PHP 7.2</a>.</p>
<div class="section" id="id1194">
<h3>9.456.1. Suggestions<a class="headerlink" href="#id1194" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use CURLPIPE_MULTIPLEX or CURLPIPE_NOTHING</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74Deprecation</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.4 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-7-4-removed-directives">
<span id="id1195"></span><h2>9.457. PHP 7.4 Removed Directives<a class="headerlink" href="#php-7-4-removed-directives" title="Permalink to this headline">¶</a></h2>
<p>List of directives that are removed in PHP 7.4.</p>
<ul class="simple">
<li>allow_url_include</li>
</ul>
<p>See <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_4#allow_url_include">Deprecation allow_url_include</a>.</p>
<div class="section" id="id1196">
<h3>9.457.1. Suggestions<a class="headerlink" href="#id1196" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Stop using this directive</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74RemovedDirective</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-7-4-removed-functions">
<span id="id1197"></span><h2>9.458. PHP 7.4 Removed Functions<a class="headerlink" href="#php-7-4-removed-functions" title="Permalink to this headline">¶</a></h2>
<p>The following PHP native functions were deprecated in PHP 7.4.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/hebrevc">hebrevc()</a></li>
<li><a class="reference external" href="https://www.php.net/convert_cyr_string">convert_cyr_string()</a></li>
<li><a class="reference external" href="https://www.php.net/ezmlm_hash">ezmlm_hash()</a></li>
<li><a class="reference external" href="https://www.php.net/money_format">money_format()</a></li>
<li><a class="reference external" href="https://www.php.net/restore_include_path">restore_include_path()</a></li>
<li><a class="reference external" href="https://www.php.net/get_magic_quotes_gpc">get_magic_quotes_gpc()</a></li>
<li><a class="reference external" href="https://www.php.net/get_magic_quotes_runtime">get_magic_quotes_runtime()</a></li>
</ul>
<p>This analysis skips redefined PHP functions : when a replacement for a removed PHP function was created, with condition on the PHP version, then its usage is considered valid.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration74.incompatible.php#migration70.incompatible.removed-functions">PHP 7.4 Removed Functions</a> and <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_4#introduction">PHP 7.4 Deprecations : Introduction</a>.</p>
<div class="section" id="id1199">
<h3>9.458.1. Suggestions<a class="headerlink" href="#id1199" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74RemovedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-7-4-reserved-keyword">
<span id="id1200"></span><h2>9.459. PHP 7.4 Reserved Keyword<a class="headerlink" href="#php-7-4-reserved-keyword" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">fn</span></code> is a new PHP keyword. In PHP 7.4, it is used to build the arrow functions. When used at an illegal position, <code class="docutils literal notranslate"><span class="pre">fn</span></code> generates a Fatal error at compile time.</p>
<p>As a key word, <code class="docutils literal notranslate"><span class="pre">fn</span></code> is not allowed as constant name, function name, class name or inside namespaces.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7.4 usage of fn</span>
<span class="k">function</span> <span class="nf">array_values_from_keys</span><span class="p">(</span><span class="nv">$arr</span><span class="p">,</span> <span class="nv">$keys</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">array_map</span><span class="p">(</span><span class="nx">fn</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nv">$arr</span><span class="p">[</span><span class="nv">$x</span><span class="p">],</span> <span class="nv">$keys</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// PHP 7.3 usage of fn</span>
<span class="k">const</span> <span class="no">fn</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">fn</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="c1">// This is valid in PHP 7.3 and 7.4</span>
    <span class="k">function</span> <span class="nf">fn</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">fn</span></code> is fine for method names. It may also be used for constants with <a class="reference external" href="https://www.php.net/define">define()</a>, and <a class="reference external" href="https://www.php.net/constant">constant()</a> but it is not recommended.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/arrow_functions">PHP RFC: Arrow Functions</a>.</p>
<div class="section" id="id1203">
<h3>9.459.1. Suggestions<a class="headerlink" href="#id1203" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74ReservedKeyword</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-74-new-directives">
<span id="id1204"></span><h2>9.460. PHP 74 New Directives<a class="headerlink" href="#php-74-new-directives" title="Permalink to this headline">¶</a></h2>
<p>List of directives that are new in PHP 7.4.</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">zend.exception_ignore_args</span></code> : From the php.ini : <code class="docutils literal notranslate"><span class="pre">Allows</span> <span class="pre">to</span> <span class="pre">include</span> <span class="pre">or</span> <span class="pre">exclude</span> <span class="pre">arguments</span> <span class="pre">from</span> <span class="pre">stack</span> <span class="pre">traces</span> <span class="pre">generated</span> <span class="pre">for</span> <span class="pre">exceptions.</span> <span class="pre">Default:</span> <span class="pre">Off</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">opcache.preload_user</span></code></li>
</ul>
<p>See <a class="reference external" href="https://wiki.php.net/rfc/preload">RFC Preload</a>.</p>
<div class="section" id="id1205">
<h3>9.460.1. Suggestions<a class="headerlink" href="#id1205" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do not use those directives with PHP before version 7.4</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74NewDirective</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-8-0-removed-constants">
<span id="id1206"></span><h2>9.461. PHP 8.0 Removed Constants<a class="headerlink" href="#php-8-0-removed-constants" title="Permalink to this headline">¶</a></h2>
<p>The following PHP native constants were removed in PHP 8.0.</p>
<ul class="simple">
<li>INTL_IDNA_VARIANT_2003 (See <a class="reference external" href="https://wiki.php.net/rfc/deprecate-and-remove-intl_idna_variant_2003">Deprecate and remove INTL_IDNA_VARIANT_2003</a>)</li>
</ul>
<div class="section" id="id1207">
<h3>9.461.1. Suggestions<a class="headerlink" href="#id1207" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove usage of INTL_IDNA_VARIANT_2003 and use</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80RemovedConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-8-0-removed-directives">
<span id="id1208"></span><h2>9.462. PHP 8.0 Removed Directives<a class="headerlink" href="#php-8-0-removed-directives" title="Permalink to this headline">¶</a></h2>
<p>List of directives that are removed in PHP 8.0.</p>
<p>In PHP 8.0, <cite>track_errors</cite> was removed.</p>
<p>You can detect valid directives with <a class="reference external" href="https://www.php.net/ini_get">ini_get()</a>. This native function will return false, when the directive doesn’t exist, while actual directive values will be returned as a string.</p>
<div class="section" id="id1209">
<h3>9.462.1. Suggestions<a class="headerlink" href="#id1209" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove usage of <cite>track_errors</cite>.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80RemovedDirective</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-8-0-removed-functions">
<span id="id1210"></span><h2>9.463. PHP 8.0 Removed Functions<a class="headerlink" href="#php-8-0-removed-functions" title="Permalink to this headline">¶</a></h2>
<p>The following PHP native functions were removed in PHP 8.0.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/image2wbmp">image2wbmp()</a></li>
<li><a class="reference external" href="https://www.php.net/png2wbmp">png2wbmp()</a></li>
<li><a class="reference external" href="https://www.php.net/jpeg2wbmp">jpeg2wbmp()</a></li>
<li><a class="reference external" href="https://www.php.net/ldap_sort">ldap_sort()</a></li>
<li><a class="reference external" href="https://www.php.net/hebrevc">hebrevc()</a></li>
<li><a class="reference external" href="https://www.php.net/convert_cyr_string">convert_cyr_string()</a></li>
<li><a class="reference external" href="https://www.php.net/ezmlm_hash">ezmlm_hash()</a></li>
<li><a class="reference external" href="https://www.php.net/money_format">money_format()</a></li>
<li><a class="reference external" href="https://www.php.net/get_magic_quotes_gpc">get_magic_quotes_gpc()</a></li>
<li>get_magic_quotes_gpc_runtime()</li>
<li><a class="reference external" href="https://www.php.net/create_function">create_function()</a></li>
<li><a class="reference external" href="https://www.php.net/each">each()</a></li>
<li><a class="reference external" href="https://www.php.net/read_exif_data">read_exif_data()</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_random">gmp_random()</a></li>
<li><a class="reference external" href="https://www.php.net/fgetss">fgetss()</a></li>
<li><a class="reference external" href="https://www.php.net/restore_include_path">restore_include_path()</a></li>
<li><a class="reference external" href="https://www.php.net/gzgetss">gzgetss()</a></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80RemovedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-80-named-parameter-variadic">
<span id="id1223"></span><h2>9.464. PHP 80 Named Parameter Variadic<a class="headerlink" href="#php-80-named-parameter-variadic" title="Permalink to this headline">¶</a></h2>
<p>Named parameter with variadic have been renamed from 0 to ‘parameter name’ in PHP 8.0</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="o">...</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">print_r</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span> <span class="mi">4</span><span class="p">);</span>              <span class="c1">// PHP 8 only</span>
<span class="nx">foo</span><span class="p">(</span><span class="o">...</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="nx">b</span><span class="o">=&gt;</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]);</span> <span class="c1">// PHP 8 only</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>In PHP 7.0, with positional argument only, the content of $b is in an array, index 0. This is also true with PHP 8.0.</p>
<p>In PHP 8.0, with named arguments, the content of $b is in an array, index ‘b’;</p>
<p>Since the behavior of the variadic depends on the calling syntax (with or without named parameter), the receiving must ensure the correct reception, and handle both cases.</p>
<div class="section" id="id1224">
<h3>9.464.1. Suggestions<a class="headerlink" href="#id1224" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Apply array_values() to the variadic arguments.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80NamedParameterVariadic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-keywords-as-names">
<span id="id1225"></span><h2>9.465. PHP Keywords As Names<a class="headerlink" href="#php-keywords-as-names" title="Permalink to this headline">¶</a></h2>
<p>PHP has a set of reserved keywords. It is recommended not to use those keywords for names structures.</p>
<p>PHP does check that a number of structures, such as classes, methods, interfaces… can’t be named or called using one of the keywords. However, in a few other situations, no check are enforced. Using keywords in such situation is confusing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This keyword is reserved since PHP 7.2</span>
<span class="k">class</span> <span class="nc">object</span> <span class="p">{</span>
    <span class="c1">// _POST is used by PHP for the $_POST variable</span>
    <span class="c1">// This methods name is probably confusing,</span>
    <span class="c1">// and may attract more than its share of attention</span>
    <span class="k">function</span> <span class="nf">_POST</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/reserved.keywords.php">List of Keywords</a>, <a class="reference external" href="https://www.php.net/manual/en/reserved.classes.php">Predefined Classes</a>, <a class="reference external" href="https://www.php.net/manual/en/reserved.constants.php">Predefined Constants</a>, <a class="reference external" href="https://www.php.net/manual/en/reserved.other-reserved-words.php">List of other reserved words</a> and <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.php">Predefined Variables</a>.</p>
<div class="section" id="id1228">
<h3>9.465.1. Suggestions<a class="headerlink" href="#id1228" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Rename the structure</li>
<li>Choose another naming convention to avoid conflict and rename the current structures</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="8%" />
<col width="7%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>reservedNames</td>
<td>&#160;</td>
<td>string</td>
<td>Other reserved names : all in a string, comma separated.</td>
</tr>
<tr class="row-odd"><td>allowedNames</td>
<td>&#160;</td>
<td>string</td>
<td>PHP reserved names that can be used in the code. All in a string, comma separated.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ReservedNames</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-php-reservednames"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#xataface-php-reservednames"><span class="std std-ref">xataface</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-resources-turned-into-objects">
<span id="id1229"></span><h2>9.466. PHP Resources Turned Into Objects<a class="headerlink" href="#php-resources-turned-into-objects" title="Permalink to this headline">¶</a></h2>
<p>Multiple PHP native functions now return objects, not resources. Any check on those values with <a class="reference external" href="https://www.php.net/is_resource">is_resource()</a> is now going to fail.</p>
<p>The affected functions are the following :</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/curl_init">curl_init()</a></li>
<li><a class="reference external" href="https://www.php.net/curl_multi_init">curl_multi_init()</a></li>
<li><a class="reference external" href="https://www.php.net/curl_share_init">curl_share_init()</a></li>
<li>deflate_init()</li>
<li><a class="reference external" href="https://www.php.net/enchant_broker_init">enchant_broker_init()</a></li>
<li><a class="reference external" href="https://www.php.net/enchant_broker_request_dict">enchant_broker_request_dict()</a></li>
<li><a class="reference external" href="https://www.php.net/enchant_broker_request_pwl_dict">enchant_broker_request_pwl_dict()</a></li>
<li>inflate_init()</li>
<li><a class="reference external" href="https://www.php.net/msg_get_queue">msg_get_queue()</a></li>
<li><a class="reference external" href="https://www.php.net/openssl_csr_new">openssl_csr_new()</a></li>
<li><a class="reference external" href="https://www.php.net/openssl_csr_sign">openssl_csr_sign()</a></li>
<li><a class="reference external" href="https://www.php.net/openssl_pkey_new">openssl_pkey_new()</a></li>
<li><a class="reference external" href="https://www.php.net/openssl_x509_read">openssl_x509_read()</a></li>
<li><a class="reference external" href="https://www.php.net/sem_get">sem_get()</a></li>
<li><a class="reference external" href="https://www.php.net/shm_attach">shm_attach()</a></li>
<li><a class="reference external" href="https://www.php.net/shmop_open">shmop_open()</a></li>
<li><a class="reference external" href="https://www.php.net/socket_accept">socket_accept()</a></li>
<li><a class="reference external" href="https://www.php.net/socket_addrinfo_bind">socket_addrinfo_bind()</a></li>
<li><a class="reference external" href="https://www.php.net/socket_addrinfo_connect">socket_addrinfo_connect()</a></li>
<li><a class="reference external" href="https://www.php.net/socket_create_listen">socket_create_listen()</a></li>
<li><a class="reference external" href="https://www.php.net/socket_create">socket_create()</a></li>
<li><a class="reference external" href="https://www.php.net/socket_import_stream">socket_import_stream()</a></li>
<li>socket_wsaprotocol_info_import()</li>
<li><a class="reference external" href="https://www.php.net/xml_parser_create_ns">xml_parser_create_ns()</a></li>
<li><a class="reference external" href="https://www.php.net/xml_parser_create">xml_parser_create()</a></li>
</ul>
<p>See also <a class="reference external" href="https://github.com/php/php-src/blob/master/UPGRADING">UPGRADING PHP 8.0</a>.</p>
<div class="section" id="id1230">
<h3>9.466.1. Suggestions<a class="headerlink" href="#id1230" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change the condition from is_resource to instanceof</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80RemovesResources</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php5-indirect-variable-expression">
<span id="id1231"></span><h2>9.467. PHP5 Indirect Variable Expression<a class="headerlink" href="#php5-indirect-variable-expression" title="Permalink to this headline">¶</a></h2>
<p>Indirect variable expressions changes between PHP 5 an 7.</p>
<p>The following structures are evaluated differently in PHP 5 and 7. It is recommended to review them or switch to a less ambiguous syntax.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7</span>
<span class="nv">$foo</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$bar</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;foobarbarbaz&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$$foo</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">];</span>
<span class="k">echo</span> <span class="p">(</span><span class="nv">$$foo</span><span class="p">)[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">];</span>

<span class="c1">// PHP 5</span>
<span class="nv">$foo</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>
<span class="nv">$bar</span> <span class="o">=</span> <span class="s1">&#39;foobarbazbar&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$$foo</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">];</span>
<span class="k">echo</span> <span class="err">$</span><span class="p">{</span><span class="nv">$foo</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">]};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.php.net/manual/en/migration70.incompatible.php">Backward incompatible changes PHP 7.0</a></p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="34%" />
<col width="34%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Expression</td>
<td>PHP 5 interpretation</td>
<td>PHP 7 interpretation</td>
</tr>
<tr class="row-even"><td>$$foo[‘bar’][‘baz’]
$foo-&gt;$bar[‘baz’]
$foo-&gt;$bar[‘baz’]()
Foo::$bar[‘baz’]()</td>
<td>${$foo[‘bar’][‘baz’]}
$foo-&gt;{$bar[‘baz’]}
$foo-&gt;{$bar[‘baz’]}()
Foo::{$bar[‘baz’]}()</td>
<td>($$foo)[‘bar’][‘baz’]
($foo-&gt;$bar)[‘baz’]
($foo-&gt;$bar)[‘baz’]()
(Foo::$bar)[‘baz’]()</td>
</tr>
</tbody>
</table>
<div class="section" id="id1232">
<h3>9.467.1. Suggestions<a class="headerlink" href="#id1232" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using complex expressions, mixing <code class="docutils literal notranslate"><span class="pre">$$\</span></code>, <code class="docutils literal notranslate"><span class="pre">[0]</span></code> and <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code> in the same expression</li>
<li>Add curly braces {} to ensure that the precedence is the same between PHP 5 and 7. For example, <code class="docutils literal notranslate"><span class="pre">$$v</span></code> becomes <code class="docutils literal notranslate"><span class="pre">${$v}</span></code></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/Php5IndirectExpression</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php7-dirname">
<span id="id1233"></span><h2>9.468. PHP7 Dirname<a class="headerlink" href="#php7-dirname" title="Permalink to this headline">¶</a></h2>
<p>With PHP 7, <a class="reference external" href="https://www.php.net/dirname">dirname()</a> has a second argument that represents the number of <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> folder to follow. This prevent us from using nested <a class="reference external" href="https://www.php.net/dirname">dirname()</a> calls to reach an grand-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> direct.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;/a/b/c/d/e/f&#39;</span><span class="p">;</span>

<span class="c1">// PHP 7 syntax</span>
<span class="nv">$threeFoldersUp</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="c1">// PHP 5 syntax</span>
<span class="nv">$threeFoldersUp</span> <span class="o">=</span> <span class="nb">dirname</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="nv">$path</span><span class="p">)));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/dirname">dirname</a>.</p>
<div class="section" id="id1239">
<h3>9.468.1. Suggestions<a class="headerlink" href="#id1239" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use dirname()’s second argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="92%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PHP7Dirname</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openconf-structures-php7dirname"><span class="std std-ref">OpenConf</span></a>, <a class="reference internal" href="Cases.html#mediawiki-structures-php7dirname"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="parameter-hiding">
<span id="id1240"></span><h2>9.469. Parameter Hiding<a class="headerlink" href="#parameter-hiding" title="Permalink to this headline">¶</a></h2>
<p>When a parameter is set to another variable, and never used.</p>
<p>While this is a legit syntax, parameter hiding tends to make the code confusing. The parameter itself seems to be unused, while some extra variable appears.</p>
<p>Keep this code simple by removing the hiding parameter.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">substract</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $b is given to $c;</span>
    <span class="nv">$c</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>

    <span class="nv">$c</span> <span class="nx">is</span> <span class="nx">used</span><span class="p">,</span> <span class="nx">but</span> <span class="nv">$b</span> <span class="nx">would</span> <span class="nx">be</span> <span class="nx">the</span> <span class="nx">same</span>
    <span class="k">return</span> <span class="nv">$a</span> <span class="o">-</span> <span class="nv">$c</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1241">
<h3>9.469.1. Suggestions<a class="headerlink" href="#id1241" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the hiding parameter</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/ParameterHiding</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="parent-first">
<span id="id1242"></span><h2>9.470. Parent First<a class="headerlink" href="#parent-first" title="Permalink to this headline">¶</a></h2>
<p>When calling <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> constructor, always put it first in the <code class="docutils literal notranslate"><span class="pre">__construct</span></code> method. It ensures the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> is correctly build before the child start using values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">father</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$name</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nx">init</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">goodSon</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// parent is build immediately,</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
        <span class="k">echo</span> <span class="nx">my</span> <span class="nx">name</span> <span class="nx">is</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">badSon</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This will fail.</span>
        <span class="k">echo</span> <span class="nx">my</span> <span class="nx">name</span> <span class="nx">is</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>

        <span class="c1">// parent is build later,</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis doesn’t apply to Exceptions.</p>
<div class="section" id="id1245">
<h3>9.470.1. Suggestions<a class="headerlink" href="#id1245" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use <code class="docutils literal notranslate"><span class="pre">parent\:\:__construct</span></code> as the first call in the constructor.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ParentFirst</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#shopware-classes-parentfirst"><span class="std std-ref">shopware</span></a>, <a class="reference internal" href="Cases.html#prestashop-classes-parentfirst"><span class="std std-ref">PrestaShop</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="parent-static-or-self-outside-class">
<span id="id1246"></span><h2>9.471. Parent, Static Or Self Outside Class<a class="headerlink" href="#parent-static-or-self-outside-class" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">Parent</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> keywords must be used within a class or a trait. They make no sens outside a class or trait scope, as <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> refers to the current class and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> refers to one of <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> above.</p>
<p>PHP 7.0 and later detect their usage at compile time, and emits a fatal error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">Y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// self is \x</span>
        <span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">Y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span> <span class="no">Z</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// This lint but won&#39;t anymore</span>
<span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">Z</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> may be used in a function or a closure, but not globally.</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/PssWithoutClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="parenthesis-as-parameter">
<span id="id1255"></span><h2>9.472. Parenthesis As Parameter<a class="headerlink" href="#parenthesis-as-parameter" title="Permalink to this headline">¶</a></h2>
<p>Using parenthesis around parameters used to silent some internal check. This is not the case anymore in PHP 7, and should be fixed by removing the parenthesis and making the value a real reference.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7 sees through parenthesis</span>
<span class="nv">$d</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">$c</span><span class="p">);</span>

<span class="c1">// Avoid parenthesis in arguments</span>
<span class="nv">$d</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="nv">$c</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1256">
<h3>9.472.1. Suggestions<a class="headerlink" href="#id1256" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the parenthesis when they are only encapsulating an argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ParenthesisAsParameter</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="pathinfo-returns-may-vary">
<span id="id1257"></span><h2>9.473. Pathinfo() Returns May Vary<a class="headerlink" href="#pathinfo-returns-may-vary" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/pathinfo">pathinfo()</a> function returns an array whose content may vary. It is recommended to collect the values after check, rather than directly.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$file</span> <span class="o">=</span> <span class="s1">&#39;/a/b/.c&#39;</span><span class="p">;</span>
<span class="c1">//$extension may be missing, leading to empty $filename and filename in $extension</span>
<span class="k">list</span><span class="p">(</span> <span class="nv">$dirname</span><span class="p">,</span> <span class="nv">$basename</span><span class="p">,</span> <span class="nv">$extension</span><span class="p">,</span> <span class="nv">$filename</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">);</span>

<span class="c1">//Use PHP 7.1 list() syntax to assign correctly the values, and skip array_values()</span>
<span class="c1">//This emits a warning in case of missing index</span>
<span class="p">[</span><span class="s1">&#39;dirname&#39;</span>   <span class="o">=&gt;</span> <span class="nv">$dirname</span><span class="p">,</span>
 <span class="s1">&#39;basename&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$basename</span><span class="p">,</span>
 <span class="s1">&#39;extension&#39;</span> <span class="o">=&gt;</span> <span class="nv">$extension</span><span class="p">,</span>
 <span class="s1">&#39;filename&#39;</span>  <span class="o">=&gt;</span> <span class="nv">$filename</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>

<span class="c1">//This works without warning</span>
<span class="nv">$details</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
<span class="nv">$dirname</span>   <span class="o">=</span> <span class="nv">$details</span><span class="p">[</span><span class="s1">&#39;dirname&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="nx">getpwd</span><span class="p">();</span>
<span class="nv">$basename</span>  <span class="o">=</span> <span class="nv">$details</span><span class="p">[</span><span class="s1">&#39;basename&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="nv">$extension</span> <span class="o">=</span> <span class="nv">$details</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="nv">$filename</span>  <span class="o">=</span> <span class="nv">$details</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The same applies to <a class="reference external" href="https://www.php.net/parse_url">parse_url()</a>, which returns an array with various index.</p>
<div class="section" id="id1258">
<h3>9.473.1. Suggestions<a class="headerlink" href="#id1258" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a check on the return value of pathinfo() before using it.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/PathinfoReturns</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#nextcloud-php-pathinforeturns"><span class="std std-ref">NextCloud</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-7-indirect-expression">
<span id="id1259"></span><h2>9.474. Php 7 Indirect Expression<a class="headerlink" href="#php-7-indirect-expression" title="Permalink to this headline">¶</a></h2>
<p>Those are variable indirect expressions that are interpreted differently in PHP 5 and PHP 7.</p>
<p>You should check them so they don’t behave strangely.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Ambiguous expression :</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nv">$$foo</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">];</span>
<span class="k">echo</span> <span class="nv">$b</span><span class="p">;</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bat&#39;</span><span class="p">));</span>
<span class="nv">$bat</span> <span class="o">=</span> <span class="s1">&#39;PHP 5.6&#39;</span><span class="p">;</span>

<span class="c1">// In PHP 5, the expression above means :</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nv">$\</span><span class="p">{</span><span class="nv">$foo</span><span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">]};</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="s1">&#39;PHP 5.6&#39;</span><span class="p">;</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bat&#39;</span><span class="p">));</span>

<span class="c1">// In PHP 7, the expression above means :</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$$foo</span><span class="p">)[</span><span class="s1">&#39;bar&#39;</span><span class="p">][</span><span class="s1">&#39;baz&#39;</span><span class="p">];</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="s1">&#39;bat&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration70.incompatible.php">Changes to variable handling</a>.</p>
<div class="section" id="id1260">
<h3>9.474.1. Suggestions<a class="headerlink" href="#id1260" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using complex expressions, mixing $$, [0] and -&gt; in the same expression</li>
<li>Add curly braces {} to ensure that the precedence is the same between PHP 5 and 7. For example, <code class="docutils literal notranslate"><span class="pre">$$v</span></code> becomes <code class="docutils literal notranslate"><span class="pre">${$v}</span></code></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/Php7IndirectExpression</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-7-1-new-class">
<span id="id1261"></span><h2>9.475. Php 7.1 New Class<a class="headerlink" href="#php-7-1-new-class" title="Permalink to this headline">¶</a></h2>
<p>New classes, introduced in PHP 7.1. If classes where created with the same name, in current code, they have to be moved in a namespace, or removed from code to migrate safely to PHP 7.1.</p>
<p>The new class is : ReflectionClassConstant. The other class is ‘Void’ : this is forbidden as a class name, as Void is used for return type hint.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">ReflectionClassConstant</span> <span class="p">{</span>
    <span class="c1">// Move to a namespace, do not leave in global</span>
    <span class="c1">// or, remove this class</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php71NewClasses</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-2-new-class">
<span id="id1262"></span><h2>9.476. Php 7.2 New Class<a class="headerlink" href="#php-7-2-new-class" title="Permalink to this headline">¶</a></h2>
<p>New classes, introduced in PHP 7.2. If classes where created with the same name, in current code, they have to be moved in a namespace, or removed from code to migrate safely to PHP 7.2.</p>
<p>The new class is : HashContext.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="p">{</span>
    <span class="c1">// Global namespace</span>
    <span class="k">class</span> <span class="nc">HashContext</span> <span class="p">{</span>
        <span class="c1">// Move to a namespace</span>
        <span class="c1">// or, remove this class</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">HashContext</span> <span class="p">{</span>
        <span class="c1">// This is OK : in a namespace</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php72NewClasses</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-7-4-new-class">
<span id="id1263"></span><h2>9.477. Php 7.4 New Class<a class="headerlink" href="#php-7-4-new-class" title="Permalink to this headline">¶</a></h2>
<p>New classes, introduced in PHP 7.4. If classes where created with the same name, in current code, they have to be moved in a namespace, or removed from code to migrate safely to PHP 7.4.</p>
<p>The new classes are :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">ReflectionReference</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">WeakReference</span></code></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="p">{</span>
    <span class="c1">// Global namespace</span>
    <span class="k">class</span> <span class="nc">WeakReference</span> <span class="p">{</span>
        <span class="c1">// Move to a namespace</span>
        <span class="c1">// or, remove this class</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">WeakReference</span> <span class="p">{</span>
        <span class="c1">// This is OK : in a namespace</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1264">
<h3>9.477.1. Suggestions<a class="headerlink" href="#id1264" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the current classes with the same names into a distinct domain name</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74NewClasses</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-8-0-only-typehints">
<span id="id1265"></span><h2>9.478. Php 8.0 Only TypeHints<a class="headerlink" href="#php-8-0-only-typehints" title="Permalink to this headline">¶</a></h2>
<p>Two scalar typehints are introduced in version 8. They are <code class="docutils literal notranslate"><span class="pre">false</span></code> and <code class="docutils literal notranslate"><span class="pre">null</span></code>. In PHP 7.0, both those values could not be used as a class or interface name, to avoid confusion with the actual booleans, nor <code class="docutils literal notranslate"><span class="pre">null</span></code> value.</p>
<p><code class="docutils literal notranslate"><span class="pre">false</span></code> represents a false boolean, and nothing else. It is more restrictive than a boolean, which accepts true too.
<code class="docutils literal notranslate"><span class="pre">null</span></code> is an alternative syntax to <code class="docutils literal notranslate"><span class="pre">?</span></code> : it allows the type to be <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<p>Both the above typehints are to be used in cunjunction with other types : they can’t be used alone.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// function accepts an A object, or null.</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">A</span><span class="o">|</span><span class="k">null</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// same as above</span>
<span class="k">function</span> <span class="nf">foo2</span><span class="p">(</span><span class="nx">A</span><span class="o">|</span><span class="k">null</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">// returns an object of class B, or false</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="o">:</span> <span class="k">false</span><span class="o">|</span><span class="nx">B</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/union_types_v2">PHP RFC: Union Types 2.0</a>.</p>
<div class="section" id="id1266">
<h3>9.478.1. Suggestions<a class="headerlink" href="#id1266" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80OnlyTypeHints</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php-8-0-variable-syntax-tweaks">
<span id="id1267"></span><h2>9.479. Php 8.0 Variable Syntax Tweaks<a class="headerlink" href="#php-8-0-variable-syntax-tweaks" title="Permalink to this headline">¶</a></h2>
<p>Several variable syntaxes are added in version 8.0. They extends the PHP 7.0 syntax updates, and fix a number of edges cases.</p>
<p>In particular, <code class="docutils literal notranslate"><span class="pre">new``and</span> <span class="pre">``instanceof</span></code> now support a way to inline the expression, rather than use a temporary variable.</p>
<p>Magic constants are now accessible with array notation, just like another constant. It is also possible to use method calls : although this is Syntacticly correct for PHP, this won’t be executed, as the left operand is a string, and not an object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

 <span class="c1">// array name is dynamically build</span>
 <span class="k">echo</span> <span class="nx">foo</span><span class="nv">$bar</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
 <span class="c1">// static method</span>
 <span class="nx">foo</span><span class="nv">$bar</span><span class="o">::</span><span class="na">baz</span><span class="p">();</span>
 <span class="c1">// static property</span>
 <span class="nx">foo</span><span class="nv">$bar</span><span class="o">::</span><span class="nv">$baz</span><span class="p">;</span>

 <span class="c1">// Syntactly correct, but not executable</span>
 <span class="nx">foo</span><span class="nv">$bar</span><span class="o">-&gt;</span><span class="na">baz</span><span class="p">();</span>

 <span class="c1">// expressions with instanceof and new</span>
    <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="p">(</span><span class="nx">class_</span><span class="o">.</span><span class="nv">$name</span><span class="p">);</span>
    <span class="nv">$x</span> <span class="nx">instanceof</span> <span class="p">(</span><span class="nx">class_</span><span class="nv">$name</span><span class="p">);</span>

    <span class="c1">// PHP 7.0 style</span>
    <span class="nv">$className</span> <span class="o">=</span> <span class="nx">class_</span><span class="o">.</span><span class="nv">$name</span><span class="p">;</span>
    <span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$className</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/variable_syntax_tweaks">PHP RFC: Variable Syntax Tweaks</a> and <a class="reference external" href="https://github.com/nikic/scalar_objects">scalar_objects in PHP</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80VariableSyntax</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="php-usematch">
<span id="id1268"></span><h2>9.480. Php/UseMatch<a class="headerlink" href="#php-usematch" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1269">
<h3>9.480.1. Suggestions<a class="headerlink" href="#id1269" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseMatch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="php7-relaxed-keyword">
<span id="id1270"></span><h2>9.481. Php7 Relaxed Keyword<a class="headerlink" href="#php7-relaxed-keyword" title="Permalink to this headline">¶</a></h2>
<p>Most of the traditional PHP keywords may be used inside classes, trait or interfaces.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Compatible with PHP 7.0 +</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// as is a PHP 5 keyword</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">as</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This was not the case in PHP 5, and will yield parse errors.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/migration70.other-changes.php#migration70.other-changes.loosening-reserved-words">Loosening Reserved Word Restrictions</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php7RelaxedKeyword</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="phpinfo">
<span id="id1271"></span><h2>9.482. Phpinfo<a class="headerlink" href="#phpinfo" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/phpinfo">phpinfo()</a> is a great function to learn about the current configuration of the server.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">DEBUG</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">phpinfo</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>If left in the production code, it may lead to a critical leak, as any attacker gaining access to this data will know a lot about the server configuration.</p>
<p>It is advised to never leave that kind of instruction in a production code.</p>
<p><a class="reference external" href="https://www.php.net/phpinfo">phpinfo()</a> may be necessary to access some specific configuration of the server : for example, <code class="docutils literal notranslate"><span class="pre">Apache</span></code> module list are only available via <a class="reference external" href="https://www.php.net/phpinfo">phpinfo()</a>, and apache_get(), when they are loaded.</p>
<div class="section" id="id1275">
<h3>9.482.1. Suggestions<a class="headerlink" href="#id1275" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove all usage of phpinfo()</li>
<li>Add one or more constant to fine-tune the phpinfo(), and limit the amount of displayed information</li>
<li>Replace phpinfo() with a more adapted method : get_loaded_extensions() to access the list of loaded extensions</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PhpinfoUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-structures-phpinfousage"><span class="std std-ref">Dolphin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="possible-alias-confusion">
<span id="id1276"></span><h2>9.483. Possible Alias Confusion<a class="headerlink" href="#possible-alias-confusion" title="Permalink to this headline">¶</a></h2>
<p>An alias is used for a class that doesn’t belong to the current namespace, while there is such a class. This also applies to traits and interfaces.</p>
<p>When no alias is used, PHP will search for a class in the local space. Since classes, traits and interfaces are usually stored one per file, it is a valid syntax to create an alias, even if this alias name is the name of a class in the same namespace.</p>
<p>Yet, with an alias refering to a remote class, while a local one is available, it is possible to generate confusion.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This should be in a separate file, but has been merged here, for display purposes.</span>
<span class="k">namespace</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="c1">//an alias from a namespace called C</span>
    <span class="k">use</span> <span class="nx">C\A</span> <span class="k">as</span> <span class="nx">C_A</span><span class="p">;</span>

    <span class="c1">//an alias from a namespace called C, which will superseed the local A\B class (see below)</span>
    <span class="k">use</span> <span class="nx">C\D</span> <span class="k">as</span> <span class="nx">B</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="c1">// There is a class B in the A namespace</span>
    <span class="k">class</span> <span class="nc">B</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1277">
<h3>9.483.1. Suggestions<a class="headerlink" href="#id1277" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using existing classes names for alias</li>
<li>Use a coding convention to distinguish alias from names</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/AliasConfusion</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="possible-increment">
<span id="id1278"></span><h2>9.484. Possible Increment<a class="headerlink" href="#possible-increment" title="Permalink to this headline">¶</a></h2>
<p>This expression looks like a typo : a missing + would change the behavior.</p>
<p>The same pattern is not reported with -, as it is legit expression. + sign is usually understated, rather than explicit.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// could it be a ++$b ?</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="o">+</span><span class="nv">$b</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.increment.php">Incrementing/Decrementing Operators</a> and <a class="reference external" href="https://www.php.net/manual/en/language.operators.arithmetic.php">Arithmetic Operators</a>.</p>
<div class="section" id="id1280">
<h3>9.484.1. Suggestions<a class="headerlink" href="#id1280" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the whole assignation</li>
<li>Complete the addition with another value : $a = 1 + $b</li>
<li>Make this a ++ operator : ++$b</li>
<li>Make this a negative operator : -$b</li>
<li>Make the casting explicit : (int) $b</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PossibleIncrement</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-structures-possibleincrement"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#mediawiki-structures-possibleincrement"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="possible-infinite-loop">
<span id="id1281"></span><h2>9.485. Possible Infinite Loop<a class="headerlink" href="#possible-infinite-loop" title="Permalink to this headline">¶</a></h2>
<p>Loops on files that can’t be open results in infinite loop.</p>
<p><a class="reference external" href="https://www.php.net/fgets">fgets()</a>, and functions like <a class="reference external" href="https://www.php.net/fgetss">fgetss()</a>, <a class="reference external" href="https://www.php.net/fgetcsv">fgetcsv()</a>, <a class="reference external" href="https://www.php.net/fread">fread()</a>, return false when they finish reading, or can’t access the file.</p>
<p>In case the file is not accessible, comparing the result of the reading to something that is falsy, leads to a permanent valid condition. The execution will only finish when the <code class="docutils literal notranslate"><span class="pre">max_execution_time</span></code> is reached.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$file</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/path/to/file.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
<span class="c1">// when fopen() fails, the next loops is infinite</span>
<span class="c1">// fgets() will always return false, and while will always be true.</span>
<span class="k">while</span><span class="p">(</span><span class="nv">$line</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to check the file resources when they are opened, and always use === or !== to compare readings. <a class="reference external" href="https://www.php.net/feof">feof()</a> is also a reliable function here.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PossibleInfiniteLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="possible-missing-subpattern">
<span id="id1283"></span><h2>9.486. Possible Missing Subpattern<a class="headerlink" href="#possible-missing-subpattern" title="Permalink to this headline">¶</a></h2>
<p>When capturing subpatterns are the last ones in a regex, PHP doesn’t fill their spot in the resulting array. This leads to a possible missing index in the result array.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// displays a partial array, from 0 to 1</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/(a)(b)?/&#39;</span><span class="p">,</span> <span class="s1">&#39;adc&#39;</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm">Array</span>
<span class="cm">(</span>
<span class="cm">    [0] =&gt; a</span>
<span class="cm">    [1] =&gt; a</span>
<span class="cm">)</span>
<span class="cm">*/</span>

<span class="c1">// displays a full array, from 0 to 2</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/(a)(b)?/&#39;</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">Array</span>
<span class="cm">(</span>
<span class="cm">    [0] =&gt; ab</span>
<span class="cm">    [1] =&gt; a</span>
<span class="cm">    [2] =&gt; b</span>
<span class="cm">)</span>
<span class="cm">*/</span>

<span class="c1">// double &#39;b&#39; when it is found</span>
<span class="k">print</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;,^a(b)?,&#39;</span><span class="p">,</span> <span class="s1">&#39;./$1$1&#39;</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">);</span> <span class="c1">// prints ./abbc</span>
<span class="k">print</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;,^a(b)?,&#39;</span><span class="p">,</span> <span class="s1">&#39;./$1$1&#39;</span><span class="p">,</span> <span class="s1">&#39;adc&#39;</span><span class="p">);</span> <span class="c1">// prints ./dc</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>?&gt;</p>
<p>The same applies to <a class="reference external" href="https://www.php.net/preg_replace">preg_replace()</a> : the pattern may match the string, but no value is available is the corresponding sub-pattern.</p>
<p>In PHP 7.4, a new option was added : PREG_UNMATCHED_AS_NULL, which always provides a value for the subpatterns.</p>
<p>See also <a class="reference external" href="https://bugs.php.net/bug.php?id=50887">Bug #50887 preg_match , last optional sub-patterns ignored when empty</a> and <a class="reference external" href="https://bugs.php.net/bug.php?id=73948">Bug #73948 Preg_match_all should return NULLs on trailing optional capture groups.</a>.</p>
<div class="section" id="id1285">
<h3>9.486.1. Suggestions<a class="headerlink" href="#id1285" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add an always capturing subpatterns after the last ?</li>
<li>Move the ? inside the parenthesis, so the parenthesis is always on, but the content may be empty</li>
<li>Add a test on the last index of the resulting array, to ensure it is available when needed</li>
<li>Use the PREG_UNMATCHED_AS_NULL option (PHP 7.4+)</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/MissingSubpattern</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpmyadmin-php-missingsubpattern"><span class="std std-ref">phpMyAdmin</span></a>, <a class="reference internal" href="Cases.html#spip-php-missingsubpattern"><span class="std std-ref">SPIP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="pre-increment">
<span id="id1286"></span><h2>9.487. Pre-increment<a class="headerlink" href="#pre-increment" title="Permalink to this headline">¶</a></h2>
<p>When possible, use the pre-increment operator (<code class="docutils literal notranslate"><span class="pre">++$i</span></code> or <code class="docutils literal notranslate"><span class="pre">--$i</span></code>) instead of the post-increment operator (<code class="docutils literal notranslate"><span class="pre">$i++</span></code> or <code class="docutils literal notranslate"><span class="pre">$i--</span></code>).</p>
<p>The latter needs an extra memory allocation that costs about 10% of performances.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// ++$i should be preferred over $i++, as current value is not important</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span><span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do Something</span>
<span class="p">}</span>

<span class="c1">// ++$b and $b++ have different impact here, since $a will collect $b + 1 or $b, respectively.</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span><span class="o">++</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is a micro-optimisation. However, its usage is so widespread, including within loops, that it may eventually have an significant impact on execution time. As such, it is recommended to adopt this rule, and only consider changing legacy code as they are refactored for other reasons.</p>
<div class="section" id="id1287">
<h3>9.487.1. Suggestions<a class="headerlink" href="#id1287" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the pre increment when the new value is not reused.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/PrePostIncrement</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#expressionengine-performances-prepostincrement"><span class="std std-ref">ExpressionEngine</span></a>, <a class="reference internal" href="Cases.html#traq-performances-prepostincrement"><span class="std std-ref">Traq</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="prefix-and-suffixes-with-typehint">
<span id="id1288"></span><h2>9.488. Prefix And Suffixes With Typehint<a class="headerlink" href="#prefix-and-suffixes-with-typehint" title="Permalink to this headline">¶</a></h2>
<p>This analysis checks the relationship between methods prefixes and suffixes, with their corresponding return typehint.</p>
<p>For example, a method with the signature <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">isACustomer()</span> <span class="pre">{}</span></code> should return a boolean. That boolean can then be read when calling the method : <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">($user-&gt;isACustomer())</span> <span class="pre">{}</span></code>.</p>
<p>There are multiple such convention that may be applied. For example, <code class="docutils literal notranslate"><span class="pre">has*</span></code> should return a boolean, <code class="docutils literal notranslate"><span class="pre">set*</span></code> should return nothing (a.k.a <code class="docutils literal notranslate"><span class="pre">void</span></code>), and <a href="#id1289"><span class="problematic" id="id1290">``</span></a>get*``shall return any kind of type.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span>  <span class="p">{</span>
    <span class="c1">// Easy to read convention</span>
    <span class="k">function</span> <span class="nf">isAUser</span><span class="p">()</span> <span class="o">:</span> <span class="nx">bool</span> <span class="p">{}</span>

    <span class="c1">// shall return a boolean</span>
    <span class="k">function</span> <span class="nf">isACustomer</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// shall return a string, based on suffix &#39;name =&gt; string&#39;</span>
    <span class="k">function</span> <span class="nf">getName</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// shall return a string, based on suffix &#39;name =&gt; string&#39;</span>
    <span class="k">function</span> <span class="nf">getUsername</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// shall return \Uuid, based on prefix &#39;uuid =&gt; \Uuid&#39;</span>
    <span class="k">function</span> <span class="nf">getUuid</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// shall return anything, based on no prefix nor suffix</span>
    <span class="k">function</span> <span class="nf">getBirthday</span><span class="p">()</span> <span class="p">{}</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>There are 2 parameters for this analysis. It is recommended to customize them to get an better results, related to the naming conventions used in the code.</p>
<p><code class="docutils literal notranslate"><span class="pre">prefixedType</span></code> is used for prefix in method names, which is the beginning of the name. <code class="docutils literal notranslate"><span class="pre">suffixedType</span></code> is used for suffixes : the ending part of the name. Matching is case insensitive.</p>
<p>The prefix is configured as the index of the map, while the related type is configured as the value of the map.</p>
<p><code class="docutils literal notranslate"><span class="pre">prefixToType['is']</span> <span class="pre">=</span> <span class="pre">'bool';</span></code> will be use as <code class="docutils literal notranslate"><span class="pre">is*</span></code> shall use the <code class="docutils literal notranslate"><span class="pre">bool</span></code> typehint.</p>
<p>Multiple typehints may be used at the same time. PHP supports multiple types since PHP 8.0, and Exakat will support them with any PHP version. Specify multiple types by separating them with comma. Any typehint not found in this list will be reported, including <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<p>PHP scalar types are available : <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">void</span></code>, etc. Explicit types, based on classes or interfaces, must use the fully qualified name, not the short name. <code class="docutils literal notranslate"><span class="pre">suffixToType['uuid']</span> <span class="pre">=</span> <span class="pre">'\Uuid';</span></code> will be use as <code class="docutils literal notranslate"><span class="pre">*uuid</span></code> shall use the <code class="docutils literal notranslate"><span class="pre">\Uuid</span></code> typehint.</p>
<p>When multiple rules applies, only one is reported.</p>
<div class="section" id="id1291">
<h3>9.488.1. Suggestions<a class="headerlink" href="#id1291" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="36%" />
<col width="9%" />
<col width="42%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>prefixedType</td>
<td>prefixedType[‘is’] = ‘bool’;
prefixedType[‘has’] = ‘bool’;
prefixedType[‘set’] = ‘void’;
prefixedType[‘list’] = ‘array’;</td>
<td>ini_hash</td>
<td>List of prefixes and their expected returntype</td>
</tr>
<tr class="row-odd"><td>suffixedType</td>
<td>prefixedType[‘list’] = ‘bool’;
prefixedType[‘int’] = ‘int’;
prefixedType[‘string’] = ‘string’;
prefixedType[‘name’] = ‘string’;
prefixedType[‘description’] = ‘string’;
prefixedType[‘id’] = ‘int’;
prefixedType[‘uuid’] = ‘Uuid’;</td>
<td>ini_hash</td>
<td>List of suffixes and their expected returntype</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/PrefixToType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="preprocess-arrays">
<span id="id1292"></span><h2>9.489. Preprocess Arrays<a class="headerlink" href="#preprocess-arrays" title="Permalink to this headline">¶</a></h2>
<p>Using long list of assignations for initializing arrays is significantly slower than the declaring them as an array.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Slow way</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// also with $a = array();</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>

<span class="c1">// Faster way</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
      <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
      <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span>
      <span class="mi">4</span> <span class="o">=&gt;</span> <span class="mi">7</span><span class="p">,</span>
      <span class="mi">5</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">];</span>

<span class="c1">// Even faster way if indexing is implicit</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">11</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>If the array has to be completed rather than created, it is also faster to use += when there are more than ten elements to add.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Slow way</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// also with $a = array();</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="c1">// some expressions to get $seven and $eleven</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$seven</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$eleven</span><span class="p">;</span>

<span class="c1">// Faster way</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
      <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
      <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">];</span>
<span class="c1">// some expressions to get $seven and $eleven</span>
<span class="nv">$a</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">4</span> <span class="o">=&gt;</span> <span class="nv">$seven</span><span class="p">,</span>
       <span class="mi">5</span> <span class="o">=&gt;</span> <span class="nv">$eleven</span><span class="p">];</span>

<span class="c1">// Even faster way if indexing is implicit</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">];</span>
<span class="c1">// some expressions to get $seven and $eleven</span>
<span class="nv">$a</span> <span class="o">+=</span> <span class="p">[</span><span class="nv">$seven</span><span class="p">,</span> <span class="nv">$eleven</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1293">
<h3>9.489.1. Suggestions<a class="headerlink" href="#id1293" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Preprocess the code so PHP doesn’t do it. Keep the detailed version into comments.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/ShouldPreprocess</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="preprocessable">
<span id="id1294"></span><h2>9.490. Preprocessable<a class="headerlink" href="#preprocessable" title="Permalink to this headline">¶</a></h2>
<p>The following expression are made of literals or already known values : they may be fully calculated before running PHP.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Building an array from a string</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="s1">&#39;PHP&#39;</span><span class="o">.</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="s1">&#39;7.2&#39;</span><span class="p">;</span>

<span class="c1">// Building an array from a string</span>
<span class="nv">$list</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;a,b,c,d,e,f&#39;</span><span class="p">);</span>

<span class="c1">// Calculating a power</span>
<span class="nv">$kbytes</span> <span class="o">=</span> <span class="nv">$bytes</span> <span class="o">/</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// This will never change</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nb">ucfirst</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="s1">&#39;PARIS&#39;</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>By doing so, this will reduce the amount of work of PHP.</p>
<div class="section" id="id1295">
<h3>9.490.1. Suggestions<a class="headerlink" href="#id1295" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do the work yourself, instead of giving it to PHP</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ShouldPreprocess</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#rector"><span class="std std-ref">Rector</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpadsnew-structures-shouldpreprocess"><span class="std std-ref">phpadsnew</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="print-and-die">
<span id="id1296"></span><h2>9.491. Print And Die<a class="headerlink" href="#print-and-die" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/die">Die() &lt;https://www.php.net/`die</a>&gt;`_ also prints.</p>
<p>When stopping a script with <a class="reference external" href="https://www.php.net/die">die() &lt;https://www.php.net/`die</a>&gt;`_, it is possible to provide a message as first argument, that will be displayed at execution. There is no need to make a specific call to print or echo.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//  die may do both print and die.</span>
<span class="k">echo</span> <span class="s1">&#39;Error message&#39;</span><span class="p">;</span>
<span class="k">die</span><span class="p">();</span>

<span class="c1">//  exit may do both print and die.</span>
<span class="k">print</span> <span class="s1">&#39;Error message&#39;</span><span class="p">;</span>
<span class="k">exit</span><span class="p">;</span>

<span class="c1">//  exit cannot print integers only : they will be used as status report to the system.</span>
<span class="k">print</span> <span class="s1">&#39;Error message&#39;</span><span class="p">;</span>
<span class="k">exit</span> <span class="mi">1</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PrintAndDie</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="printf-number-of-arguments">
<span id="id1299"></span><h2>9.492. Printf Number Of Arguments<a class="headerlink" href="#printf-number-of-arguments" title="Permalink to this headline">¶</a></h2>
<p>The number of arguments provided to <a class="reference external" href="https://www.php.net/printf">printf()</a> or <a class="reference external" href="https://www.php.net/vprintf">vprintf()</a> doesn’t match the format string.</p>
<p>Extra arguments are ignored, and are dead code as such. Missing arguments are reported with a warning, and nothing is displayed.</p>
<p>Omitted arguments produce an error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// not enough</span>
<span class="nb">printf</span><span class="p">(</span><span class="s1">&#39; a %s &#39;</span><span class="p">,</span> <span class="nv">$a1</span><span class="p">);</span>
<span class="c1">// OK</span>
<span class="nb">printf</span><span class="p">(</span><span class="s1">&#39; a %s &#39;</span><span class="p">,</span> <span class="nv">$a1</span><span class="p">,</span> <span class="nv">$a2</span><span class="p">);</span>
<span class="c1">// too many</span>
<span class="nb">printf</span><span class="p">(</span><span class="s1">&#39; a %s &#39;</span><span class="p">,</span> <span class="nv">$a1</span><span class="p">,</span> <span class="nv">$a2</span><span class="p">,</span> <span class="nv">$a3</span><span class="p">);</span>

<span class="c1">// not enough</span>
<span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39; a %s &#39;</span><span class="p">,</span> <span class="nv">$a1</span><span class="p">);</span>
<span class="c1">// OK</span>
<span class="nx">\sprintf</span><span class="p">(</span><span class="s1">&#39; a %s &#39;</span><span class="p">,</span> <span class="nv">$a1</span><span class="p">,</span> <span class="nv">$a2</span><span class="p">);</span>
<span class="c1">// too many</span>
<span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39; a %s &#39;</span><span class="p">,</span> <span class="nv">$a1</span><span class="p">,</span> <span class="nv">$a2</span><span class="p">,</span> <span class="nv">$a3</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/printf">printf</a> and <a class="reference external" href="https://www.php.net/sprintf">sprintf</a>.</p>
<div class="section" id="id1302">
<h3>9.492.1. Suggestions<a class="headerlink" href="#id1302" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Sync the number of argument with the format command</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PrintfArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpipam-structures-printfarguments"><span class="std std-ref">PhpIPAM</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="processing-collector">
<span id="id1303"></span><h2>9.493. Processing Collector<a class="headerlink" href="#processing-collector" title="Permalink to this headline">¶</a></h2>
<p>When accumulating data in a variable, within a loop, it is slow to apply repeatedly a function to the variable.</p>
<p>The example below illustrate the problem : <code class="docutils literal notranslate"><span class="pre">$collector</span></code> is build with element from <code class="docutils literal notranslate"><span class="pre">$array</span></code>. <code class="docutils literal notranslate"><span class="pre">$collector</span></code> actually gets larger and larger, slowing the <a class="reference external" href="https://www.php.net/in_array">in_array()</a> call each time.</p>
<p>It is better to apply the <a class="reference external" href="https://www.php.net/preg_replace">preg_replace()</a> to <code class="docutils literal notranslate"><span class="pre">$a</span></code>, a short variable, and then, add <code class="docutils literal notranslate"><span class="pre">$a</span></code> to the collector.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Fast way</span>
<span class="nv">$collector</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">){</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/__(.*?)__/&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;b&gt;$1&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>
    <span class="nv">$collector</span> <span class="o">.=</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Slow way</span>
<span class="nv">$collector</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">){</span>
    <span class="nv">$collector</span> <span class="o">.=</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="nv">$collector</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/__(.*?)__/&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;b&gt;$1&lt;/b&gt;&#39;</span><span class="p">,</span> <span class="nv">$collector</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1306">
<h3>9.493.1. Suggestions<a class="headerlink" href="#id1306" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid applying the checks on the whole data, rather on the diff only.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/RegexOnCollector</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="property-could-be-local">
<span id="id1307"></span><h2>9.494. Property Could Be Local<a class="headerlink" href="#property-could-be-local" title="Permalink to this headline">¶</a></h2>
<p>A property only used in one method may be turned into a local variable.</p>
<p>Public an protected properties are omitted here : they may be modified somewhere else, in the code. This analysis may be upgraded to support those properties, when tracking of such properties becomes available.</p>
<p>Classes where only one non-magic method is available are omitted.</p>
<p>Traits with private properties are processed the same way.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Magic method, and constructor in particular, are omitted.</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$foo</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span> <span class="o">=</span> <span class="nv">$foo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span><span class="o">++</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">barbar</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1308">
<h3>9.494.1. Suggestions<a class="headerlink" href="#id1308" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the property and make it an argument in the method</li>
<li>Use that property elsewhere</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/PropertyCouldBeLocal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#mautic-classes-propertycouldbelocal"><span class="std std-ref">Mautic</span></a>, <a class="reference internal" href="Cases.html#typo3-classes-propertycouldbelocal"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="property-could-be-private-property">
<span id="id1309"></span><h2>9.495. Property Could Be Private Property<a class="headerlink" href="#property-could-be-private-property" title="Permalink to this headline">¶</a></h2>
<p>The following properties are never used outside their class of definition  Given the analyzed code, they could be set as private.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$couldBePrivate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$cantdBePrivate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// couldBePrivate is used internally.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">couldBePrivate</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">foo2</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar2</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// cantdBePrivate is used in a child class.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cantdBePrivate</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//$couldBePrivate is not used outside</span>
<span class="nv">$foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">foo</span><span class="p">();</span>

<span class="c1">//$cantdBePrivate is used outside the class</span>
<span class="nv">$foo</span><span class="o">-&gt;</span><span class="na">cantdBePrivate</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that dynamic properties (such as $x-&gt;$y) are not taken into account.</p>
<div class="section" id="id1310">
<h3>9.495.1. Suggestions<a class="headerlink" href="#id1310" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the unused property</li>
<li>Use the private property</li>
<li>Change the visibility to allow access the property from other part of the code</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/CouldBePrivate</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="property-used-in-one-method-only">
<span id="id1311"></span><h2>9.496. Property Used In One Method Only<a class="headerlink" href="#property-used-in-one-method-only" title="Permalink to this headline">¶</a></h2>
<p>Properties should be used in several methods. When a property is used in only one method, this should have be of another shape.</p>
<p>Properties used in one method only may be used several times, and read only. This may be a class constant. Such properties are meant to be overwritten by an extending class, and that’s possible with class constants.</p>
<p>Properties that read and written may be converted into a variable, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> to the method. This way, they are kept close to the method, and do not pollute the object’s properties.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$once</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">const</span> <span class="no">ONCE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// $this-&gt;once is never used anywhere else.</span>
        <span class="nx">someFunction</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">);</span>
        <span class="nx">someFunction</span><span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="na">ONCE</span><span class="p">);</span>   <span class="c1">// Make clear that it is a</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">bar2</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">static</span> <span class="nv">$localCounter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">counter</span><span class="o">++</span><span class="p">;</span>

        <span class="c1">// $this-&gt;once is only used here, for distinguising calls to someFunction2</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">counter</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// $this-&gt;counter is used only in bar2, but it may be used several times</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">someFunction2</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">counter</span><span class="p">);</span>

        <span class="c1">// $localCounter keeps track for all the calls</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$localCounter</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">someFunction2</span><span class="p">(</span><span class="nv">$localCounter</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note : properties used only once are not returned by this analysis. They are omitted, and are available in the analysis <a class="reference internal" href="#id1988">Used Once Property</a>.</p>
<div class="section" id="id1313">
<h3>9.496.1. Suggestions<a class="headerlink" href="#id1313" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the property, and inline the value</li>
<li>Drop the property, and make the property a local variable</li>
<li>Use the property in another method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/PropertyUsedInOneMethodOnly</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#contao-classes-propertyusedinonemethodonly"><span class="std std-ref">Contao</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="property-variable-confusion">
<span id="id1314"></span><h2>9.497. Property Variable Confusion<a class="headerlink" href="#property-variable-confusion" title="Permalink to this headline">¶</a></h2>
<p>Within a class, there is both a property and variables bearing the same name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">class</span> <span class="nc">Object</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$x</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">SetData</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">x</span> <span class="o">=</span> <span class="nv">$x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The property and the variable may easily be confused one for another and lead to a bug.</p>
<p>Sometimes, when the property is going to be replaced by the incoming argument, or data based on that argument, this naming schema is made on purpose, indicating that the current argument will eventually end up in the property. When the argument has the same name as the property, no warning is reported.</p>
<div class="section" id="id1315">
<h3>9.497.1. Suggestions<a class="headerlink" href="#id1315" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use different names for the properties and variables</li>
<li>Adopt and apply a naming convention for variables and properties.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/PropertyVariableConfusion</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpipam-structures-propertyvariableconfusion"><span class="std std-ref">PhpIPAM</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="queries-in-loops">
<span id="id1316"></span><h2>9.498. Queries In Loops<a class="headerlink" href="#queries-in-loops" title="Permalink to this headline">¶</a></h2>
<p>Avoid querying databases in a loop.</p>
<p>Querying an external database in a loop usually leads to performances problems. This is also called the ‘n + 1 problem’.</p>
<p>This problem applies also to prepared statement : when such statement are called in a loop, they are slower than one-time large queries.</p>
<p>It is recommended to reduce the number of queries by making one query, and dispatching the results afterwards. This is true with SQL databases, graph queries, LDAP queries, etc.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Typical N = 1 problem : there will be as many queries as there are elements in $array</span>
<span class="nv">$ids</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

<span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SQLite3</span><span class="p">(</span><span class="s1">&#39;mysqlitedb.db&#39;</span><span class="p">);</span>

<span class="c1">// all the IDS are merged into the query at once</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;SELECT bar FROM foo WHERE id  in (&#39;</span><span class="o">.</span><span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;)&#39;</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$results</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">())</span> <span class="p">{</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// Typical N = 1 problem : there will be as many queries as there are elements in $array</span>
<span class="nv">$ids</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

<span class="nv">$db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SQLite3</span><span class="p">(</span><span class="s1">&#39;mysqlitedb.db&#39;</span><span class="p">);</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$ids</span> <span class="k">as</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$results</span> <span class="o">=</span> <span class="nv">$db</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;SELECT bar FROM foo WHERE id = &#39;</span><span class="o">.</span><span class="nv">$id</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$row</span> <span class="o">=</span> <span class="nv">$results</span><span class="o">-&gt;</span><span class="na">fetchArray</span><span class="p">())</span> <span class="p">{</span>
        <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$row</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This optimisation is not always possible : for example, some SQL queries may not be prepared, like <code class="docutils literal notranslate"><span class="pre">DROP</span> <span class="pre">TABLE</span></code> or <code class="docutils literal notranslate"><span class="pre">DESC</span></code>. <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> commands often update one row at a time, and grouping such queries may be counter-productive or unsafe.</p>
<div class="section" id="id1317">
<h3>9.498.1. Suggestions<a class="headerlink" href="#id1317" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Batch calls by using WHERE clauses and applying the same operation to all similar data</li>
<li>Use native commands to avoid double query : REPLACE instead of SELECT-(UPDATE/INSERT), or UPSERT, for example</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/QueriesInLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#teampass-structures-queriesinloop"><span class="std std-ref">TeamPass</span></a>, <a class="reference internal" href="Cases.html#openemr-structures-queriesinloop"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="raised-access-level">
<span id="id1318"></span><h2>9.499. Raised Access Level<a class="headerlink" href="#raised-access-level" title="Permalink to this headline">¶</a></h2>
<p>A property’s visibility may be lowered, but not raised.</p>
<p>This error may be detected when the classes are all in the same file : then, PHP reports the problem. However, when the classes are separated in different files, as it is customary, PHP won’t check this at linting time, yielding a fatal error at execution time.</p>
<p>First file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$publicProperty</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$protectedProperty</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$privateProperty</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Second file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Bar</span> <span class="k">extends</span> <span class="nx">Foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$publicProperty</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$protectedProperty</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$privateProperty</span><span class="p">;</span>   <span class="c1">// This one is OK</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.visibility.php">Visibility</a> and <a class="reference external" href="https://torquemag.io/2016/05/understanding-concept-visibility-object-oriented-php/">Understanding the concept of visibility in object oriented php</a>.</p>
<div class="section" id="id1321">
<h3>9.499.1. Suggestions<a class="headerlink" href="#id1321" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Lower the visibility in the child class</li>
<li>Raise the visibility in the parent class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/RaisedAccessLevel</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="random-without-try">
<span id="id1322"></span><h2>9.500. Random Without Try<a class="headerlink" href="#random-without-try" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/random_int">random_int()</a> and <a class="reference external" href="https://www.php.net/random_bytes">random_bytes()</a> require a try/catch structure around them.</p>
<p><a class="reference external" href="https://www.php.net/random_int">random_int()</a> and <a class="reference external" href="https://www.php.net/random_bytes">random_bytes()</a> emit Exceptions if they meet a problem. This way, failure can’t be mistaken with returning an empty value, which leads to lower security.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$salt</span> <span class="o">=</span> <span class="nx">random_bytes</span><span class="p">(</span><span class="nv">$length</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">TypeError</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Error while reading the provided parameter</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Insufficient random data generated</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Error</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Error with the provided parameter : &lt;= 0</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Since PHP 7.4, <a class="reference external" href="https://www.php.net/openssl_random_pseudo_bytes">openssl_random_pseudo_bytes()</a> has adopted the same behavior. It is included in this analysis : check your PHP version for actual application.</p>
<div class="section" id="id1327">
<h3>9.500.1. Suggestions<a class="headerlink" href="#id1327" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a try/catch structure around calls to random_int() and random_bytes().</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/RandomWithoutTry</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="randomly-sorted-arrays">
<span id="id1328"></span><h2>9.501. Randomly Sorted Arrays<a class="headerlink" href="#randomly-sorted-arrays" title="Permalink to this headline">¶</a></h2>
<p>Those literal arrays are written in several places, but their items are in various orders.</p>
<p>This may reduce the reading and proofing of the arrays, and induce confusion. The random order may also be a residue of development : both arrays started with different values, but they grew overtime to handle the same items. The way they were written lead to the current order.</p>
<p>Unless order is important, it is recommended to always use the same order when defining literal arrays. This makes it easier to match different part of the code by recognizing one of its literal.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// an array</span>
<span class="nv">$set</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">];</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// an array, with the same values but different order, in a different context</span>
    <span class="nv">$list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">,];</span>
<span class="p">}</span>

<span class="c1">// an array, with the same order than the initial one</span>
<span class="nv">$inits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1329">
<h3>9.501.1. Suggestions<a class="headerlink" href="#id1329" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Match the sorting order of the arrays. Choose any of them.</li>
<li>Configure a constant and use it as a replacement for those arrays.</li>
<li>Leave the arrays intact : the order may be important.</li>
<li>For hash arrays, consider turning the array in a class.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/RandomlySortedLiterals</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#contao-arrays-randomlysortedliterals"><span class="std std-ref">Contao</span></a>, <a class="reference internal" href="Cases.html#vanilla-arrays-randomlysortedliterals"><span class="std std-ref">Vanilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="redeclared-php-functions">
<span id="id1330"></span><h2>9.502. Redeclared PHP Functions<a class="headerlink" href="#redeclared-php-functions" title="Permalink to this headline">¶</a></h2>
<p>Function that bear the same name as a PHP function, and that are declared.</p>
<p>This is useful when managing backward compatibility, like emulating an old function, or preparing for newer PHP versions, like emulating new upcoming function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="k">PHP_VERSION</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">split</span><span class="p">(</span><span class="nv">$separator</span><span class="p">,</span> <span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">explode</span><span class="p">(</span><span class="nv">$separator</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;2 3&#39;</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1331">
<h3>9.502.1. Suggestions<a class="headerlink" href="#id1331" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check if it is still worth emulating that function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/RedeclaredPhpFunction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="redefined-class-constants">
<span id="id1332"></span><h2>9.503. Redefined Class Constants<a class="headerlink" href="#redefined-class-constants" title="Permalink to this headline">¶</a></h2>
<p>Redefined class constants.</p>
<p>Class constants may be redefined, though it is prone to errors when using them, as it is now crucial to use the right class name to access the right value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">b</span> <span class="k">extends</span> <span class="nx">a</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">c</span> <span class="k">extends</span> <span class="nx">c</span> <span class="p">{</span> <span class="p">}</span>

<span class="k">echo</span> <span class="nx">a</span><span class="o">::</span><span class="na">A</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nx">b</span><span class="o">::</span><span class="na">A</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nx">c</span><span class="o">::</span><span class="na">A</span><span class="p">;</span>
<span class="c1">// 1 2 2</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to use distinct names.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/RedefinedConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="redefined-default">
<span id="id1333"></span><h2>9.504. Redefined Default<a class="headerlink" href="#redefined-default" title="Permalink to this headline">¶</a></h2>
<p>Classes allows properties to be set with a default value. When those properties get, unconditionally, another value at constructor time, then one of the default value are useless. One of those definition should go : it is better to define properties outside the constructor.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$redefined</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redefined</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1334">
<h3>9.504.1. Suggestions<a class="headerlink" href="#id1334" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the default assignation to the property definition</li>
<li>Drop the reassignation in the constructor</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/RedefinedDefault</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#piwigo-classes-redefineddefault"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="redefined-private-property">
<span id="id1335"></span><h2>9.505. Redefined Private Property<a class="headerlink" href="#redefined-private-property" title="Permalink to this headline">¶</a></h2>
<p>Private properties are local to their defined class. PHP doesn’t forbid the re-declaration of a private property in a child class.</p>
<p>However, having two or more properties with the same name, in the class hierarchy tends to be error prone.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$isReady</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">B</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$isReady</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/RedefinedPrivateProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-classes-redefinedprivateproperty"><span class="std std-ref">Zurmo</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="redefined-property">
<span id="id1336"></span><h2>9.506. Redefined Property<a class="headerlink" href="#redefined-property" title="Permalink to this headline">¶</a></h2>
<p>Property redefined in a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class.</p>
<p>Using heritage, it is possible to define several times the same property, at different levels of the hierarchy.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$aProperty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">bar</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="c1">// This property is redefined in the parent class, leading to potential confusion</span>
    <span class="k">protected</span> <span class="nv">$aProperty</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When this is the case, it is difficult to understand which class will actually handle the property.</p>
<p>In the case of a private property, the different instances will stay distinct. In the case of protected or public properties, they will all share the same value.</p>
<p>It is recommended to avoid redefining the same property in a hierarchy.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/RedefinedProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="reflection-export-is-deprecated">
<span id="id1338"></span><h2>9.507. Reflection Export() Is Deprecated<a class="headerlink" href="#reflection-export-is-deprecated" title="Permalink to this headline">¶</a></h2>
<p>export() method in Reflection classes is now deprecated. It is obsolete since PHP 7.4 and will disappear in PHP 8.0.</p>
<p>The Reflector interface, which is implemented by all reflection classes, specifies two methods: <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a> and export().</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nx">ReflectionFunction</span><span class="o">::</span><span class="na">export</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
<span class="c1">// same as</span>
<span class="k">echo</span> <span class="k">new</span> <span class="nx">ReflectionFunction</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="nx">\n</span><span class="p">;</span>

<span class="nv">$str</span> <span class="o">=</span> <span class="nx">ReflectionFunction</span><span class="o">::</span><span class="na">export</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="c1">// same as</span>
<span class="nv">$str</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="k">new</span> <span class="nx">ReflectionFunction</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_4#reflection_export_methods">Reflection export() methods</a> and <a class="reference external" href="https://www.php.net/manual/en/book.reflection.php">Reflection</a>.</p>
<div class="section" id="id1340">
<h3>9.507.1. Suggestions<a class="headerlink" href="#id1340" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Cast the object to string</li>
<li>Remove the call to export()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ReflectionExportIsDeprecated</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="regex-on-arrays">
<span id="id1341"></span><h2>9.508. Regex On Arrays<a class="headerlink" href="#regex-on-arrays" title="Permalink to this headline">¶</a></h2>
<p>Avoid using a loop with arrays of regex or values. There are several PHP function which work directly on arrays, and much faster.</p>
<p><a class="reference external" href="https://www.php.net/preg_grep">preg_grep()</a> is able to extract all matching strings from an array, or non-matching strings. This usually saves a loop over the strings.</p>
<p><a class="reference external" href="https://www.php.net/preg_filter">preg_filter()</a> is able to extract all strings from an array, matching at least one regex in an array. This usually saves a double loop over the strings and the regex. The trick here is to provide ‘$0’ as replacement, leading <a class="reference external" href="https://www.php.net/preg_filter">preg_filter()</a> to replace the found string by itself.</p>
<p>Finally, <a class="reference external" href="https://www.php.net/preg_replace_callback">preg_replace_callback()</a> an <a class="reference external" href="https://www.php.net/preg_replace_callback_array">preg_replace_callback_array()</a> are also able to apply an array of regex to an array of strings, and then, apply callbacks to the found values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$regexs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/ab+c/&#39;</span><span class="p">,</span> <span class="s1">&#39;/abd+/&#39;</span><span class="p">,</span> <span class="s1">&#39;/abe+/&#39;</span><span class="p">];</span>
<span class="nv">$strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/abbbbc/&#39;</span><span class="p">,</span> <span class="s1">&#39;/abd/&#39;</span><span class="p">,</span> <span class="s1">&#39;/abeee/&#39;</span><span class="p">];</span>

<span class="c1">// Directly extract all strings that match one regex</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$regexs</span> <span class="k">as</span> <span class="nv">$regex</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$results</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">preg_grep</span><span class="p">(</span><span class="nv">$regex</span><span class="p">,</span> <span class="nv">$strings</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// extract all matching regex, by string</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$strings</span> <span class="k">as</span> <span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$results</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">preg_filter</span><span class="p">(</span><span class="nv">$regexs</span><span class="p">,</span> <span class="nb">array_fill</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$regexs</span><span class="p">),</span> <span class="s1">&#39;$0&#39;</span><span class="p">),</span> <span class="nv">$string</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// very slow way to get all the strings that match a regex</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$regexs</span> <span class="k">as</span> <span class="nv">$regex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$strings</span> <span class="k">as</span> <span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$regex</span><span class="p">,</span> <span class="nv">$string</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$results</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$string</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://php.net/preg_filter">preg_filter</a>.</p>
<div class="section" id="id1346">
<h3>9.508.1. Suggestions<a class="headerlink" href="#id1346" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Apply preg_match() to an array of string or regex, via preg_filter() or preg_grep().</li>
<li>Apply preg_match() to an array of string or regex, via preg_replace_callback() or preg_replace_callback_array().</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/RegexOnArrays</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="register-globals">
<span id="id1347"></span><h2>9.509. Register Globals<a class="headerlink" href="#register-globals" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">register_globals</span></code> was a PHP directive that dumped all incoming variables from GET, POST, COOKIE and FILES as global variables in the called scripts.
This lead to security failures, as the variables were often used but not filtered.</p>
<p>Though it is less often found in more recent code, <code class="docutils literal notranslate"><span class="pre">register_globals</span></code> is sometimes needed in legacy code, that haven’t made the move to eradicate this style of coding.
Backward compatible pieces of code that mimic the <code class="docutils literal notranslate"><span class="pre">register_globals</span></code> features usually create even greater security risks by being run after scripts startup. At that point, some important variables are already set, and may be overwritten by the incoming call, creating confusion in the script.</p>
<p>Mimicking <code class="docutils literal notranslate"><span class="pre">register_globals</span></code> is achieved with variables variables, <a class="reference external" href="https://www.php.net/extract">extract()</a>, <a class="reference external" href="https://www.php.net/parse_str">parse_str()</a> and <a class="reference external" href="https://www.php.net/import_request_variables">import_request_variables()</a> (Up to PHP 5.4).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Security warning ! This overwrites existing variables.</span>
<span class="nb">extract</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">);</span>

<span class="c1">// Security warning ! This overwrites existing variables.</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$_REQUEST</span> <span class="k">as</span> <span class="nv">$var</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$$var</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1350">
<h3>9.509.1. Suggestions<a class="headerlink" href="#id1350" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid reimplementing register_globals</li>
<li>Use a container to store and access commonly used values</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/RegisterGlobals</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#teampass-security-registerglobals"><span class="std std-ref">TeamPass</span></a>, <a class="reference internal" href="Cases.html#xoops-security-registerglobals"><span class="std std-ref">XOOPS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="relay-function">
<span id="id1351"></span><h2>9.510. Relay Function<a class="headerlink" href="#relay-function" title="Permalink to this headline">¶</a></h2>
<p>Relay function only delegate workload to another one.</p>
<p>Relay functions and methods are delegating the actual work to another function or method. They do not have any impact on the results, besides exposing another name for the same feature.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">myStrtolower</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">\strtolower</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Relay functions are typical of transition API, where an old API have to be preserved until it is fully migrated. Then, they may be removed, so as to reduce confusion, and simplify the API.</p>
<div class="section" id="id1352">
<h3>9.510.1. Suggestions<a class="headerlink" href="#id1352" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove relay function, call directly the final function</li>
<li>Remove the target function, and move the code here</li>
<li>Add more logic to that function, like conditions or cache</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/RelayFunction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#teampass-functions-relayfunction"><span class="std std-ref">TeamPass</span></a>, <a class="reference internal" href="Cases.html#spip-functions-relayfunction"><span class="std std-ref">SPIP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="repeated-interface">
<span id="id1353"></span><h2>9.511. Repeated Interface<a class="headerlink" href="#repeated-interface" title="Permalink to this headline">¶</a></h2>
<p>A class should implements only once an interface. An interface can only extends once another interface. In both cases, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> classes or interfaces must be checked.</p>
<p>PHP accepts multiple times the same interface in the <code class="docutils literal notranslate"><span class="pre">implements</span></code> clause. In fact, it doesn’t do anything beyond the first implement.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">i</span> <span class="k">as</span> <span class="nx">j</span><span class="p">;</span>

<span class="k">interface</span> <span class="nx">i</span> <span class="p">{}</span>

<span class="c1">// Multiple ways to reference an interface</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="k">implements</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">\i</span><span class="p">,</span> <span class="nx">j</span> <span class="p">{}</span>

<span class="c1">// This applies to interfaces too</span>
<span class="k">interface</span> <span class="nx">bar</span> <span class="k">extends</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">\i</span><span class="p">,</span> <span class="nx">j</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This code may compile, but won’t execute.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.interfaces.php">Object Interfaces</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">The Basics</a>.</p>
<div class="section" id="id1356">
<h3>9.511.1. Suggestions<a class="headerlink" href="#id1356" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the interface usage at the lowest class or interface</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/RepeatedInterface</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="repeated-regex">
<span id="id1357"></span><h2>9.512. Repeated Regex<a class="headerlink" href="#repeated-regex" title="Permalink to this headline">¶</a></h2>
<p>Repeated regex should be centralized.</p>
<p>When a regex is repeatedly used in the code, it is getting harder to update.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Regex used several times, at least twice.</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^abc_|^square$/i&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]);</span>

<span class="c1">//.......</span>

<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^abc_|^square$/i&#39;</span><span class="p">,</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]);</span>

<span class="c1">// This regex is dynamically built, so it is not reported.</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^circle|^&#39;</span><span class="o">.</span><span class="nv">$x</span><span class="o">.</span><span class="s1">&#39;$/i&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="c1">// This regex is used once, so it is not reported.</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^circle|^square$/i&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Regex that are repeated at least once (aka, used twice or more) are reported. Regex that are dynamically build are not reported.</p>
<div class="section" id="id1358">
<h3>9.512.1. Suggestions<a class="headerlink" href="#id1358" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create a central library of regex</li>
<li>Use the regex inventory to spot other regex that are close, and should be identical.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/RepeatedRegex</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#vanilla-structures-repeatedregex"><span class="std std-ref">Vanilla</span></a>, <a class="reference internal" href="Cases.html#tikiwiki-structures-repeatedregex"><span class="std std-ref">Tikiwiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="repeated-print">
<span id="id1359"></span><h2>9.513. Repeated print()<a class="headerlink" href="#repeated-print" title="Permalink to this headline">¶</a></h2>
<p>Always merge several print or echo in one call.</p>
<p>It is recommended to use echo with multiple arguments, or a concatenation with print, instead of multiple calls to print echo, when outputting several blob of text.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//Write :</span>
  <span class="k">echo</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">;</span>
  <span class="k">print</span> <span class="s1">&#39;a&#39;</span> <span class="o">.</span> <span class="nv">$b</span> <span class="o">.</span> <span class="s1">&#39;c&#39;</span><span class="p">;</span>

<span class="c1">//Don&#39;t write :</span>
  <span class="k">print</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>
  <span class="k">print</span> <span class="nv">$b</span><span class="p">;</span>
  <span class="k">print</span> <span class="s1">&#39;c&#39;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1360">
<h3>9.513.1. Suggestions<a class="headerlink" href="#id1360" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge all prints into one echo call, separating arguments by commas.</li>
<li>Collect all values in one variable, and do only one call to print or echo.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/RepeatedPrint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-repeated-print.md">no-repeated-print</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#edusoho-structures-repeatedprint"><span class="std std-ref">Edusoho</span></a>, <a class="reference internal" href="Cases.html#humo-gen-structures-repeatedprint"><span class="std std-ref">HuMo-Gen</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="reserved-keywords-in-php-7">
<span id="id1361"></span><h2>9.514. Reserved Keywords In PHP 7<a class="headerlink" href="#reserved-keywords-in-php-7" title="Permalink to this headline">¶</a></h2>
<p>PHP reserved names for class/trait/interface. They won’t be available anymore in user space starting with PHP 7.</p>
<p>For example, string, float, false, true, null, resource,`… &lt;<a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list">https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list</a>&gt;`_ are not acceptable as class name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This doesn&#39;t compile in PHP 7.0 and more recent</span>
<span class="k">class</span> <span class="nc">null</span> <span class="p">{</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/reserved.other-reserved-words.php">List of other reserved words</a>.</p>
<div class="section" id="id1363">
<h3>9.514.1. Suggestions<a class="headerlink" href="#id1363" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using PHP reserved keywords</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ReservedKeywords7</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="results-may-be-missing">
<span id="id1364"></span><h2>9.515. Results May Be Missing<a class="headerlink" href="#results-may-be-missing" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/preg_match">preg_match()</a> may return empty values, if the search fails. It is important to check for the existence of results before assigning them to another variable, or using it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/PHP ([0-9\.]+) /&#39;</span><span class="p">,</span> <span class="nv">$res</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>
    <span class="nv">$s</span> <span class="o">=</span> <span class="nv">$r</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="c1">// $s may end up null if preg_match fails.</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ResultMayBeMissing</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="rethrown-exceptions">
<span id="id1365"></span><h2>9.516. Rethrown Exceptions<a class="headerlink" href="#rethrown-exceptions" title="Permalink to this headline">¶</a></h2>
<p>Throwing a caught exception is usually useless and dead code.</p>
<p>When exceptions are caught, they should be processed or transformed, but not rethrown as is.</p>
<p>Those issues often happen when a catch structure was positioned for debug purposes, but lost its usage later.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://stackoverflow.com/questions/5551668/what-are-the-best-practices-for-catching-and-re-throwing-exceptions">What are the best practices for catching and re-throwing exceptions?</a> and <a class="reference external" href="https://www.php.net/manual/en/exception.construct.php">Exception chaining</a>.</p>
<div class="section" id="id1366">
<h3>9.516.1. Suggestions<a class="headerlink" href="#id1366" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Log the message of the exception for later usage.</li>
<li>Remove the try/catch and let the rest of the application handle this exception.</li>
<li>Chain the exception, by throwing a new exception, including the caught exception.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/Rethrown</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#prestashop-exceptions-rethrown"><span class="std std-ref">PrestaShop</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="return-true-false">
<span id="id1367"></span><h2>9.517. Return True False<a class="headerlink" href="#return-true-false" title="Permalink to this headline">¶</a></h2>
<p>These conditional expressions return true/false, depending on the condition. This may be simplified by dropping the control structure altogether.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This may be simplified with :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">return</span> <span class="nb">version_compare</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This may be applied to assignations and ternary operators too.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nb">version_compare</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="k">false</span> <span class="o">:</span> <span class="k">true</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1368">
<h3>9.517.1. Suggestions<a class="headerlink" href="#id1368" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Return directly the comparison, without using the if/then structure</li>
<li>Cast the value to (boolean) and use it instead of the ternary</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ReturnTrueFalse</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#mautic-structures-returntruefalse"><span class="std std-ref">Mautic</span></a>, <a class="reference internal" href="Cases.html#fuelcms-structures-returntruefalse"><span class="std std-ref">FuelCMS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="return-with-parenthesis">
<span id="id1369"></span><h2>9.518. Return With Parenthesis<a class="headerlink" href="#return-with-parenthesis" title="Permalink to this headline">¶</a></h2>
<p>return statement doesn’t need parenthesis. PHP tolerates them with return statement, but it is recommended not to use them.</p>
<p>From the PHP Manual : ‘Note: Note that since return is a language construct and not a function, the parentheses surrounding its argument are not required and their use is discouraged.’.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

    <span class="c1">// No need for parenthesis</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>

    <span class="c1">// Parenthesis are useless here</span>
    <span class="k">return</span> <span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

    <span class="c1">// Parenthesis are useful here: they are needed by the multplication.</span>
    <span class="k">return</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://stackoverflow.com/questions/2921843/php-returnvalue-vs-return-value">PHP return(value); vs return value;</a> and <a class="reference external" href="https://www.php.net/manual/en/function.return.php">return</a>.</p>
<div class="section" id="id1371">
<h3>9.518.1. Suggestions<a class="headerlink" href="#id1371" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the parenthesis</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ReturnWithParenthesis</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="reuse-variable">
<span id="id1372"></span><h2>9.519. Reuse Variable<a class="headerlink" href="#reuse-variable" title="Permalink to this headline">¶</a></h2>
<p>A variable is already holding the content that is calculated multiple times over.</p>
<p>It is recommended to use the cached value. This saves some computation, in particular when used in a loop, and speeds up the process.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

    <span class="c1">// strtolower($a) is already calculated in $b. Just reuse the value.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doSomething</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1373">
<h3>9.519.1. Suggestions<a class="headerlink" href="#id1373" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Reuse the already created variable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ReuseVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="safe-curl-options">
<span id="id1374"></span><h2>9.520. Safe Curl Options<a class="headerlink" href="#safe-curl-options" title="Permalink to this headline">¶</a></h2>
<p>It is advised to always use <code class="docutils literal notranslate"><span class="pre">CURLOPT_SSL_VERIFYPEER</span></code> and <code class="docutils literal notranslate"><span class="pre">CURLOPT_SSL_VERIFYHOST</span></code> when requesting a SSL connection.</p>
<p>With those tests, the certificate is verified, and if it isn’t valid, the connection fails : this is a safe behavior.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>

<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nx">https</span><span class="o">://</span><span class="nx">www</span><span class="o">.</span><span class="nx">php</span><span class="o">.</span><span class="nx">net</span><span class="o">/</span><span class="p">);</span>

<span class="c1">// To be safe, always set this to true</span>
<span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="nb">curl_close</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.saotn.org/dont-turn-off-curlopt_ssl_verifypeer-fix-php-configuration/">Don’t turn off CURLOPT_SSL_VERIFYPEER, fix your PHP configuration</a>, <a class="reference external" href="https://paragonie.com/blog/2017/10/certainty-automated-cacert-pem-management-for-php-software">Certainty: Automated CACert.pem Management for PHP Software</a> and <a class="reference external" href="https://paragonie.com/blog/2017/12/2018-guide-building-secure-php-software#secure-server-side-https">Server-Side HTTPS Requests</a>.</p>
<div class="section" id="id1375">
<h3>9.520.1. Suggestions<a class="headerlink" href="#id1375" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use CURLOPT_SSL_VERIFYPEER and HTTPS for communication with other servers</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/CurlOptions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openconf-security-curloptions"><span class="std std-ref">OpenConf</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="safe-http-headers">
<span id="id1376"></span><h2>9.521. Safe HTTP Headers<a class="headerlink" href="#safe-http-headers" title="Permalink to this headline">¶</a></h2>
<p>Avoid configuring HTTP headers with lax restriction from within PHP.</p>
<p>There are a lot of HTTP headers those days, targeting various vulnerabilities. To ensure backward compatibility, those headers have a default mode that is lax and permissive. It is recommended to avoid using those from within the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//Good configuration, limiting access to origin</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin: https://www.exakat.io&#39;</span><span class="p">);</span>

<span class="c1">//Configuration is present, but doesn&#39;t restrict anything : any external site is a potential source</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Access-Control-Allow-Origin: *&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.keycdn.com/blog/http-security-headers">Hardening Your HTTP Security Headers</a>, <a class="reference external" href="https://www.smashingmagazine.com/2017/04/secure-web-app-http-headers/">How To Secure Your Web App With HTTP Headers</a> and <a class="reference external" href="https://securityheaders.com/">SecurityHeaders</a>.</p>
<div class="section" id="id1377">
<h3>9.521.1. Suggestions<a class="headerlink" href="#id1377" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove usage of those headers</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/SafeHttpHeaders</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="same-conditions-in-condition">
<span id="id1378"></span><h2>9.522. Same Conditions In Condition<a class="headerlink" href="#same-conditions-in-condition" title="Permalink to this headline">¶</a></h2>
<p>At least two consecutive if/then structures use identical conditions. The latter will probably be ignored.</p>
<p>This analysis returns false positive when there are attempt to fix a situation, or to call an alternative solution.</p>
<p>Conditions that are shared between if structures, but inside a logical OR expression are also detected.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">elseif</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">elseif</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">elseif</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">else</span> <span class="p">{}</span>

<span class="c1">// Also works on if then else if chains</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">else</span> <span class="p">{}</span>

<span class="c1">// Also works on if then else if chains</span>
<span class="c1">// Here, $a is common and sufficient in both conditions</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">||</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>
<span class="k">elseif</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">||</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomethingElse</span><span class="p">();</span> <span class="p">}</span>

<span class="c1">// This sort of situation generate false postive.</span>
<span class="nv">$config</span> <span class="o">=</span> <span class="nx">load_config_from_commandline</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$config</span> <span class="o">=</span> <span class="nx">load_config_from_file</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$config</span> <span class="o">=</span> <span class="nx">load_default_config</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1379">
<h3>9.522.1. Suggestions<a class="headerlink" href="#id1379" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Merge the two conditions into one</li>
<li>Make the two conditions different</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SameConditions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#teampass-structures-sameconditions"><span class="std std-ref">TeamPass</span></a>, <a class="reference internal" href="Cases.html#typo3-structures-sameconditions"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="same-variable-foreach">
<span id="id1380"></span><h2>9.523. Same Variable Foreach<a class="headerlink" href="#same-variable-foreach" title="Permalink to this headline">¶</a></h2>
<p>A foreach which uses its own source as a blind variable is actually broken.</p>
<p>Actually, PHP makes a copy of the source before it starts the loop. As such, the same variable may be used for both source and blind value.</p>
<p>Of course, this is very confusing, to see the same variables used in very different ways.</p>
<p>The source will also be destroyed immediately after the blind variable has been turned into a reference.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$array</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nv">$array</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="c1">// display number from 0 to 10.</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$array</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nv">$array</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="c1">// display 10</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/AutoUnsetForeach</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="scalar-are-not-arrays">
<span id="id1381"></span><h2>9.524. Scalar Are Not Arrays<a class="headerlink" href="#scalar-are-not-arrays" title="Permalink to this headline">¶</a></h2>
<p>It is wrong to use a scalar as an array, a Warning is emitted. PHP 7.4 emits a Warning in such situations.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Here, $x may be null, and in that case, the echo will fail.</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">?</span><span class="nx">A</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$x</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Typehinted argument with a scalar are reported by this analysis. Also, nullable arguments, both with typehint and return type hint.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/notice-for-non-valid-array-container">E_WARNING for invalid container read array-access</a>.</p>
<div class="section" id="id1382">
<h3>9.524.1. Suggestions<a class="headerlink" href="#id1382" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Update type hints to avoid scalar values</li>
<li>Remove the array syntax in the code using the results</li>
<li>Cast to string type, so the array notation is accessible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ScalarAreNotArrays</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="scalar-or-object-property">
<span id="id1383"></span><h2>9.525. Scalar Or Object Property<a class="headerlink" href="#scalar-or-object-property" title="Permalink to this headline">¶</a></h2>
<p>Property shouldn’t use both object and scalar syntaxes. When a property may be an object, it is recommended to implement the Null Object pattern : instead of checking if the property is scalar, make it always object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$display</span> <span class="o">=</span> <span class="s1">&#39;echo&#39;</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">display</span> <span class="nx">instanceof</span> <span class="nx">myDisplayInterface</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$display</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">print</span> <span class="nx">Error</span> <span class="nx">when</span> <span class="nx">displaying\n</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="nx">myDisplayInterface</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">display</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span> <span class="c1">// does the display in its own way</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">nullDisplay</span> <span class="k">implements</span> <span class="nx">myDisplayInterface</span> <span class="p">{</span>
    <span class="c1">// implements myDisplayInterface but does nothing</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">display</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">x2</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$display</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">display</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">nullDisplay</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Keep the check, as $display is public, and may get wrong values</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">display</span> <span class="nx">instanceof</span> <span class="nx">myDisplayInterface</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$display</span><span class="o">-&gt;</span><span class="na">display</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">print</span> <span class="nx">Error</span> <span class="nx">when</span> <span class="nx">displaying\n</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Simple class for echo</span>
<span class="k">class</span> <span class="nc">echoDisplay</span> <span class="k">implements</span> <span class="nx">myDisplayInterface</span> <span class="p">{</span>
    <span class="c1">// implements myDisplayInterface but does nothing</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">display</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$string</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://en.wikipedia.org/wiki/Null_Object_pattern#PHP">Null Object Pattern</a>. and <a class="reference external" href="https://www.sitepoint.com/the-null-object-pattern-polymorphism-in-domain-models/">The Null Object Pattern</a>.</p>
<div class="section" id="id1384">
<h3>9.525.1. Suggestions<a class="headerlink" href="#id1384" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Only use one type of syntax with your properties.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ScalarOrObjectProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#sugarcrm-classes-scalarorobjectproperty"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="self-using-trait">
<span id="id1385"></span><h2>9.526. Self Using Trait<a class="headerlink" href="#self-using-trait" title="Permalink to this headline">¶</a></h2>
<p>Trait uses itself : this is unnecessary. Traits may use themselves, or be used by other traits, that are using the initial trait itself.</p>
<p>PHP handles the situation quietly, by ignoring all extra use of the same trait, keeping only one valid version.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// empty, but valid</span>
<span class="k">trait</span> <span class="nx">a</span> <span class="p">{}</span>

<span class="c1">// obvious self usage</span>
<span class="k">trait</span> <span class="nx">b</span> <span class="p">{</span> <span class="k">use</span> <span class="nx">b</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// less obvious self usage</span>
<span class="k">trait</span> <span class="nx">c</span> <span class="p">{</span> <span class="k">use</span> <span class="nx">d</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">f</span><span class="p">,</span> <span class="nx">g</span><span class="p">,</span> <span class="nx">h</span><span class="p">,</span> <span class="nx">c</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// level 2 self usage</span>
<span class="k">trait</span> <span class="nx">i</span> <span class="p">{</span> <span class="k">use</span> <span class="nx">j</span><span class="p">;</span> <span class="p">}</span>
<span class="k">trait</span> <span class="nx">j</span> <span class="p">{</span> <span class="k">use</span> <span class="nx">i</span><span class="p">;</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.traits.php">Traits</a>.</p>
<div class="section" id="id1387">
<h3>9.526.1. Suggestions<a class="headerlink" href="#id1387" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the extra usage of the trait.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/SelfUsingTrait</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="semantic-typing">
<span id="id1388"></span><h2>9.527. Semantic Typing<a class="headerlink" href="#semantic-typing" title="Permalink to this headline">¶</a></h2>
<p>Arguments names are only useful inside the method’s body. They are not actual type.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// arguments should be a string and an array</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// more code</span>
    <span class="k">return</span> <span class="nv">$boolean</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// typehint is actually checking the values</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">iterable</span> <span class="nv">$closure</span><span class="p">)</span> <span class="o">:</span> <span class="nx">bool</span> <span class="p">{</span>
    <span class="c1">// more code</span>
    <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1389">
<h3>9.527.1. Suggestions<a class="headerlink" href="#id1389" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a typehint to make sure the argument is of the expected type.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/SemanticTyping</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="session-lazy-write">
<span id="id1390"></span><h2>9.528. Session Lazy Write<a class="headerlink" href="#session-lazy-write" title="Permalink to this headline">¶</a></h2>
<p>Classes that implements SessionHandlerInterface must also implements SessionUpdateTimestampHandlerInterface.</p>
<p>The two extra methods are used to help lazy loading : the first actually checks if a sessionId is available, and the seconds updates the time of last usage of the session data in the session storage.</p>
<p>This was spotted by <code class="docutils literal notranslate"><span class="pre">Nicolas</span> <span class="pre">Grekas</span></code>, and fixed in Symfony <a class="reference external" href="https://github.com/symfony/symfony/pull/24523">[HttpFoundation] Make sessions secure and lazy #24523</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">SessionUpdateTimestampHandlerInterface</span> <span class="p">{</span>
    <span class="c1">// returns a boolean to indicate that valid data is available for this sessionId, or not.</span>
    <span class="k">function</span> <span class="nf">validateId</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">);</span>

    <span class="c1">//called to change the last time of usage for the session data.</span>
    <span class="c1">//It may be a file&#39;s touch or full write, or a simple update on the database</span>
    <span class="k">function</span> <span class="nf">updateTimestamp</span><span class="p">(</span><span class="nv">$sessionId</span><span class="p">,</span> <span class="nv">$sessionData</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/session-read_only-lazy_write">Sessions: Improve original RFC about lazy_write</a> and the <a class="reference external" href="https://www.php.net/manual/en/book.session.php">Sessions</a>.</p>
<div class="section" id="id1391">
<h3>9.528.1. Suggestions<a class="headerlink" href="#id1391" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Implements the SessionUpdateTimestampHandlerInterface interface</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/SessionLazyWrite</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="set-aside-code">
<span id="id1392"></span><h2>9.529. Set Aside Code<a class="headerlink" href="#set-aside-code" title="Permalink to this headline">¶</a></h2>
<p>Setting aside code should be made into a method.</p>
<p>Setting aside code happens when one variable or member is stored locally, to be temporarily replaced by another value. Once the new value has been processed, the original value is reverted.</p>
<p>The temporary change of the value makes the code hard to read.</p>
<p>It is a good example of a piece of code that could be moved to a separate method or function. Using the temporary value as a parameter makes the change visible, and avoid local pollution.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Setting aside database</span>
<span class="k">class</span> <span class="nc">cache</span> <span class="k">extends</span> <span class="nx">Storage</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$database</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$database</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">database</span> <span class="o">=</span> <span class="nv">$database</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$values</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// handling storage with sqlite3</span>
        <span class="nv">$secondary</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">cache</span><span class="p">(</span><span class="k">new</span> <span class="nx">Sqlite3</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">));</span>
        <span class="nv">$secondary</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span>      <span class="c1">// handling storage with injection</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Setting aside database to cache data in two distinct backend</span>
<span class="k">class</span> <span class="nc">cache</span> <span class="k">extends</span> <span class="nx">Storage</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$database</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">\Pdo</span> <span class="nv">$database</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">database</span> <span class="o">=</span> <span class="nv">$database</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$values</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $this-&gt;database is set aside for secondary configuration</span>
        <span class="nv">$side</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">database</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">database</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Sqlite3</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span>      <span class="c1">// handling storage with sqlite3</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">database</span> <span class="o">=</span> <span class="nv">$side</span><span class="p">;</span>
        <span class="c1">// $this-&gt;database is restored</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">store</span><span class="p">(</span><span class="nv">$values</span><span class="p">);</span>      <span class="c1">// handling storage with injection</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1393">
<h3>9.529.1. Suggestions<a class="headerlink" href="#id1393" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Extract the code that run with the temporary value to a separate method.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SetAside</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="set-cookie-safe-arguments">
<span id="id1394"></span><h2>9.530. Set Cookie Safe Arguments<a class="headerlink" href="#set-cookie-safe-arguments" title="Permalink to this headline">¶</a></h2>
<p>The last five arguments of <a class="reference external" href="https://www.php.net/setcookie">setcookie()</a> and <a class="reference external" href="https://www.php.net/setrawcookie">setrawcookie()</a> are for security. Use them anytime you can.</p>
<p><code class="docutils literal notranslate"><span class="pre">setcookie</span> <span class="pre">(</span> <span class="pre">string</span> <span class="pre">$name</span> <span class="pre">[,</span> <span class="pre">string</span> <span class="pre">$value</span> <span class="pre">=</span>&#160; <span class="pre">[,</span> <span class="pre">int</span> <span class="pre">$expire</span> <span class="pre">=</span> <span class="pre">0</span> <span class="pre">[,</span> <span class="pre">string</span> <span class="pre">$path</span> <span class="pre">=</span>&#160; <span class="pre">[,</span> <span class="pre">string</span> <span class="pre">$domain</span> <span class="pre">=</span>&#160; <span class="pre">[,</span> <span class="pre">bool</span> <span class="pre">$secure</span> <span class="pre">=</span> <span class="pre">false</span> <span class="pre">[,</span> <span class="pre">bool</span> <span class="pre">$httponly</span> <span class="pre">=</span> <span class="pre">false</span> <span class="pre">]]]]]]</span> <span class="pre">)</span></code></p>
<p>The <code class="docutils literal notranslate"><span class="pre">$expire</span></code> argument sets the date of expiration of the cookie. It is recommended to make it as low as possible, to reduce its chances to be captured. Sometimes, low expiration date may be several days (for preferences), and other times, low expiration date means a few minutes.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$path</span></code> argument limits the transmission of the cookie to URL whose path matches the one mentioned here. By default, it is <code class="docutils literal notranslate"><span class="pre">'/'</span></code>, which means the whole server. If a cookie usage is limited to a part of the application, use it here.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$domain</span></code> argument limits the transmission of the cookie to URL whose domain matches the one mentioned here. By default, it is <code class="docutils literal notranslate"><span class="pre">''</span></code>, which means any server on the internet. At worse, you may use <code class="docutils literal notranslate"><span class="pre">mydomain.com</span></code> to cover your whole domain, or better, refine it with the actual subdomain of usage.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$secure</span></code> argument limits the transmission of the cookie over HTTP (by default) or HTTPS. The second is better, as the transmission of the cookie is crypted. In case HTTPS is still at the planned stage, use ‘$_SERVER[HTTPS]’. This environment variable is false on HTTP, and true on HTTPS.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$httponly</span></code> argument limits the access of the cookie to JavaScript. It is only transmitted to the browser, and retransmitted. This helps reducing XSS and CSRF attacks, though it is disputed.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">$samesite</span></code> argument limits the sending of the cookie to the domain that initiated the request. It is by default <code class="docutils literal notranslate"><span class="pre">Lax</span></code> but should be upgraded to <code class="docutils literal notranslate"><span class="pre">Strict</span></code> whenever possible. This feature is available as PHP 7.3.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//admin cookie, available only on https://admin.my-domain.com/system/, for the next minute, and not readable by javascript</span>
<span class="nb">setcookie</span><span class="p">(</span><span class="nx">admin</span><span class="p">,</span> <span class="nv">$login</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">60</span><span class="p">,</span> <span class="o">/</span><span class="nb">system</span><span class="o">/</span><span class="p">,</span> <span class="nx">admin</span><span class="o">.</span><span class="nx">my</span><span class="o">-</span><span class="nx">domain</span><span class="o">.</span><span class="nx">com</span><span class="p">,</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTPS&#39;</span><span class="p">],</span> <span class="mi">1</span><span class="p">);</span>

<span class="c1">//login cookie, available until the browser is closed, over http or https</span>
<span class="nb">setcookie</span><span class="p">(</span><span class="nx">login</span><span class="p">,</span> <span class="nv">$login</span><span class="p">);</span>

<span class="c1">//removing the login cookie : Those situations are omitted by the analysis</span>
<span class="nb">setcookie</span><span class="p">(</span><span class="nx">login</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/setcookie">setcookie</a> and <a class="reference external" href="https://www.chromestatus.com/feature/4672634709082112">‘SameSite’ cookie attribute</a>.</p>
<div class="section" id="id1396">
<h3>9.530.1. Suggestions<a class="headerlink" href="#id1396" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use all the argument when setting cookies with PHP functions</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/SetCookieArgs</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="setlocale-uses-constants">
<span id="id1397"></span><h2>9.531. Setlocale() Uses Constants<a class="headerlink" href="#setlocale-uses-constants" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/setlocale">setlocale()</a> don’t use strings but constants.</p>
<p>The first argument of <a class="reference external" href="https://www.php.net/setlocale">setlocale()</a> must be one of the valid constants, <code class="docutils literal notranslate"><span class="pre">LC_ALL</span></code>, <code class="docutils literal notranslate"><span class="pre">LC_COLLATE</span></code>, <code class="docutils literal notranslate"><span class="pre">LC_CTYPE</span></code>, <code class="docutils literal notranslate"><span class="pre">LC_MONETARY</span></code>, <code class="docutils literal notranslate"><span class="pre">LC_NUMERIC</span></code>, <code class="docutils literal notranslate"><span class="pre">LC_TIME,</span> <span class="pre">LC_MESSAGES</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Use constantes for setlocale first argument</span>
<span class="nb">setlocale</span><span class="p">(</span><span class="nx">LC_ALL</span><span class="p">,</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">);</span>
<span class="nb">setlocale</span><span class="p">(</span><span class="nx">\LC_ALL</span><span class="p">,</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">);</span>

<span class="c1">// Don&#39;t use string for setlocale first argument</span>
<span class="nb">setlocale</span><span class="p">(</span><span class="s1">&#39;LC_ALL&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">);</span>
<span class="nb">setlocale</span><span class="p">(</span><span class="s1">&#39;LC_&#39;</span><span class="o">.</span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The PHP 5 usage of strings (same name as above, enclosed in ‘ or “) is not legit anymore in PHP 7 and later.</p>
<p>See also <a class="reference external" href="https://www.php.net/setlocale">setlocale</a>.</p>
<div class="section" id="id1400">
<h3>9.531.1. Suggestions<a class="headerlink" href="#id1400" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use setlocale() constants</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SetlocaleNeedsConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="several-instructions-on-the-same-line">
<span id="id1401"></span><h2>9.532. Several Instructions On The Same Line<a class="headerlink" href="#several-instructions-on-the-same-line" title="Permalink to this headline">¶</a></h2>
<p>Usually, instructions do not share their line : one instruction, one line.</p>
<p>This is good for readability, and help at understanding the code. This is especially important when fast-reading the code to find some special situation, where such double-meaning line way have an impact.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">switch</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Is it a fallthrough or not ?</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">();</span> <span class="k">break</span><span class="p">;</span>

    <span class="c1">// Easily spotted break.</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
        <span class="nx">doSomethingElse</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>

    <span class="k">default</span> <span class="o">:</span>
        <span class="nx">doDefault</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://williamdurand.fr/2013/06/03/object-calisthenics/#one-dot-per-line">Object Calisthenics, rule # 5</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/OneLineTwoInstructions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#piwigo-structures-onelinetwoinstructions"><span class="std std-ref">Piwigo</span></a>, <a class="reference internal" href="Cases.html#tine20-structures-onelinetwoinstructions"><span class="std std-ref">Tine20</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="short-open-tags">
<span id="id1402"></span><h2>9.533. Short Open Tags<a class="headerlink" href="#short-open-tags" title="Permalink to this headline">¶</a></h2>
<p>Usage of short open tags is discouraged. The following files were found to be impacted by the short open tag directive at compilation time. They must be reviewed to ensure no &amp;lt;? tags are found in the code.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ShortOpenTagRequired</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="short-syntax-for-arrays">
<span id="id1403"></span><h2>9.534. Short Syntax For Arrays<a class="headerlink" href="#short-syntax-for-arrays" title="Permalink to this headline">¶</a></h2>
<p>Arrays written with the new short syntax.</p>
<p>PHP 5.4 introduced the new short syntax, with square brackets. The previous syntax, based on the <a class="reference external" href="https://www.php.net/array">array()</a> keyword is still available.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// All PHP versions array</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="c1">// PHP 5.4+ arrays</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.array.php">Array</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/ArrayNSUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="should-be-single-quote">
<span id="id1406"></span><h2>9.535. Should Be Single Quote<a class="headerlink" href="#should-be-single-quote" title="Permalink to this headline">¶</a></h2>
<p>Use single quote for simple strings.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> content inside a string, that has no single quotes nor escape sequence (such as n or t), should be using single quote delimiter, instead of double quote.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nx">abc</span><span class="p">;</span>

<span class="c1">// This one is using a special sequence</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nx">cde\n</span><span class="p">;</span>

<span class="c1">// This one is using two special sequences</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nx">\x03\u</span><span class="p">{</span><span class="mi">1</span><span class="nx">F418</span><span class="p">};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>If you have too many of them, don’t loose your time switching them all. If you have a few of them, it may be good for consistence.</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/ShouldBeSingleQuote</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-double-quote.md">no-double-quote</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="should-chain-exception">
<span id="id1408"></span><h2>9.536. Should Chain Exception<a class="headerlink" href="#should-chain-exception" title="Permalink to this headline">¶</a></h2>
<p>Chain exception to provide more context.</p>
<p>When catching an exception and rethrowing another one, it is recommended to chain the exception : this means providing the original exception, so that the final recipient has a chance to track the origin of the problem. This doesn’t change the thrown message, but provides more information.</p>
<p>Note : Chaining requires PHP &gt; 5.3.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;Exception 1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;Exception 2&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nv">$e</span><span class="p">);</span>
        <span class="c1">// Chaining here.</span>

    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.decon.php">Exception::`__construct</a> &lt;<a class="reference external" href="https://www.php.net/manual/en/exception.construct.php">https://www.php.net/manual/en/exception.construct.php</a>&gt;`_ and <a class="reference external" href="https://stackoverflow.com/questions/5551668/what-are-the-best-practices-for-catching-and-re-throwing-exceptions/5551828">What are the best practices for catching and re-throwing exceptions?</a>.</p>
<div class="section" id="id1410">
<h3>9.536.1. Suggestions<a class="headerlink" href="#id1410" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the incoming exception to the newly thrown exception</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ShouldChainException</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#magento-structures-shouldchainexception"><span class="std std-ref">Magento</span></a>, <a class="reference internal" href="Cases.html#tine20-structures-shouldchainexception"><span class="std std-ref">Tine20</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-deep-clone">
<span id="id1411"></span><h2>9.537. Should Deep Clone<a class="headerlink" href="#should-deep-clone" title="Permalink to this headline">¶</a></h2>
<p>By default, PHP makes a shallow clone. It only clone the scalars, and keep the reference to any object already referenced. This means that the cloned object and its original share any object they hold as property.</p>
<p>This is where the magic method <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__clone()</a> comes into play. It is called, when defined, at clone time, so that the cloned object may clone all the needed sub-objects.</p>
<p>It is recommended to use the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__clone()</a> method whenever the objects hold objects.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$b</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">=</span>  <span class="k">new</span> <span class="k">Stdclass</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">ab</span> <span class="k">extends</span> <span class="nx">a</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__clone</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// class A is shallow clone, so $a-&gt;b is not cloned</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">a</span><span class="p">();</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$a</span><span class="p">;</span>
<span class="nv">$a</span><span class="o">-&gt;</span><span class="na">b</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">b</span><span class="o">-&gt;</span><span class="na">c</span><span class="p">;</span>
<span class="c1">// displays 3</span>

<span class="c1">// class Ab is deep clone, so $a-&gt;b is cloned</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ab</span><span class="p">();</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$a</span><span class="p">;</span>
<span class="nv">$a</span><span class="o">-&gt;</span><span class="na">b</span><span class="o">-&gt;</span><span class="na">c</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">b</span><span class="o">-&gt;</span><span class="na">c</span><span class="p">;</span>
<span class="c1">// displays 1</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://jacob-walker.com/blog/php-clone-and-shallow-vs-deep-copying.html">PHP Clone and Shallow vs Deep Copying</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.cloning.php">Cloning objects</a>.</p>
<div class="section" id="id1414">
<h3>9.537.1. Suggestions<a class="headerlink" href="#id1414" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ShouldDeepClone</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-have-destructor">
<span id="id1415"></span><h2>9.538. Should Have Destructor<a class="headerlink" href="#should-have-destructor" title="Permalink to this headline">¶</a></h2>
<p>PHP destructors are called when the object has to be destroyed. By default, PHP calls recursively the destructor on internal objects, until everything is unset.</p>
<p>Unsetting objects and resources explicitly in the destructor is a good practice to reduce the amount of memory in use. It helps PHP resource counter to keep the numbers low, and easier to clean. This is a major advantage for long running scripts.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">y</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">print</span> <span class="no">__METHOD__</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">y</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">print</span> <span class="no">__METHOD__</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">y</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">print</span> <span class="no">__METHOD__</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">x</span><span class="p">);</span>
<span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// This increment the resource counter by one for the property.</span>
<span class="nv">$p</span> <span class="o">=</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">p</span><span class="p">;</span>
<span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="nb">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="k">print</span> <span class="s1">&#39;end&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="c1">// Y destructor is only called here, as the object still exists in $p.</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.decon.php#language.oop5.decon.destructor">Destructor</a>, and <a class="reference external" href="https://stackoverflow.com/questions/3566155/php-destructors">Php Destructors</a>.</p>
<div class="section" id="id1416">
<h3>9.538.1. Suggestions<a class="headerlink" href="#id1416" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a destruct method to the class to help clean at destruction time.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ShouldHaveDestructor</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-make-alias">
<span id="id1417"></span><h2>9.539. Should Make Alias<a class="headerlink" href="#should-make-alias" title="Permalink to this headline">¶</a></h2>
<p>Long names should be aliased.</p>
<p>Aliased names are easy to read at the beginning of the script; they may be changed at one point, and update the whole code at the same time.
Finally, short names makes the rest of the code readable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">x\y\z</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">a\b\c\d\e\f\g</span> <span class="k">as</span> <span class="nx">Object</span><span class="p">;</span>

<span class="c1">// long name, difficult to read, prone to change.</span>
<span class="k">new</span> <span class="nx">a\b\c\d\e\f\g</span><span class="p">();</span>

<span class="c1">// long name, difficult to read, prone to silent dead code if namespace change.</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nx">a\b\c\d\e\f\g</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// short names Easy to update all at once.</span>
<span class="k">new</span> <span class="nx">Object</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nx">Object</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/ShouldMakeAlias</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="should-make-ternary">
<span id="id1418"></span><h2>9.540. Should Make Ternary<a class="headerlink" href="#should-make-ternary" title="Permalink to this headline">¶</a></h2>
<p>Ternary operators are the best when assigning values to a variable.</p>
<p>This way, they are less verbose, compatible with assignation and easier to read.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// verbose if then structure</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// compact ternary call</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>

    <span class="c1">// verbose if then structure</span>
    <span class="c1">// Works with short assignations and simple expressions</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$b</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">-</span> <span class="nv">$a</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$b</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// compact ternary call</span>
    <span class="nv">$b</span> <span class="o">+=</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">-</span> <span class="nv">$a</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.comparison.php#language.operators.comparison.ternary">Ternary Operator</a> and <a class="reference external" href="https://stitcher.io/blog/shorthand-comparisons-in-php">Shorthand comparisons in PHP</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ShouldMakeTernary</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-structures-shouldmaketernary"><span class="std std-ref">ChurchCRM</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="should-preprocess-chr">
<span id="id1420"></span><h2>9.541. Should Preprocess Chr()<a class="headerlink" href="#should-preprocess-chr" title="Permalink to this headline">¶</a></h2>
<p>Replace literal <a class="reference external" href="https://www.php.net/chr">chr()</a> calls with their escape sequence.</p>
<p><a class="reference external" href="https://www.php.net/chr">chr()</a> is a functioncall, that cannot be cached. It is only resolved at execution time.
On the other hand, literal values are preprocessed by PHP and may be cached.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is easier on PHP</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s2">&quot;0000 is great!&quot;</span><span class="p">;</span>

<span class="c1">// This is slow</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">72</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="s1">&#39; is great!&#39;</span><span class="p">;</span>

<span class="c1">// This would be the best with this example, but it is not always possible</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;PHP is great!&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is a micro-optimisation.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/regexp.reference.escape.php">Escape sequences</a>.</p>
<div class="section" id="id1422">
<h3>9.541.1. Suggestions<a class="headerlink" href="#id1422" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use PHP string sequences, and skip chr() at execution time</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ShouldPreprocess</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpadsnew-php-shouldpreprocess"><span class="std std-ref">phpadsnew</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-typecast">
<span id="id1423"></span><h2>9.542. Should Typecast<a class="headerlink" href="#should-typecast" title="Permalink to this headline">¶</a></h2>
<p>When typecasting, it is better to use the casting operator, such as <code class="docutils literal notranslate"><span class="pre">(int)</span></code> or <code class="docutils literal notranslate"><span class="pre">(bool)</span></code>.</p>
<p>Functions such as <a class="reference external" href="https://www.php.net/intval">intval()</a> or <a class="reference external" href="https://www.php.net/settype">settype()</a> are always slower.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Fast version</span>
<span class="nv">$int</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$X</span><span class="p">;</span>

<span class="c1">// Slow version</span>
<span class="nv">$int</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$X</span><span class="p">);</span>

<span class="c1">// Convert to base 8 : can&#39;t use (int) for that</span>
<span class="nv">$int</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$X</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is a micro-optimisation, although such conversion may be use multiple time, leading to a larger performance increase.</p>
<p>Note that <a class="reference external" href="https://www.php.net/intval">intval()</a> may also be used to convert an integer to another base.</p>
<div class="section" id="id1425">
<h3>9.542.1. Suggestions<a class="headerlink" href="#id1425" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a typecast, instead of a functioncall.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/ShouldTypecast</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-type-shouldtypecast"><span class="std std-ref">xataface</span></a>, <a class="reference internal" href="Cases.html#openconf-type-shouldtypecast"><span class="std std-ref">OpenConf</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-coalesce">
<span id="id1426"></span><h2>9.543. Should Use Coalesce<a class="headerlink" href="#should-use-coalesce" title="Permalink to this headline">¶</a></h2>
<p>PHP 7 introduced the <code class="docutils literal notranslate"><span class="pre">??</span></code> operator, that replaces longer structures to set default values when a variable is not set.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Fetches the request parameter user and results in &#39;nobody&#39; if it doesn&#39;t exist</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="s1">&#39;nobody&#39;</span><span class="p">;</span>
<span class="c1">// equivalent to: $username = isset($_GET[&#39;user&#39;]) ? $_GET[&#39;user&#39;] : &#39;nobody&#39;;</span>

<span class="c1">// Calls a hypothetical model-getting function, and uses the provided default if it fails</span>
<span class="nv">$model</span> <span class="o">=</span> <span class="nx">Model</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="o">??</span> <span class="nv">$default_model</span><span class="p">;</span>
<span class="c1">// equivalent to: if (($model = Model::get($id)) === NULL) { $model = $default_model; }</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Sample extracted from PHP docs <a class="reference external" href="https://wiki.php.net/rfc/isset_ternary">Isset Ternary</a>.</p>
<p>See also <a class="reference external" href="https://lornajane.net/posts/2015/new-in-php-7-null-coalesce-operator">New in PHP 7: null coalesce operator</a>.</p>
<div class="section" id="id1427">
<h3>9.543.1. Suggestions<a class="headerlink" href="#id1427" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the long syntax with the short one</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ShouldUseCoalesce</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-php-shouldusecoalesce"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#cleverstyle-php-shouldusecoalesce"><span class="std std-ref">Cleverstyle</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-constants">
<span id="id1428"></span><h2>9.544. Should Use Constants<a class="headerlink" href="#should-use-constants" title="Permalink to this headline">¶</a></h2>
<p>The following functions have related constants that should be used as arguments, instead of scalar literals, such as integers or strings.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The file is read and new lines are ignored.</span>
<span class="nv">$lines</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="nx">FILE_IGNORE_NEW_LINES</span><span class="p">)</span>

<span class="c1">// What is this doing, with 2 ?</span>
<span class="nv">$lines</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="s1">&#39;file.txt&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://medium.com/&#64;liamhammett/bitmask-constant-arguments-in-php-cf32bf35c73">Bitmask Constant Arguments in PHP</a>.</p>
<div class="section" id="id1429">
<h3>9.544.1. Suggestions<a class="headerlink" href="#id1429" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use PHP native constants whenever possible, for better readability.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/ShouldUseConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-functions-shoulduseconstants"><span class="std std-ref">Tine20</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-explode-args">
<span id="id1430"></span><h2>9.545. Should Use Explode Args<a class="headerlink" href="#should-use-explode-args" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/explode">explode()</a> has a third argument, which limits the amount of exploded elements. With it, it is possible to collect only the first elements, or drop the last ones.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$exploded</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="nx">DELIMITER</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="c1">// use explode(DELIMITER, $string, -1);</span>
<span class="nb">array_pop</span><span class="p">(</span><span class="nv">$exploded</span><span class="p">);</span>

<span class="c1">// use explode(DELIMITER, $string, -2);</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$exploded</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>

<span class="c1">// with explode()&#39;s third argument :</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="nx">DELIMITER</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// with list() omitted arguments</span>
<span class="k">list</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="nx">DELIMITER</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.explode.php">explode</a>.</p>
<div class="section" id="id1433">
<h3>9.545.1. Suggestions<a class="headerlink" href="#id1433" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ShouldUseExplodeArgs</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-foreach">
<span id="id1434"></span><h2>9.546. Should Use Foreach<a class="headerlink" href="#should-use-foreach" title="Permalink to this headline">¶</a></h2>
<p>Use foreach instead of for when traversing an array.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">Foreach()</a> is the modern loop : it maps automatically every element of the array to a blind variable, and loop over it. This is faster and safer.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Foreach version</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$element</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// The above case may even be upgraded with array_map and a callback,</span>
<span class="c1">// for the simplest one of them</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;doSomething&#39;</span><span class="p">,</span> <span class="nv">$array</span><span class="p">);</span>

<span class="c1">// For version (one of various alternatives)</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$element</span> <span class="o">=</span> <span class="nv">$array</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$element</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Based on array_pop or array_shift()</span>
<span class="k">while</span><span class="p">(</span><span class="nv">$value</span> <span class="o">=</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$array</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a> and <a class="reference external" href="https://www.codewall.co.uk/5-ways-to-loop-through-array-php/">5 Ways To Loop Through An Array In PHP</a>.</p>
<div class="section" id="id1437">
<h3>9.546.1. Suggestions<a class="headerlink" href="#id1437" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move for() loops to foreach(), whenever they apply to a finite list of elements</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ShouldUseForeach</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#expressionengine-structures-shoulduseforeach"><span class="std std-ref">ExpressionEngine</span></a>, <a class="reference internal" href="Cases.html#woocommerce-structures-shoulduseforeach"><span class="std std-ref">Woocommerce</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-function">
<span id="id1438"></span><h2>9.547. Should Use Function<a class="headerlink" href="#should-use-function" title="Permalink to this headline">¶</a></h2>
<p>Functioncalls that fall back to global scope should be using ‘use function’ or be fully namespaced.</p>
<p>PHP searches for functions in the local namespaces, and in case it fails, makes the same search in the global scope. Anytime a native function is referenced this way, the search (and fail) happens. This slows down the scripts.</p>
<p>The speed bump range from 2 to 8 %, depending on the availability of functions in the local scope. The overall bump is about 1 µs per functioncall, which makes it a micro optimisation until a lot of function calls are made.</p>
<p>Based on one of <a class="reference external" href="https://twitter.com/Ocramius/status/811504929357660160">Marco Pivetta tweet</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">X</span> <span class="p">{</span>
    <span class="k">use</span> <span class="k">function</span> <span class="nf">strtolower</span> <span class="k">as</span> <span class="nx">strtolower_aliased</span><span class="p">;</span>

    <span class="c1">// PHP searches for strtolower in X, fails, then falls back to global scope, succeeds.</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>

    <span class="c1">// PHP searches for strtolower in global scope, succeeds.</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nx">\strtolower</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>

    <span class="c1">// PHP searches for strtolower_aliased in global scope, succeeds.</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nx">\strtolower_aliased</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis is a related to Performances/Php74ArrayKeyExists, and is a more general version.</p>
<p>See also <a class="reference external" href="http://veewee.github.io/blog/optimizing-php-performance-by-fq-function-calls/">blog post</a>.</p>
<div class="section" id="id1439">
<h3>9.547.1. Suggestions<a class="headerlink" href="#id1439" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the <cite>use</cite> command for arrray_key_exists(), at the beginning of the script</li>
<li>Use an initial before array_key_exists()</li>
<li>Remove the namespace</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ShouldUseFunction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-local-class">
<span id="id1440"></span><h2>9.548. Should Use Local Class<a class="headerlink" href="#should-use-local-class" title="Permalink to this headline">¶</a></h2>
<p>Methods should use the defining class, or be functions.</p>
<p>Methods should use <code class="docutils literal notranslate"><span class="pre">$this</span></code> with another method or a property, or call <code class="docutils literal notranslate"><span class="pre">parent\:\:</span></code>. <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> methods should call another <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method, or a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> property.
Methods which are overwritten by a child class are omitted : the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class act as a default value for the children class, and this is correct.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This method should do something locally, or be removed.</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">bar</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Calling parent:: is sufficient</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">__construct</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">barbar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This is acting on the local object</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">barfoo</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This has no action on the local object. It could be a function or a closure where needed</span>
        <span class="k">return</span> <span class="mi">3</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that a method using a class constant is not considered as using the local class, for this analyzer.</p>
<div class="section" id="id1445">
<h3>9.548.1. Suggestions<a class="headerlink" href="#id1445" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make this method a function</li>
<li>Actually use $this, or any related attributes of the class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ShouldUseThis</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/not-a-method.md">not-a-method</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-math">
<span id="id1446"></span><h2>9.549. Should Use Math<a class="headerlink" href="#should-use-math" title="Permalink to this headline">¶</a></h2>
<p>Use math operators to make the operation readable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Adding one to self</span>
<span class="nv">$a</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">// same as above</span>
<span class="nv">$a</span> <span class="o">+=</span> <span class="nv">$a</span><span class="p">;</span>

<span class="c1">// Squaring oneself</span>
<span class="nv">$a</span> <span class="nx">\</span><span class="o">*</span><span class="nx">\</span><span class="o">*</span><span class="nx">\</span><span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1">// same as above</span>
<span class="nv">$a</span> <span class="o">*=</span> <span class="nv">$a</span><span class="p">;</span>

<span class="c1">// Removing oneself</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// same as above</span>
<span class="nv">$a</span> <span class="o">-=</span> <span class="nv">$a</span><span class="p">;</span>

<span class="c1">// Dividing oneself</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="c1">// same as above</span>
<span class="nv">$a</span> <span class="o">/=</span> <span class="nv">$a</span><span class="p">;</span>

<span class="c1">// Divisition remainer</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="c1">// same as above</span>
<span class="nv">$a</span> <span class="o">%=</span> <span class="nv">$a</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/book.math.php">Mathematical Functions</a>.</p>
<div class="section" id="id1447">
<h3>9.549.1. Suggestions<a class="headerlink" href="#id1447" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use explicit math assignation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ShouldUseMath</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openemr-structures-shouldusemath"><span class="std std-ref">OpenEMR</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-operator">
<span id="id1448"></span><h2>9.550. Should Use Operator<a class="headerlink" href="#should-use-operator" title="Permalink to this headline">¶</a></h2>
<p>Some functions duplicate the feature of an operator. When in doubt, it is better to use the operator.</p>
<p>Beware, some edge cases may apply. In particular, backward compatibility may prevent usage of newer features.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/array_push">array_push()</a> is equivalent to []</li>
<li><a class="reference external" href="https://www.php.net/is_object">is_object()</a> is equivalent to <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">instanceof</a></li>
<li>function_get_arg() and function_get_args() is equivalent to ellipsis : <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list">…</a></li>
<li><a class="reference external" href="https://www.php.net/chr">chr()</a> is equivalent to string escape sequences, such as <code class="docutils literal notranslate"><span class="pre">\n</span></code>, <code class="docutils literal notranslate"><span class="pre">\x69</span></code>, <code class="docutils literal notranslate"><span class="pre">u{04699}</span></code></li>
<li><a class="reference external" href="https://www.php.net/call_user_func">call_user_func()</a> is equivalent to <code class="docutils literal notranslate"><span class="pre">$functionName(arguments)</span></code>, <code class="docutils literal notranslate"><span class="pre">$object-&gt;$method(`...</span> <span class="pre">&lt;https://www.php.net/manual/en/functions.arguments.php#functions.variable-arg-list&gt;`_$arguments)</span></code></li>
<li><a class="reference external" href="https://www.php.net/is_null">is_null()</a> is equivalent to <code class="docutils literal notranslate"><span class="pre">===</span> <span class="pre">null</span></code></li>
<li>php_version() is equivalent to <code class="docutils literal notranslate"><span class="pre">PHP_VERSION</span></code> (the constant)</li>
<li><a class="reference external" href="https://www.php.net/is_array">is_array()</a>, <a class="reference external" href="https://www.php.net/is_int">is_int()</a>, <a class="reference external" href="https://www.php.net/is_object">is_object()</a>, etc. is equivalent to a scalar typehint</li>
</ul>
<div class="section" id="id1454">
<h3>9.550.1. Suggestions<a class="headerlink" href="#id1454" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use [] instead of array_push()</li>
<li>Use instanceof instead of is_object()</li>
<li>Use … instead of function_get_arg() and function_get_args()</li>
<li>Use escape sequences instead of chr()</li>
<li>Use dynamic function call instead of call_user_func()</li>
<li>Use === null instead of is_null()</li>
<li>Use PHP_VERSION instead of php_version()</li>
<li>Use typehint instead of is_int(), is_string(), is_bool(), etc.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ShouldUseOperator</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-structures-shoulduseoperator"><span class="std std-ref">Zencart</span></a>, <a class="reference internal" href="Cases.html#sugarcrm-structures-shoulduseoperator"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-prepared-statement">
<span id="id1455"></span><h2>9.551. Should Use Prepared Statement<a class="headerlink" href="#should-use-prepared-statement" title="Permalink to this headline">¶</a></h2>
<p>Modern databases provides support for prepared statement : it separates the query from the processed data and raise significantly the security.</p>
<p>Building queries with concatenations is not recommended, though not always avoidable. When possible, use prepared statements.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="cm">/* Execute a prepared statement by passing an array of values */</span>

<span class="nv">$sql</span> <span class="o">=</span> <span class="s1">&#39;SELECT name, colour, calories</span>
<span class="s1">    FROM fruit</span>
<span class="s1">    WHERE calories &lt; :calories AND colour = :colour&#39;</span><span class="p">;</span>
<span class="nv">$sth</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_CURSOR</span> <span class="o">=&gt;</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">CURSOR_FWDONLY</span><span class="p">));</span>
<span class="nv">$sth</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;:calories&#39;</span> <span class="o">=&gt;</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;:colour&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;red&#39;</span><span class="p">));</span>
<span class="nv">$red</span> <span class="o">=</span> <span class="nv">$sth</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Same code, without preparation :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="nv">$sql</span> <span class="o">=</span> <span class="s1">&#39;SELECT name, color, calories FROM fruit WHERE calories &lt; &#39;</span><span class="o">.</span><span class="nv">$conn</span><span class="o">-</span><span class="nx">quote</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39; AND colour = &#39;</span><span class="o">.</span><span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">quotes</span><span class="p">(</span><span class="s1">&#39;red&#39;</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39; ORDER BY name&#39;</span><span class="p">;</span>
    <span class="nv">$sth</span> <span class="o">=</span> <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$sql</span><span class="p">)</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/mysqli.quickstart.prepared-statements.php">Prepared Statements</a>, <a class="reference external" href="https://websitebeaver.com/prepared-statements-in-php-mysqli-to-prevent-sql-injection">PHP MySQLi Prepared Statements Tutorial to Prevent SQL Injection</a>, <a class="reference external" href="https://developer.hyvor.com/php/prepared-statements">The Best Way to Perform MYSQLI Prepared Statements in PHP</a>.</p>
<div class="section" id="id1456">
<h3>9.551.1. Suggestions<a class="headerlink" href="#id1456" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use an ORM</li>
<li>Use an Active Record library</li>
<li>Change the query to hard code it and make it not injectable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="30%" />
<col width="9%" />
<col width="42%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>queryMethod</td>
<td>query_methods.json</td>
<td>data</td>
<td>Methods that call a query.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/ShouldUsePreparedStatement</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-security-shouldusepreparedstatement"><span class="std std-ref">Dolibarr</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-setcookie">
<span id="id1457"></span><h2>9.552. Should Use SetCookie()<a class="headerlink" href="#should-use-setcookie" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="https://www.php.net/setcookie">setcookie()</a> or <a class="reference external" href="https://www.php.net/setrawcookie">setrawcookie()</a>. Avoid using <a class="reference external" href="https://www.php.net/header">header()</a> to do so, as the PHP native functions are more convenient and easier to spot during a refactoring.</p>
<p><a class="reference external" href="https://www.php.net/setcookie">setcookie()</a> applies some encoding internally, for the value of the cookie and the date of expiration. Rarely, this encoding has to be skipped : then, use setrawencoding().</p>
<p>Both functions help by giving a checklist of important attributes to be used with the cookie.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// same as below</span>
<span class="nb">setcookie</span><span class="p">(</span><span class="nx">myCookie</span><span class="p">,</span> <span class="s1">&#39;chocolate&#39;</span><span class="p">,</span> <span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>

<span class="c1">// same as above. Slots for path and domain are omitted, but should be used whenever possible</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Set-Cookie: myCookie=chocolate; Expires=&#39;</span><span class="o">.</span><span class="nb">date</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">time</span><span class="p">()</span><span class="o">+</span><span class="mi">3600</span><span class="p">))</span><span class="o">.</span><span class="s1">&#39;; Secure; HttpOnly&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie">Set-Cookie</a>, <a class="reference external" href="http://www.php.net/setcookie">setcookie</a>.</p>
<div class="section" id="id1462">
<h3>9.552.1. Suggestions<a class="headerlink" href="#id1462" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use setcookie() function, instead of header()</li>
<li>Use setcookie() function, instead of header()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseSetCookie</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-array-column">
<span id="id1463"></span><h2>9.553. Should Use array_column()<a class="headerlink" href="#should-use-array-column" title="Permalink to this headline">¶</a></h2>
<p>Avoid writing a whole slow loop, and use the native <a class="reference external" href="https://www.php.net/array_column">array_column()</a>.</p>
<p><a class="reference external" href="https://www.php.net/array_column">array_column()</a> is a native PHP function, that extract a property or a index from a array of object, or a multidimensional array. This prevents the usage of foreach to collect those values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">),</span>
           <span class="k">array</span><span class="p">(</span><span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">),</span>
           <span class="k">array</span><span class="p">(</span>          <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">));</span> <span class="c1">// b doesn&#39;t always exists</span>

<span class="nv">$bColumn</span> <span class="o">=</span> <span class="nb">array_column</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span>

<span class="c1">// Slow and cumbersome code</span>
<span class="nv">$bColumn</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]))</span> <span class="p">{</span>
        <span class="nv">$bColumn</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/array_column">array_column()</a> is faster than <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> (with or without the <a class="reference external" href="https://www.www.php.net/isset">isset()</a> test) with 3 elements or more, and it is significantly faster beyond 5 elements. Memory consumption is the same.</p>
<p>See also <a class="reference external" href="https://www.php.net/array_column">[blog] `array_column()</a> &lt;<a class="reference external" href="https://benramsey.com/projects/array-column/">https://benramsey.com/projects/array-column/</a>&gt;`_.</p>
<div class="section" id="id1468">
<h3>9.553.1. Suggestions<a class="headerlink" href="#id1468" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use array_column(), instead of a foreach()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ShouldUseArrayColumn</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-array-filter">
<span id="id1469"></span><h2>9.554. Should Use array_filter()<a class="headerlink" href="#should-use-array-filter" title="Permalink to this headline">¶</a></h2>
<p>Should use <a class="reference external" href="https://www.php.net/array_filter">array_filter()</a>.</p>
<p><a class="reference external" href="https://www.php.net/array_filter">array_filter()</a> is a native PHP function, that extract elements from an array, based on a closure or a function. Using <a class="reference external" href="https://www.php.net/array_filter">array_filter()</a> shortens your code, and allows for reusing the filtering logic across the application, instead of hard coding it every time.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c1">// integers from 0 to 10</span>

<span class="c1">// Extracts odd numbers</span>
<span class="nv">$odds</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span> <span class="p">});</span>
<span class="nv">$odds</span> <span class="o">=</span> <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="s1">&#39;odd&#39;</span><span class="p">);</span>

<span class="c1">// Slow and cumbersome code for extracting odd numbers</span>
<span class="nv">$odds</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// same filter than the closure above, or the odd function below</span>
        <span class="nv">$bColumn</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$x</span> <span class="o">%</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/array_filter">array_filter()</a> is faster than <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> (with or without the <a class="reference external" href="https://www.www.php.net/isset">isset()</a> test) with 3 elements or more, and it is significantly faster beyond 5 elements. Memory consumption is the same.</p>
<p>See also <a class="reference external" href="https://php.net/array_filter">array_filter</a>.</p>
<div class="section" id="id1476">
<h3>9.554.1. Suggestions<a class="headerlink" href="#id1476" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use array_filter()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ShouldUseArrayFilter</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-php-shouldusearrayfilter"><span class="std std-ref">xataface</span></a>, <a class="reference internal" href="Cases.html#shopware-php-shouldusearrayfilter"><span class="std std-ref">shopware</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-use-session-regenerateid">
<span id="id1477"></span><h2>9.555. Should Use session_regenerateid()<a class="headerlink" href="#should-use-session-regenerateid" title="Permalink to this headline">¶</a></h2>
<p>session_regenerateid() should be used when sessions are used.</p>
<p>When using sessions, a session ID is assigned to the user. It is a random number, used to connect the user and its data on the server. Actually, anyone with the session ID may have access to the data. This is why those session ID are so long and complex.</p>
<p>A good approach to protect the session ID is to reduce its lifespan : the shorter the time of use, the better. While changing the session ID at every hit on the page may no be possible, a more reasonable approach is to change the session id when an important action is about to take place. What important means is left to the application to decide.</p>
<p>Based on this philosophy, a code source that uses ZendSession but never uses ZendSession::regenerateId() has to be updated.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="nb">session_start</span><span class="p">();</span>

    <span class="nv">$id</span> <span class="o">=</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">];</span>
    <span class="c1">// no usage of session_regenerateid() anywhere triggers the analysis</span>

    <span class="c1">// basic regeneration every 20 hits on the page.</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">session_regenerateid</span><span class="p">();</span>
    <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See <a class="reference external" href="https://www.php.net/session_regenerate_id">session_regenerateid()</a> and <a class="reference external" href="http://phpsec.org/projects/guide/4.html">PHP Security Guide: Sessions</a>.</p>
<div class="section" id="id1478">
<h3>9.555.1. Suggestions<a class="headerlink" href="#id1478" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add session_regenerateid() call before any important operation on the application</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/ShouldUseSessionRegenerateId</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="should-yield-with-key">
<span id="id1479"></span><h2>9.556. Should Yield With Key<a class="headerlink" href="#should-yield-with-key" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/iterator_to_array">iterator_to_array()</a> will overwrite generated values with the same key.</p>
<p>PHP generators are based on the <code class="docutils literal notranslate"><span class="pre">yield</span></code> keyword. They also delegate some generating to other methods, with <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code>.</p>
<p>When delegating, <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> uses the keys that are generated with <code class="docutils literal notranslate"><span class="pre">yield</span></code>, and otherwise, it uses auto-generated index, starting with 0.</p>
<p>The trap is that each <code class="docutils literal notranslate"><span class="pre">yield</span> <span class="pre">from</span></code> reset the index generation and start again with 0. Coupled with <a class="reference external" href="https://www.php.net/iterator_to_array">iterator_to_array()</a>, this means that the final generated array may lack some values, while a <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> loop would yield all of them.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">g1</span><span class="p">()</span> <span class="o">:</span> <span class="nx">Generator</span> <span class="p">{</span>
     <span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span> <span class="k">yield</span> <span class="nv">$i</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">g2</span><span class="p">()</span> <span class="o">:</span> <span class="nx">Generator</span> <span class="p">{</span>
     <span class="k">for</span> <span class="p">(</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span> <span class="k">yield</span> <span class="nv">$i</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">aggregator</span><span class="p">()</span> <span class="o">:</span> <span class="nx">Generator</span> <span class="p">{</span>
     <span class="k">yield</span> <span class="nx">from</span> <span class="nx">g1</span><span class="p">();</span>
     <span class="k">yield</span> <span class="nx">from</span> <span class="nx">g2</span><span class="p">();</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nb">iterator_to_array</span><span class="p">());</span>

<span class="cm">/*</span>
<span class="cm">Array</span>
<span class="cm">(</span>
<span class="cm">    [0] =&gt; 6</span>
<span class="cm">    [1] =&gt; 7</span>
<span class="cm">    [2] =&gt; 8</span>
<span class="cm">    [3] =&gt; 9</span>
<span class="cm">    [4] =&gt; 4  // Note that 4 and 5 still appears</span>
<span class="cm">    [5] =&gt; 5  // They are not overwritten by the second yield</span>
<span class="cm">)</span>
<span class="cm">*/</span>


<span class="k">foreach</span> <span class="p">(</span> <span class="nx">aggregator</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$i</span> <span class="p">)</span> <span class="p">{</span>
     <span class="k">print</span> <span class="nv">$i</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm">0  // Foreach has no overlap and yield it all.</span>
<span class="cm">1</span>
<span class="cm">2</span>
<span class="cm">3</span>
<span class="cm">4</span>
<span class="cm">5</span>
<span class="cm">6</span>
<span class="cm">7</span>
<span class="cm">8</span>
<span class="cm">9</span>
<span class="cm">*/</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Thanks to <a class="reference external" href="https://twitter.com/hollodotme">Holger Woltersdorf</a> for <a class="reference external" href="https://twitter.com/hollodotme/status/1057909890566537217">pointing this</a>.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.generators.syntax.php">Generator syntax</a> and <a class="reference external" href="https://www.php.net/manual/en/language.generators.syntax.php#control-structures.yield.associative">Yielding values with keys</a>.</p>
<div class="section" id="id1482">
<h3>9.556.1. Suggestions<a class="headerlink" href="#id1482" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use iterator_to_array() on each generator separately, and use array_merge() to merge all the arrays.</li>
<li>Always yield with distinct keys</li>
<li>Avoid iterator_to_array() and use foreach()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/ShouldYieldWithKey</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="signature-trailing-comma">
<span id="id1483"></span><h2>9.557. Signature Trailing Comma<a class="headerlink" href="#signature-trailing-comma" title="Permalink to this headline">¶</a></h2>
<p>Trailing comma in method signature. This feature was added in PHP 8.0.</p>
<p>Allowing the trailing comma makes it possible to reduce the size of VCS’s diff, when adding , removing a parameter.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Example from the RFC</span>
<span class="k">class</span> <span class="nc">Uri</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
        <span class="o">?</span><span class="nx">string</span> <span class="nv">$scheme</span><span class="p">,</span>
        <span class="o">?</span><span class="nx">string</span> <span class="nv">$user</span><span class="p">,</span>
        <span class="o">?</span><span class="nx">string</span> <span class="nv">$pass</span><span class="p">,</span>
        <span class="o">?</span><span class="nx">string</span> <span class="nv">$host</span><span class="p">,</span>
        <span class="o">?</span><span class="nx">int</span> <span class="nv">$port</span><span class="p">,</span>
        <span class="nx">string</span> <span class="nv">$path</span><span class="p">,</span>
        <span class="o">?</span><span class="nx">string</span> <span class="nv">$query</span><span class="p">,</span>
        <span class="o">?</span><span class="nx">string</span> <span class="nv">$fragment</span> <span class="c1">// &lt;-- ARGH!</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/trailing_comma_in_parameter_list">PHP RFC: Allow trailing comma in parameter list</a>.</p>
<div class="section" id="id1484">
<h3>9.557.1. Suggestions<a class="headerlink" href="#id1484" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/SignatureTrailingComma</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="silently-cast-integer">
<span id="id1485"></span><h2>9.558. Silently Cast Integer<a class="headerlink" href="#silently-cast-integer" title="Permalink to this headline">¶</a></h2>
<p>Those are integer literals that are cast to a float when running PHP. They are too big for the current PHP version, and PHP resorts to cast them into a float, which has a much larger capacity but a lower precision.</p>
<p>Compare your literals to <code class="docutils literal notranslate"><span class="pre">PHP_MAX_INT</span></code> (typically <code class="docutils literal notranslate"><span class="pre">9223372036854775807</span></code>) and <code class="docutils literal notranslate"><span class="pre">PHP_MIN_INT</span></code> (typically <code class="docutils literal notranslate"><span class="pre">-9223372036854775808</span></code>).
This applies to binary (<code class="docutils literal notranslate"><span class="pre">0b10101</span></code>…), octal (<code class="docutils literal notranslate"><span class="pre">0123123</span></code>…) and hexadecimal (<code class="docutils literal notranslate"><span class="pre">0xfffff</span></code>…) too.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">echo</span> <span class="mi">0</span><span class="nx">b1010101101010110101011010101011010101011010101011010101011010111</span><span class="p">;</span>
<span class="c1">//6173123008118052203</span>
<span class="k">echo</span> <span class="mi">0</span><span class="nx">b10101011010101101010110101010110101010110101010110101010110101111</span><span class="p">;</span>
<span class="c1">//1.2346246016236E+19</span>

<span class="k">echo</span> <span class="mo">0123123123123123123123</span><span class="p">;</span>
<span class="c1">//1498121094048818771</span>
<span class="k">echo</span> <span class="mo">01231231231231231231231</span><span class="p">;</span>
<span class="c1">//1.1984968752391E+19</span>

<span class="k">echo</span> <span class="mh">0x12309812311230</span><span class="p">;</span>
<span class="c1">//5119979279159856</span>
<span class="k">echo</span> <span class="mh">0x12309812311230fed</span><span class="p">;</span>
<span class="c1">//2.0971435127439E+19</span>

<span class="k">echo</span> <span class="mi">9223372036854775807</span><span class="p">;</span> <span class="c1">//PHP_MAX_INT</span>
<span class="c1">//9223372036854775807</span>
<span class="k">echo</span> <span class="mi">9223372036854775808</span><span class="p">;</span>
<span class="mf">9.2233720368548E+18</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.integer.php#language.types.integer.overflow">Integer overflow</a>.</p>
<div class="section" id="id1486">
<h3>9.558.1. Suggestions<a class="headerlink" href="#id1486" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make sure hexadecimal numbers have the right number of digits : generally, it is 15, but it may depends on your PHP version.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/SilentlyCastInteger</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#mediawiki-type-silentlycastinteger"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="similar-integers">
<span id="id1487"></span><h2>9.559. Similar Integers<a class="headerlink" href="#similar-integers" title="Permalink to this headline">¶</a></h2>
<p>This analysis reports all integer values that are expressed in different format.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Three ways to write 10 (more available)</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mo">012</span><span class="p">;</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="mh">0xA</span><span class="p">;</span>

<span class="c1">// 7 is expressed in one way only</span>
<span class="nv">$d</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="nv">$d</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>

<span class="c1">// Four ways to write 11 (more available)</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mo">013</span><span class="p">;</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="mh">0xB</span><span class="p">;</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="o">-+-</span><span class="mi">11</span><span class="p">;</span>

<span class="c1">// Expressions are not counted</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1488">
<h3>9.559.1. Suggestions<a class="headerlink" href="#id1488" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/SimilarIntegers</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a>, <a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="simple-global-variable">
<span id="id1489"></span><h2>9.560. Simple Global Variable<a class="headerlink" href="#simple-global-variable" title="Permalink to this headline">¶</a></h2>
<p>The global keyword should only be used with simple variables. Since PHP 7, it cannot be used with complex or dynamic structures.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Forbidden in PHP 7</span>
<span class="k">global</span> <span class="nv">$normalGlobal</span><span class="p">;</span>

<span class="c1">// Forbidden in PHP 7</span>
<span class="k">global</span> <span class="nv">$$variable</span><span class="o">-&gt;</span><span class="na">global</span> <span class="p">;</span>

<span class="c1">// Tolerated in PHP 7</span>
<span class="k">global</span> <span class="err">$</span><span class="p">{</span><span class="nv">$variable</span><span class="o">-&gt;</span><span class="na">global</span><span class="p">};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1490">
<h3>9.560.1. Suggestions<a class="headerlink" href="#id1490" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add curly braces so the syntax is compatibles PHP 5 and PHP 7</li>
<li>Remove this syntax, and access the variable through another way : argument, array, property.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/GlobalWithoutSimpleVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="simple-switch">
<span id="id1491"></span><h2>9.561. Simple Switch<a class="headerlink" href="#simple-switch" title="Permalink to this headline">¶</a></h2>
<p>Switches are faster when relying only on integers or strings.</p>
<p>Since PHP 7.2, simple switches that use only strings or integers are optimized. The gain is as great as the switch is big.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Optimized switch.</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s2">&quot;a&quot;</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;b&quot;</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;d&quot;</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span> <span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Unoptimized switch.</span>
<span class="c1">// Try moving the foo() call in the default, to keep the rest of the switch optimized.</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s2">&quot;a&quot;</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">foo</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;c&quot;</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="s2">&quot;d&quot;</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span> <span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://derickrethans.nl/php7.2-switch.html">PHP 7.2’s “switch” optimisations</a>.</p>
<div class="section" id="id1492">
<h3>9.561.1. Suggestions<a class="headerlink" href="#id1492" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Split the switch between literal and dynamic cases</li>
<li>Remove the dynamic cases from the switch</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/SimpleSwitch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.2 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="simplify-regex">
<span id="id1493"></span><h2>9.562. Simplify Regex<a class="headerlink" href="#simplify-regex" title="Permalink to this headline">¶</a></h2>
<p>Avoid using regex when the searched string or the replacement are simple enough.</p>
<p>PRCE regex are a powerful way to search inside strings, but they also come at the price of performance. When the query is simple enough, try using <a class="reference external" href="https://www.php.net/strpos">strpos()</a> or <a class="reference external" href="https://www.php.net/stripos">stripos()</a> instead.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// simple preg calls</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/a/&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">))</span>  <span class="p">{}</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/b/i&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">))</span> <span class="p">{}</span> <span class="c1">// case insensitive</span>

<span class="c1">// light replacements</span>
<span class="k">if</span><span class="p">(</span> <span class="nb">strpos</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">))</span> <span class="p">{}</span>
<span class="k">if</span><span class="p">(</span> <span class="nb">stripos</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">))</span> <span class="p">{}</span>       <span class="c1">// case insensitive</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1494">
<h3>9.562.1. Suggestions<a class="headerlink" href="#id1494" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use str_replace(), strtr() or even strpos()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SimplePreg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-structures-simplepreg"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#openconf-structures-simplepreg"><span class="std std-ref">OpenConf</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="slice-arrays-first">
<span id="id1495"></span><h2>9.563. Slice Arrays First<a class="headerlink" href="#slice-arrays-first" title="Permalink to this headline">¶</a></h2>
<p>Always start by reducing an array before applying some transformation on it. The shorter array will be processed faster.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// fast version</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>

<span class="c1">// slower version</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">array_slice</span><span class="p">(</span><span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$array</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The gain produced here is greater with longer arrays, or greater reductions. They may also be used in loops. This is a micro-optimisation when used on short arrays.</p>
<div class="section" id="id1496">
<h3>9.563.1. Suggestions<a class="headerlink" href="#id1496" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the array transforming function on the result of the array shortening function.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/SliceFirst</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-arrays-slicefirst"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="slow-functions">
<span id="id1497"></span><h2>9.564. Slow Functions<a class="headerlink" href="#slow-functions" title="Permalink to this headline">¶</a></h2>
<p>Avoid using those slow native PHP functions, and replace them with alternatives.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="nx">source</span><span class="p">();</span>

<span class="c1">// Slow extraction of distinct values</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// Much faster extraction of distinct values</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">array_keys</span><span class="p">(</span><span class="nb">array_count_values</span><span class="p">(</span><span class="nv">$array</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Slow Function</td>
<td>Faster</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://www.php.net/array_diff">array_diff()</a>
<a class="reference external" href="https://www.php.net/array_intersect">array_intersect()</a>
<a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a>
<a class="reference external" href="https://www.php.net/array_map">array_map()</a>
<a class="reference external" href="https://www.php.net/array_search">array_search()</a>
<a class="reference external" href="https://www.php.net/array_udiff">array_udiff()</a>
<a class="reference external" href="https://www.php.net/array_uintersect">array_uintersect()</a>
<a class="reference external" href="https://www.php.net/array_unshift">array_unshift()</a>
<a class="reference external" href="https://www.php.net/array_walk">array_walk()</a>
<a class="reference external" href="https://www.php.net/in_array">in_array()</a>
<a class="reference external" href="https://www.php.net/preg_replace">preg_replace()</a>
<a class="reference external" href="https://www.php.net/strstr">strstr()</a>
<a class="reference external" href="https://www.php.net/uasort">uasort()</a>
<a class="reference external" href="https://www.php.net/uksort">uksort()</a>
<a class="reference external" href="https://www.php.net/usort">usort()</a>
<a class="reference external" href="https://www.php.net/array_unique">array_unique()</a></td>
<td><a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>
<a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>
<a class="reference external" href="https://www.www.php.net/isset">isset()</a> and <a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a>
<a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>
<a class="reference external" href="https://www.php.net/array_flip">array_flip()</a> and <a class="reference external" href="https://www.www.php.net/isset">isset()</a>
Use another way
Use another way
Use another way
<a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a>
<a class="reference external" href="https://www.www.php.net/isset">isset()</a>
<a class="reference external" href="https://www.php.net/strpos">strpos()</a>
<a class="reference external" href="https://www.php.net/strpos">strpos()</a>
Use another way
Use another way
Use another way
<a class="reference external" href="https://www.php.net/array_keys">array_keys()</a> and <a class="reference external" href="https://www.php.net/array_count_values">array_count_values()</a></td>
</tr>
</tbody>
</table>
<p><a class="reference external" href="https://www.php.net/array_unique">array_unique()</a> has been accelerated in PHP 7.2 and may be used directly from this version on : <a class="reference external" href="https://www.php.net/array_unique">Optimize `array_unique()</a> &lt;<a class="reference external" href="https://github.com/php/php-src/commit/6c2c7a023da4223e41fea0225c51a417fc8eb10d">https://github.com/php/php-src/commit/6c2c7a023da4223e41fea0225c51a417fc8eb10d</a>&gt;`_.</p>
<p><a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a> has been accelerated in PHP 7.4 and may be used directly from this version on : <a class="reference external" href="https://www.php.net/array_key_exists">Implement ZEND_ARRAY_KEY_EXISTS opcode to speed up `array_key_exists()</a> &lt;<a class="reference external" href="https://github.com/php/php-src/pull/3360">https://github.com/php/php-src/pull/3360</a>&gt;`_.</p>
<div class="section" id="id1519">
<h3>9.564.1. Suggestions<a class="headerlink" href="#id1519" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the slow function with a faster version</li>
<li>Remove the usage of the slow function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/SlowFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/avoid-those-slow-functions.md">avoid-those-slow-functions</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-performances-slowfunctions"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#suitecrm-performances-slowfunctions"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="sqlite3-requires-single-quotes">
<span id="id1520"></span><h2>9.565. Sqlite3 Requires Single Quotes<a class="headerlink" href="#sqlite3-requires-single-quotes" title="Permalink to this headline">¶</a></h2>
<p>The escapeString() method from <code class="docutils literal notranslate"><span class="pre">SQLite3</span></code> doesn’t escape <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>, but only <code class="docutils literal notranslate"><span class="pre">'</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// OK. escapeString is OK with &#39;</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM table WHERE col = &#39;&quot;</span><span class="o">.</span><span class="nv">$sqlite</span><span class="o">-&gt;</span><span class="na">escapeString</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span><span class="o">.</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>

<span class="c1">// This is vulnerable to &quot; in $x</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="s1">&#39;SELECT * FROM table WHERE col = &quot;&#39;</span><span class="o">.</span><span class="nv">$sqlite</span><span class="o">-&gt;</span><span class="na">escapeString</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;&quot;&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>To properly handle quotes and <code class="docutils literal notranslate"><span class="pre">NUL</span></code> characters, use bindParam() instead.</p>
<p>Quote from the PHP manual comments : <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">reason</span> <span class="pre">this</span> <span class="pre">function</span> <span class="pre">doesn't</span> <span class="pre">escape</span> <span class="pre">double</span> <span class="pre">quotes</span> <span class="pre">is</span> <span class="pre">because</span> <span class="pre">double</span> <span class="pre">quotes</span> <span class="pre">are</span> <span class="pre">used</span> <span class="pre">with</span> <span class="pre">names</span> <span class="pre">(the</span> <span class="pre">equivalent</span> <span class="pre">of</span> <span class="pre">backticks</span> <span class="pre">in</span> <span class="pre">MySQL),</span> <span class="pre">as</span> <span class="pre">in</span> <span class="pre">table</span> <span class="pre">or</span> <span class="pre">column</span> <span class="pre">names,</span> <span class="pre">while</span> <span class="pre">single</span> <span class="pre">quotes</span> <span class="pre">are</span> <span class="pre">used</span> <span class="pre">for</span> <span class="pre">values.</span></code></p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/sqlite3.escapestring.php">SQLite3::escapeString</a>.</p>
<div class="section" id="id1521">
<h3>9.565.1. Suggestions<a class="headerlink" href="#id1521" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use prepared statements whenever possible</li>
<li>Switch the query to use single quote</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/Sqlite3RequiresSingleQuotes</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="static-global-variables-confusion">
<span id="id1522"></span><h2>9.566. Static Global Variables Confusion<a class="headerlink" href="#static-global-variables-confusion" title="Permalink to this headline">¶</a></h2>
<p>PHP can’t have variable that are both <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> and variable. While the syntax is legit, the variables will be alternatively global or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>.</p>
<p>It is recommended to avoid using the same name for a global variable and a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> variable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// $a is a local variable</span>

    <span class="k">global</span> <span class="nv">$a</span><span class="p">;</span> <span class="c1">// $a is now a global variable</span>

    <span class="k">static</span> <span class="nv">$a</span><span class="p">;</span> <span class="c1">// $a is not w static variable</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1526">
<h3>9.566.1. Suggestions<a class="headerlink" href="#id1526" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using static variables</li>
<li>Avoid using global variables</li>
<li>Avoid using the same name for static and global variables</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SGVariablesConfusion</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="static-loop">
<span id="id1527"></span><h2>9.567. Static Loop<a class="headerlink" href="#static-loop" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> loop may be preprocessed.</p>
<p>It looks like the following loops are <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> : the same code is executed each time, without taking into account loop variables.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Static loop</span>
<span class="nv">$total</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$total</span> <span class="o">+=</span> <span class="nv">$i</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// The above loop may be replaced by (with some math help)</span>
<span class="nv">$total</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span>  <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// Non-Static loop (the loop depends on the size of the array)</span>
<span class="nv">$n</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$n</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$total</span> <span class="o">+=</span> <span class="nv">$i</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is possible to create loops that don’t use any blind variables, though this is fairly rare. In particular, calling a method may update an internal pointer, like <a class="reference external" href="https://www.php.net/next">next()</a> or <code class="docutils literal notranslate"><span class="pre">SimpleXMLIterator\:\:`next()</span> <span class="pre">&lt;https://www.php.net/next&gt;`_</span></code>.</p>
<p>It is recommended to turn a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> loop into an expression that avoid the loop. For example, replacing the sum of all integers by the <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">$n</span> <span class="pre">*</span> <span class="pre">($n</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">/</span> <span class="pre">2</span></code>, or using <a class="reference external" href="https://www.php.net/array_sum">array_sum()</a>.</p>
<p>This analysis doesn’t detect usage of variables with <code class="docutils literal notranslate"><span class="pre">compact</span></code>.</p>
<div class="section" id="id1533">
<h3>9.567.1. Suggestions<a class="headerlink" href="#id1533" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Precalculate the result of that loop and removes it altogether</li>
<li>Check that the loop is not missing a blind variable usage</li>
<li>Replace the usage of a loop with a native PHP call : for example, with str_repeat(). Although the loop is still here, it usually reflects better the intend.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/StaticLoop</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="static-methods-called-from-object">
<span id="id1534"></span><h2>9.568. Static Methods Called From Object<a class="headerlink" href="#static-methods-called-from-object" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> methods may be called without instantiating an object. As such, they never interact with the special variable ‘<a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a>’, as they do not depend on object existence.</p>
<p>Besides this, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods are normal methods that may be called directly from object context, to perform some utility task.</p>
<p>To maintain code readability, it is recommended to call <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method in a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> way, rather than within object context.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
        <span class="k">static</span> <span class="k">function</span> <span class="nf">y</span><span class="p">(</span> <span class="p">)</span> <span class="p">{}</span>
    <span class="p">}</span>

    <span class="nv">$z</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">x</span><span class="p">(</span> <span class="p">);</span>

    <span class="nv">$z</span><span class="o">-&gt;</span><span class="na">y</span><span class="p">(</span> <span class="p">);</span> <span class="c1">// Readability : no one knows it is a static call</span>
    <span class="nx">x</span><span class="o">::</span><span class="na">y</span><span class="p">(</span> <span class="p">);</span>  <span class="c1">// Readability : here we know</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/StaticMethodsCalledFromObject</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="static-methods-can-t-contain-this">
<span id="id1540"></span><h2>9.569. Static Methods Can’t Contain $this<a class="headerlink" href="#static-methods-can-t-contain-this" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> methods are also called <code class="docutils literal notranslate"><span class="pre">class</span> <span class="pre">methods</span></code> : they may be called even if the class has no instantiated object. Thus, the local variable <code class="docutils literal notranslate"><span class="pre">$this</span></code> won’t exist, PHP will set it to <a class="reference external" href="https://www.php.net/manual/en/language.types.null.php">NULL</a> as usual.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// Static method may access other static methods, or property, or none.</span>
    <span class="k">static</span> <span class="k">function</span> <span class="nf">staticBar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This is not possible in a static method</span>
        <span class="k">return</span> <span class="nx">self</span><span class="o">::</span><span class="na">otherStaticBar</span><span class="p">()</span> <span class="o">.</span> <span class="k">static</span><span class="o">::</span><span class="nv">$staticProperty</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This is not possible in a static method</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">property</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Either this is not a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method, which is fixed by removing the <code class="docutils literal notranslate"><span class="pre">static</span></code> keyword, or replace all <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> mention by <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> properties <code class="docutils literal notranslate"><span class="pre">Class\:\:$property</span></code>.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static Keyword &lt;https://www.php.net/manual/en/language.oop5.`static</a>.php&gt;`_</p>
<div class="section" id="id1547">
<h3>9.569.1. Suggestions<a class="headerlink" href="#id1547" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove any $this usage</li>
<li>Turn any $this usage into a static call : $this-&gt;foo() =&gt; self::foo()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/StaticContainsThis</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-static-this.md">no-static-this</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-classes-staticcontainsthis"><span class="std std-ref">xataface</span></a>, <a class="reference internal" href="Cases.html#sugarcrm-classes-staticcontainsthis"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="strange-name-for-constants">
<span id="id1548"></span><h2>9.570. Strange Name For Constants<a class="headerlink" href="#strange-name-for-constants" title="Permalink to this headline">¶</a></h2>
<p>Those constants looks like a typo from other names.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This code looks OK : DIRECTORY_SEPARATOR is a native PHP constant</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="nv">$path</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">;</span>

<span class="c1">// Strange name DIRECOTRY_SEPARATOR</span>
<span class="nv">$path</span> <span class="o">=</span> <span class="nv">$path</span> <span class="o">.</span> <span class="nx">DIRECOTRY_SEPARATOR</span> <span class="o">.</span> <span class="nv">$file</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1549">
<h3>9.570.1. Suggestions<a class="headerlink" href="#id1549" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix any typo in the spelling of the constants</li>
<li>Tell us about common misspelling so we can upgrade this analysis</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/StrangeName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="strange-name-for-variables">
<span id="id1550"></span><h2>9.571. Strange Name For Variables<a class="headerlink" href="#strange-name-for-variables" title="Permalink to this headline">¶</a></h2>
<p>Variables with strange names. They might be a typo, or bear strange patterns.</p>
<p>Any variable with three identical letter in a row are considered as strange. 2 letters in a row is classic, and while three letters may happen, it is rare enough.</p>
<p>A list of classic typo is also used to find such variables.</p>
<p>This analysis is case-sensitive.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Strange name $tihs</span>
        <span class="k">return</span> <span class="nv">$tihs</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">barbar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// variables with blocks of 3 times the same character are reported</span>
        <span class="c1">// Based on Alexandre Joly&#39;s tweet</span>
        <span class="nv">$aaa</span> <span class="o">=</span> <span class="nv">$bab</span> <span class="o">+</span> <span class="nv">$www</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://twitter.com/bsmt_nevers/status/949238391769653249">#QuandLeDevALaFleme</a>.</p>
<div class="section" id="id1551">
<h3>9.571.1. Suggestions<a class="headerlink" href="#id1551" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the name of the variable</li>
<li>Rename the variable to something better</li>
<li>Drop the variable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/StrangeName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#fuelcms-variables-strangename"><span class="std std-ref">FuelCMS</span></a>, <a class="reference internal" href="Cases.html#phpipam-variables-strangename"><span class="std std-ref">PhpIPAM</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="strict-comparison-with-booleans">
<span id="id1552"></span><h2>9.572. Strict Comparison With Booleans<a class="headerlink" href="#strict-comparison-with-booleans" title="Permalink to this headline">¶</a></h2>
<p>Strict comparisons prevent from mistaking an error with a false.</p>
<p>Boolean values may be easily mistaken with other values, especially when the function may return integer or boolean as a normal course of action.</p>
<p>It is encouraged to use strict comparison === or !== when booleans are involved in a comparison.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// distinguish between : $b isn&#39;t in $a, and, $b is at the beginning of $a</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// DOES NOT distinguish between : $b isn&#39;t in $a, and, $b is at the beginning of $a</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// will NOT mistake 1 and true</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// will mistake 1 and true</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a> structures always uses == comparisons.</p>
<p>Native function <a class="reference external" href="https://www.php.net/in_array">in_array()</a> has a third parameter to make it use strict comparisons.</p>
<div class="section" id="id1555">
<h3>9.572.1. Suggestions<a class="headerlink" href="#id1555" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use strict comparison whenever possible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/BooleanStrictComparison</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phinx-structures-booleanstrictcomparison"><span class="std std-ref">Phinx</span></a>, <a class="reference internal" href="Cases.html#typo3-structures-booleanstrictcomparison"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="string-initialization">
<span id="id1556"></span><h2>9.573. String Initialization<a class="headerlink" href="#string-initialization" title="Permalink to this headline">¶</a></h2>
<p>It used to be possible to initialize a variable with an string, and use it as an array. It is not the case anymore in PHP 7.1.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Initialize arrays with array()</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="c1">// Don&#39;t start with a string</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">print</span> <span class="nv">$a</span><span class="p">;</span>

<span class="c1">// Don&#39;t start with a string</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.drupal.org/project/adaptivetheme/issues/2832900">PHP 7.1 no longer converts string to arrays the first time a value is assigned with square bracket notation</a>.</p>
<div class="section" id="id1557">
<h3>9.573.1. Suggestions<a class="headerlink" href="#id1557" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always initialize arrays with an empty array(), not a string.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/StringInitialization</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="string-may-hold-a-variable">
<span id="id1558"></span><h2>9.574. String May Hold A Variable<a class="headerlink" href="#string-may-hold-a-variable" title="Permalink to this headline">¶</a></h2>
<p>Those strings looks like holding a variable.</p>
<p>Single quotes and Nowdoc syntax may include $ signs that are treated as literals, and not replaced with a variable value.</p>
<p>However, there are some potential variables in those strings, making it possible for an error : the variable was forgotten and will be published as such. It is worth checking the content and make sure those strings are not variables.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// Explicit variable, but literal effect is needed</span>
<span class="k">echo</span> <span class="s1">&#39;$a is &#39;</span><span class="o">.</span><span class="nv">$a</span><span class="p">;</span>

<span class="c1">// One of the variable has been forgotten</span>
<span class="k">echo</span> <span class="s1">&#39;$a is $a&#39;</span><span class="p">;</span>

<span class="c1">// $CAD is not a variable, rather a currency unit</span>
<span class="nv">$total</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$total</span><span class="o">.</span><span class="s1">&#39; $CAD&#39;</span><span class="p">;</span>

<span class="c1">// $CAD is not a variable, rather a currency unit</span>
<span class="nv">$total</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>

<span class="c1">// Here, $total has been forgotten</span>
<span class="k">echo</span> <span class="s">&lt;&lt;&lt;&#39;</span><span class="dl">TEXT</span><span class="s">&#39;</span>
<span class="s">$total $CAD</span>
<span class="dl">TEXT</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/StringHoldAVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="strings-with-strange-space">
<span id="id1559"></span><h2>9.575. Strings With Strange Space<a class="headerlink" href="#strings-with-strange-space" title="Permalink to this headline">¶</a></h2>
<p>An invisible space may be mistaken for a normal space.</p>
<p>However, PHP does straight comparisons, and may fail at recognizing. This analysis reports when it finds such strange spaces inside strings.</p>
<p>PHP doesn’t mistake space and tables for whitespace when tokenizing the code.</p>
<p>This analysis doesn’t report Unicode Codepoint Notation : those are visible in the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7 notation,</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">\u</span><span class="p">{</span><span class="mi">3000</span><span class="p">};</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="p">;</span>

<span class="c1">// Displays false</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="nv">$b</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.cs.tut.fi/~jkorpela/chars/spaces.html">Unicode spaces</a>, and <a class="reference external" href="http://eslint.org/docs/rules/no-irregular-whitespace">disallow irregular whitespace (no-irregular-whitespace)</a>.</p>
<div class="section" id="id1560">
<h3>9.575.1. Suggestions<a class="headerlink" href="#id1560" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the odd spaces with a normal space</li>
<li>If unsecable spaces are important for presentation, add them at the templating level.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Type/StringWithStrangeSpace</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openemr-type-stringwithstrangespace"><span class="std std-ref">OpenEMR</span></a>, <a class="reference internal" href="Cases.html#thelia-type-stringwithstrangespace"><span class="std std-ref">Thelia</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="strpos-like-comparison">
<span id="id1561"></span><h2>9.576. Strpos()-like Comparison<a class="headerlink" href="#strpos-like-comparison" title="Permalink to this headline">¶</a></h2>
<p>The result of that function may be mistaken with an error.</p>
<p><a class="reference external" href="https://www.php.net/strpos">strpos()</a>, along with several PHP native functions, returns a string position, starting at 0, or false, in case of failure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is the best comparison</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// This is OK, as 2 won&#39;t be mistaken with false</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// strpos is one of the 26 functions that may behave this way</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="nv">$regex</span><span class="p">,</span> <span class="nv">$string</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// This works like above, catching the value for later reuse</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// This misses the case where &#39;a&#39; is the first char of the string</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// This misses the case where &#39;a&#39; is the first char of the string, just like above</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to check the result of <a class="reference external" href="https://www.php.net/strpos">strpos()</a> with === or !==, so as to avoid confusing 0 and false.</p>
<p>This analyzer list all the <a class="reference external" href="https://www.php.net/strpos">strpos()</a>-like functions that are directly compared with == or !=. <a class="reference external" href="https://www.php.net/preg_match">preg_match()</a>, when its first argument is a literal, is omitted : this function only returns <a class="reference external" href="https://www.php.net/manual/en/language.types.null.php">NULL</a> in case of regex error.</p>
<p>The full list is the following :</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/array_search">array_search()</a></li>
<li><a class="reference external" href="https://www.php.net/collator_compare">collator_compare()</a></li>
<li><a class="reference external" href="https://www.php.net/collator_get_sort_key">collator_get_sort_key()</a></li>
<li><a class="reference external" href="https://www.php.net/current">current()</a></li>
<li><a class="reference external" href="https://www.php.net/fgetc">fgetc()</a></li>
<li><a class="reference external" href="https://www.php.net/file_get_contents">file_get_contents()</a></li>
<li><a class="reference external" href="https://www.php.net/file_put_contents">file_put_contents()</a></li>
<li><a class="reference external" href="https://www.php.net/fread">fread()</a></li>
<li><a class="reference external" href="https://www.php.net/iconv_strpos">iconv_strpos()</a></li>
<li><a class="reference external" href="https://www.php.net/iconv_strrpos">iconv_strrpos()</a></li>
<li><a class="reference external" href="https://www.php.net/imagecolorallocate">imagecolorallocate()</a></li>
<li><a class="reference external" href="https://www.php.net/imagecolorallocatealpha">imagecolorallocatealpha()</a></li>
<li><a class="reference external" href="https://www.php.net/mb_strlen">mb_strlen()</a></li>
<li><a class="reference external" href="https://www.php.net/next">next()</a></li>
<li><a class="reference external" href="https://www.php.net/pcntl_getpriority">pcntl_getpriority()</a></li>
<li><a class="reference external" href="https://www.php.net/preg_match">preg_match()</a></li>
<li><a class="reference external" href="https://www.php.net/prev">prev()</a></li>
<li><a class="reference external" href="https://www.php.net/readdir">readdir()</a></li>
<li><a class="reference external" href="https://www.php.net/stripos">stripos()</a></li>
<li><a class="reference external" href="https://www.php.net/strpos">strpos()</a></li>
<li><a class="reference external" href="https://www.php.net/strripos">strripos()</a></li>
<li><a class="reference external" href="https://www.php.net/strrpos">strrpos()</a></li>
<li><a class="reference external" href="https://www.php.net/strtok">strtok()</a></li>
<li><a class="reference external" href="https://www.php.net/curl_exec">curl_exec()</a></li>
</ul>
<p>In PHP 8.0, str_contains() will do the expected job of <a class="reference external" href="https://www.php.net/strpos">strpos()</a>, with less confusion.</p>
<p>See also <a class="reference external" href="https://bugs.php.net/bug.php?id=52198">strpos not working correctly</a>.</p>
<div class="section" id="id1578">
<h3>9.576.1. Suggestions<a class="headerlink" href="#id1578" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use identity comparisons, for 0 values : === instead of ==, etc.</li>
<li>Compare with other exact values than 0 : strpos() == 2</li>
<li>Use str_contains()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/StrposCompare</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/strict-comparisons.md">strict-comparisons</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#piwigo-structures-strposcompare"><span class="std std-ref">Piwigo</span></a>, <a class="reference internal" href="Cases.html#thelia-structures-strposcompare"><span class="std std-ref">Thelia</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="strtr-arguments">
<span id="id1579"></span><h2>9.577. Strtr Arguments<a class="headerlink" href="#strtr-arguments" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/strtr">Strtr()</a> replaces characters by others in a string. When using strings, <a class="reference external" href="https://www.php.net/strtr">strtr()</a> replaces characters as long as they have a replacement. All others are ignored.</p>
<p>In particular, <a class="reference external" href="https://www.php.net/strtr">strtr()</a> works on strings of the same size, and cannot be used to remove chars.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;abcde&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">strtr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span> <span class="s1">&#39;AB&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">strtr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">,</span> <span class="s1">&#39;ABC&#39;</span><span class="p">);</span>
<span class="c1">// displays ABcde</span>
<span class="c1">// c is ignored each time</span>

<span class="c1">// strtr can&#39;t remove a char</span>
<span class="k">echo</span> <span class="nb">strtr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="c1">// displays a</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/strtr">strtr</a>.</p>
<div class="section" id="id1583">
<h3>9.577.1. Suggestions<a class="headerlink" href="#id1583" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check the call to strtr() and make sure the arguments are of the same size</li>
<li>Replace strtr() with str_replace(), which works with strings and array, not chars</li>
<li>Replace strtr() with preg_match(), which works with patterns and not chars</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/StrtrArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#suitecrm-php-strtrarguments"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="substr-to-trim">
<span id="id1584"></span><h2>9.578. Substr To Trim<a class="headerlink" href="#substr-to-trim" title="Permalink to this headline">¶</a></h2>
<p>When removing the first or the last character of a string, <a class="reference external" href="https://www.php.net/trim">trim()</a> does a more readable job.</p>
<p><a class="reference external" href="https://www.php.net/trim">trim()</a>, <a class="reference external" href="https://www.php.net/ltrim">ltrim()</a> and <a class="reference external" href="https://www.php.net/rtrim">rtrim()</a> accept a string as second argument. Those will all be removed from the endings of the string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;$drop the dollar&#39;</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// drop the first char</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">ltrim</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="s1">&#39;$&#39;</span><span class="p">);</span> <span class="c1">// remove the initial &#39;$&#39;s</span>


<span class="nv">$b</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>     <span class="c1">// replace with ltrim()</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// replace with rtrim()</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// replace with trim()</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/trim">trim()</a> will remove all occurrences of the requested char(). This may remove a loop with <a class="reference external" href="https://www.php.net/substr">substr()</a>, or remove more than is needed.</p>
<p><a class="reference external" href="https://www.php.net/trim">trim()</a> doesn’t work with multi-bytes strings, but so does <a class="reference external" href="https://www.php.net/substr">substr()</a>. For that, use <a class="reference external" href="https://www.php.net/mb_substr">mb_substr()</a>, as there isn’t any mb_trim function (yet).</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.trim.php">trim</a>, <a class="reference external" href="https://www.php.net/manual/en/function.ltrim.php">ltrim</a>, <a class="reference external" href="https://www.php.net/manual/en/function.rtrim.php">rtrim</a>.</p>
<div class="section" id="id1594">
<h3>9.578.1. Suggestions<a class="headerlink" href="#id1594" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace substr() with trim(), ltrim() or rtrim().</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SubstrToTrim</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="substring-first">
<span id="id1595"></span><h2>9.579. Substring First<a class="headerlink" href="#substring-first" title="Permalink to this headline">¶</a></h2>
<p>Always start by reducing a string before applying some transformation on it. The shorter string will be processed faster.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// fast version</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="nv">$offset</span><span class="p">,</span> <span class="nv">$length</span><span class="p">));</span>

<span class="c1">// slower version</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$string</span><span class="p">),</span> <span class="nv">$offset</span><span class="p">,</span> <span class="nv">$length</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The gain produced here is greater with longer strings, or greater reductions. They may also be used in loops. This is a micro-optimisation when used on short strings and single string reductions.</p>
<p>This works with any reduction function instead of <a class="reference external" href="https://www.php.net/substr">substr()</a>, like <a class="reference external" href="https://www.php.net/trim">trim()</a>, <a class="reference external" href="https://www.php.net/iconv">iconv()</a>, etc.</p>
<div class="section" id="id1598">
<h3>9.579.1. Suggestions<a class="headerlink" href="#id1598" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always reduce the string first, then apply some transformation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/SubstrFirst</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#spip-performances-substrfirst"><span class="std std-ref">SPIP</span></a>, <a class="reference internal" href="Cases.html#prestashop-performances-substrfirst"><span class="std std-ref">PrestaShop</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="suspicious-comparison">
<span id="id1599"></span><h2>9.580. Suspicious Comparison<a class="headerlink" href="#suspicious-comparison" title="Permalink to this headline">¶</a></h2>
<p>The comparison seems to be misplaced.</p>
<p>A comparison happens in the last argument, while the actual function expect another type : this may be the case of a badly placed parenthesis.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// trim expect a string, a boolean is given.</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$str</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)){</span>

<span class="p">}</span>

<span class="c1">// Just move the first closing parenthesis to give back its actual meaning</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">){</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Original idea by <a class="reference external" href="https://twitter.com/kalessil">Vladimir Reznichenko</a>.</p>
<div class="section" id="id1600">
<h3>9.580.1. Suggestions<a class="headerlink" href="#id1600" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the comparison altogether</li>
<li>Move the comparison to its right place : that, or more the parenthesis.</li>
<li>This may be what is intended : just leave it.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SuspiciousComparison</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpipam-structures-suspiciouscomparison"><span class="std std-ref">PhpIPAM</span></a>, <a class="reference internal" href="Cases.html#expressionengine-structures-suspiciouscomparison"><span class="std std-ref">ExpressionEngine</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="swapped-arguments">
<span id="id1601"></span><h2>9.581. Swapped Arguments<a class="headerlink" href="#swapped-arguments" title="Permalink to this headline">¶</a></h2>
<p>Overwritten methods must be compatible, but argument names is not part of that compatibility.</p>
<p>Methods with the same name, in two classes of the same hierarchy, must be compatible for typehint, default value, reference. The name of the argument is not taken into account when checking such compatibility, at least until PHP 7.4.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{}</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">y</span> <span class="k">extends</span> <span class="nx">x</span> <span class="p">{</span>
    <span class="c1">// foo is compatible (identical) with the above class</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{}</span>

    <span class="c1">// bar is compatible with the above class, yet, the argument might not receive what they expect.</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis reports argument lists that differs in ordering. This analysis doesn’t report argument lists that also differs in argument names.</p>
<div class="section" id="id1602">
<h3>9.581.1. Suggestions<a class="headerlink" href="#id1602" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make sure the names of the argument are in the same order in all classes and interfaces</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/SwappedArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="switch-fallthrough">
<span id="id1603"></span><h2>9.582. Switch Fallthrough<a class="headerlink" href="#switch-fallthrough" title="Permalink to this headline">¶</a></h2>
<p>A switch with fallthrough is prone to errors.</p>
<p>A fallthrough happens when a case or default clause in a switch statement is not finished by a <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> (or equivalent);
CWE report this as a security concern, unless well documented.</p>
<p>A fallthrough may be used as a feature. Then, it is indistinguishable from an error.</p>
<p>When the case block is empty, this analysis doesn’t report it : the case is then used as an alias.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$variable</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span> <span class="o">:</span>   <span class="c1">// case 1 is not reported, as it actually shares the same body as case 33</span>
    <span class="k">case</span> <span class="mi">33</span> <span class="o">:</span>
        <span class="k">break</span> <span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span> <span class="o">:</span>
        <span class="k">break</span> <span class="p">;</span>
    <span class="k">default</span><span class="o">:</span>
        <span class="o">++</span><span class="nv">$a</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">4</span> <span class="o">:</span>
        <span class="k">break</span> <span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis doesn’t take into account comments about the fallthrough.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">CWE-484: Omitted `Break</a> Statement in Switch &lt;<a class="reference external" href="https://cwe.mitre.org/data/definitions/484.html">https://cwe.mitre.org/data/definitions/484.html</a>&gt;`_ and <a class="reference external" href="https://palantir.github.io/tslint/rules/no-switch-case-fall-through/">Rule: no-switch-case-fall-through</a>.</p>
<div class="section" id="id1605">
<h3>9.582.1. Suggestions<a class="headerlink" href="#id1605" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make separate code for each case. Always use break at the end of a case or default.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/Fallthrough</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="switch-to-switch">
<span id="id1606"></span><h2>9.583. Switch To Switch<a class="headerlink" href="#switch-to-switch" title="Permalink to this headline">¶</a></h2>
<p>The following structures are based on if / elseif / else. Since they have more than three conditions (not withstanding the final else), it is recommended to use the switch structure, so as to make this more readable.</p>
<p>On the other hand, <a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a> structures with less than 3 elements should be expressed as a if / else structure.</p>
<p>Note that if condition that uses strict typing (=== or !==) can’t be converted to <a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a> as the latter only performs == or != comparisons.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// Better way to write long if/else lists</span>
<span class="k">switch</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span> <span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">2</span> <span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">3</span> <span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">case</span> <span class="mi">4</span> <span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">default</span> <span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">();</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that simple switch statement, which compare a variable to a literal are optimised in PHP 7.2 and more recent. This gives a nice performance boost, and keep code readable.</p>
<p>See also <a class="reference external" href="https://derickrethans.nl/php7.2-switch.html">PHP 7.2’s switch optimisations</a> and <a class="reference external" href="https://www.tomasvotruba.cz/blog/2018/05/21/is-your-code-readable-by-humans-cognitive-complexity-tells-you/">Is Your Code Readable By Humans? Cognitive Complexity Tells You</a>.</p>
<div class="section" id="id1610">
<h3>9.583.1. Suggestions<a class="headerlink" href="#id1610" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use a switch statement, rather than a long string of if/else</li>
<li>Use a match() statement, rather than a long string of if/else (PHP 8.0 +)</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SwitchToSwitch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thelia-structures-switchtoswitch"><span class="std std-ref">Thelia</span></a>, <a class="reference internal" href="Cases.html#xoops-structures-switchtoswitch"><span class="std std-ref">XOOPS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="switch-with-too-many-default">
<span id="id1611"></span><h2>9.584. Switch With Too Many Default<a class="headerlink" href="#switch-with-too-many-default" title="Permalink to this headline">¶</a></h2>
<p>Switch statements should only hold one default, not more. Check the code and remove the extra default.</p>
<p>PHP 7.0 won’t compile a script that allows for several default cases.</p>
<p>Multiple default happens often with large <a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">switch</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span> <span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span> <span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">2</span> <span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="k">default</span> <span class="o">:</span>  <span class="c1">// This default is never reached</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1613">
<h3>9.584.1. Suggestions<a class="headerlink" href="#id1613" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the useless default : it may be the first, or the last. In case of ambiguity, keep the first, as it is the one being used at the moment.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SwitchWithMultipleDefault</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="switch-without-default">
<span id="id1614"></span><h2>9.585. Switch Without Default<a class="headerlink" href="#switch-without-default" title="Permalink to this headline">¶</a></h2>
<p>Always use a default statement in <a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a>.</p>
<p>Switch statements hold a number of ‘case’ that cover all known situations, and a ‘default’ one which is executed when all other options are exhausted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Missing default</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$format</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;gif&#39;</span> <span class="o">:</span>
        <span class="nx">processGif</span><span class="p">();</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">case</span> <span class="s1">&#39;jpeg&#39;</span> <span class="o">:</span>
        <span class="nx">processJpeg</span><span class="p">();</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">case</span> <span class="s1">&#39;bmp&#39;</span> <span class="o">:</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnsupportedFormat</span><span class="p">(</span><span class="nv">$format</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// In case $format is not known, then switch is ignored and no processing happens, leading to preparation errors</span>


<span class="c1">// switch with default</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$format</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;text&#39;</span> <span class="o">:</span>
        <span class="nx">processText</span><span class="p">();</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">case</span> <span class="s1">&#39;jpeg&#39;</span> <span class="o">:</span>
        <span class="nx">processJpeg</span><span class="p">();</span>
        <span class="k">break</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">case</span> <span class="s1">&#39;rtf&#39;</span> <span class="o">:</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnsupportedFormat</span><span class="p">(</span><span class="nv">$format</span><span class="p">);</span>

    <span class="k">default</span> <span class="o">:</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">UnknownFileFormat</span><span class="p">(</span><span class="nv">$format</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// In case $format is not known, an exception is thrown for processing</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Most of the time, <a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a> do need a default case, so as to catch the odd situation where the ‘value is not what it was expected’. This is a good place to catch unexpected values, to set a default behavior.</p>
<div class="section" id="id1617">
<h3>9.585.1. Suggestions<a class="headerlink" href="#id1617" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a default case</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/SwitchWithoutDefault</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-switch-without-default.md">no-switch-without-default</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-structures-switchwithoutdefault"><span class="std std-ref">Zencart</span></a>, <a class="reference internal" href="Cases.html#traq-structures-switchwithoutdefault"><span class="std std-ref">Traq</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="ternary-in-concat">
<span id="id1618"></span><h2>9.586. Ternary In Concat<a class="headerlink" href="#ternary-in-concat" title="Permalink to this headline">¶</a></h2>
<p>Ternary and coalesce operator have higher priority than dot ‘.’ for concatenation. This means that :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="c1">// print B0CE as expected</span>
  <span class="k">print</span> <span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s1">&#39;C&#39;</span><span class="o">.</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;D&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;E&#39;</span><span class="p">;</span>

  <span class="c1">// print E, instead of B0CE</span>
  <span class="k">print</span> <span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s1">&#39;C&#39;</span><span class="o">.</span> <span class="nv">$b</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;D&#39;</span> <span class="o">:</span> <span class="s1">&#39;E&#39;</span><span class="p">;</span>

  <span class="k">print</span> <span class="s1">&#39;B&#39;</span><span class="o">.</span><span class="nv">$b</span><span class="o">.</span><span class="s1">&#39;C&#39;</span><span class="o">.</span> <span class="nv">$b</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;D&#39;</span> <span class="o">:</span> <span class="s1">&#39;E&#39;</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>prints actually ‘E’, instead of the awaited ‘B0CE’.</p>
<p>To be safe, always add parenthesis when using ternary operator with concatenation.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operator Precedence</a>.</p>
<div class="section" id="id1620">
<h3>9.586.1. Suggestions<a class="headerlink" href="#id1620" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use parenthesis</li>
<li>Avoid ternaries and coalesce operators inside a string</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/TernaryInConcat</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#teampass-structures-ternaryinconcat"><span class="std std-ref">TeamPass</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="test-then-cast">
<span id="id1621"></span><h2>9.587. Test Then Cast<a class="headerlink" href="#test-then-cast" title="Permalink to this headline">¶</a></h2>
<p>A test is run on the value, but the cast value is later used.</p>
<p>The cast may introduce a distortion to the value, and still lead to the unwanted situation. For example, comparing to 0, then later casting to an int. The comparison to 0 is done without casting, and as such, 0.1 is different from 0. Yet, (int) 0.1 is actually 0, leading to a Division by 0 error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Here. $x may be different from 0, but (int) $x may be 0</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$y</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$x</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Safe solution : check the cast value.</span>
<span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$y</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="nx">int</span><span class="p">)</span> <span class="nv">$x</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1622">
<h3>9.587.1. Suggestions<a class="headerlink" href="#id1622" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Test with the cast value</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/TestThenCast</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-structures-testthencast"><span class="std std-ref">Dolphin</span></a>, <a class="reference internal" href="Cases.html#suitecrm-structures-testthencast"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="throw-functioncall">
<span id="id1623"></span><h2>9.588. Throw Functioncall<a class="headerlink" href="#throw-functioncall" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">throw</span></code> keyword expects to use an exception. Calling a function to prepare that exception before throwing it is possible, but forgetting the new keyword is also possible.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Forgotten new</span>
<span class="k">throw</span> <span class="nx">\RuntimeException</span><span class="p">(</span><span class="s1">&#39;error!&#39;</span><span class="p">);</span>

<span class="c1">// Code is OK, function returns an exception</span>
<span class="k">throw</span> <span class="nx">getException</span><span class="p">(</span><span class="nx">ERROR_TYPE</span><span class="p">,</span> <span class="s1">&#39;error!&#39;</span><span class="p">);</span>

<span class="k">function</span> <span class="nf">getException</span><span class="p">(</span><span class="nx">ERROR_TYPE</span><span class="p">,</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">\RuntimeException</span><span class="p">(</span><span class="nv">$messsage</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When the <code class="docutils literal notranslate"><span class="pre">new</span></code> keyword is forgotten, then the class constructor is used as a function name, and now exception is emitted, but an <code class="docutils literal notranslate"><span class="pre">Undefined</span> <span class="pre">function</span></code> fatal error is emitted.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.exceptions.php">Exceptions</a>.</p>
<div class="section" id="id1624">
<h3>9.588.1. Suggestions<a class="headerlink" href="#id1624" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add the new operator to the call</li>
<li>Make sure the function is really a functioncall, not a class name</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/ThrowFunctioncall</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#sugarcrm-exceptions-throwfunctioncall"><span class="std std-ref">SugarCrm</span></a>, <a class="reference internal" href="Cases.html#zurmo-exceptions-throwfunctioncall"><span class="std std-ref">Zurmo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="throw-in-destruct">
<span id="id1625"></span><h2>9.589. Throw In Destruct<a class="headerlink" href="#throw-in-destruct" title="Permalink to this headline">¶</a></h2>
<p>According to the manual, <code class="docutils literal notranslate"><span class="pre">Attempting</span> <span class="pre">to</span> <span class="pre">throw</span> <span class="pre">an</span> <span class="pre">exception</span> <span class="pre">from</span> <span class="pre">a</span> <span class="pre">destructor</span> <span class="pre">(called</span> <span class="pre">in</span> <span class="pre">the</span> <span class="pre">time</span> <span class="pre">of</span> <span class="pre">script</span> <span class="pre">termination)</span> <span class="pre">causes</span> <span class="pre">a</span> <span class="pre">fatal</span> <span class="pre">error.</span></code></p>
<p>The destructor may be called during the lifespan of the script, but it is not certain. If the exception is thrown later, the script may end up with a fatal error.</p>
<p>Thus, it is recommended to avoid throwing exceptions within the <code class="docutils literal notranslate"><span class="pre">__destruct</span></code> method of a class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// No exception thrown</span>
<span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;__construct&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cleanObject</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Potential crash</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__destruct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;__destruct&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.decon.php">Constructors and Destructors</a>.</p>
<div class="section" id="id1627">
<h3>9.589.1. Suggestions<a class="headerlink" href="#id1627" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove any exception thrown from a destructor</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/ThrowInDestruct</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="throw-was-an-expression">
<span id="id1628"></span><h2>9.590. Throw Was An Expression<a class="headerlink" href="#throw-was-an-expression" title="Permalink to this headline">¶</a></h2>
<p>Throw used to be an expression. In PHP 7.0, there were some location where one couldn’t use a throw : this was the case for arrow functions, which expect one expression as function’s body.</p>
<p>Using throw as an instruction makes the code incompatible with PHP 7 version and older.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Valid in PHP 8.0 and more recent</span>
<span class="nv">$fn</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/throw_expression">Throw Expression</a> and <a class="reference external" href="https://www.php.net/manual/en/language.exceptions.php">Exceptions</a>.</p>
<div class="section" id="id1630">
<h3>9.590.1. Suggestions<a class="headerlink" href="#id1630" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ThrowWasAnExpression</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="throws-an-assignement">
<span id="id1631"></span><h2>9.591. Throws An Assignement<a class="headerlink" href="#throws-an-assignement" title="Permalink to this headline">¶</a></h2>
<p>It is possible to throw an exception, and, in the same time, assign this exception to a variable.</p>
<p>However, the variable will never be used, as the exception is thrown, and any following code is not executed, unless the exception is caught in the same scope.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// $e is useful, though not by much</span>
    <span class="nv">$e</span> <span class="o">=</span> <span class="k">new</span><span class="p">()</span> <span class="nx">Exception</span><span class="p">();</span>
    <span class="k">throw</span> <span class="nv">$e</span><span class="p">;</span>

    <span class="c1">// $e is useless</span>
    <span class="k">throw</span> <span class="nv">$e</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1632">
<h3>9.591.1. Suggestions<a class="headerlink" href="#id1632" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the assignation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ThrowsAndAssign</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="timestamp-difference">
<span id="id1633"></span><h2>9.592. Timestamp Difference<a class="headerlink" href="#timestamp-difference" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">time()</span></code> and <code class="docutils literal notranslate"><span class="pre">microtime()</span></code> shouldn’t be used to calculate duration.</p>
<p><code class="docutils literal notranslate"><span class="pre">time()</span></code> and <code class="docutils literal notranslate"><span class="pre">microtime()</span></code> are subject to variations, depending on system clock variations, such as daylight saving time difference (every spring and fall, one hour variation), or leap seconds, happening on <code class="docutils literal notranslate"><span class="pre">June,</span> <span class="pre">30th</span></code> or <code class="docutils literal notranslate"><span class="pre">December</span> <span class="pre">31th</span></code>, as announced by <a class="reference external" href="https://www.iers.org/IERS/EN/Home/home_node.html">IERS</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Calculating tomorow, same hour, the wrong way</span>
<span class="c1">// tomorrow is not always in 86400s, especially in countries with daylight saving</span>
<span class="nv">$tomorrow</span> <span class="o">=</span> <span class="nb">time</span><span class="p">()</span>  <span class="o">+</span> <span class="mi">86400</span><span class="p">;</span>

<span class="c1">// Good way to calculate tomorrow</span>
<span class="nv">$datetime</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;tomorrow&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When the difference may be rounded to a larger time unit (rounding the difference to days, or several hours), the variation may be ignored safely.</p>
<p>When the difference is very small, it requires a better way to measure time difference, such as <cite>Ticks &lt;https://www.php.net/manual/en/control-structures.declare.php#control-structures.declare.ticks&gt;’_,
`ext/hrtime &lt;https://www.php.net/manual/en/book.hrtime.php&gt;’_, or including a check on the actual time zone (``ini_get()`</cite> with ‘date.timezone’).</p>
<p>See also <a class="reference external" href="http://blog.codebusters.pl/en/php-datetime-difference-trap/">PHP DateTime difference – it’s a trap!</a> and <a class="reference external" href="https://stackoverflow.com/questions/22519091/php-daylight-savings-bug">PHP Daylight savings bug?</a>.</p>
<div class="section" id="id1634">
<h3>9.592.1. Suggestions<a class="headerlink" href="#id1634" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>For small time intervals, use hrtime() functions</li>
<li>For larger time intervals, use add() method with <code class="docutils literal notranslate"><span class="pre">DateTime</span></code></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/TimestampDifference</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-structures-timestampdifference"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#shopware-structures-timestampdifference"><span class="std std-ref">shopware</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="too-long-a-block">
<span id="id1635"></span><h2>9.593. Too Long A Block<a class="headerlink" href="#too-long-a-block" title="Permalink to this headline">¶</a></h2>
<p>The loop is operating on a block that is too long.</p>
<p>This analysis is applied to loops (for, foreach, while, do..while) and if/then/else/elseif structures.</p>
<p>Then length of a block is managed with the <a href="#id1636"><span class="problematic" id="id1637">``</span></a>longBlock``parameter. By default, it is 200 lines, from beginning to the end. Comments are taken into account.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">do</span> <span class="p">{</span>
    <span class="c1">// 200 lines of PHP code</span>

    <span class="o">++</span><span class="nv">$i</span><span class="p">;</span>
<span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1638">
<h3>9.593.1. Suggestions<a class="headerlink" href="#id1638" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Move the code of the block to an method or a function</li>
<li>Move part of the code of the block to methods or functions</li>
<li>Extract repeated patterns and use them</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="6%" />
<col width="6%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>longBlock</td>
<td>200</td>
<td>integer</td>
<td>Size of a block for it to be too long. A block is commanded by a for, foreach, while, do…while, if/then else structure.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/LongBlock</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="too-many-array-dimensions">
<span id="id1639"></span><h2>9.594. Too Many Array Dimensions<a class="headerlink" href="#too-many-array-dimensions" title="Permalink to this headline">¶</a></h2>
<p>When arrays a getting to many nesting.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span>          <span class="o">=</span> <span class="k">array</span><span class="p">();</span>   <span class="c1">// level 1;</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>       <span class="o">=</span> <span class="k">array</span><span class="p">();</span>   <span class="c1">// level 2</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>    <span class="o">=</span> <span class="k">array</span><span class="p">();</span>   <span class="c1">// level 3 : still valid by default</span>
<span class="nv">$a</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>   <span class="c1">// level 4</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>PHP has no limit, and accepts any number of nesting levels. Yet, this is usually very memory hungry.</p>
<div class="section" id="id1640">
<h3>9.594.1. Suggestions<a class="headerlink" href="#id1640" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="12%" />
<col width="12%" />
<col width="55%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>maxDimensions</td>
<td>3</td>
<td>integer</td>
<td>Number of valid dimensions in an array.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/TooManyDimensions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="too-many-children">
<span id="id1641"></span><h2>9.595. Too Many Children<a class="headerlink" href="#too-many-children" title="Permalink to this headline">¶</a></h2>
<p>Classes that have more than 15 children. It is worth checking if they cannot be refactored in anyway.</p>
<p>The threshold of 15 children can be configured. There is no technical limitation of the number of children and grand-children for a class.</p>
<p>The analysis doesn’t work recursively : only direct generations are counted. Only children that can be found in the code are counted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// parent class</span>
<span class="c1">// calling it grandparent to avoid confusion with &#39;parent&#39;</span>
<span class="k">class</span> <span class="nc">grandparent</span> <span class="p">{}</span>


<span class="k">class</span> <span class="nc">children1</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children2</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children3</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children4</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children5</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children6</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children7</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children8</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children9</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children11</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children12</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children13</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children14</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children15</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children16</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children17</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children18</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">children19</span> <span class="k">extends</span> <span class="nx">grandparent</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://softwareengineering.stackexchange.com/questions/137687/why-is-subclassing-too-much-bad-and-hence-why-should-we-use-prototypes-to-do-aw">Why is subclassing too much bad (and hence why should we use prototypes to do away with it)?</a>.</p>
<div class="section" id="id1642">
<h3>9.595.1. Suggestions<a class="headerlink" href="#id1642" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Split the original class into more specialised classes</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="10%" />
<col width="10%" />
<col width="60%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>childrenClassCount</td>
<td>15</td>
<td>integer</td>
<td>Threshold for too many children classes for one class.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/TooManyChildren</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#typo3-classes-toomanychildren"><span class="std std-ref">Typo3</span></a>, <a class="reference internal" href="Cases.html#woocommerce-classes-toomanychildren"><span class="std std-ref">Woocommerce</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="too-many-dereferencing">
<span id="id1643"></span><h2>9.596. Too Many Dereferencing<a class="headerlink" href="#too-many-dereferencing" title="Permalink to this headline">¶</a></h2>
<p>Linking too many properties and methods, one to the other.</p>
<p>This analysis counts both <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> calls and normal call; methods, properties and constants. It also takes into account arrays along the way.</p>
<p>The default limit of chaining methods and properties is set to 7 by default.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// 9 chained calls.</span>
<span class="nv">$main</span><span class="o">-&gt;</span><span class="na">getA</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getB</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getC</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getD</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getE</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getF</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getG</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getH</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getI</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">property</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Too many chained methods is harder to read.</p>
<div class="section" id="id1645">
<h3>9.596.1. Suggestions<a class="headerlink" href="#id1645" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="12%" />
<col width="12%" />
<col width="46%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>tooManyDereferencing</td>
<td>7</td>
<td>integer</td>
<td>Maximum number of dereferencing.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/TooManyDereferencing</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="too-many-finds">
<span id="id1646"></span><h2>9.597. Too Many Finds<a class="headerlink" href="#too-many-finds" title="Permalink to this headline">¶</a></h2>
<p>Too many methods called ‘find*’ in this class. It is may be time to consider the <a class="reference external" href="https://en.wikipedia.org/wiki/Specification_pattern">Specification pattern</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// quite a fishy interface</span>
<span class="k">interface</span> <span class="nx">UserInterface</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findByEmail</span><span class="p">(</span><span class="nv">$email</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findByUsername</span><span class="p">(</span><span class="nv">$username</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findByFirstName</span><span class="p">(</span><span class="nv">$firstname</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findByLastName</span><span class="p">(</span><span class="nv">$lastname</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findByName</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">findById</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">insert</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">update</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://beberlei.de/2013/03/04/doctrine_repositories.html">On Taming Repository Classes in Doctrine</a> , <a class="reference external" href="http://blog.kevingomez.fr/2015/02/07/on-taming-repository-classes-in-doctrine-among-other-things/">On Taming Repository Classes in Doctrine… Among other things.</a>, <a class="reference external" href="https://slides.pixelart.at/2017-02-04/fosdem/specifications/#/">specifications</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="7%" />
<col width="7%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>minimumFinds</td>
<td>5</td>
<td>integer</td>
<td>Minimal number of prefixed methods to report.</td>
</tr>
<tr class="row-odd"><td>findPrefix</td>
<td>find</td>
<td>string</td>
<td>list of prefix to use when detecting the ‘find’. Comma-separated list, case insensitive.</td>
</tr>
<tr class="row-even"><td>findSuffix</td>
<td>&#160;</td>
<td>string</td>
<td>list of fix to use when detecting the ‘find’. Comma-separated list, case insensitive.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/TooManyFinds</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="too-many-injections">
<span id="id1647"></span><h2>9.598. Too Many Injections<a class="headerlink" href="#too-many-injections" title="Permalink to this headline">¶</a></h2>
<p>When a class is constructed with more than four dependencies, it should be split into smaller classes.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This class relies on 5 other instances.</span>
<span class="c1">// It is probably doing too much.</span>
<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
            <span class="nx">A</span> <span class="nv">$a</span><span class="p">,</span>
            <span class="nx">B</span> <span class="nv">$b</span><span class="p">,</span>
            <span class="nx">C</span> <span class="nv">$c</span><span class="p">,</span>
            <span class="nx">D</span> <span class="nv">$d</span>
            <span class="nx">E</span> <span class="nv">$e</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">b</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">d</span> <span class="o">=</span> <span class="nv">$d</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">d</span> <span class="o">=</span> <span class="nv">$d</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">e</span> <span class="o">=</span> <span class="nv">$e</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://seregazhuk.github.io/2017/05/04/di-smells/">Dependency Injection Smells</a>.</p>
<div class="section" id="id1648">
<h3>9.598.1. Suggestions<a class="headerlink" href="#id1648" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Split the class into smaller classes. Try to do less in that class.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="10%" />
<col width="10%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>injectionsCount</td>
<td>5</td>
<td>integer</td>
<td>Threshold for too many injected parameters for one class.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/TooManyInjections</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#nextcloud-classes-toomanyinjections"><span class="std std-ref">NextCloud</span></a>, <a class="reference internal" href="Cases.html#thelia-classes-toomanyinjections"><span class="std std-ref">Thelia</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="too-many-local-variables">
<span id="id1649"></span><h2>9.599. Too Many Local Variables<a class="headerlink" href="#too-many-local-variables" title="Permalink to this headline">¶</a></h2>
<p>Too many local variables were found in the methods. When over 15 variables are found in such a method, a violation is reported.</p>
<p>Local variables exclude globals (imported with global) and arguments. Local variable include <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> variables.</p>
<p>When too many variables are used in a function, it is a code smells. The function is trying to do too much and needs extra space for juggling.
Beyond 15 variables, it becomes difficult to keep track of their name and usage, leading to confusion, overwriting or hijacking.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This function is OK : 3 vars are arguments, 3 others are globals.</span>
<span class="k">function</span> <span class="nf">a20a3g3</span><span class="p">(</span><span class="nv">$a1</span><span class="p">,</span> <span class="nv">$a2</span><span class="p">,</span> <span class="nv">$a3</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$a4</span><span class="p">,</span> <span class="nv">$a5</span><span class="p">,</span> <span class="nv">$a6</span><span class="p">;</span>

    <span class="nv">$a1</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$a2</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nv">$a3</span>  <span class="o">=</span> <span class="mi">3</span> <span class="p">;</span>
    <span class="nv">$a4</span>  <span class="o">=</span> <span class="mi">4</span> <span class="p">;</span>
    <span class="nv">$a5</span>  <span class="o">=</span> <span class="mi">5</span> <span class="p">;</span>
    <span class="nv">$a6</span>  <span class="o">=</span> <span class="mi">6</span> <span class="p">;</span>
    <span class="nv">$a7</span>  <span class="o">=</span> <span class="mi">7</span> <span class="p">;</span>
    <span class="nv">$a8</span>  <span class="o">=</span> <span class="mi">8</span> <span class="p">;</span>
    <span class="nv">$a9</span>  <span class="o">=</span> <span class="mi">9</span> <span class="p">;</span>
    <span class="nv">$a10</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="nv">$a11</span>  <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
    <span class="nv">$a12</span>  <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="nv">$a13</span>  <span class="o">=</span> <span class="mi">13</span> <span class="p">;</span>
    <span class="nv">$a14</span>  <span class="o">=</span> <span class="mi">14</span> <span class="p">;</span>
    <span class="nv">$a15</span>  <span class="o">=</span> <span class="mi">15</span> <span class="p">;</span>
    <span class="nv">$a16</span>  <span class="o">=</span> <span class="mi">16</span> <span class="p">;</span>
    <span class="nv">$a17</span>  <span class="o">=</span> <span class="mi">17</span> <span class="p">;</span>
    <span class="nv">$a18</span>  <span class="o">=</span> <span class="mi">18</span> <span class="p">;</span>
    <span class="nv">$a19</span>  <span class="o">=</span> <span class="mi">19</span> <span class="p">;</span>
    <span class="nv">$a20</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

<span class="p">}</span>

<span class="c1">// This function has too many variables</span>
<span class="k">function</span> <span class="nf">a20</span><span class="p">()</span> <span class="p">{</span>

    <span class="nv">$a1</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nv">$a2</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nv">$a3</span>  <span class="o">=</span> <span class="mi">3</span> <span class="p">;</span>
    <span class="nv">$a4</span>  <span class="o">=</span> <span class="mi">4</span> <span class="p">;</span>
    <span class="nv">$a5</span>  <span class="o">=</span> <span class="mi">5</span> <span class="p">;</span>
    <span class="nv">$a6</span>  <span class="o">=</span> <span class="mi">6</span> <span class="p">;</span>
    <span class="nv">$a7</span>  <span class="o">=</span> <span class="mi">7</span> <span class="p">;</span>
    <span class="nv">$a8</span>  <span class="o">=</span> <span class="mi">8</span> <span class="p">;</span>
    <span class="nv">$a9</span>  <span class="o">=</span> <span class="mi">9</span> <span class="p">;</span>
    <span class="nv">$a10</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="nv">$a11</span>  <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
    <span class="nv">$a12</span>  <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="nv">$a13</span>  <span class="o">=</span> <span class="mi">13</span> <span class="p">;</span>
    <span class="nv">$a14</span>  <span class="o">=</span> <span class="mi">14</span> <span class="p">;</span>
    <span class="nv">$a15</span>  <span class="o">=</span> <span class="mi">15</span> <span class="p">;</span>
    <span class="nv">$a16</span>  <span class="o">=</span> <span class="mi">16</span> <span class="p">;</span>
    <span class="nv">$a17</span>  <span class="o">=</span> <span class="mi">17</span> <span class="p">;</span>
    <span class="nv">$a18</span>  <span class="o">=</span> <span class="mi">18</span> <span class="p">;</span>
    <span class="nv">$a19</span>  <span class="o">=</span> <span class="mi">19</span> <span class="p">;</span>
    <span class="nv">$a20</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1651">
<h3>9.599.1. Suggestions<a class="headerlink" href="#id1651" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove some of the variables, and inline them</li>
<li>Break the big function into smaller ones</li>
<li>Find repeated code and make it a separate function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="8%" />
<col width="8%" />
<col width="57%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>tooManyLocalVariableThreshold</td>
<td>15</td>
<td>integer</td>
<td>Minimal number of variables in one function or method to report.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/TooManyLocalVariables</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#humo-gen-functions-toomanylocalvariables"><span class="std std-ref">HuMo-Gen</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="too-many-native-calls">
<span id="id1652"></span><h2>9.600. Too Many Native Calls<a class="headerlink" href="#too-many-native-calls" title="Permalink to this headline">¶</a></h2>
<p>Avoid stuffing too many PHP native call inside another functioncall.</p>
<p>For readability reasons, or, more often, for edge case handling, it is recommended to avoid nesting too many PHP native calls.</p>
<p>This analysis reports any situation where more than 3 PHP native calls are nested.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Too many nested functions</span>
<span class="nv">$cleanArray</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nb">array_count_values</span><span class="p">(</span><span class="nb">array_column</span><span class="p">(</span><span class="nv">$source</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">))));</span>

<span class="c1">// Avoid warning when source is empty</span>
<span class="nv">$extract</span> <span class="o">=</span> <span class="nb">array_column</span><span class="p">(</span><span class="nv">$source</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$extract</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$cleanArray</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$cleanArray</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nb">array_count_values</span><span class="p">(</span><span class="nv">$extract</span><span class="p">)));</span>
<span class="p">}</span>

<span class="c1">// This is not readable, although it is short.</span>
<span class="c1">// It may easily get out of hand.</span>
<span class="k">echo</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">72</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">80</span><span class="p">),</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span> <span class="s1">&#39; is great!&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="10%" />
<col width="10%" />
<col width="59%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>nativeCallCounts</td>
<td>3</td>
<td>integer</td>
<td>Number of native calls found inside another call.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/TooManyNativeCalls</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#spip-php-toomanynativecalls"><span class="std std-ref">SPIP</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="too-many-parameters">
<span id="id1653"></span><h2>9.601. Too Many Parameters<a class="headerlink" href="#too-many-parameters" title="Permalink to this headline">¶</a></h2>
<p>Method has too many parameters. Exakat has a default parameter count which may be configured.</p>
<p>A method that needs more than 8 parameters is trying to do too much : it should be reviewed and split into smaller methods.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This methods has too many parameters.</span>
<span class="k">function</span> <span class="nf">alertSomeone</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$email</span><span class="p">,</span> <span class="nv">$title</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$attachements</span><span class="p">,</span> <span class="nv">$signature</span><span class="p">,</span> <span class="nv">$bcc</span><span class="p">,</span> <span class="nv">$cc</span><span class="p">,</span> <span class="nv">$extra_headers</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* too much code here */</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.exakat.io/how-many-parameters-is-too-many/">How many parameters is too many ?</a> and <a class="reference external" href="http://wiki.c2.com/?TooManyParameters">Too Many Parameters</a>.</p>
<div class="section" id="id1655">
<h3>9.601.1. Suggestions<a class="headerlink" href="#id1655" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Reduce the number of parameters to a lower level</li>
<li>Break the function into smaller functions</li>
<li>Turn the function into a class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="12%" />
<col width="12%" />
<col width="54%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>parametersCount</td>
<td>8</td>
<td>integer</td>
<td>Minimal number of parameters to report.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/TooManyParameters</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-functions-toomanyparameters"><span class="std std-ref">WordPress</span></a>, <a class="reference internal" href="Cases.html#churchcrm-functions-toomanyparameters"><span class="std std-ref">ChurchCRM</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="too-much-indented">
<span id="id1656"></span><h2>9.602. Too Much Indented<a class="headerlink" href="#too-much-indented" title="Permalink to this headline">¶</a></h2>
<p>Reports methods that are using more than one level of indentation on average.</p>
<p>Indentations levels are counted for each for, foreach, if…then, while, do..while, try..catch..finally structure met. Compulsory expressions, such as conditions, are not counted in the total. Levels of indentation start at 0 (no indentation needed)</p>
<p>This analysis targets methods which are build around large conditions : the actual useful code is nested inside the branches of the if/then/else (for example).</p>
<p>The default threshold <code class="docutils literal notranslate"><span class="pre">indentationAverage</span></code> of 1 is a good start for spotting large methods with big conditional code, and will leave smaller methods, even when they only contain one if/then. Larger methods shall be refactored in smaller size.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">minimumSize</span></code> set aside methods which are too small for refactoring.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// average 0</span>
<span class="k">function</span> <span class="nf">foo0</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
    <span class="nv">$a</span> <span class="o">*=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// average 0.66 = (0 + 1 + 1) / 3</span>
<span class="k">function</span> <span class="nf">foo0_66</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// if () is at level 0</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// condition is not counted</span>
        <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>    <span class="c1">// level 1</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>    <span class="c1">// level 1</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// average 1 = (0 + 2 + 1 + 1) / 4</span>
<span class="k">function</span> <span class="nf">foo1</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// if () is at level 0</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// if () is at level 1</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// level 2</span>
        <span class="p">}</span>
        <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// level 1</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// level 1</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis is distinct from Structures/MaxLevelOfIdentation, which only reports the highest level of indentation. This one reports how one method is build around one big</p>
<p>See also <a class="reference internal" href="#max-level-of-nesting"><span class="std std-ref">Max Level Of Nesting</span></a>.</p>
<div class="section" id="id1657">
<h3>9.602.1. Suggestions<a class="headerlink" href="#id1657" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Refactor the method to reduce the highest level of indentation</li>
<li>Refactor the method move some of the code to external methods.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="5%" />
<col width="3%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Default</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>indentationAverage</td>
<td>1</td>
<td>real</td>
<td>Minimal average of indentation in a method to report. Default is 1.0, which means that the method is on average at one level of indentation or more.</td>
</tr>
<tr class="row-odd"><td>minimumSize</td>
<td>3</td>
<td>real</td>
<td>Minimal number of expressions in a method to apply this analysis.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/TooMuchIndented</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="trailing-comma-in-calls">
<span id="id1658"></span><h2>9.603. Trailing Comma In Calls<a class="headerlink" href="#trailing-comma-in-calls" title="Permalink to this headline">¶</a></h2>
<p>The last argument may be left empty.</p>
<p>This feature was introduced in PHP 7.3.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// VCS friendly call</span>
<span class="c1">// PHP 7.3 and more recent</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">,</span>
   <span class="p">);</span>

<span class="c1">// backward compatible call</span>
<span class="c1">// All PHP versions</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">,</span>
    <span class="mi">3</span>
   <span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/trailing-comma-function-calls">PHP RFC: Allow a trailing comma in function calls</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/TrailingComma</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="trait-not-found">
<span id="id1659"></span><h2>9.604. Trait Not Found<a class="headerlink" href="#trait-not-found" title="Permalink to this headline">¶</a></h2>
<p>A unknown trait is mentioned in the use expression.</p>
<p>The used traits all exist, but in the configuration block, some unmentioned trait is called.</p>
<p>Be aware that the traits used in any configuration block may originate in any use expression. PHP will check the configuration block at instantiation only, and after compiling : at that moment, it will know all the used traits across the class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">class</span> <span class="nc">x</span>  <span class="p">{</span>
    <span class="c1">// c is not a used trait</span>
    <span class="k">use</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="p">{</span> <span class="nx">c</span><span class="o">::</span><span class="na">d</span> <span class="nx">insteadof</span> <span class="nx">e</span><span class="p">;}</span>

    <span class="c1">// e is a used trait, even if is not in the use above.</span>
    <span class="k">use</span> <span class="nx">e</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.traits.php">Traits</a>.</p>
<div class="section" id="id1661">
<h3>9.604.1. Suggestions<a class="headerlink" href="#id1661" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Switch the name of the trait to an existing and used trait</li>
<li>Drop the expression that rely on the non-existent trait</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/TraitNotFound</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="typed-property-usage">
<span id="id1662"></span><h2>9.605. Typed Property Usage<a class="headerlink" href="#typed-property-usage" title="Permalink to this headline">¶</a></h2>
<p>Traditionally, PHP properties aren’t typed. Since PHP 7.4, it is possible to type properties, just like arguments.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">User</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nx">int</span> <span class="nv">$id</span><span class="p">;</span>
    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$id</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">=</span> <span class="nv">$id</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/typed_properties_v2">Typed Properties 2.0</a>.</p>
<div class="section" id="id1663">
<h3>9.605.1. Suggestions<a class="headerlink" href="#id1663" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/TypedPropertyUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="typehint-must-be-returned">
<span id="id1664"></span><h2>9.606. Typehint Must Be Returned<a class="headerlink" href="#typehint-must-be-returned" title="Permalink to this headline">¶</a></h2>
<p>When using a typehint for a method, it is compulsory to use a at least one return in the method’s body. This is true for nullable typehint too : <code class="docutils literal notranslate"><span class="pre">return</span></code> alone won’t be sufficient.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The function returns a value (here, correct object)</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">Bar</span> <span class="p">{</span> <span class="k">return</span> <span class="k">new</span> <span class="nx">Bar</span><span class="p">();</span> <span class="p">}</span>

<span class="c1">// The function should at least, return a value</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">Bar</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// The function should at least, return a value : Null or an object. Void, here, is not acceptable.</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">:</span> <span class="o">?</span><span class="nx">Bar</span> <span class="p">{</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>PHP lint this, but won’t execute it.</p>
<p>This analysis doesn’t check if the returned value is compatible with the returned typehint. Only its presence is checked.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.returning-values.php#functions.returning-values.type-declaration">Return Type Declaration</a> and <a class="reference external" href="https://mlocati.github.io/articles/php-type-hinting.html">Type hint in PHP function parameters and return values</a>.</p>
<div class="section" id="id1665">
<h3>9.606.1. Suggestions<a class="headerlink" href="#id1665" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a return with a valid value</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/TypehintMustBeReturned</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="typehinted-references">
<span id="id1666"></span><h2>9.607. Typehinted References<a class="headerlink" href="#typehinted-references" title="Permalink to this headline">¶</a></h2>
<p>Typehinted arguments have no need for references. Since they are only an object, they are already a reference.</p>
<p>In fact, adding the &amp; on the argument definition may lead to error like <code class="docutils literal notranslate"><span class="pre">Only</span> <span class="pre">variables</span> <span class="pre">should</span> <span class="pre">be</span> <span class="pre">passed</span> <span class="pre">by</span> <span class="pre">reference</span></code>.</p>
<p>This applies to the <code class="docutils literal notranslate"><span class="pre">object</span></code> type hint, but not the the others, such as <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">bool</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// a class</span>
    <span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
        <span class="k">public</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// typehinted reference</span>
    <span class="c1">//function foo(object &amp;$x) works too</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">X</span> <span class="o">&amp;</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$x</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Send an object</span>
    <span class="nv">$y</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">(</span><span class="k">new</span> <span class="nx">X</span><span class="p">);</span>

    <span class="c1">// This prints 1;</span>
    <span class="k">print</span> <span class="nv">$y</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.references.pass.php">Passing by reference</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.references.php">Objects and references</a>.</p>
<div class="section" id="id1668">
<h3>9.607.1. Suggestions<a class="headerlink" href="#id1668" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove reference for typehinted arguments, unless the typehint is a scalar typehint.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/TypehintedReferences</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unbinding-closures">
<span id="id1669"></span><h2>9.608. Unbinding Closures<a class="headerlink" href="#unbinding-closures" title="Permalink to this headline">¶</a></h2>
<p>Never drop <code class="docutils literal notranslate"><span class="pre">$this</span></code>, once a closure was created in a non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> method.</p>
<p>From the PHP wiki : Currently it is possible to unbind the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> variable from a closure that originally had one by using $closure-&gt;bindTo(null). Due to the removal of <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> calls to non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods in PHP 8, we now have a guarantee that <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> always exists inside non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods. We would like to have a similar guarantee that <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> always exists for non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> closures declared inside non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods. Otherwise, we will end up imposing an unnecessary performance penalty either on <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> accesses in general, or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a> accesses inside such closures.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span> <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$closure</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">x</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">();</span>

<span class="c1">// $this was expected, and it is not anymore</span>
<span class="nv">$closure</span><span class="o">-&gt;</span><span class="na">bindTo</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>

<span class="nv">$closure</span><span class="o">-&gt;</span><span class="na">bindTo</span><span class="p">(</span><span class="k">new</span> <span class="nx">x</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Calling bindTo() with a valid object is still valid.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">Unbinding `$this</a> from non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> closures &lt;<a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_4#unbinding_this_from_non-static_closures">https://wiki.php.net/rfc/deprecations_php_7_4#unbinding_this_from_non-static_closures</a>&gt;`_.</p>
<div class="section" id="id1682">
<h3>9.608.1. Suggestions<a class="headerlink" href="#id1682" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Create a static closure, which doesn’t rely on $this at all</li>
<li>Remove the call to bindTo(null).</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UnbindingClosures</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="uncaught-exceptions">
<span id="id1683"></span><h2>9.609. Uncaught Exceptions<a class="headerlink" href="#uncaught-exceptions" title="Permalink to this headline">¶</a></h2>
<p>The following exceptions are thrown in the code, but are never caught.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This exception is throw, but not caught. It will lead to a fatal error.</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$message</span> <span class="o">=</span> <span class="nx">check_for_error</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">My\Exception</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// This exception is throw, and caught.</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$message</span> <span class="o">=</span> <span class="nx">check_for_error</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">My\Exception</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Either they will lead to a Fatal Error, or they have to be caught by an including application. This is a valid behavior for libraries, but is not for a final application.</p>
<p>See also <a class="reference external" href="https://www.alainschlesser.com/structuring-php-exceptions/">Structuring PHP Exceptions</a>.</p>
<div class="section" id="id1684">
<h3>9.609.1. Suggestions<a class="headerlink" href="#id1684" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Catch all the exceptions you throw</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/UncaughtExceptions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unchecked-resources">
<span id="id1685"></span><h2>9.610. Unchecked Resources<a class="headerlink" href="#unchecked-resources" title="Permalink to this headline">¶</a></h2>
<p>Resources are created, but never checked before being used. This is not safe.</p>
<p>Always check that resources are correctly created before using them.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// always check that the resource is created correctly</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$d</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$fp</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s1">&#39;File not found&#39;</span><span class="p">);</span>
<span class="p">}</span>
<span class="nv">$firstLine</span> <span class="o">=</span> <span class="nb">fread</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>

<span class="c1">// This directory is not checked : the path may not exist and return false</span>
<span class="nv">$uncheckedDir</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$pathToDir</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="nb">readdir</span><span class="p">(</span><span class="nv">$uncheckedDir</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// do something()</span>
<span class="p">}</span>

<span class="c1">// This file is not checked : the path may not exist or be unreadable and return false</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$pathToFile</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="nv">$line</span> <span class="o">=</span> <span class="nx">freads</span><span class="p">(</span><span class="nv">$fp</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$text</span> <span class="o">.=</span> <span class="nv">$line</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// unsafe one-liner : using bzclose on an unchecked resource</span>
<span class="nb">bzclose</span><span class="p">(</span><span class="nb">bzopen</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.resource.php">resources</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UncheckedResources</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-unchecked-resources.md">no-unchecked-resources</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="unconditional-break-in-loop">
<span id="id1686"></span><h2>9.611. Unconditional Break In Loop<a class="headerlink" href="#unconditional-break-in-loop" title="Permalink to this headline">¶</a></h2>
<p>An unconditional <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> in a loop creates dead code. Since the <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> is directly in the body of the loop, it is always executed, creating a strange loop that can only run once.</p>
<p>Here, <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> may also be a return, a goto or a <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a>. They all branch out of the loop. Such statement are valid, but should be moderated with a condition.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// return in loop should be in</span>
<span class="k">function</span> <span class="nf">summAll</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Stop at the first error</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$sum</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$sum</span> <span class="o">+=</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$sum</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// foreach loop used to collect first element in array</span>
<span class="k">function</span> <span class="nf">getFirst</span><span class="p">(</span><span class="nv">$array</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1691">
<h3>9.611.1. Suggestions<a class="headerlink" href="#id1691" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the loop and call the content of the loop once.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UnconditionLoopBreak</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#livezilla-structures-unconditionloopbreak"><span class="std std-ref">LiveZilla</span></a>, <a class="reference internal" href="Cases.html#mediawiki-structures-unconditionloopbreak"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-class">
<span id="id1692"></span><h2>9.612. Undefined ::class<a class="headerlink" href="#undefined-class" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">\:\:class</span></code> doesn’t check if a corresponding class exists.</p>
<p><code class="docutils literal notranslate"><span class="pre">\:\:class</span></code> must be checked with a call to <a class="reference external" href="https://www.php.net/class_exists">class_exists()</a>. Otherwise, it may lead to a <code class="docutils literal notranslate"><span class="pre">Class</span> <span class="pre">'foo'</span> <span class="pre">not</span> <span class="pre">found</span></code> or even silent dead code : this happens also with Catch and <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">instanceof</a> commands with undefined classes. PHP doesn’t raise an error in that case.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span><span class="p">()</span> <span class="p">{}</span>

<span class="c1">// prints foo</span>
<span class="k">echo</span> <span class="nx">foo</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>

<span class="c1">// prints bar though bar doesn&#39;t exist.</span>
<span class="k">echo</span> <span class="nx">bar</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.constants.php">Class Constants</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UndefinedStaticclass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="undefined-caught-exceptions">
<span id="id1695"></span><h2>9.613. Undefined Caught Exceptions<a class="headerlink" href="#undefined-caught-exceptions" title="Permalink to this headline">¶</a></h2>
<p>Those are exceptions that are caught in the code, but are not defined in the application.</p>
<p>They may be externally defined, such as in core PHP, extensions or libraries. Make sure those exceptions are useful to your application : otherwise, they are dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nx">library_function</span><span class="p">(</span><span class="nv">$some</span><span class="p">,</span> <span class="nv">$args</span><span class="p">);</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">LibraryException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This exception is not defined, and probably belongs to Library</span>
    <span class="k">print</span> <span class="nx">Library</span> <span class="nx">failed\n</span><span class="p">;</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">OtherLibraryException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This exception is not defined, and probably do not belongs to this code</span>
    <span class="k">print</span> <span class="nx">Library</span> <span class="nx">failed\n</span><span class="p">;</span>

<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This exception is a PHP standard exception</span>
    <span class="k">print</span> <span class="nx">Something</span> <span class="nx">went</span> <span class="nx">wrong</span><span class="p">,</span> <span class="nx">but</span> <span class="k">not</span> <span class="nx">at</span> <span class="nx">Libary</span> <span class="nx">level\n</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1696">
<h3>9.613.1. Suggestions<a class="headerlink" href="#id1696" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the catch clause, as it is dead code</li>
<li>Make sure the exception is thrown by the underlying code</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/CaughtButNotThrown</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-class-constants">
<span id="id1697"></span><h2>9.614. Undefined Class Constants<a class="headerlink" href="#undefined-class-constants" title="Permalink to this headline">¶</a></h2>
<p>Class constants that are used, but never defined. This should yield a fatal error upon execution, but no feedback at compile level.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// here, C is not defined in the code and is reported</span>
<span class="k">echo</span> <span class="nx">foo</span><span class="o">::</span><span class="na">A</span><span class="o">.</span><span class="nx">foo</span><span class="o">::</span><span class="na">B</span><span class="o">.</span><span class="nx">foo</span><span class="o">::</span><span class="na">C</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1698">
<h3>9.614.1. Suggestions<a class="headerlink" href="#id1698" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the name of the constant</li>
<li>Add the constant to the current class or one of its parent</li>
<li>Update the constant’s visibility</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UndefinedConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-classes">
<span id="id1699"></span><h2>9.615. Undefined Classes<a class="headerlink" href="#undefined-classes" title="Permalink to this headline">¶</a></h2>
<p>Those classes are used in the code, but there are no definition for them.</p>
<p>This may happens under normal conditions, if the application makes use of an unsupported extension, that defines extra classes;
or if some external libraries, such as PEAR, are not provided during the analysis.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// FPDF is a classic PDF class, that is usually omitted by Exakat.</span>
<span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FPDF</span><span class="p">();</span>

<span class="c1">// Exakat reports undefined classes in instanceof</span>
<span class="c1">// PHP ignores them</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nx">SomeClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething();</span>
<span class="p">}</span>

<span class="c1">// Classes may be used in typehint too</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">TypeHintClass</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis also checks in attributes.</p>
<div class="section" id="id1700">
<h3>9.615.1. Suggestions<a class="headerlink" href="#id1700" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the typo in the class name</li>
<li>Add a missing ‘use’ expression</li>
<li>Create the missing class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UndefinedClasses</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-constant-name">
<span id="id1701"></span><h2>9.616. Undefined Constant Name<a class="headerlink" href="#undefined-constant-name" title="Permalink to this headline">¶</a></h2>
<p>When using the `` syntax for variable, the name used must be a defined constant. It is not a simple string, like ‘x’, it is an actual constant name.</p>
<p>Interestingly, it is possible to use a qualified name within <a href="#id1702"><span class="problematic" id="id1703">``</span></a>, full or partial. PHP will lint such code, and will collect the value of the constant immediately. Since there is no fallback mechanism for fully qualified names, this ends with a Fatal error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">const</span> <span class="no">x</span> <span class="o">=</span> <span class="nx">a</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">Hello</span><span class="p">;</span>

<span class="c1">// Display &#39;Hello&#39;  -&gt; $a -&gt; Hello</span>
<span class="k">echo</span> <span class="p">;</span>

<span class="c1">// Yield a PHP Warning</span>
<span class="c1">// Use of undefined constant y - assumed &#39;y&#39; (this will throw an Error in a future version of PHP)</span>
<span class="k">echo</span> <span class="p">;</span>

<span class="c1">// Yield a PHP Fatal error as PHP first checks that the constant exists</span>
<span class="c1">//Undefined constant &#39;y&#39;</span>
<span class="k">echo</span> <span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1704">
<h3>9.616.1. Suggestions<a class="headerlink" href="#id1704" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Define the constant</li>
<li>Turn the dynamic syntax into a normal variable syntax</li>
<li>Use a fully qualified name (at least one ) to turn this syntax into a Fatal error when the constant is not found. This doesn’t fix the problem, but may make it more obvious during the diagnostic.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/UndefinedConstantName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-constants">
<span id="id1705"></span><h2>9.617. Undefined Constants<a class="headerlink" href="#undefined-constants" title="Permalink to this headline">¶</a></h2>
<p>Constants definition can’t be located.</p>
<p>Those constants are not defined in the code, and will raise errors, or use the fallback mechanism of being treated like a string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">const</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1">// here, C is not defined in the code and is reported</span>
<span class="k">echo</span> <span class="nx">A</span><span class="o">.</span><span class="nx">B</span><span class="o">.</span><span class="nx">C</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to define them all, or to avoid using them.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.constants.php">Constants</a>.</p>
<div class="section" id="id1707">
<h3>9.617.1. Suggestions<a class="headerlink" href="#id1707" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Define the constant</li>
<li>Fix the name of the constant</li>
<li>Fix the namespace of the constant (FQN or use)</li>
<li>Remove the usage of the constant</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/UndefinedConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-functions">
<span id="id1708"></span><h2>9.618. Undefined Functions<a class="headerlink" href="#undefined-functions" title="Permalink to this headline">¶</a></h2>
<p>Some functions are called, but not defined in the code. This means that the functions are probably defined in a missing library, or in an extension. If not, this will yield a Fatal error at execution.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Undefined function</span>
<span class="nx">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="c1">// valid function, as it belongs to the ext/yaml extension</span>
<span class="nv">$parsed</span> <span class="o">=</span> <span class="nb">yaml_parse</span><span class="p">(</span><span class="nv">$yaml</span><span class="p">);</span>

<span class="c1">// This function is not defined in the a\b\c namespace, nor in the global namespace</span>
<span class="nx">a\b\c\foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.functions.php">Functions</a>.</p>
<div class="section" id="id1709">
<h3>9.618.1. Suggestions<a class="headerlink" href="#id1709" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the name of the function in the code</li>
<li>Remove the functioncall in the code</li>
<li>Define the function for the code to call it</li>
<li>Include the correct library in the code source</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UndefinedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-insteadof">
<span id="id1710"></span><h2>9.619. Undefined Insteadof<a class="headerlink" href="#undefined-insteadof" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">Insteadof</span></code> tries to replace a method with another, but it doesn’t exists. This happens when the replacing class is refactored, and some of its definition are dropped.</p>
<p><code class="docutils literal notranslate"><span class="pre">Insteadof</span></code> may replace a non-existing method with an existing one, but not the contrary.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">trait</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">C</span> <span class="p">(){}</span>
<span class="p">}</span>

<span class="k">trait</span> <span class="nx">B</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">C</span> <span class="p">(){}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Talker</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">A</span><span class="p">,</span> <span class="nx">B</span> <span class="p">{</span>
        <span class="nx">B</span><span class="o">::</span><span class="na">C</span> <span class="nx">insteadof</span> <span class="nx">A</span><span class="p">;</span>
        <span class="nx">B</span><span class="o">::</span><span class="na">D</span> <span class="nx">insteadof</span> <span class="nx">A</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Talker</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This error is not linted : it only appears at execution time.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.traits.php">Traits</a>.</p>
<div class="section" id="id1712">
<h3>9.619.1. Suggestions<a class="headerlink" href="#id1712" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the insteadof expression</li>
<li>Fix the original method and replace it with an existing method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/UndefinedInsteadof</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-interfaces">
<span id="id1713"></span><h2>9.620. Undefined Interfaces<a class="headerlink" href="#undefined-interfaces" title="Permalink to this headline">¶</a></h2>
<p>Some typehints or <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> that are relying on undefined interfaces or classes. They will always return false. Any condition based upon them are dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">var</span> <span class="k">implements</span> <span class="nx">undefinedInterface</span> <span class="p">{</span>
    <span class="c1">// If undefinedInterface is undefined, this code lints but doesn&#39;t run</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nx">undefinedInterface</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This is silent dead code</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">undefinedInterface</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// This is dead code</span>
    <span class="c1">// it will probably be discovered at execution</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.interfaces.php">Object interfaces</a>, <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">Type declarations</a>, and <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">Instanceof</a>.</p>
<div class="section" id="id1717">
<h3>9.620.1. Suggestions<a class="headerlink" href="#id1717" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Implement the missing interfaces</li>
<li>Remove the code governed by the missing interface : the whole method if it is an typehint, the whole if/then if it is a condition.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/UndefinedInterfaces</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-interfaces-undefinedinterfaces"><span class="std std-ref">xataface</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-parent">
<span id="id1718"></span><h2>9.621. Undefined Parent<a class="headerlink" href="#undefined-parent" title="Permalink to this headline">¶</a></h2>
<p>List of properties and methods that are accessed using <code class="docutils literal notranslate"><span class="pre">parent</span></code> keyword but are not defined in the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> classes.</p>
<p>This may compile but, eventually yields a fatal error during execution.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">theParent</span> <span class="p">{</span>
    <span class="c1">// No bar() method</span>
    <span class="c1">// private bar() method is not accessible to theChild</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">theChild</span> <span class="k">extends</span> <span class="nx">theParent</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// bar is defined in theChild, but not theParent</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">bar</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that if the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> is defined using <code class="docutils literal notranslate"><span class="pre">extends</span> <span class="pre">someClass</span></code> but <code class="docutils literal notranslate"><span class="pre">someClass</span></code> is not available in the tested code, it will not be reported : it may be in composer, another dependency, or just missing.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent &lt;https://www.php.net/manual/en/keyword.`parent</a>.php&gt;`_.</p>
<div class="section" id="id1721">
<h3>9.621.1. Suggestions<a class="headerlink" href="#id1721" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the usage of the found method</li>
<li>Add a definition for the method in the appropriate parent</li>
<li>Fix the name of the method, and replace it with a valid definition</li>
<li>Change ‘parent’ with ‘self’ if the method is eventually defined in the current class</li>
<li>Change ‘parent’ with another object, if the method has been defined in another class</li>
<li>Add the ‘extends’ keyword to the class, to actually have a parent class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UndefinedParentMP</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-properties">
<span id="id1722"></span><h2>9.622. Undefined Properties<a class="headerlink" href="#undefined-properties" title="Permalink to this headline">¶</a></h2>
<p>List of properties that are not explicitly defined in the class, its parents or traits.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// property definition</span>
    <span class="k">private</span> <span class="nx">bar</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foofoo</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// $this-&gt;bar is defined in the class</span>
        <span class="c1">// $this-&gt;barbar is NOT defined in the class</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span> <span class="o">+</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">barbar</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is possible to spot unidentified properties by using the PHP’s magic methods <code class="docutils literal notranslate"><span class="pre">__get</span></code> and <code class="docutils literal notranslate"><span class="pre">__set</span></code>. Even if the class doesn’t use magic methods, any call to an undefined property will be directed to those methods, and they can be used as a canary, warning that the code is missing a definition.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">trait</span> <span class="nx">NoUnefinedProperties</span> <span class="p">{</span>
     <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
             <span class="nb">assert</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="s2">&quot;Attempt to read the </span><span class="si">$name</span><span class="s2"> property, on the class &quot;</span><span class="o">.</span><span class="no">__CLASS__</span><span class="p">;</span>
     <span class="p">}</span>

     <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nv">$name</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
             <span class="nb">assert</span><span class="p">(</span><span class="k">false</span><span class="p">,</span> <span class="s2">&quot;Attempt to read the </span><span class="si">$name</span><span class="s2"> property, on the class &quot;</span><span class="o">.</span><span class="no">__CLASS__</span><span class="p">;</span>
     <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.properties.php">Properties</a>.</p>
<div class="section" id="id1723">
<h3>9.622.1. Suggestions<a class="headerlink" href="#id1723" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add an explicit property definition, and give it <code class="docutils literal notranslate"><span class="pre">null</span></code> as a default value : this way, it behaves the same as undefined.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UndefinedProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-undefined-properties.md">no-undefined-properties</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-classes-undefinedproperty"><span class="std std-ref">WordPress</span></a>, <a class="reference internal" href="Cases.html#mediawiki-classes-undefinedproperty"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-trait">
<span id="id1724"></span><h2>9.623. Undefined Trait<a class="headerlink" href="#undefined-trait" title="Permalink to this headline">¶</a></h2>
<p>Those are undefined, traits .</p>
<p>When the using class or trait is instantiated, PHP emits a a fatal error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">Composer</span><span class="o">/</span><span class="nx">Component</span><span class="o">/</span><span class="nx">someTrait</span> <span class="k">as</span> <span class="nx">externalTrait</span><span class="p">;</span>

<span class="k">trait</span> <span class="nx">t</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="c1">// This class uses trait that are all known</span>
<span class="k">class</span> <span class="nc">hasOnlyDefinedTrait</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">externalTrait</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// This class uses trait that are unknown</span>
<span class="k">class</span> <span class="nc">hasUndefinedTrait</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">unknownTrait</span><span class="p">,</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">externalTrait</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Trait which are referenced in a <cite>use</cite> expression are omitted: they are considered part of code that is probably outside the current code, either omitted or in external component.</p>
<div class="section" id="id1725">
<h3>9.623.1. Suggestions<a class="headerlink" href="#id1725" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Define the missing trait</li>
<li>Remove usage of the missing trait</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/UndefinedTrait</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-variable">
<span id="id1726"></span><h2>9.624. Undefined Variable<a class="headerlink" href="#undefined-variable" title="Permalink to this headline">¶</a></h2>
<p>Variable that is used before any creation.</p>
<p>It is recommended to use a default value for every variable used. When not specified, the default value is set to <code class="docutils literal notranslate"><span class="pre">NULL</span></code> by PHP.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Adapted from the PHP manual</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="s1">&#39;Bob&#39;</span><span class="p">;</span>
<span class="nv">$Var</span> <span class="o">=</span> <span class="s1">&#39;Joe&#39;</span><span class="p">;</span>
<span class="c1">// The following line may emit a warning : Undefined variable: $undefined</span>
<span class="k">echo</span> <span class="nv">$var</span><span class="p">,</span> <span class="nv">$Var</span><span class="p">,</span> <span class="nv">$undefined</span><span class="p">;</span>      <span class="c1">// outputs Bob, Joe,</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Variable may be created in various ways : assignation, arguments, foreach blind variables, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> and global variables.</p>
<p>This analysis doesn’t handle dynamic variables, such as <code class="docutils literal notranslate"><span class="pre">$$x</span></code>. It also doesn’t handle variables outside a method or function.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.variables.basics.php">Variable basics</a>.</p>
<div class="section" id="id1728">
<h3>9.624.1. Suggestions<a class="headerlink" href="#id1728" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the expression that is using the undefined variable</li>
<li>Fix the variable name</li>
<li>Define the variable by assigning a value to it, before using it</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/UndefinedVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="undefined-static-or-self">
<span id="id1729"></span><h2>9.625. Undefined static:: Or self::<a class="headerlink" href="#undefined-static-or-self" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> refer to the current class, or one of its <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a>. The property or the method may be undefined.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">definedStatic</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">private</span> <span class="nx">definedStatic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">definedStatic</span><span class="p">();</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">undefinedStatic</span><span class="p">();</span>

        <span class="k">static</span><span class="o">::</span><span class="na">definedStatic</span><span class="p">;</span>
        <span class="k">static</span><span class="o">::</span><span class="na">undefinedStatic</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Late `Static</a> Bindings &lt;<a class="reference external" href="https://www.php.net/manual/en/language.oop5.late">https://www.php.net/manual/en/language.oop5.late</a>-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a>-bindings.php&gt;`_.</p>
<div class="section" id="id1734">
<h3>9.625.1. Suggestions<a class="headerlink" href="#id1734" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Define the missing method or property</li>
<li>Remove usage of that undefined method or property</li>
<li>Fix name to call an actual local structure</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UndefinedStaticMP</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-classes-undefinedstaticmp"><span class="std std-ref">xataface</span></a>, <a class="reference internal" href="Cases.html#sugarcrm-classes-undefinedstaticmp"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unicode-escape-partial">
<span id="id1735"></span><h2>9.626. Unicode Escape Partial<a class="headerlink" href="#unicode-escape-partial" title="Permalink to this headline">¶</a></h2>
<p>PHP 7 introduces a new escape sequence for strings : u{hex}. It is backward incompatible with previous PHP versions for two reasons :</p>
<p>PHP 7 will recognize en replace those sequences, while PHP 5 keep them intact.
PHP 7 will halt on partial Unicode Sequences, as it tries to understand them, but may fail.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">echo</span><span class="nx"> \u</span><span class="p">{</span><span class="mi">1</span><span class="nx">F418</span><span class="p">}</span><span class="nx">\n</span><span class="p">;</span>
<span class="c1">// PHP 5 displays the same string</span>
<span class="c1">// PHP 7 displays : an elephant</span>

<span class="k">echo</span><span class="nx"> \u</span><span class="p">{</span><span class="k">NOT</span> <span class="nx">A</span> <span class="nx">UNICODE</span> <span class="nx">CODEPOINT</span><span class="p">}</span><span class="nx">\n</span><span class="p">;</span>
<span class="c1">// PHP 5 displays the same string</span>
<span class="c1">// PHP 7 emits a fatal error</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Is is recommended to check all those strings, and make sure they will behave correctly in PHP 7.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UnicodeEscapePartial</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="unicode-escape-syntax">
<span id="id1736"></span><h2>9.627. Unicode Escape Syntax<a class="headerlink" href="#unicode-escape-syntax" title="Permalink to this headline">¶</a></h2>
<p>Usage of the Unicode Escape syntax, with the <code class="docutils literal notranslate"><span class="pre">\u{xxxxx}</span></code> format, available since PHP 7.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Produce an elephant icon in PHP 7.0+</span>
<span class="k">echo</span> <span class="nx">\u</span><span class="p">{</span><span class="mi">1</span><span class="nx">F418</span><span class="p">};</span>

<span class="c1">// Produce the raw sequence in PHP 5.0</span>
<span class="k">echo</span> <span class="nx">\u</span><span class="p">{</span><span class="mi">1</span><span class="nx">F418</span><span class="p">};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/unicode_escape">PHP RFC: Unicode Codepoint Escape Syntax</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Code_point">Code point</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Unicode">Unicode</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UnicodeEscapeSyntax</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="uninitilized-property">
<span id="id1737"></span><h2>9.628. Uninitilized Property<a class="headerlink" href="#uninitilized-property" title="Permalink to this headline">¶</a></h2>
<p>Uninitilized properties are not fully bootstrapped at the end of the constructor.</p>
<p>Properties may be inited at definition time, along with their visibility and type. Some types are not inited at definition time, as any object, so they should be inited during constructor. At the end of the former, all properties shall have a legit value, and be ready for usage.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$uninited</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span> <span class="o">=</span> <span class="nv">$args</span><span class="p">;</span>

        <span class="c1">// $this-&gt;uninited is not inited, nor at definition, nor in constructor</span>
        <span class="c1">// it will hold null at the beginning of the next method call</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1738">
<h3>9.628.1. Suggestions<a class="headerlink" href="#id1738" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the property, and move it to another class</li>
<li>Add an initialisation for this property</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UninitedProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="union-typehint">
<span id="id1739"></span><h2>9.629. Union Typehint<a class="headerlink" href="#union-typehint" title="Permalink to this headline">¶</a></h2>
<p>Union typehints allows the specification of several typehint for the same argument or return value. This is a PHP 8.0 new feature.</p>
<p>Several typehints are specified at the same place as a single one. The different values are separated by a pipe character <code class="docutils literal notranslate"><span class="pre">|</span></code>, like for exceptions</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Example from the RFC https://wiki.php.net/rfc/union_types_v2</span>
<span class="k">class</span> <span class="nc">Number</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">int</span><span class="o">|</span><span class="nx">float</span> <span class="nv">$number</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setNumber</span><span class="p">(</span><span class="nx">int</span><span class="o">|</span><span class="nx">float</span> <span class="nv">$number</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">number</span> <span class="o">=</span> <span class="nv">$number</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getNumber</span><span class="p">()</span><span class="o">:</span> <span class="nx">int</span><span class="o">|</span><span class="nx">float</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">number</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Union types are not compatible with PHP 7 and older.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/union_types_v2">PHP RFC: Union Types 2.0</a>.</p>
<div class="section" id="id1741">
<h3>9.629.1. Suggestions<a class="headerlink" href="#id1741" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php80UnionTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unitialized-properties">
<span id="id1742"></span><h2>9.630. Unitialized Properties<a class="headerlink" href="#unitialized-properties" title="Permalink to this headline">¶</a></h2>
<p>Properties that are not initialized in the constructor, nor at definition.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$i1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$i2</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$u1</span><span class="p">,</span> <span class="nv">$u2</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">i2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">u2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">m</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">i1</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">i2</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">u1</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">u2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>With the above class, when m() is accessed right after instantiation, there will be a missing property.
Using default values at property definition, or setting default values in the constructor ensures that the created object is consistent.</p>
<div class="section" id="id1743">
<h3>9.630.1. Suggestions<a class="headerlink" href="#id1743" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add an explicit initialization for each property.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnitializedProperties</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#spip-classes-unitializedproperties"><span class="std std-ref">SPIP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unknown-parameter-name">
<span id="id1744"></span><h2>9.631. Unknown Parameter Name<a class="headerlink" href="#unknown-parameter-name" title="Permalink to this headline">¶</a></h2>
<p>The name of the parameter doesn’t belong to the method signature. Named arguments was introduced in PHP 8.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// All good</span>
<span class="nx">foo</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="o">...</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="o">:</span><span class="mi">3</span><span class="p">]);</span>

<span class="c1">// A is not a parameter name, it should be a : names are case sensitive</span>
<span class="nx">foo</span><span class="p">(</span><span class="nx">A</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="nx">b</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="nx">c</span><span class="o">:</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="o">...</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="o">:</span><span class="mi">3</span><span class="p">]);</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/named_params">Named Arguments</a>.</p>
<div class="section" id="id1745">
<h3>9.631.1. Suggestions<a class="headerlink" href="#id1745" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the name of the parameter and use a valid one</li>
<li>Remove the parameter name, and revert to positional notation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UnknownParameterName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unknown-pcre2-option">
<span id="id1746"></span><h2>9.632. Unknown Pcre2 Option<a class="headerlink" href="#unknown-pcre2-option" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">PCRE2</span></code> supports different options, compared to <code class="docutils literal notranslate"><span class="pre">PCRE1</span></code>. <code class="docutils literal notranslate"><span class="pre">PCRE2</span></code> was adopted with PHP 7.3.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">S</span></code> modifier : it used to tell PCRE to spend more time studying the regex, so as to be faster at execution. This is now the default behavior, and may be dropped from the regex.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">X</span></code> modifier : <code class="docutils literal notranslate"><span class="pre">X</span></code> is still existing with <code class="docutils literal notranslate"><span class="pre">PCRE2</span></code>, though it is now the default for <code class="docutils literal notranslate"><span class="pre">PCRE2</span></code>, and not for PHP as time of writing. In particular, <code class="docutils literal notranslate"><span class="pre">Any</span> <span class="pre">backslash</span> <span class="pre">in</span> <span class="pre">a</span> <span class="pre">pattern</span> <span class="pre">that</span> <span class="pre">is</span> <span class="pre">followed</span> <span class="pre">by</span> <span class="pre">a</span> <span class="pre">letter</span> <span class="pre">that</span> <span class="pre">has</span> <span class="pre">no</span> <span class="pre">special</span> <span class="pre">meaning</span> <span class="pre">causes</span> <span class="pre">an</span> <span class="pre">error,</span> <span class="pre">thus</span> <span class="pre">reserving</span> <span class="pre">these</span> <span class="pre">combinations</span> <span class="pre">for</span> <span class="pre">future</span> <span class="pre">expansion.</span> <span class="pre">``.</span> <span class="pre">It</span> <span class="pre">is</span> <span class="pre">recommended</span> <span class="pre">to</span> <span class="pre">avoid</span> <span class="pre">using</span> <span class="pre">useless</span> <span class="pre">sequence</span> <span class="pre">\s</span> <span class="pre">in</span> <span class="pre">regex</span> <span class="pre">to</span> <span class="pre">get</span> <span class="pre">ready</span> <span class="pre">for</span> <span class="pre">that</span> <span class="pre">change.</span> <span class="pre">All</span> <span class="pre">the</span> <span class="pre">following</span> <span class="pre">letters</span> <span class="pre">``gijkmoqyFIJMOTY</span></code> . Note that <code class="docutils literal notranslate"><span class="pre">clLpPuU</span></code> are valid <code class="docutils literal notranslate"><span class="pre">PRCE</span></code> sequences, and are probably failing for other reasons.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// \y has no meaning. With X option, this leads to a regex compilation error, and a failed test.</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/ye\y/&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>
<span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/ye\y/X&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/reference.pcre.pattern.modifiers.php">Pattern Modifiers</a> and <a class="reference external" href="https://wiki.php.net/rfc/pcre2-migration">PHP RFC: PCRE2 migration</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UnknownPcre2Option</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="unkown-regex-options">
<span id="id1747"></span><h2>9.633. Unkown Regex Options<a class="headerlink" href="#unkown-regex-options" title="Permalink to this headline">¶</a></h2>
<p>Regex support in PHP accepts the following list of options : <code class="docutils literal notranslate"><span class="pre">eimsuxADJSUX</span></code>.</p>
<p>All other letter used as option are not supported : depending on the situation, they may be ignored or raise an error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// all options are available</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/\d+/isA&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$results</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// p and h are not regex options, p is double</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/\d+/php&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$results</span><span class="p">))</span> <span class="p">{</span> <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/reference.pcre.pattern.modifiers.php">Pattern Modifiers</a></p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UnknownPregOption</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="unpacking-inside-arrays">
<span id="id1749"></span><h2>9.634. Unpacking Inside Arrays<a class="headerlink" href="#unpacking-inside-arrays" title="Permalink to this headline">¶</a></h2>
<p>The variadic operator is now available inside arrays. Until PHP 7.4, it is not possible to use the variadic operator, or <code class="docutils literal notranslate"><span class="pre">...</span></code> inside arrays.</p>
<p>The workaround is to use <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a>, after checking that arrays are not empty.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">];</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">];</span>

<span class="c1">// PHP 7.4</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="p">[</span><span class="o">...</span><span class="nv">$a</span><span class="p">,</span> <span class="o">...</span><span class="nv">$b</span><span class="p">];</span>

<span class="c1">// PHP 7.3 and older</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<dl class="docutils">
<dt>See also <a class="reference external" href="https://wiki.php.net/rfc/spread_operator_for_array">Spread Operator in Array Expression</a> and</dt>
<dd><a class="reference external" href="https://lornajane.net/posts/2014/php-5-6-and-the-splat-operator">PHP 5.6 and the Splat Operator</a> .</dd>
</dl>
<div class="section" id="id1752">
<h3>9.634.1. Suggestions<a class="headerlink" href="#id1752" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace array_merge() with <code class="docutils literal notranslate"><span class="pre">...</span></code>.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="94%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UnpackingInsideArrays</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp73"><span class="std std-ref">CompatibilityPHP73</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unpreprocessed-values">
<span id="id1753"></span><h2>9.635. Unpreprocessed Values<a class="headerlink" href="#unpreprocessed-values" title="Permalink to this headline">¶</a></h2>
<p>Preprocessing values is the preparation of values before PHP executes the code.</p>
<p>There is no macro language in PHP, that prepares the code before compilation, bringing some comfort and short syntax. Most of the time, one uses PHP itself to preprocess data.</p>
<p>For example :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$days_en</span> <span class="o">=</span> <span class="s1">&#39;monday,tuesday,wednesday,thursday,friday,saturday,sunday&#39;</span><span class="p">;</span>
    <span class="nv">$days_zh</span> <span class="o">=</span> <span class="s1">&#39;星期－,星期二,星期三,星期四,星期五,星期六,星期日&#39;</span><span class="p">;</span>

    <span class="nv">$days</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="nv">$lang</span> <span class="o">===</span> <span class="s1">&#39;en&#39;</span> <span class="o">?</span> <span class="nv">$days_en</span> <span class="o">:</span> <span class="nv">$days_zh</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>could be written</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$lang</span> <span class="o">===</span> <span class="s1">&#39;en&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$days</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;monday&#39;</span><span class="p">,</span> <span class="s1">&#39;tuesday&#39;</span><span class="p">,</span> <span class="s1">&#39;wednesday&#39;</span><span class="p">,</span> <span class="s1">&#39;thursday&#39;</span><span class="p">,</span> <span class="s1">&#39;friday&#39;</span><span class="p">,</span> <span class="s1">&#39;saturday&#39;</span><span class="p">,</span> <span class="s1">&#39;sunday&#39;</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$days</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;星期－&#39;</span><span class="p">,</span> <span class="s1">&#39;星期二&#39;</span><span class="p">,</span> <span class="s1">&#39;星期三&#39;</span><span class="p">,</span> <span class="s1">&#39;星期四&#39;</span><span class="p">,</span> <span class="s1">&#39;星期五&#39;</span><span class="p">,</span> <span class="s1">&#39;星期六&#39;</span><span class="p">,</span> <span class="s1">&#39;星期日&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>and avoid preprocessing the string into an array first.</p>
<p>Preprocessing could be done anytime the script includes all the needed values to process the expression.</p>
<div class="section" id="id1754">
<h3>9.635.1. Suggestions<a class="headerlink" href="#id1754" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Preprocess the values and hardcode them in PHP. Do not use PHP to calculate something at the last moment.</li>
<li>Use already processed values, or cache to avoid calculating the value each hit.</li>
<li>Create a class that export the data in the right format for every situation, including the developer’s comfort.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/Unpreprocessed</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/always-preprocess.md">always-preprocess</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-structures-unpreprocessed"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#piwigo-structures-unpreprocessed"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unreachable-class-constant">
<span id="id1755"></span><h2>9.636. Unreachable Class Constant<a class="headerlink" href="#unreachable-class-constant" title="Permalink to this headline">¶</a></h2>
<p>Class constants may be unreachable due to visibility configuration.</p>
<p>Since PHP 7.1, class constants support visibility. Their usage may be restricted to the current class, or <code class="docutils literal notranslate"><span class="pre">private</span></code>, to classes that extends or are extended by the current class, or <code class="docutils literal notranslate"><span class="pre">protected</span></code>. They may also be <code class="docutils literal notranslate"><span class="pre">public</span></code>, just like it was before.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span><span class="p">{</span>
    <span class="k">private</span> <span class="k">const</span> <span class="no">PRIVATE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">const</span> <span class="no">PUBLIC</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// PHP 7.1- and older</span>
<span class="k">echo</span> <span class="nx">Foo</span><span class="o">::</span><span class="na">PUBLIC</span><span class="p">;</span>

<span class="c1">// This is not accessible</span>
<span class="k">echo</span> <span class="nx">Foo</span><span class="o">::</span><span class="na">PRIVATE</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.constants.php">Class Constant</a> and <a class="reference external" href="https://wiki.php.net/rfc/class_const_visibility">PHP RFC: Support Class Constant Visibility</a>.</p>
<div class="section" id="id1758">
<h3>9.636.1. Suggestions<a class="headerlink" href="#id1758" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the class constant protected, when the call to the constant is inside a related class.</li>
<li>Create another constant, that may be accessible</li>
<li>Make the class constant public</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnreachableConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unreachable-code">
<span id="id1759"></span><h2>9.637. Unreachable Code<a class="headerlink" href="#unreachable-code" title="Permalink to this headline">¶</a></h2>
<p>Code may be unreachable, because other instructions prevent its reaching.</p>
<p>For example, it be located after throw, return, <a class="reference external" href="https://www.www.php.net/exit">exit() &lt;https://www.php.net/`exit</a>&gt;`_, <a class="reference external" href="https://www.php.net/die">die() &lt;https://www.php.net/`die</a>&gt;`_, goto, <a class="reference external" href="https://www.php.net/manual/en/control-structures.break.php">break</a> or <a class="reference external" href="https://www.php.net/manual/en/control-structures.continue.php">continue</a> : this way, it cannot be reached, as the previous instruction will divert the engine to another part of the code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="nv">$b</span><span class="o">++</span><span class="p">;</span>      <span class="c1">// $b++ can&#39;t be reached;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$b</span><span class="o">++</span><span class="p">;</span>      <span class="c1">// $b++ can&#39;t be reached;</span>
<span class="p">}</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$a</span> <span class="k">as</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$c</span> <span class="o">+=</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$c</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">continue</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$c</span><span class="o">--</span><span class="p">;</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$d</span> <span class="o">+=</span> <span class="nv">$e</span><span class="p">;</span>   <span class="c1">// this can&#39;t be reached</span>
<span class="p">}</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nx">goto</span> <span class="nx">B</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{}</span>    <span class="c1">// Definitions are accessible, but not functioncalls</span>
<span class="nx">B</span><span class="o">:</span>
<span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is dead code, that may be removed.</p>
<div class="section" id="id1763">
<h3>9.637.1. Suggestions<a class="headerlink" href="#id1763" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the unreachable code</li>
<li>Remove the blocking expression, and let the code execute</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UnreachableCode</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-dead-code.md">no-dead-code</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unresolved-catch">
<span id="id1764"></span><h2>9.638. Unresolved Catch<a class="headerlink" href="#unresolved-catch" title="Permalink to this headline">¶</a></h2>
<p>Catch clauses do not check for Exception existence.</p>
<p>Catch clauses check that the emitted expression is of the requested Class, but if that class doesn’t exist in the code, the catch clause is always false. This is dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span><span class="nx">TypoedExxeption</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Do not exist Exception</span>
    <span class="c1">// Fix this exception</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span><span class="k">Stdclass</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>        <span class="c1">// Exists, but is not an exception</span>
    <span class="c1">// Fix this exception</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>        <span class="c1">// Actual and effective catch</span>
    <span class="c1">// Fix this exception</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1765">
<h3>9.638.1. Suggestions<a class="headerlink" href="#id1765" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Fix the name of the exception</li>
<li>Remove the catch clause</li>
<li>Add a use expression with a valid name</li>
<li>Create/import the missing exception</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnresolvedCatch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-unresolved-catch.md">no-unresolved-catch</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unresolved-classes">
<span id="id1766"></span><h2>9.639. Unresolved Classes<a class="headerlink" href="#unresolved-classes" title="Permalink to this headline">¶</a></h2>
<p>The following classes are instantiated in the code, but their definition couldn’t be found.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="k">extends</span> <span class="nx">Bar</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">foobar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// here, parent is not resolved, as Bar is not defined in the code.</span>
        <span class="k">return</span> <span class="k">parent</span><span class="o">::</span><span class="nv">$prop</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1767">
<h3>9.639.1. Suggestions<a class="headerlink" href="#id1767" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check for namespaces and aliases and make sure they are correctly configured.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnresolvedClasses</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unresolved-instanceof">
<span id="id1768"></span><h2>9.640. Unresolved Instanceof<a class="headerlink" href="#unresolved-instanceof" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">instanceof</a> operator doesn’t confirm if the compared class exists.</p>
<p>It checks if an variable is of a specific class. However, if the referenced class doesn’t exist, because of a bug, a missed inclusion or a typo, the operator always fails, without a warning.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">X</span> <span class="p">{</span>
    <span class="k">class</span> <span class="nc">C</span> <span class="p">{}</span>

    <span class="c1">// This is OK, as C is defined in X</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nx">C</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="c1">// This is not OK, as C is not defined in global</span>
    <span class="c1">// instanceof respects namespaces and use expressions</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nx">\C</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="c1">// This is not OK, as undefinedClass</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nx">undefinedClass</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

    <span class="c1">// This is not OK, as $class is now a full namespace. It actually refers to \c, which doesn&#39;t exist</span>
    <span class="nv">$class</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nv">$class</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Make sure the following classes are well defined.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">Instanceof</a>.</p>
<div class="section" id="id1771">
<h3>9.640.1. Suggestions<a class="headerlink" href="#id1771" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the call to instanceof and all its dependencies.</li>
<li>Fix the class name and use a class existing in the project.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnresolvedInstanceof</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-unresolved-instanceof.md">no-unresolved-instanceof</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-classes-unresolvedinstanceof"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unresolved-use">
<span id="id1772"></span><h2>9.641. Unresolved Use<a class="headerlink" href="#unresolved-use" title="Permalink to this headline">¶</a></h2>
<p>The following use instructions cannot be resolved to a known class, interface, trait, constant or function. They should be dropped or fixed.</p>
<p>A known class, interface, trait, constant or function is defined in PHP (standard), an extension, a stub or the current code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="c1">// class B is defined</span>
    <span class="k">class</span> <span class="nc">B</span> <span class="p">{}</span>
    <span class="c1">// class C is not defined</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">X</span><span class="o">/</span><span class="nx">Y</span> <span class="p">{</span>

    <span class="k">use</span> <span class="nx">A</span><span class="o">/</span><span class="nx">B</span><span class="p">;</span>  <span class="c1">// This use is valid</span>
    <span class="k">use</span> <span class="nx">A</span><span class="o">/</span><span class="nx">C</span><span class="p">;</span>  <span class="c1">// This use point to nothing.</span>

    <span class="k">new</span> <span class="nx">B</span><span class="p">();</span>
    <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Use expression are options for the current namespace.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.namespaces.importing.php">Using namespaces: Aliasing/Importing</a>.</p>
<div class="section" id="id1774">
<h3>9.641.1. Suggestions<a class="headerlink" href="#id1774" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the use expression</li>
<li>Fix the use expression</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/UnresolvedUse</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-unresolved-use.md">no-unresolved-use</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unserialize-second-arg">
<span id="id1775"></span><h2>9.642. Unserialize Second Arg<a class="headerlink" href="#unserialize-second-arg" title="Permalink to this headline">¶</a></h2>
<p>Since PHP 7, <a class="reference external" href="https://www.php.net/unserialize">unserialize()</a> function has a second argument that limits the classes that may be unserialized. In case of a breach, this is limiting the classes accessible from <a class="reference external" href="https://www.php.net/unserialize">unserialize()</a>.</p>
<p>One way to exploit unserialize, is to make PHP unserialized the data to an available class, may be one that may be auto-loaded.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// safe unserialization : only the expected class will be extracted</span>
<span class="nv">$serialized</span> <span class="o">=</span> <span class="s1">&#39;O:7:dbClass:0:{}&#39;</span><span class="p">;</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$serialized</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dbClass&#39;</span><span class="p">]);</span>
<span class="nv">$var</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>

<span class="c1">// unsafe unserialization : $var may be of any type that was in the serialized string</span>
<span class="c1">// although, here, this is working well.</span>
<span class="nv">$serialized</span> <span class="o">=</span> <span class="s1">&#39;O:7:dbClass:0:{}&#39;</span><span class="p">;</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$serialized</span><span class="p">);</span>
<span class="nv">$var</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>

<span class="c1">// unsafe unserialization : $var is not of the expected type.</span>
<span class="c1">// and, here, this will lead to disaster.</span>
<span class="nv">$serialized</span> <span class="o">=</span> <span class="s1">&#39;O:10:debugClass:0:{}&#39;</span><span class="p">;</span>
<span class="nv">$var</span> <span class="o">=</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nv">$serialized</span><span class="p">);</span>
<span class="nv">$var</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/unserialize">unserialize()</a>, <a class="reference external" href="https://paragonie.com/blog/2016/04/securely-implementing-de-serialization-in-php">Securely Implementing (De)Serialization in PHP</a>, and <a class="reference external" href="https://www.notsosecure.com/remote-code-execution-via-php-unserialize/">Remote code execution via PHP [Unserialize]</a>.</p>
<div class="section" id="id1778">
<h3>9.642.1. Suggestions<a class="headerlink" href="#id1778" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a list of class as second argument of any call to unserialize(). This is valid for PHP 7.0 and later.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/UnserializeSecondArg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#piwigo-security-unserializesecondarg"><span class="std std-ref">Piwigo</span></a>, <a class="reference internal" href="Cases.html#livezilla-security-unserializesecondarg"><span class="std std-ref">LiveZilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unset-in-foreach">
<span id="id1779"></span><h2>9.643. Unset In Foreach<a class="headerlink" href="#unset-in-foreach" title="Permalink to this headline">¶</a></h2>
<p>Unset applied to the variables of a <code class="docutils literal notranslate"><span class="pre">foreach</span></code> loop are useless. Those variables are copies and not the actual value. Even if the value is a reference, unsetting it has no effect on the original array : the only effect may be indirect, on elements inside an array, or on properties inside an object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// When unset is useless</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">];</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="c1">// still [1, 2, 3]</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$b</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="c1">// still [1, 2, 3]</span>

<span class="c1">// When unset is useful</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]</span> <span class="p">];</span> <span class="c1">// Array in array</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">unset</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="nb">print_r</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span> <span class="c1">// now [ [&#39;c&#39; =&gt; null] ]</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a>.</p>
<div class="section" id="id1781">
<h3>9.643.1. Suggestions<a class="headerlink" href="#id1781" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the unset</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UnsetInForeach</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unsupported-types-with-operators">
<span id="id1782"></span><h2>9.644. Unsupported Types With Operators<a class="headerlink" href="#unsupported-types-with-operators" title="Permalink to this headline">¶</a></h2>
<p>Arrays, resources and objects are generally not accepted with unary and binary operators.</p>
<p>The operators are <cite>+</cite>, <cite>-</cite>, <cite>*</cite>, <cite>/</cite>, <cite>**</cite>, <cite>%</cite>, <cite>&lt;&lt;</cite>, <cite>&gt;&gt;</cite>, <cite>&amp;</cite>, <cite>|</cite>, <cite>^</cite>, <cite>~</cite>, <cite>++</cite> and <cite>–</cite>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nb">var_dump</span><span class="p">([]</span> <span class="o">%</span> <span class="p">[</span><span class="mi">42</span><span class="p">]);</span>
<span class="c1">// int(0) in PHP 7.x</span>
<span class="c1">// TypeError in PHP 8.0 +</span>

<span class="c1">// Also impossible usage : index are string or int</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nv">$c</span><span class="p">[</span><span class="nv">$a</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>In PHP 8.0, the rules have been made stricter and more consistent.</p>
<p>The only valid operator is <cite>+</cite>, combined with arrays in both operands. Other situation will throw <cite>TypeError</cite>.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/arithmetic_operator_type_checks">Stricter type checks for arithmetic/bitwise operators</a> and <a class="reference external" href="https://www.php.net/manual/en/class.typeerror.php">TypeError</a>.</p>
<div class="section" id="id1783">
<h3>9.644.1. Suggestions<a class="headerlink" href="#id1783" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do not use those values with those operators</li>
<li>Use a condition to skip this awkward situation</li>
<li>Add an extra step to turn this value into a valid type</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UnsupportedTypesWithOperators</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp80"><span class="std std-ref">CompatibilityPHP80</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unthrown-exception">
<span id="id1784"></span><h2>9.645. Unthrown Exception<a class="headerlink" href="#unthrown-exception" title="Permalink to this headline">¶</a></h2>
<p>These are exceptions that are defined in the code but never thrown.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//This exception is defined but never used in the code.</span>
<span class="k">class</span> <span class="nc">myUnusedException</span> <span class="k">extends</span> <span class="nx">\Exception</span> <span class="p">{}</span>

<span class="c1">//This exception is defined and used in the code.</span>
<span class="k">class</span> <span class="nc">myUsedException</span> <span class="k">extends</span> <span class="nx">\Exception</span> <span class="p">{}</span>

<span class="k">throw</span> <span class="k">new</span> <span class="nx">myUsedException</span><span class="p">(</span><span class="s1">&#39;I was called&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.exceptions.php">Exceptions</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/Unthrown</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-unthrown-exceptions.md">no-unthrown-exceptions</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="unused-arguments">
<span id="id1786"></span><h2>9.646. Unused Arguments<a class="headerlink" href="#unused-arguments" title="Permalink to this headline">¶</a></h2>
<p>Those arguments are not used in the method or function.</p>
<p>Unused arguments should be removed in functions : they are just dead code.</p>
<p>Unused argument may have to stay in methods, as the signature is actually defined in the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> class.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $unused is in the signature, but not used.</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$unused</span><span class="p">,</span> <span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$b</span> <span class="o">+</span> <span class="nv">$c</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1788">
<h3>9.646.1. Suggestions<a class="headerlink" href="#id1788" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the argument from the signature</li>
<li>Actually use that argument in the body of the method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UnusedArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thinkphp-functions-unusedarguments"><span class="std std-ref">ThinkPHP</span></a>, <a class="reference internal" href="Cases.html#phpmyadmin-functions-unusedarguments"><span class="std std-ref">phpMyAdmin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-class-constant">
<span id="id1789"></span><h2>9.647. Unused Class Constant<a class="headerlink" href="#unused-class-constant" title="Permalink to this headline">¶</a></h2>
<p>The class constant is unused. Consider removing it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">const</span> <span class="no">UNUSED</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// No mention in the code</span>

    <span class="k">private</span> <span class="k">const</span> <span class="no">USED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">// used constant</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">USED</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1790">
<h3>9.647.1. Suggestions<a class="headerlink" href="#id1790" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the class constant</li>
<li>Use the class constant</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnusedConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-classes">
<span id="id1791"></span><h2>9.648. Unused Classes<a class="headerlink" href="#unused-classes" title="Permalink to this headline">¶</a></h2>
<p>The following classes are never explicitly used in the code.</p>
<p>Note that this may be valid in case the current code is a library or framework, since it defines classes that are used by other (unprovided) codes.
Also, this analyzer may find classes that are, in fact, dynamically loaded.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">unusedClasss</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">usedClass</span> <span class="p">{}</span>

<span class="nv">$y</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">usedClass</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnusedClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="unused-constants">
<span id="id1792"></span><h2>9.649. Unused Constants<a class="headerlink" href="#unused-constants" title="Permalink to this headline">¶</a></h2>
<p>Those constants are defined in the code but never used. Defining unused constants slow down the application, as they are executed and stored in PHP hashtables.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// const-defined constant</span>
<span class="k">const</span> <span class="no">USED_CONSTANT</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">const</span> <span class="no">UNUSED_CONSTANT</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nx">USED_CONSTANT</span><span class="p">;</span>

<span class="c1">// define-defined constant</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;ANOTHER_UNUSED_CONSTANT&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to comment them out, and only define them when it is necessary.</p>
<div class="section" id="id1793">
<h3>9.649.1. Suggestions<a class="headerlink" href="#id1793" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make use of the constant</li>
<li>Remove the constant</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/UnusedConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-exception-variable">
<span id="id1794"></span><h2>9.650. Unused Exception Variable<a class="headerlink" href="#unused-exception-variable" title="Permalink to this headline">¶</a></h2>
<p>The variable from a catch clause is not used. It is expected to be used, either by chaining the exception, or logging the message.</p>
<p>In PHP 8.0, this variable may be omitted.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">try</span><span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">A</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $a is caught, but not used here</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">B</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $b is caught, and used</span>
    <span class="nb">log</span><span class="p">(</span><span class="nv">$b</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">());</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">C</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Caught and ignored (PHP 8.0 +)</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1795">
<h3>9.650.1. Suggestions<a class="headerlink" href="#id1795" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the variable in the clause expression (PHP 8.0 and more recent)</li>
<li>Chain the exception</li>
<li>Log the exception message</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/UnusedExceptionVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-functions">
<span id="id1796"></span><h2>9.651. Unused Functions<a class="headerlink" href="#unused-functions" title="Permalink to this headline">¶</a></h2>
<p>The functions below are unused. They look like dead code.</p>
<p>Recursive functions, level 1, are detected : they are only reported when a call from outside the function is made. Recursive functions calls of higher level (A calls B calls A) are not handled.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">used</span><span class="p">()</span> <span class="p">{}</span>
<span class="c1">// The &#39;unused&#39; function is defined but never called</span>
<span class="k">function</span> <span class="nf">unused</span><span class="p">()</span> <span class="p">{}</span>

<span class="c1">// The &#39;used&#39; function is called at least once</span>
<span class="nx">used</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1797">
<h3>9.651.1. Suggestions<a class="headerlink" href="#id1797" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the function in the code</li>
<li>Remove the functions from the code</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UnusedFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#woocommerce-functions-unusedfunctions"><span class="std std-ref">Woocommerce</span></a>, <a class="reference internal" href="Cases.html#piwigo-functions-unusedfunctions"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-global">
<span id="id1798"></span><h2>9.652. Unused Global<a class="headerlink" href="#unused-global" title="Permalink to this headline">¶</a></h2>
<p>A global keyword is used in a method, yet the variable is not actually used. This makes PHP import values for nothing, or may create interference</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">global</span> <span class="nx">bar</span><span class="p">;</span>

        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1799">
<h3>9.652.1. Suggestions<a class="headerlink" href="#id1799" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the global declaration</li>
<li>Remove the global variable altogether</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UnusedGlobal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolphin-structures-unusedglobal"><span class="std std-ref">Dolphin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-inherited-variable-in-closure">
<span id="id1800"></span><h2>9.653. Unused Inherited Variable In Closure<a class="headerlink" href="#unused-inherited-variable-in-closure" title="Permalink to this headline">¶</a></h2>
<p>Some closures forgot to make usage of inherited variables.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/class.closure.php">Closure</a> have two separate set of incoming variables : the arguments (between parenthesis) and the inherited variables, in the ‘use’ clause. Inherited variables are extracted from the local environment at creation time, and keep their value until execution.</p>
<p>The reported closures are requesting some local variables, but do not make any usage of them. They may be considered as dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// In this closure, $y is forgotten, but $u is used.</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$y</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$u</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$u</span><span class="p">;</span> <span class="p">};</span>

<span class="c1">// In this closure, $u is forgotten</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$y</span><span class="p">,</span> <span class="nv">$z</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$u</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$u</span><span class="p">;</span> <span class="p">};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.anonymous.php">Anonymous functions</a>.</p>
<div class="section" id="id1803">
<h3>9.653.1. Suggestions<a class="headerlink" href="#id1803" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the unused inherited variable</li>
<li>Make us of the unused inherited variable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UnusedInheritedVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#shopware-functions-unusedinheritedvariable"><span class="std std-ref">shopware</span></a>, <a class="reference internal" href="Cases.html#mautic-functions-unusedinheritedvariable"><span class="std std-ref">Mautic</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-interfaces">
<span id="id1804"></span><h2>9.654. Unused Interfaces<a class="headerlink" href="#unused-interfaces" title="Permalink to this headline">¶</a></h2>
<p>Those interfaces are defined and never used. They should be removed, as they are dead code.</p>
<p>Interfaces may be use as <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> for other interfaces, as typehint (argument, return and property), in instance of.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">interface</span> <span class="nx">used</span> <span class="p">{}</span>
<span class="k">interface</span> <span class="nx">unused</span> <span class="p">{}</span>

<span class="c1">// Used by implementation</span>
<span class="k">class</span> <span class="nc">c</span> <span class="k">implements</span> <span class="nx">used</span> <span class="p">{}</span>

<span class="c1">// Used by extension</span>
<span class="k">interface</span> <span class="nx">j</span> <span class="k">implements</span> <span class="nx">used</span> <span class="p">{}</span>

<span class="nv">$x</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">c</span><span class="p">;</span>

<span class="c1">// Used in a instanceof</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$x</span> <span class="nx">instanceof</span> <span class="nx">used</span><span class="p">);</span>

<span class="c1">// Used in a typehint</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">Used</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1806">
<h3>9.654.1. Suggestions<a class="headerlink" href="#id1806" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the interface</li>
<li>Actually use the interface</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/UnusedInterfaces</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-interfaces-unusedinterfaces"><span class="std std-ref">Tine20</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-label">
<span id="id1807"></span><h2>9.655. Unused Label<a class="headerlink" href="#unused-label" title="Permalink to this headline">¶</a></h2>
<p>Some labels have been defined in the code, but they are not used. They may be removed as they are dead code.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">A</span><span class="o">:</span>

    <span class="o">++</span><span class="nv">$a</span><span class="p">;</span>

    <span class="c1">// A loop. A: is used</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="nx">goto</span> <span class="nx">A</span><span class="p">;</span> <span class="p">}</span>

<span class="c1">// B is never called explicitely. This is useless.</span>
<span class="nx">B</span><span class="o">:</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>There is no analysis for undefined goto call, as PHP checks that goto has a destination label at compile time :</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.goto.php">Goto</a>.</p>
<div class="section" id="id1808">
<h3>9.655.1. Suggestions<a class="headerlink" href="#id1808" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the unused label</li>
<li>Add a goto call to this label</li>
<li>Check for spelling mistakes</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UnusedLabel</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-methods">
<span id="id1809"></span><h2>9.656. Unused Methods<a class="headerlink" href="#unused-methods" title="Permalink to this headline">¶</a></h2>
<p>Those methods are never called.</p>
<p>They are probably dead code, unless they are called dynamically.</p>
<p>This analysis omits methods which are in a class that makes dynamical <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> calls : <code class="docutils literal notranslate"><span class="pre">$this-&gt;$m()</span></code>. That way, any method may be called.</p>
<p>This analysis omits methods which are overwritten by a child class. That way, they are considered to provide a default behavior.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">used</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">used</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">unused</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">used</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">bar</span> <span class="k">extends</span> <span class="nx">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">some</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">used</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">foo</span><span class="p">();</span>
<span class="nv">$a</span><span class="o">-&gt;</span><span class="na">used</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://vulncat.fortify.com/en/detail?id=desc.structural.java.dead_code_unused_method">Dead Code: Unused Method</a>.</p>
<div class="section" id="id1811">
<h3>9.656.1. Suggestions<a class="headerlink" href="#id1811" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make use of the method</li>
<li>Remove the method</li>
<li>Move the method to another class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnusedMethods</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-private-methods">
<span id="id1812"></span><h2>9.657. Unused Private Methods<a class="headerlink" href="#unused-private-methods" title="Permalink to this headline">¶</a></h2>
<p>Private methods that are not used are dead code.</p>
<p>Private methods are reserved for the defining class. Thus, they must be used with the current class, with <code class="docutils literal notranslate"><span class="pre">$this</span></code> or <code class="docutils literal notranslate"><span class="pre">self\:\:</span></code>.</p>
<p>Protected methods, in a standalone class, are also included.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="c1">// Those methods are used</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">staticMethod</span><span class="p">()</span> <span class="p">{}</span>

    <span class="c1">// Those methods are not used</span>
    <span class="k">private</span> <span class="k">function</span> <span class="nf">unusedMethod</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">private</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">staticUnusedMethod</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="o">::</span><span class="na">staticMethod</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis skips classes that makes <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> dynamic calls, such as <code class="docutils literal notranslate"><span class="pre">$this-&gt;$method()</span></code>.</p>
<div class="section" id="id1814">
<h3>9.657.1. Suggestions<a class="headerlink" href="#id1814" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the private method, as it is unused</li>
<li>Add a call to this private method</li>
<li>Change method visibility to make it available to other classes</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnusedPrivateMethod</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-private-properties">
<span id="id1815"></span><h2>9.658. Unused Private Properties<a class="headerlink" href="#unused-private-properties" title="Permalink to this headline">¶</a></h2>
<p>Unused <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> properties should be removed.</p>
<p>Unused private properties are dead code. They are usually leftovers of development or refactorisation : they used to have a mission, but are now left.</p>
<p>Being private, those properties are only accessible to the current class or trait. As such, validating the</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="c1">// This is a used property (see bar method)</span>
    <span class="k">private</span> <span class="nv">$used</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// This is an unused property</span>
    <span class="k">private</span> <span class="nv">$unused</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">used</span> <span class="o">+=</span> <span class="nv">$a</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">used</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1817">
<h3>9.658.1. Suggestions<a class="headerlink" href="#id1817" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the property altogether</li>
<li>Check if the property wasn’t forgotten in the rest of the class</li>
<li>Check if the property is correctly named</li>
<li>Change the visibility to protected or public : may be a visibility refactoring was too harsh</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnusedPrivateProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openemr-classes-unusedprivateproperty"><span class="std std-ref">OpenEMR</span></a>, <a class="reference internal" href="Cases.html#phpadsnew-classes-unusedprivateproperty"><span class="std std-ref">phpadsnew</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-protected-methods">
<span id="id1818"></span><h2>9.659. Unused Protected Methods<a class="headerlink" href="#unused-protected-methods" title="Permalink to this headline">¶</a></h2>
<p>The following protected methods are unused in children class. As such, they may be considered for being private.</p>
<p>Methods reported by this analysis are not used by children, yet they are protected.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="c1">// This method is not used</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">unusedBar</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">usedInFoo</span><span class="p">()</span> <span class="p">{}</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">usedInFooFoo</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar2</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// some code</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">usedInFoo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">FooFoo</span> <span class="k">extends</span> <span class="nx">Foo</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar2</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// some code</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">usedInFooFoo</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">someOtherClass</span> <span class="p">{</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This is not related to foo.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">unusedbar</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>No usage of those methods were found.</p>
<p>This analysis is impacted by dynamic method calls.</p>
<div class="section" id="id1819">
<h3>9.659.1. Suggestions<a class="headerlink" href="#id1819" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make use of the protected method in the code</li>
<li>Remove the method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UnusedProtectedMethods</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-returned-value">
<span id="id1820"></span><h2>9.660. Unused Returned Value<a class="headerlink" href="#unused-returned-value" title="Permalink to this headline">¶</a></h2>
<p>The function called returns a value, which is ignored.</p>
<p>Usually, this is a sign of dead code, or a missed check on the results of the functioncall. At times, it may be a valid call if the function has voluntarily no return value.</p>
<p>It is recommended to add a check on the return value, or remove the call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// simplest form</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">foo</span><span class="p">();</span>

<span class="c1">// In case of multiple return, any one that returns something means that return value is meaningful</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">bar</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that this analysis ignores functions that return void (same meaning that PHP 7.1 : return ; or no return in the function body).</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UnusedReturnedValue</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="unused-trait-in-class">
<span id="id1821"></span><h2>9.661. Unused Trait In Class<a class="headerlink" href="#unused-trait-in-class" title="Permalink to this headline">¶</a></h2>
<p>A trait has been summoned in a class, but is not used. Traits may be used as a copy/paste of code, bringing a batch of methods and properties to a class. In the current case, the imported trait is never called. As such, it may be removed.</p>
<p>Currently, the analysis covers only traits that are used in the class where they are imported. Also, the properties are not covered yet.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">trait</span> <span class="nx">t</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;}</span>
<span class="p">}</span>

<span class="c1">// this class imports and uses the trait</span>
<span class="k">class</span> <span class="nc">UsingTrait</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// this class imports but doesn&#39;t uses the trait</span>
<span class="k">class</span> <span class="nc">UsingTrait</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>There are some sneaky situations, where a trait falls into decay : for example, creating a method in the importing class, with the name of a trait class, will exclude the trait method, as the class method has priority. Other precedence rules may lead to the same effect.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.traits.php">Traits</a>.</p>
<div class="section" id="id1823">
<h3>9.661.1. Suggestions<a class="headerlink" href="#id1823" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the trait from the class</li>
<li>Actually use the trait, at least in the importing class</li>
<li>Use conflict resolution to make the trait accessible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/UnusedClassTrait</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unused-use">
<span id="id1824"></span><h2>9.662. Unused Use<a class="headerlink" href="#unused-use" title="Permalink to this headline">¶</a></h2>
<p>Unused use statements. They may be removed, as they clutter the code and slows PHP by forcing it to search in this list for nothing.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">A</span> <span class="k">as</span> <span class="nx">B</span><span class="p">;</span> <span class="c1">// Used in a new call.</span>
<span class="k">use</span> <span class="nx">Unused</span><span class="p">;</span> <span class="c1">// Never used. May be removed</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">B</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1825">
<h3>9.662.1. Suggestions<a class="headerlink" href="#id1825" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the unused use</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/UnusedUse</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-useless-use.md">no-useless-use</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="unusual-case-for-php-functions">
<span id="id1826"></span><h2>9.663. Unusual Case For PHP Functions<a class="headerlink" href="#unusual-case-for-php-functions" title="Permalink to this headline">¶</a></h2>
<p>Usually, PHP functions are written all in lower case.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// All uppercases PHP functions</span>
<span class="k">ECHO</span> <span class="nx">STRTOLOWER</span><span class="p">(</span><span class="s1">&#39;This String&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UpperCaseFunction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="upload-filename-injection">
<span id="id1827"></span><h2>9.664. Upload Filename Injection<a class="headerlink" href="#upload-filename-injection" title="Permalink to this headline">¶</a></h2>
<p>When receiving a file via Upload, it is recommended to store it under a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a>-generated name. Any storage that uses the original filename, or even a part of it may be vulnerable to injections.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Security error ! the $_FILES[&#39;upload&#39;][&#39;filename&#39;] is provided by the sender.</span>
<span class="c1">// &#39;a.&lt;script&gt;alert(\&#39;a\&#39;)&lt;/script&gt;&#39;; may lead to a HTML injection.</span>
<span class="nv">$extension</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nb">strrchr</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$extension</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;gif&#39;</span><span class="p">,</span> <span class="s1">&#39;jpeg&#39;</span><span class="p">,</span> <span class="s1">&#39;jpg&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// process error</span>
    <span class="k">continue</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// Md5 provides a name without special characters</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">]);</span>
<span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="s1">&#39;/var/no-www/upload/&#39;</span><span class="o">.</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="nv">$extension</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">safeStoring</span><span class="p">(</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="nv">$extension</span><span class="p">,</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// Security error ! the $_FILES[&#39;upload&#39;][&#39;filename&#39;] is provided by the sender.</span>
<span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nx">safeStoring</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// Security error ! the $_FILES[&#39;upload&#39;][&#39;filename&#39;] is provided by the sender.</span>
<span class="c1">// &#39;a.&lt;script&gt;alert(&#39;a&#39;)&lt;/script&gt;&#39;; may lead to a HTML injection.</span>
<span class="nv">$extension</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span> <span class="nb">strrchr</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">]);</span>
<span class="k">if</span><span class="p">(</span><span class="o">@</span><span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="nv">$extension</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">safeStoring</span><span class="p">(</span><span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="nv">$extension</span><span class="p">,</span> <span class="nv">$_FILES</span><span class="p">[</span><span class="s1">&#39;upload&#39;</span><span class="p">][</span><span class="s1">&#39;filename&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is highly recommended to validate any incoming file, generate a name for it, and store the result in a folder outside the web folder. Also, avoid accepting PHP scripts, if possible.</p>
<p>See also <a class="reference external" href="https://cxsecurity.com/issue/WLB-2017100031">[CVE-2017-6090]</a>, <a class="reference external" href="https://cwe.mitre.org/data/definitions/616.html">CWE-616: Incomplete Identification of Uploaded File Variables</a>, <a class="reference external" href="https://www.acunetix.com/websitesecurity/upload-forms-threat/">Why File Upload Forms are a Major Security Threat</a>.</p>
<div class="section" id="id1829">
<h3>9.664.1. Suggestions<a class="headerlink" href="#id1829" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Validate uploaded filenames</li>
<li>Rename files upon storage, and keep the original name in a database</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/UploadFilenameInjection</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-class-operator">
<span id="id1830"></span><h2>9.665. Use ::Class Operator<a class="headerlink" href="#use-class-operator" title="Permalink to this headline">¶</a></h2>
<p>Use <code class="docutils literal notranslate"><span class="pre">\:\:class</span></code> to hardcode class names, instead of strings.</p>
<p>This is actually faster than strings, which are parsed at execution time, while <code class="docutils literal notranslate"><span class="pre">\:\:class</span></code> is compiled, making it faster to execute.</p>
<p><code class="docutils literal notranslate"><span class="pre">\:\:class</span></code> operator is also able to handle use expressions, including aliases and local namespace. The code is easier to maintain. For example, the target class’s namespace may be renamed, without changing the <code class="docutils literal notranslate"><span class="pre">\:\:class</span></code>, while the string must be updated.</p>
<p><code class="docutils literal notranslate"><span class="pre">\:\:class</span></code> operator works with <code class="docutils literal notranslate"><span class="pre">self</span></code> and <a href="#id1831"><span class="problematic" id="id1832">``</span></a>static``keywords.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">foo\bar</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">foo\bar\X</span> <span class="k">as</span> <span class="nx">B</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{}</span>

<span class="nv">$className</span> <span class="o">=</span> <span class="s1">&#39;\foo\bar\X&#39;</span><span class="p">;</span>

<span class="nv">$className</span> <span class="o">=</span> <span class="nx">foo\bar\X</span><span class="o">::</span><span class="na">class</span><span class="p">;</span>

<span class="nv">$className</span> <span class="o">=</span> <span class="nx">B\X</span><span class="p">;</span>

<span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$className</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is not possible when building the name of the class with concatenation.</p>
<p>This is a micro-optimization. This also helps <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> analysis, as it gives more information at compile time to analyse.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php#language.oop5.basic.class.class">::class</a>.</p>
<div class="section" id="id1835">
<h3>9.665.1. Suggestions<a class="headerlink" href="#id1835" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace strings by the ::class operator whenever possible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UseClassOperator</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#typo3-classes-useclassoperator"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-null">
<span id="id1836"></span><h2>9.666. Use === null<a class="headerlink" href="#use-null" title="Permalink to this headline">¶</a></h2>
<p>It is faster to use === null instead of <a class="reference external" href="https://www.php.net/is_null">is_null()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Operator === is fast</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// Function call is slow</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>

<span class="p">}</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1838">
<h3>9.666.1. Suggestions<a class="headerlink" href="#id1838" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use === comparison</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/IsnullVsEqualNull</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/avoid-those-slow-functions.md">avoid-those-slow-functions</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-array-functions">
<span id="id1839"></span><h2>9.667. Use Array Functions<a class="headerlink" href="#use-array-functions" title="Permalink to this headline">¶</a></h2>
<p>There are a lot of native PHP functions for arrays. It is often faster to take advantage of them than write a loop.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/array_push">array_push()</a> : use <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a></li>
<li><a class="reference external" href="https://www.php.net/array_slice">array_slice()</a> : use <a class="reference external" href="https://www.php.net/array_chunk">array_chunk()</a></li>
<li>index access : use <a class="reference external" href="https://www.php.net/array_column">array_column()</a></li>
<li>append <cite>[]</cite>: use <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a></li>
<li>addition : use <a class="reference external" href="https://www.php.net/array_sum">array_sum()</a></li>
<li>multiplication : use <a class="reference external" href="https://www.php.net/array_product">array_product()</a></li>
<li>concatenation : use <a class="reference external" href="https://www.php.net/implode">implode()</a></li>
<li>ifthen : use <a class="reference external" href="https://www.php.net/array_filter">array_filter()</a></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$all</span> <span class="o">=</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="nv">$s</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;-&#39;</span><span class="p">;</span>

<span class="c1">// same as above</span>
<span class="nv">$all</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$all</span> <span class="o">.=</span> <span class="nv">$s</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<dl class="docutils">
<dt>See also <a class="reference external" href="https://www.php.net/manual/en/ref.array.php">Array Functions</a> and</dt>
<dd><a class="reference internal" href="#no-array-merge-in-loops"><span class="std std-ref">No array_merge() In Loops</span></a>.</dd>
</dl>
<div class="section" id="id1847">
<h3>9.667.1. Suggestions<a class="headerlink" href="#id1847" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the loop and use a native PHP function</li>
<li>Add more expressions to the loop : batching multiple operations in one loop makes it more interesting than running separates loops.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UseArrayFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-basename-suffix">
<span id="id1848"></span><h2>9.668. Use Basename Suffix<a class="headerlink" href="#use-basename-suffix" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/basename">basename()</a> will remove extension when it is provided as argument. The second argument will be removed from the name of the file.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$path</span> <span class="o">=</span> <span class="s1">&#39;phar:///path/to/file.php&#39;</span><span class="p">;</span>

<span class="c1">// Don&#39;t forget the .</span>
<span class="nv">$filename</span> <span class="o">=</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$path</span><span class="p">,</span> <span class="s1">&#39;.php&#39;</span><span class="p">);</span>

<span class="c1">// Too much work for this</span>
<span class="nv">$filename</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nb">basename</span><span class="p">(</span><span class="nv">$path</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Using <a class="reference external" href="https://www.php.net/basename">basename()</a> instead of <a class="reference external" href="https://www.php.net/substr">substr()</a> or else, makes the intention clear.</p>
<p>See also <a class="reference external" href="http://www.php.net/basename">basename</a>.</p>
<div class="section" id="id1852">
<h3>9.668.1. Suggestions<a class="headerlink" href="#id1852" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use basename(), remove more complex code based on substr() or str_replace()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/BasenameSuffix</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#nextcloud-structures-basenamesuffix"><span class="std std-ref">NextCloud</span></a>, <a class="reference internal" href="Cases.html#dolibarr-structures-basenamesuffix"><span class="std std-ref">Dolibarr</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-case-value">
<span id="id1853"></span><h2>9.669. Use Case Value<a class="headerlink" href="#use-case-value" title="Permalink to this headline">¶</a></h2>
<p>When <a class="reference external" href="https://www.php.net/manual/en/control-structures.switch.php">switch()</a> has branched to the right case, the value of the switched variable is know : it is the case.</p>
<p>This doesn’t work with complex expression cases, nor with default.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">switch</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="s1">&#39;a&#39;</span> <span class="o">:</span>
        <span class="c1">// $a == &#39;a&#39;;</span>
        <span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>

    <span class="k">case</span> <span class="s1">&#39;b&#39;</span> <span class="o">:</span>
        <span class="c1">// $a == &#39;b&#39;;</span>
        <span class="k">echo</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1855">
<h3>9.669.1. Suggestions<a class="headerlink" href="#id1855" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the literal value in the case, to avoid unnecessary computation.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UseCaseValue</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-const-and-functions">
<span id="id1856"></span><h2>9.670. Use Const And Functions<a class="headerlink" href="#use-const-and-functions" title="Permalink to this headline">¶</a></h2>
<p>Since PHP 5.6 it is possible to import specific functions or constants from other namespaces.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">A</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">X</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span> <span class="k">echo</span> <span class="no">__FUNCTION__</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">namespace</span> <span class="nx">My</span><span class="p">{</span>
    <span class="k">use</span> <span class="k">function</span> <span class="nf">A\foo</span><span class="p">;</span>
    <span class="k">use</span> <span class="nb">constant</span> <span class="nx">A\X</span><span class="p">;</span>

    <span class="k">echo</span> <span class="nx">foo</span><span class="p">(</span><span class="nx">X</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.namespaces.importing.php">Using namespaces: Aliasing/Importing</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/UseFunctionsConstants</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="use-constant">
<span id="id1858"></span><h2>9.671. Use Constant<a class="headerlink" href="#use-constant" title="Permalink to this headline">¶</a></h2>
<p>The following functioncall have a constant equivalent, that is faster to use than calling the functions.</p>
<p>This applies to the following functions :</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/pi">pi()</a> : replace with <cite>M_PI</cite></li>
<li><a class="reference external" href="https://www.php.net/phpversion">phpversion()</a> : replace with <cite>PHP_VERSION</cite></li>
<li><a class="reference external" href="https://www.php.net/php_sapi_name">php_sapi_name()</a> : replace with <cite>PHP_SAPI_NAME</cite></li>
</ul>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// recommended way</span>
<span class="k">echo</span> <span class="k">PHP_VERSION</span><span class="p">;</span>

<span class="c1">// slow version</span>
<span class="k">echo</span> <span class="k">php_version</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/pi">PHP why `pi()</a> and M_PI &lt;<a class="reference external" href="https://stackoverflow.com/questions/42021176/php-why-pi-and-m-pi">https://stackoverflow.com/questions/42021176/php-why-pi-and-m-pi</a>&gt;`_.</p>
<div class="section" id="id1859">
<h3>9.671.1. Suggestions<a class="headerlink" href="#id1859" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the constant version, not the function.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UseConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#php-cs-fixable"><span class="std std-ref">php-cs-fixable</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-constant-as-arguments">
<span id="id1860"></span><h2>9.672. Use Constant As Arguments<a class="headerlink" href="#use-constant-as-arguments" title="Permalink to this headline">¶</a></h2>
<p>Some methods and functions are defined to be used with constants as arguments. Those constants are made to be meaningful and readable, keeping the code maintenable. It is recommended to use such constants as soon as they are documented.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Turn off all error reporting</span>
<span class="c1">// 0 and -1 are accepted</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1">// Report simple running errors</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ERROR</span> <span class="o">|</span> <span class="k">E_WARNING</span> <span class="o">|</span> <span class="k">E_PARSE</span><span class="p">);</span>

<span class="c1">// The first argument can be one of INPUT_GET, INPUT_POST, INPUT_COOKIE, INPUT_SERVER, or INPUT_ENV.</span>
<span class="nv">$search_html</span> <span class="o">=</span> <span class="nb">filter_input</span><span class="p">(</span><span class="nx">INPUT_GET</span><span class="p">,</span> <span class="s1">&#39;search&#39;</span><span class="p">,</span> <span class="nx">FILTER_SANITIZE_SPECIAL_CHARS</span><span class="p">);</span>

<span class="c1">// sort accepts one of SORT_REGULAR, SORT_NUMERIC, SORT_STRING, SORT_LOCALE_STRING, SORT_NATURAL</span>
<span class="c1">// SORT_FLAG_CASE may be added, and combined with SORT_STRING or SORT_NATURAL</span>
<span class="nb">sort</span><span class="p">(</span><span class="nv">$fruits</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Here is the list of function that use a unique PHP constant as argument :</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/array_change_key_case">array_change_key_case()</a></li>
<li><a class="reference external" href="https://www.php.net/array_multisort">array_multisort()</a></li>
<li><a class="reference external" href="https://www.php.net/array_unique">array_unique()</a></li>
<li><a class="reference external" href="https://www.php.net/count">count()</a></li>
<li>dns_get_record()</li>
<li><a class="reference external" href="https://www.php.net/easter_days">easter_days()</a></li>
<li><a class="reference external" href="https://www.php.net/extract">extract()</a></li>
<li><a class="reference external" href="https://www.php.net/filter_input">filter_input()</a></li>
<li><a class="reference external" href="https://www.php.net/filter_var">filter_var()</a></li>
<li><a class="reference external" href="https://www.php.net/fseek">fseek()</a></li>
<li><a class="reference external" href="https://www.php.net/get_html_translation_table">get_html_translation_table()</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_div_q">gmp_div_q()</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_div_qr">gmp_div_qr()</a></li>
<li><a class="reference external" href="https://www.php.net/gmp_div_r">gmp_div_r()</a></li>
<li><a class="reference external" href="https://www.php.net/html_entity_decode">html_entity_decode()</a></li>
<li><a class="reference external" href="https://www.php.net/htmlspecialchars_decode">htmlspecialchars_decode()</a></li>
<li><a class="reference external" href="https://www.php.net/http_build_query">http_build_query()</a></li>
<li><a class="reference external" href="https://www.php.net/http_parse_cookie">http_parse_cookie()</a></li>
<li><a class="reference external" href="https://www.php.net/http_parse_params">http_parse_params()</a></li>
<li><a class="reference external" href="https://www.php.net/http_redirect">http_redirect()</a></li>
<li><a class="reference external" href="https://www.php.net/http_support">http_support()</a></li>
<li><a class="reference external" href="https://www.php.net/parse_ini_file">parse_ini_file()</a></li>
<li><a class="reference external" href="https://www.php.net/parse_ini_string">parse_ini_string()</a></li>
<li><a class="reference external" href="https://www.php.net/parse_url">parse_url()</a></li>
<li><a class="reference external" href="https://www.php.net/pathinfo">pathinfo()</a></li>
<li><a class="reference external" href="https://www.php.net/pg_select">pg_select()</a></li>
<li><a class="reference external" href="https://www.php.net/posix_access">posix_access()</a></li>
<li><a class="reference external" href="https://www.php.net/round">round()</a></li>
<li><a class="reference external" href="https://www.php.net/scandir">scandir()</a></li>
<li><a class="reference external" href="https://www.php.net/socket_read">socket_read()</a></li>
<li><a class="reference external" href="https://www.php.net/str_pad">str_pad()</a></li>
<li><a class="reference external" href="https://www.php.net/trigger_error">trigger_error()</a></li>
</ul>
<p>Here is the list of functions that use a combination of PHP native functions as argument.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/arsort">arsort()</a></li>
<li><a class="reference external" href="https://www.php.net/asort">asort()</a></li>
<li><a class="reference external" href="https://www.php.net/error_reporting">error_reporting()</a></li>
<li><a class="reference external" href="https://www.php.net/filter_input">filter_input()</a></li>
<li><a class="reference external" href="https://www.php.net/filter_var">filter_var()</a></li>
<li><a class="reference external" href="https://www.php.net/get_html_translation_table">get_html_translation_table()</a></li>
<li><a class="reference external" href="https://www.php.net/htmlentities">htmlentities()</a></li>
<li><a class="reference external" href="https://www.php.net/htmlspecialchars">htmlspecialchars()</a></li>
<li><a class="reference external" href="https://www.php.net/http_build_url">http_build_url()</a></li>
<li><a class="reference external" href="https://www.php.net/jdtojewish">jdtojewish()</a></li>
<li><a class="reference external" href="https://www.php.net/krsort">krsort()</a></li>
<li><a class="reference external" href="https://www.php.net/ksort">ksort()</a></li>
<li><a class="reference external" href="https://www.php.net/pg_result_status">pg_result_status()</a></li>
<li><a class="reference external" href="https://www.php.net/phpcredits">phpcredits()</a></li>
<li><a class="reference external" href="https://www.php.net/phpinfo">phpinfo()</a></li>
<li><a class="reference external" href="https://www.php.net/preg_grep">preg_grep()</a></li>
<li><a class="reference external" href="https://www.php.net/preg_match">preg_match()</a></li>
<li><a class="reference external" href="https://www.php.net/preg_split">preg_split()</a></li>
<li><a class="reference external" href="https://www.php.net/rsort">rsort()</a></li>
<li><a class="reference external" href="https://www.php.net/runkit_import">runkit_import()</a></li>
<li><a class="reference external" href="https://www.php.net/sort">sort()</a></li>
<li><a class="reference external" href="https://www.php.net/stream_socket_client">stream_socket_client()</a></li>
<li><a class="reference external" href="https://www.php.net/stream_socket_server">stream_socket_server()</a></li>
</ul>
<div class="section" id="id1881">
<h3>9.672.1. Suggestions<a class="headerlink" href="#id1881" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use PHP native constants, whenever possible, instead of meaningless literals.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UseConstantAsArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tikiwiki-functions-useconstantasarguments"><span class="std std-ref">Tikiwiki</span></a>, <a class="reference internal" href="Cases.html#shopware-functions-useconstantasarguments"><span class="std std-ref">shopware</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-count-recursive">
<span id="id1882"></span><h2>9.673. Use Count Recursive<a class="headerlink" href="#use-count-recursive" title="Permalink to this headline">¶</a></h2>
<p>The code could use the recursive version of count.</p>
<p>The second argument of count, when set to <code class="docutils literal notranslate"><span class="pre">COUNT_RECURSIVE</span></code>, count recursively the elements. It also counts the elements themselves.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="k">array</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">));</span>

<span class="k">print</span> <span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nx">COUNT_RECURSIVE</span><span class="p">)</span> <span class="o">-</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="nx">COUNT_NORMAL</span><span class="p">));</span>

<span class="nv">$count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$count</span> <span class="o">+=</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">print</span> <span class="nv">$count</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/count">count</a>.</p>
<div class="section" id="id1884">
<h3>9.673.1. Suggestions<a class="headerlink" href="#id1884" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the loop and use the 2nd argument of count()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UseCountRecursive</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-structures-usecountrecursive"><span class="std std-ref">WordPress</span></a>, <a class="reference internal" href="Cases.html#prestashop-structures-usecountrecursive"><span class="std std-ref">PrestaShop</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-datetimeimmutable-class">
<span id="id1885"></span><h2>9.674. Use DateTimeImmutable Class<a class="headerlink" href="#use-datetimeimmutable-class" title="Permalink to this headline">¶</a></h2>
<p>The DateTimeImmutable class is the immutable version of the <a class="reference external" href="https://www.php.net/manual/en/class.datetime.php">Datetime</a> class.</p>
<p>While DateTime may be modified ‘in situ’, <code class="docutils literal notranslate"><span class="pre">DateTimeImmutable</span></code> cannot be modified. Any modification to such an object will return a new and distinct object. This avoid interferences that are hard to track.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Example extracted from Derick Rethans&#39; article (link below)</span>

<span class="k">function</span> <span class="nf">formatNextMondayFromNow</span><span class="p">(</span> <span class="nx">DateTime</span> <span class="nv">$dt</span> <span class="p">)</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="nv">$dt</span><span class="o">-&gt;</span><span class="na">modify</span><span class="p">(</span> <span class="s1">&#39;next monday&#39;</span> <span class="p">)</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span> <span class="s1">&#39;Y-m-d&#39;</span> <span class="p">);</span>
<span class="p">}</span>

<span class="nv">$d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">();</span>                          <span class="c1">//2014-02-17</span>
<span class="k">echo</span> <span class="nx">formatNextMondayFromNow</span><span class="p">(</span> <span class="nv">$d</span> <span class="p">),</span> <span class="nx">\n</span><span class="p">;</span>
<span class="k">echo</span> <span class="nv">$d</span><span class="o">-&gt;</span><span class="na">format</span><span class="p">(</span> <span class="s1">&#39;Y-m-d&#39;</span> <span class="p">),</span> <span class="nx">\n</span><span class="p">;</span>             <span class="c1">//2014-02-17</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://medium.com/&#64;codebyjeff/whats-all-this-immutable-date-stuff-anyway-72d4130af8ce">What’s all this ‘immutable date’ stuff, anyway?</a>, <a class="reference external" href="https://derickrethans.nl/immutable-datetime.html">DateTimeImmutable</a>, <a class="reference external" href="https://www.php.net/manual/en/class.datetime.php">The DateTime class</a> and <a class="reference external" href="https://www.php.net/manual/en/class.datetimeimmutable.php">The DateTimeImmutable class</a>.</p>
<div class="section" id="id1886">
<h3>9.674.1. Suggestions<a class="headerlink" href="#id1886" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use DateTimeImmutable when manipulating dates.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseDateTimeImmutable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-instanceof">
<span id="id1887"></span><h2>9.675. Use Instanceof<a class="headerlink" href="#use-instanceof" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> operator is a more precise alternative to <code class="docutils literal notranslate"><span class="pre">is_object()</span></code>. It is also faster.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">instanceof</a> checks for an variable to be of a class or its parents or the interfaces it implements.
Once <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> has been used, the actual attributes available (properties, constants, methods) are known, unlike with <code class="docutils literal notranslate"><span class="pre">is_object()</span></code>.</p>
<p>Last, <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> may be upgraded to Typehint, by moving it to the method signature.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>

    <span class="c1">// Don&#39;t use is_object</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$o</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// Classic argument check</span>
        <span class="k">return</span> <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// use instanceof</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$o</span> <span class="nx">instanceof</span> <span class="nx">myClass</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// Now, we know which methods are available</span>
            <span class="k">return</span> <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// Default behavior</span>
    <span class="p">}</span>

    <span class="c1">// use of typehinting</span>
    <span class="c1">// in case $o is not of the right type, exception is raised automatically</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">myClass</span> <span class="nv">$o</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$o</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">instanceof</span></code> and <code class="docutils literal notranslate"><span class="pre">is_object()</span></code> may not be always interchangeable. Consider using <a class="reference external" href="https://www.www.php.net/isset">isset()</a> on a known property for a simple check on objects. You may also consider <a class="reference external" href="https://www.php.net/is_string">is_string()</a>, <a class="reference external" href="https://www.php.net/is_integer">is_integer()</a> or <a class="reference external" href="https://www.php.net/is_scalar">is_scalar()</a>, in particular instead of <code class="docutils literal notranslate"><span class="pre">!`is_object()</span> <span class="pre">&lt;https://www.php.net/is_object&gt;`_</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> operator is also faster than the <code class="docutils literal notranslate"><span class="pre">is_object()</span></code> functioncall.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php#language.operators.type">Type Operators</a> and <a class="reference external" href="https://www.php.net/manual/en/function.is-object.php">is_object</a>.</p>
<div class="section" id="id1892">
<h3>9.675.1. Suggestions<a class="headerlink" href="#id1892" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use instanceof and remove is_object()</li>
<li>Create a high level interface to check a whole family of classes, instead of testing them individually</li>
<li>Use typehint when possible</li>
<li>Avoid mixing scalar types and objects in the same variable</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UseInstanceof</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#teampass-classes-useinstanceof"><span class="std std-ref">TeamPass</span></a>, <a class="reference internal" href="Cases.html#zencart-classes-useinstanceof"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-list-with-foreach">
<span id="id1893"></span><h2>9.676. Use List With Foreach<a class="headerlink" href="#use-list-with-foreach" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">Foreach()</a> structures accepts <a class="reference external" href="https://www.php.net/list">list()</a> as blind key. If the loop-value is an array with a fixed structure, it is possible to extract the values directly into variables with explicit names.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Short way to assign variables</span>
<span class="c1">// Works on PHP 7.1, where list() accepts keys.</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$names</span> <span class="k">as</span> <span class="k">list</span><span class="p">(</span><span class="s1">&#39;first&#39;</span> <span class="o">=&gt;</span> <span class="nv">$first</span><span class="p">,</span> <span class="s1">&#39;last&#39;</span> <span class="o">=&gt;</span> <span class="nv">$last</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$first</span><span class="p">,</span> <span class="nv">$last</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Short way to assign variables</span>
<span class="c1">// Works on all PHP versions with numerically indexed arrays.</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$names</span> <span class="k">as</span> <span class="k">list</span><span class="p">(</span><span class="nv">$first</span><span class="p">,</span> <span class="nv">$last</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$first</span><span class="p">,</span> <span class="nv">$last</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Long way to assign variables</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$names</span> <span class="k">as</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$first</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">[</span><span class="s1">&#39;first&#39;</span><span class="p">];</span>
    <span class="nv">$last</span> <span class="o">=</span> <span class="nv">$name</span><span class="p">[</span><span class="s1">&#39;last&#39;</span><span class="p">];</span>

    <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$first</span><span class="p">,</span> <span class="nv">$last</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.list.php">list</a> and <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a>.</p>
<div class="section" id="id1898">
<h3>9.676.1. Suggestions<a class="headerlink" href="#id1898" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the list keyword (or the short syntax), and simplify the array calls in the loop.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UseListWithForeach</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#mediawiki-structures-uselistwithforeach"><span class="std std-ref">MediaWiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-lower-case-for-parent-static-and-self">
<span id="id1899"></span><h2>9.677. Use Lower Case For Parent, Static And Self<a class="headerlink" href="#use-lower-case-for-parent-static-and-self" title="Permalink to this headline">¶</a></h2>
<p>The special <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> keywords needed to be lowercase to be usable. This was fixed in PHP 5.5; otherwise, they would yield a ‘PHP Fatal error:  Class ‘<a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">PARENT</a>’ not found’.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> are traditionally written in lowercase only. Mixed case and Upper case are both valid, though.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">const</span> <span class="no">aConstante</span> <span class="o">=</span> <span class="mi">233</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Wrong case, error with PHP 5.4.* and older</span>
        <span class="k">echo</span> <span class="nx">SELF</span><span class="o">::</span><span class="na">aConstante</span><span class="p">;</span>

        <span class="c1">// Always right.</span>
        <span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">aConstante</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Until PHP 5.5, non-lowercase version of those keywords are generating a bug.</p>
<div class="section" id="id1907">
<h3>9.677.1. Suggestions<a class="headerlink" href="#id1907" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Upgrade to PHP 5.6 or more recent</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/CaseForPSS</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-named-boolean-in-argument-definition">
<span id="id1908"></span><h2>9.678. Use Named Boolean In Argument Definition<a class="headerlink" href="#use-named-boolean-in-argument-definition" title="Permalink to this headline">¶</a></h2>
<p>Boolean in argument definitions is confusing.</p>
<p>It is recommended to use explicit constant names, instead. They are more readable. They also allow for easy replacement when the code evolve and has to replace those booleans by strings. This works even also with classes, and class constants.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">flipImage</span><span class="p">(</span><span class="nv">$im</span><span class="p">,</span> <span class="nv">$horizontal</span> <span class="o">=</span> <span class="nx">NO_HORIZONTAL_FLIP</span><span class="p">,</span> <span class="nv">$vertical</span> <span class="o">=</span> <span class="nx">NO_VERTICAL_FLIP</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// with constants</span>
<span class="k">const</span> <span class="no">HORIZONTAL_FLIP</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="k">const</span> <span class="no">NO_HORIZONTAL_FLIP</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="k">const</span> <span class="no">VERTICAL_FLIP</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<span class="k">const</span> <span class="no">NO_VERTICAL_FLIP</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

<span class="nx">rotateImage</span><span class="p">(</span><span class="nv">$im</span><span class="p">,</span> <span class="nx">HORIZONTAL_FLIP</span><span class="p">,</span> <span class="nx">NO_VERTICAL_FLIP</span><span class="p">);</span>


<span class="c1">// without constants</span>
<span class="k">function</span> <span class="nf">flipImage</span><span class="p">(</span><span class="nv">$im</span><span class="p">,</span> <span class="nv">$horizontal</span> <span class="o">=</span> <span class="k">false</span><span class="p">,</span> <span class="nv">$vertical</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="nx">rotateImage</span><span class="p">(</span><span class="nv">$im</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://martinfowler.com/bliki/FlagArgument.html">Flag Argument</a>, to avoid boolean altogether.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/AvoidBooleanArgument</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpmyadmin-functions-avoidbooleanargument"><span class="std std-ref">phpMyAdmin</span></a>, <a class="reference internal" href="Cases.html#cleverstyle-functions-avoidbooleanargument"><span class="std std-ref">Cleverstyle</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="use-nullable-type">
<span id="id1909"></span><h2>9.679. Use Nullable Type<a class="headerlink" href="#use-nullable-type" title="Permalink to this headline">¶</a></h2>
<p>The code uses nullable type, available since PHP 7.1.</p>
<p>Nullable Types are an option to type hint : they allow the passing value to be null, or another type.</p>
<p>According to the authors of the feature : ‘It is common in many programming languages including PHP to allow a variable to be of some type or null. This null often indicates an error or lack of something to return.’</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="o">?</span><span class="nx">string</span> <span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="o">?</span><span class="nx">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="o">.</span><span class="nx">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">Type declarations</a> and <a class="reference external" href="https://wiki.php.net/rfc/nullable_types">PHP RFC: Nullable Types</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseNullableType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.1 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="use-php-object-api">
<span id="id1911"></span><h2>9.680. Use PHP Object API<a class="headerlink" href="#use-php-object-api" title="Permalink to this headline">¶</a></h2>
<p>OOP API is the modern version of the PHP API.</p>
<p>When PHP offers the alternative between procedural and OOP api for the same features, it is recommended to use the OOP API.</p>
<p>Often, this least to more compact code, as methods are shorter, and there is no need to bring the resource around. Lots of new extensions are directly written in OOP form too.</p>
<p>OOP / procedural alternatives are available for <a class="reference external" href="https://www.php.net/manual/en/book.mysqli.php">mysqli</a>, <a class="reference external" href="https://www.php.net/manual/en/book.tidy.php">tidy</a>, <a class="reference external" href="https://www.php.net/manual/en/book.cairo.php">cairo</a>, <a class="reference external" href="https://www.php.net/manual/en/book.fileinfo.php">finfo</a>, and some others.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">/// OOP version</span>
<span class="nv">$mysqli</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mysqli</span><span class="p">(</span><span class="nx">localhost</span><span class="p">,</span> <span class="nx">my_user</span><span class="p">,</span> <span class="nx">my_password</span><span class="p">,</span> <span class="nx">world</span><span class="p">);</span>

<span class="cm">/* check connection */</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="na">connect_errno</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="nx">Connect</span> <span class="nx">failed</span><span class="o">:</span> <span class="o">%</span><span class="nx">s\n</span><span class="p">,</span> <span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="na">connect_error</span><span class="p">);</span>
    <span class="k">exit</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* Create table doesn&#39;t return a resultset */</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nx">CREATE</span> <span class="nx">TEMPORARY</span> <span class="nx">TABLE</span> <span class="nx">myCity</span> <span class="nx">LIKE</span> <span class="nx">City</span><span class="p">)</span> <span class="o">===</span> <span class="k">TRUE</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="nx">Table</span> <span class="nx">myCity</span> <span class="nx">successfully</span> <span class="nx">created</span><span class="o">.</span><span class="nx">\n</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Select queries return a resultset */</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nx">SELECT</span> <span class="nx">Name</span> <span class="nx">FROM</span> <span class="nx">City</span> <span class="nx">LIMIT</span> <span class="mi">10</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="nx">Select</span> <span class="nx">returned</span> <span class="o">%</span><span class="nx">d</span> <span class="nx">rows</span><span class="o">.</span><span class="nx">\n</span><span class="p">,</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">num_rows</span><span class="p">);</span>

    <span class="cm">/* free result set */</span>
    <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">/// Procedural version</span>
<span class="nv">$link</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="nx">localhost</span><span class="p">,</span> <span class="nx">my_user</span><span class="p">,</span> <span class="nx">my_password</span><span class="p">,</span> <span class="nx">world</span><span class="p">);</span>

<span class="cm">/* check connection */</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">mysqli_connect_errno</span><span class="p">())</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="nx">Connect</span> <span class="nx">failed</span><span class="o">:</span> <span class="o">%</span><span class="nx">s\n</span><span class="p">,</span> <span class="nx">mysqli_connect_error</span><span class="p">());</span>
    <span class="k">exit</span><span class="p">();</span>
<span class="p">}</span>

<span class="cm">/* Create table doesn&#39;t return a resultset */</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$link</span><span class="p">,</span> <span class="nx">CREATE</span> <span class="nx">TEMPORARY</span> <span class="nx">TABLE</span> <span class="nx">myCity</span> <span class="nx">LIKE</span> <span class="nx">City</span><span class="p">)</span> <span class="o">===</span> <span class="k">TRUE</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">printf</span><span class="p">(</span><span class="nx">Table</span> <span class="nx">myCity</span> <span class="nx">successfully</span> <span class="nx">created</span><span class="o">.</span><span class="nx">\n</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1912">
<h3>9.680.1. Suggestions<a class="headerlink" href="#id1912" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the object API</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseObjectApi</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/use-object-api.md">use-object-api</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-php-useobjectapi"><span class="std std-ref">WordPress</span></a>, <a class="reference internal" href="Cases.html#prestashop-php-useobjectapi"><span class="std std-ref">PrestaShop</span></a>, <a class="reference internal" href="Cases.html#sugarcrm-php-useobjectapi"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-php7-encapsed-strings">
<span id="id1913"></span><h2>9.681. Use PHP7 Encapsed Strings<a class="headerlink" href="#use-php7-encapsed-strings" title="Permalink to this headline">¶</a></h2>
<p>PHP 7 has optimized the handling of double-quoted strings. In particular, double-quoted strings are much less memory hungry than classic concatenations.</p>
<p>PHP allocates memory at the end of the double-quoted string, making only one call to the allocator. On the other hand, concatenations are allocated each time they include dynamic content, leading to higher memory consumption.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$bar</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">;</span>

<span class="cm">/* PHP 7 optimized this */</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s2">&quot;foo and </span><span class="si">$bar</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="cm">/* This is PHP 5 code (aka, don&#39;t use it) */</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;foo and &#39;</span> <span class="o">.</span> <span class="nv">$bar</span><span class="p">;</span>

<span class="c1">// Constants can&#39;t be used with double quotes</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;foo and &#39;</span> <span class="o">.</span> <span class="no">__DIR__</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">foo</span> <span class="k">and</span> <span class="no">__DIR__</span><span class="p">;</span> <span class="c1">// __DIR__ is not interpolated</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Concatenations are still needed with constants, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> constants, magic constants, functions, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> properties or <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods.</p>
<p>See also <a class="reference external" href="https://blog.blackfire.io/php-7-performance-improvements-encapsed-strings-optimization.html">PHP 7 performance improvements (3/5): Encapsed strings optimization</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/PHP7EncapsedStrings</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="use-pathinfo">
<span id="id1918"></span><h2>9.682. Use Pathinfo<a class="headerlink" href="#use-pathinfo" title="Permalink to this headline">¶</a></h2>
<p>Use <a class="reference external" href="https://www.php.net/pathinfo">pathinfo()</a> function instead of string manipulations.</p>
<p><a class="reference external" href="https://www.php.net/pathinfo">pathinfo()</a> is more efficient and readable and string functions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$filename</span> <span class="o">=</span> <span class="s1">&#39;/path/to/file.php&#39;</span><span class="p">;</span>

<span class="c1">// With pathinfo();</span>
<span class="nv">$details</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$filename</span><span class="p">);</span>
<span class="k">print</span> <span class="nv">$details</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">];</span>  <span class="c1">// also capture php</span>

<span class="c1">// With string functions (other solutions possible)</span>
<span class="nv">$ext</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$filename</span><span class="p">,</span> <span class="o">-</span> <span class="nb">strpos</span><span class="p">(</span><span class="nx">strreverse</span><span class="p">(</span><span class="nv">$filename</span><span class="p">),</span> <span class="s1">&#39;.&#39;</span><span class="p">));</span> <span class="c1">// Capture php</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When the path contains UTF-8 characters, <a class="reference external" href="https://www.php.net/pathinfo">pathinfo()</a> may strip them. There, string functions are necessary.</p>
<div class="section" id="id1922">
<h3>9.682.1. Suggestions<a class="headerlink" href="#id1922" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use pathinfo() and its second argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UsePathinfo</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#suitecrm-php-usepathinfo"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-positive-condition">
<span id="id1923"></span><h2>9.683. Use Positive Condition<a class="headerlink" href="#use-positive-condition" title="Permalink to this headline">¶</a></h2>
<p>Whenever possible, use a positive condition.</p>
<p>Positive conditions are easier to understand, and lead to less understanding problems.
Negative conditions are not reported when else is not present.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is a positive condition</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// This is a negative condition</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// No need to force $a == &#39;b&#39; with empty else</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">!=</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomethingElse</span><span class="p">();</span>
<span class="p">}</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1924">
<h3>9.683.1. Suggestions<a class="headerlink" href="#id1924" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Invert the code in the if branches, and the condition</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UsePositiveCondition</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#spip-structures-usepositivecondition"><span class="std std-ref">SPIP</span></a>, <a class="reference internal" href="Cases.html#expressionengine-structures-usepositivecondition"><span class="std std-ref">ExpressionEngine</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-system-tmp">
<span id="id1925"></span><h2>9.684. Use System Tmp<a class="headerlink" href="#use-system-tmp" title="Permalink to this headline">¶</a></h2>
<p>It is recommended to avoid hardcoding the temporary file. It is better to rely on the system’s temporary folder, which is accessible with <a class="reference external" href="https://www.php.net/sys_get_temp_dir">sys_get_temp_dir()</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Where the tmp is :</span>
<span class="nb">file_put_contents</span><span class="p">(</span><span class="nb">sys_get_temp_dir</span><span class="p">()</span><span class="o">.</span><span class="s1">&#39;/tempFile.txt&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>


<span class="c1">// Avoid hard-coding tmp folder :</span>
<span class="c1">// On Linux-like systems</span>
<span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">&#39;/tmp/tempFile.txt&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

<span class="c1">// On Windows systems</span>
<span class="nb">file_put_contents</span><span class="p">(</span><span class="s1">&#39;C:\WINDOWS\TEMP\tempFile.txt&#39;</span><span class="p">,</span> <span class="nv">$content</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.the-art-of-web.com/php/where-is-tmp/">PHP: When is /tmp not /tmp?</a>.</p>
<div class="section" id="id1927">
<h3>9.684.1. Suggestions<a class="headerlink" href="#id1927" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do not hardcode the temporary file, use the system’s</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UseSystemTmp</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-the-blind-var">
<span id="id1928"></span><h2>9.685. Use The Blind Var<a class="headerlink" href="#use-the-blind-var" title="Permalink to this headline">¶</a></h2>
<p>When in a loop, it is faster to rely on the blind var, rather than the original source.</p>
<p>When the key is referenced in the foreach loop, it is faster to use the available container to access a value for reading.</p>
<p>Note that it is also faster to use the value with a reference to handle the writings.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Reaching $source[$key] via $value is faster</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$source</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$coordinates</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;x&#39;</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                         <span class="s1">&#39;y&#39;</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>

<span class="c1">// Reaching $source[$key] via $source is slow</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$source</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$coordinates</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;x&#39;</span> <span class="o">=&gt;</span> <span class="nv">$source</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                         <span class="s1">&#39;y&#39;</span> <span class="o">=&gt;</span> <span class="nv">$source</span><span class="p">[</span><span class="nv">$key</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1929">
<h3>9.685.1. Suggestions<a class="headerlink" href="#id1929" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the blind var</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/UseBlindVar</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-url-query-functions">
<span id="id1930"></span><h2>9.686. Use Url Query Functions<a class="headerlink" href="#use-url-query-functions" title="Permalink to this headline">¶</a></h2>
<p>PHP features several functions dedicated to processing URL’s query string.</p>
<ul class="simple">
<li><a class="reference external" href="https://www.php.net/parse_str">parse_str()</a></li>
<li><a class="reference external" href="https://www.php.net/parse_url">parse_url()</a></li>
<li><a class="reference external" href="https://www.php.net/http_build_query">http_build_query()</a></li>
</ul>
<p>Those functions include extra checks : for example, <a class="reference external" href="https://www.php.net/http_build_query">http_build_query()</a> adds <a class="reference external" href="https://www.php.net/urlencode">urlencode()</a> call on the values, and allow for choosing the separator and the Query string format.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="s1">&#39;baz&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boom&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cow&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;milk&#39;</span><span class="p">,</span>
    <span class="s1">&#39;php&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;hypertext processor&#39;</span>
<span class="p">);</span>

<span class="c1">// safe and efficient way to build a query string</span>
<span class="k">echo</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">)</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="c1">// slow way to produce a query string</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$data</span> <span class="k">as</span> <span class="nv">$name</span> <span class="o">=&gt;</span> <span class="o">&amp;</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$name</span><span class="o">.</span><span class="s1">&#39;=&#39;</span><span class="o">.</span><span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">echo</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1935">
<h3>9.686.1. Suggestions<a class="headerlink" href="#id1935" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UseUrlQueryFunctions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-with-fully-qualified-name">
<span id="id1936"></span><h2>9.687. Use With Fully Qualified Name<a class="headerlink" href="#use-with-fully-qualified-name" title="Permalink to this headline">¶</a></h2>
<p>Use statement doesn’t require a fully qualified name.</p>
<p>PHP manual recommends not to use fully qualified name (starting with ) when using the ‘use’ statement : they are “the leading backslash is unnecessary and not recommended, as import names must be fully qualified, and are not processed relative to the current namespace”.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Recommended way to write a use statement.</span>
<span class="k">use</span>  <span class="nx">A\B\C\D</span> <span class="k">as</span> <span class="nx">E</span><span class="p">;</span>

<span class="c1">// No need to use the initial \</span>
<span class="k">use</span> <span class="nx">\A\B\C\D</span> <span class="k">as</span> <span class="nx">F</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1937">
<h3>9.687.1. Suggestions<a class="headerlink" href="#id1937" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the initial in use expressions.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/UseWithFullyQualifiedNS</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-array-slice">
<span id="id1938"></span><h2>9.688. Use array_slice()<a class="headerlink" href="#use-array-slice" title="Permalink to this headline">¶</a></h2>
<p>Array_slice is de equivalent of <a class="reference external" href="https://www.php.net/substr">substr()</a> for arrays.</p>
<p><a class="reference external" href="https://www.php.net/array_splice">array_splice()</a> is also possible, to remove a portion of array inside the array, not at the ends. This has no equivalent for strings.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">);</span>

<span class="c1">// Extract the 5 first elements</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">));</span>

<span class="c1">// Extract the 4 last elements</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nb">array_slice</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">));</span>

<span class="c1">// Extract the 2 central elements : 4 and 5</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nb">array_splice</span><span class="p">(</span><span class="nv">$array</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>

<span class="c1">// slow way to remove the last elementst of an array</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/array_slice">array_slice</a> and <a class="reference external" href="http://www.php.net/array_splice">array_splice</a>.</p>
<div class="section" id="id1942">
<h3>9.688.1. Suggestions<a class="headerlink" href="#id1942" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/UseArraySlice</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-const">
<span id="id1943"></span><h2>9.689. Use const<a class="headerlink" href="#use-const" title="Permalink to this headline">¶</a></h2>
<p>The const keyword may be used to define constant, just like the <a class="reference external" href="https://www.php.net/define">define()</a> function.</p>
<p>When defining a constant, it is recommended to use ‘const’ when the features of the constant are not dynamical (name or value are known at compile time).
This way, constant will be defined at compile time, and not at execution time.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="c1">//Do</span>
  <span class="k">const</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="c1">// Don&#39;t</span>
  <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.php.net/define">define()</a> function is useful when the constant is not known at compile time, or when case sensitivity is necessary.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="c1">// Read $a in database or config file</span>
  <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>

  <span class="c1">// Read $a in database or config file</span>
  <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
  <span class="k">echo</span> <span class="nx">b</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.constants.syntax.php">Syntax</a>.</p>
<div class="section" id="id1947">
<h3>9.689.1. Suggestions<a class="headerlink" href="#id1947" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use const instead of define()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Constants/ConstRecommended</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpmyadmin-constants-constrecommended"><span class="std std-ref">phpMyAdmin</span></a>, <a class="reference internal" href="Cases.html#piwigo-constants-constrecommended"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-get-debug-type">
<span id="id1948"></span><h2>9.690. Use get_debug_type()<a class="headerlink" href="#use-get-debug-type" title="Permalink to this headline">¶</a></h2>
<p>get_debug_type() returns the given type of a variable. It was introduced in PHP 8.0.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="c1">// From the RFC</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Expected &#39;</span> <span class="o">.</span> <span class="nx">Foo</span><span class="o">::</span><span class="na">class</span> <span class="o">.</span> <span class="s1">&#39; got &#39;</span> <span class="o">.</span> <span class="p">(</span><span class="nb">is_object</span><span class="p">(</span><span class="nv">$bar</span><span class="p">)</span> <span class="o">?</span> <span class="nb">get_class</span><span class="p">(</span><span class="nv">$bar</span><span class="p">)</span> <span class="o">:</span> <span class="nb">gettype</span><span class="p">(</span><span class="nv">$bar</span><span class="p">)));</span>

  <span class="c1">// Becomes</span>
  <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Expected &#39;</span> <span class="o">.</span> <span class="nx">Foo</span><span class="o">::</span><span class="na">class</span> <span class="o">.</span> <span class="s1">&#39; got &#39;</span> <span class="o">.</span> <span class="nx">get_debug_type</span><span class="p">(</span><span class="nv">$bar</span><span class="p">));</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/get_debug_type">PHP RFC: get_debug_type</a>.</p>
<div class="section" id="id1949">
<h3>9.690.1. Suggestions<a class="headerlink" href="#id1949" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the ternary with a call to get_debug_type()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseGetDebugType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-is-countable">
<span id="id1950"></span><h2>9.691. Use is_countable<a class="headerlink" href="#use-is-countable" title="Permalink to this headline">¶</a></h2>
<p>is_countable() checks if a variables holds a value that can be counted. It is recommended to use it before calling <a class="reference external" href="https://www.php.net/count">count()</a>.</p>
<p>is_countable() accepts arrays and object whose class implements countable.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">is_countable</span><span class="p">(</span><span class="nv">$arg</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// $arg cannot be passed to count()</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$arg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="k">and</span> <span class="o">!</span><span class="nv">$x</span> <span class="nx">instanceof</span> <span class="nx">\Countable</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// $arg cannot be passed to count()</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$arg</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/is-countable">PHP RFC: is_countable</a>.</p>
<div class="section" id="id1952">
<h3>9.691.1. Suggestions<a class="headerlink" href="#id1952" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use is_countable()</li>
<li>Create a compatibility function that replaces is_countable() until the code is ready for PHP 7.3</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/CouldUseIsCountable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.3 and more recent</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-json-decode-options">
<span id="id1953"></span><h2>9.692. Use json_decode() Options<a class="headerlink" href="#use-json-decode-options" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/json_decode">json_decode()</a> returns objects by default, unless the second argument is set to <code class="docutils literal notranslate"><span class="pre">TRUE</span></code> or <code class="docutils literal notranslate"><span class="pre">JSON_OBJECT_AS_ARRAY</span></code>. Then, it returns arrays.</p>
<p>Avoid casting the returned value from <a class="reference external" href="https://www.php.net/json_decode">json_decode()</a>, and use the second argument to directly set the correct type.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$json</span> <span class="o">=</span> <span class="s1">&#39;{a:b}&#39;</span><span class="p">;</span>

<span class="c1">// Good syntax</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">,</span> <span class="nx">JSON_OBJECT_AS_ARRAY</span><span class="p">);</span>

<span class="c1">// GoToo much work</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="p">(</span><span class="k">array</span><span class="p">)</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$json</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that all objects will be turned into arrays, recursively. If you’re expecting an array of objects, don’t use the <code class="docutils literal notranslate"><span class="pre">JSON_OBJECT_AS_ARRAY</span></code> constant, and change your JSON code.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">JSON_OBJECT_AS_ARRAY</span></code> is the only constant : there is no defined constant to explicitly ask for an object as returned value.</p>
<p>See also <a class="reference external" href="https://www.php.net/json_decode">json_decode</a>.</p>
<div class="section" id="id1956">
<h3>9.692.1. Suggestions<a class="headerlink" href="#id1956" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the correct second argument of json_decode() : JSON_OBJECT_AS_ARRAY</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/JsonWithOption</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-password-hash">
<span id="id1957"></span><h2>9.693. Use password_hash()<a class="headerlink" href="#use-password-hash" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/password_hash">password_hash()</a> and password_check() are a better choice to replace the use of <a class="reference external" href="https://www.php.net/crypt">crypt()</a> to check password.</p>
<p>PHP 5.5 introduced these functions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$password</span> <span class="o">=</span> <span class="s1">&#39;rasmuslerdorf&#39;</span><span class="p">;</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="s1">&#39;$2y$10$YCFsG6elYca568hBi2pZ0.3LDL5wjgxct1N8w/oLR/jfHsiQwCqTS&#39;</span><span class="p">;</span>

<span class="c1">// The cost parameter can change over time as hardware improves</span>
<span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;cost&#39;</span> <span class="o">=&gt;</span> <span class="mi">11</span><span class="p">);</span>

<span class="c1">// Verify stored hash against plain-text password</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">password_verify</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$hash</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Check if a newer hashing algorithm is available</span>
    <span class="c1">// or the cost has changed</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">password_needs_rehash</span><span class="p">(</span><span class="nv">$hash</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// If so, create a new hash, and replace the old one</span>
        <span class="nv">$newHash</span> <span class="o">=</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nx">PASSWORD_DEFAULT</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Log user in</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/book.password.php">Password hashing</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Password55</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.5 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="use-pathinfo-arguments">
<span id="id1959"></span><h2>9.694. Use pathinfo() Arguments<a class="headerlink" href="#use-pathinfo-arguments" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/pathinfo">pathinfo()</a> has a second argument to select only useful data.</p>
<p>It is twice faster to get only one element from <a class="reference external" href="https://www.php.net/pathinfo">pathinfo()</a> than get the four of them, and use only one.</p>
<p>This analysis reports <a class="reference external" href="https://www.php.net/pathinfo">pathinfo()</a> usage, without second argument, where only one or two indices are used, after the call.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This could use only PATHINFO_BASENAME</span>
<span class="k">function</span> <span class="nf">foo_db</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file2</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;basename&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// This could be 2 calls, with PATHINFO_BASENAME and PATHINFO_DIRNAME.</span>
<span class="k">function</span> <span class="nf">foo_de</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file3</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;dirname&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;basename&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// This is OK : 3 calls to pathinfo() is slower than array access.</span>
<span class="k">function</span> <span class="nf">foo_deb</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="nb">pathinfo</span><span class="p">(</span><span class="nv">$file4</span><span class="p">);</span>
    <span class="k">return</span>  <span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;dirname&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="nv">$a</span><span class="p">[</span><span class="s1">&#39;extension&#39;</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Depending on the situation, the functions <a class="reference external" href="https://www.php.net/dirname">dirname()</a> and <a class="reference external" href="https://www.php.net/basename">basename()</a> may also be used. They are even faster, when only fetching those data.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.list.php">list</a>.</p>
<div class="section" id="id1966">
<h3>9.694.1. Suggestions<a class="headerlink" href="#id1966" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use PHP native function pathinfo() and its arguments</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UsePathinfoArgs</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zend-config-php-usepathinfoargs"><span class="std std-ref">Zend-Config</span></a>, <a class="reference internal" href="Cases.html#thinkphp-php-usepathinfoargs"><span class="std std-ref">ThinkPHP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-random-int">
<span id="id1967"></span><h2>9.695. Use random_int()<a class="headerlink" href="#use-random-int" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/rand">rand()</a> and <a class="reference external" href="https://www.php.net/mt_rand">mt_rand()</a> should be replaced with <a class="reference external" href="https://www.php.net/random_int">random_int()</a>.</p>
<p>At worse, <a class="reference external" href="https://www.php.net/rand">rand()</a> should be replaced with <a class="reference external" href="https://www.php.net/mt_rand">mt_rand()</a>, which is a drop-in replacement and <a class="reference external" href="https://www.php.net/srand">srand()</a> by <a class="reference external" href="https://www.php.net/mt_srand">mt_srand()</a>.</p>
<p><a class="reference external" href="https://www.php.net/random_int">random_int()</a> replaces <a class="reference external" href="https://www.php.net/rand">rand()</a>, and has no seeding function like <a class="reference external" href="https://www.php.net/srand">srand()</a>.</p>
<p>Other sources of entropy that should be replaced by <a class="reference external" href="https://www.php.net/random_int">random_int()</a> : <a class="reference external" href="https://www.php.net/microtime">microtime()</a>, <a class="reference external" href="https://www.php.net/uniqid">uniqid()</a>, <a class="reference external" href="https://www.php.net/time">time()</a>. Those a often combined with hashing functions and mixed with other sources of entropy, such as a salt.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Avoid using this</span>
<span class="nv">$random</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// Drop-in replacement</span>
<span class="nv">$random</span> <span class="o">=</span> <span class="nb">mt_rand</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="c1">// Even better but different :</span>
<span class="c1">// valid with PHP 7.0+</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$random</span> <span class="o">=</span> <span class="nx">random_int</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// process case of not enoug random values</span>
<span class="p">}</span>

<span class="c1">// This is also a source of entropy, based on srand()</span>
<span class="c1">// random_int() is a drop-in replacement here</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nx">sha256</span><span class="p">(</span><span class="nb">uniqid</span><span class="p">());</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Since PHP 7, <a class="reference external" href="https://www.php.net/random_int">random_int()</a> along with <a class="reference external" href="https://www.php.net/random_bytes">random_bytes()</a>, provides cryptographically secure pseudo-random bytes, which are good to be used
when security is involved. <a class="reference external" href="https://www.php.net/openssl_random_pseudo_bytes">openssl_random_pseudo_bytes()</a> may be used when the <code class="docutils literal notranslate"><span class="pre">OpenSSL</span></code> extension is available.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/book.csprng.php">CSPRNG</a> and <a class="reference external" href="https://www.php.net/manual/en/book.openssl.php">OpenSSL</a>.</p>
<div class="section" id="id1978">
<h3>9.695.1. Suggestions<a class="headerlink" href="#id1978" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use random_bytes() and randon_int(). At least, use them as a base for random data, and then add extra prefix and suffix, and a hash call on top.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/BetterRand</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thelia-php-betterrand"><span class="std std-ref">Thelia</span></a>, <a class="reference internal" href="Cases.html#fuelcms-php-betterrand"><span class="std std-ref">FuelCMS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-session-start-options">
<span id="id1979"></span><h2>9.696. Use session_start() Options<a class="headerlink" href="#use-session-start-options" title="Permalink to this headline">¶</a></h2>
<p>It is possible to set the session’s option at <a class="reference external" href="https://www.php.net/session_start">session_start()</a> call, skipping the usage of session_option().</p>
<p>This way, session’s options are set in one call, saving several hits.</p>
<p>This is available since PHP 7.0. It is recommended to set those values in the <code class="docutils literal notranslate"><span class="pre">php.ini</span></code> file, whenever possible.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 7.0</span>
<span class="nb">session_start</span><span class="p">([</span><span class="s1">&#39;session.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mySession&#39;</span><span class="p">,</span>
               <span class="s1">&#39;session.cookie_httponly&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
               <span class="s1">&#39;session.gc_maxlifetime&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>

<span class="c1">// PHP 5.6- old way</span>
<span class="nb">ini_set</span> <span class="p">(</span><span class="s1">&#39;session.name&#39;</span><span class="p">,</span> <span class="s1">&#39;mySession&#39;</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="nx">session</span><span class="o">.</span><span class="nx">cookie_httponly</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;session.gc_maxlifetime&#39;</span><span class="p">,</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>
<span class="nb">session_start</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1980">
<h3>9.696.1. Suggestions<a class="headerlink" href="#id1980" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use session_start() with array arguments</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseSessionStartOptions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-php-usesessionstartoptions"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="use-str-contains">
<span id="id1981"></span><h2>9.697. Use str_contains()<a class="headerlink" href="#use-str-contains" title="Permalink to this headline">¶</a></h2>
<p>str_contains() checks if a string is within another one. It replaces a call to <a class="reference external" href="https://www.php.net/strpos">strpos()</a> with a comparison.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">str_contains</span><span class="p">(</span><span class="nx">abc</span><span class="p">,</span> <span class="nx">a</span><span class="p">))</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>

<span class="c1">// strpos is used only for detection.</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nx">abc</span><span class="p">,</span> <span class="nx">a</span><span class="p">)</span> <span class="o">!==</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span> <span class="p">}</span>

<span class="c1">// strpos returns a position,</span>
<span class="nv">$pos</span> <span class="o">=</span> <span class="nb">strpos</span><span class="p">(</span><span class="nx">abca</span><span class="p">,</span> <span class="nx">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$pos</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span> <span class="nx">doSomething</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that this function is case sensitive : it cannot replace <a class="reference external" href="https://www.php.net/stripos">stripos()</a>.</p>
<p>Note that this function is single-byte only : it cannot replace <a class="reference external" href="https://www.php.net/mb_strpos">mb_strpos()</a>.</p>
<p>This analysis omits calls to <a class="reference external" href="https://www.php.net/strpos">strpos()</a> that are saved to a variable. <a class="reference external" href="https://www.php.net/strpos">strpos()</a> is actually returning the position of the found string in the haystack, which may be reused later.</p>
<p>See also <a class="reference external" href="https://wiki.php.net/rfc/str_contains">PHP RFC: str_contains</a>.</p>
<div class="section" id="id1987">
<h3>9.697.1. Suggestions<a class="headerlink" href="#id1987" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Switch to str_contains()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UseStrContains</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="used-once-property">
<span id="id1988"></span><h2>9.698. Used Once Property<a class="headerlink" href="#used-once-property" title="Permalink to this headline">¶</a></h2>
<p>Property used once in their defining class.</p>
<p>Properties used in one method only may be used several times, and read only. This may be a class constant. Such properties are meant to be overwritten by an extending class, and that’s possible with class constants.</p>
<p>Setting properties with default values is a good way to avoid littering the code with literal values, and provide a single point of update (by extension, or by hardcoding) for all those situations. A constant is definitely better suited for this task.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$defaultCols</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">;</span>
    <span class="nx">cont</span> <span class="nx">DEFAULT_COLUMNS</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="p">;</span>

    <span class="c1">// $this-&gt;defaultCols holds a default value. Should be a constant.</span>
    <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span> <span class="nv">$cols</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This is necessary to activate usage of default values</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">empty</span><span class="p">(</span><span class="nv">$cols</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$cols</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">defaultCols</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;SELECT &#39;</span><span class="o">.</span><span class="nv">$cols</span><span class="o">.</span><span class="s1">&#39; FROM &#39;</span><span class="o">.</span><span class="nv">$table</span><span class="p">);</span>
        <span class="c1">// ....</span>
    <span class="p">}</span>

    <span class="c1">// Upgraded version of bar, with default values</span>
    <span class="k">function</span> <span class="nf">bar2</span><span class="p">(</span><span class="nv">$table</span><span class="p">,</span> <span class="nv">$cols</span> <span class="o">=</span> <span class="nx">self</span><span class="o">::</span><span class="na">DEFAULT_COLUMNS</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$res</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="s1">&#39;SELECT &#39;</span><span class="o">.</span><span class="nv">$cols</span><span class="o">.</span><span class="s1">&#39; FROM &#39;</span><span class="o">.</span><span class="nv">$table</span><span class="p">);</span>
        <span class="c1">// .....</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1989">
<h3>9.698.1. Suggestions<a class="headerlink" href="#id1989" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the property, as it is probably not unused</li>
<li>Add another usage of the property where it is useful</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UsedOnceProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="used-once-variables">
<span id="id1990"></span><h2>9.699. Used Once Variables<a class="headerlink" href="#used-once-variables" title="Permalink to this headline">¶</a></h2>
<p>This is the list of used once variables.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The variables below never appear again in the code</span>
<span class="nv">$writtenOnce</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nx">foo</span><span class="p">(</span><span class="nv">$readOnce</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Such variables are useless. Variables must be used at least twice : once for writing, once for reading, at least. It is recommended to remove them.</p>
<p>In special situations, variables may be used once :</p>
<ul class="simple">
<li>PHP predefined variables, as they are already initialized. They are omitted in this analyze.</li>
<li>Interface function’s arguments, since the function has no body; They are omitted in this analyze.</li>
<li>Dynamically created variables ($$x, ${<a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">$this</a>-&gt;y} or also using extract), as they are runtime values and can’t be determined at <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> code time. They are reported for manual review.</li>
<li>Dynamically included files will provide in-scope extra variables.</li>
</ul>
<p>The current analyzer count variables at the application level, and not at a method scope level.</p>
<div class="section" id="id1993">
<h3>9.699.1. Suggestions<a class="headerlink" href="#id1993" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the variable</li>
<li>Fix the name of variable</li>
<li>Use the variable a second time, at least</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/VariableUsedOnce</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#shopware-variables-variableusedonce"><span class="std std-ref">shopware</span></a>, <a class="reference internal" href="Cases.html#vanilla-variables-variableusedonce"><span class="std std-ref">Vanilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="used-once-variables-in-scope">
<span id="id1994"></span><h2>9.700. Used Once Variables (In Scope)<a class="headerlink" href="#used-once-variables-in-scope" title="Permalink to this headline">¶</a></h2>
<p>This is the list of used once variables, scope by scope. Those variables are used once in a function, a method, a class or a namespace. In any case, this means the variable is read or written, while it should be used at least twice.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// The variables below never appear twice, inside foo()</span>
    <span class="nv">$writtenOnce</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="nx">foo</span><span class="p">(</span><span class="nv">$readOnce</span><span class="p">);</span>
    <span class="c1">// They do appear again in other functions, or in global space.</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$writtenOnce</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="nx">foo</span><span class="p">(</span><span class="nv">$readOnce</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1995">
<h3>9.700.1. Suggestions<a class="headerlink" href="#id1995" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the variable</li>
<li>Fix the name of variable</li>
<li>Use the variable a second time in the current scope, at least</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/VariableUsedOnceByContext</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#shopware-variables-variableusedoncebycontext"><span class="std std-ref">shopware</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-abstract-class">
<span id="id1996"></span><h2>9.701. Useless Abstract Class<a class="headerlink" href="#useless-abstract-class" title="Permalink to this headline">¶</a></h2>
<p>Those classes are marked ‘abstract’ and they are never extended. This way, they won’t be instantiated nor used.</p>
<p>Abstract classes that have only <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods are omitted here : one usage of such classes are Utilities classes, which only offer <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> methods.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Never extended class : this is useless</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">foo</span> <span class="p">{}</span>

<span class="c1">// Extended class</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">bar</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">barbar</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">bar2</span> <span class="k">extends</span> <span class="nx">bar</span> <span class="p">{}</span>

<span class="c1">// Utility class : omitted here</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">bar</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">barbar</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id1999">
<h3>9.701.1. Suggestions<a class="headerlink" href="#id1999" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the abstract keyword</li>
<li>Actually add an abstract keyword</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UselessAbstract</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-alias">
<span id="id2000"></span><h2>9.702. Useless Alias<a class="headerlink" href="#useless-alias" title="Permalink to this headline">¶</a></h2>
<p>It is not possible to declare an alias of a method with the same name.</p>
<p>PHP reports that <code class="docutils literal notranslate"><span class="pre">Trait</span> <span class="pre">method</span> <span class="pre">f</span> <span class="pre">has</span> <span class="pre">not</span> <span class="pre">been</span> <span class="pre">applied,</span> <span class="pre">because</span> <span class="pre">there</span> <span class="pre">are</span> <span class="pre">collisions</span> <span class="pre">with</span> <span class="pre">other</span> <span class="pre">trait</span> <span class="pre">methods</span> <span class="pre">on</span> <span class="pre">x</span></code>, which is a way to say that the alias will be in conflict with the method name.</p>
<p>When the method is the only one bearing a name, and being imported, there is no need to alias it. When the method is imported in several traits, the keyword <code class="docutils literal notranslate"><span class="pre">insteadof</span></code> is available to solve the conflict.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">trait</span> <span class="nx">t</span> <span class="p">{</span>
    <span class="k">function</span> <span class="nf">h</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">use</span> <span class="nx">t</span> <span class="p">{</span>
        <span class="c1">// This is possible</span>
        <span class="nx">t</span><span class="o">::</span><span class="na">f</span> <span class="k">as</span> <span class="nx">g</span><span class="p">;</span>

        <span class="c1">// This is not possible, as the alias is in conflict with itself</span>
        <span class="c1">// alias are case insensitive</span>
        <span class="nx">t</span><span class="o">::</span><span class="na">f</span> <span class="k">as</span> <span class="nx">f</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This code lints but doesn’t execute.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.traits.php#language.oop5.traits.conflict">Conflict resolution</a>.</p>
<div class="section" id="id2001">
<h3>9.702.1. Suggestions<a class="headerlink" href="#id2001" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the alias</li>
<li>Fix the alias or the origin method name</li>
<li>Switch to insteadof, and avoid as keyword</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Traits/UselessAlias</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-brackets">
<span id="id2002"></span><h2>9.703. Useless Brackets<a class="headerlink" href="#useless-brackets" title="Permalink to this headline">¶</a></h2>
<p>Standalone brackets have no use. Brackets are used to delimit a block of code, and are used by control statements. They may also be used to protect variables in strings.</p>
<p>Standalone brackets may be a left over of an old instruction, or a misunderstanding of the alternative syntax.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The following brackets are useless : they are a leftover from an older instruction</span>
<span class="c1">// if (DEBUG)</span>
<span class="p">{</span>
    <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Here, the extra brackets are useless</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$a</span><span class="o">++</span><span class="p">)</span> <span class="o">:</span> <span class="p">{</span>
    <span class="nv">$b</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span> <span class="k">endfor</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2003">
<h3>9.703.1. Suggestions<a class="headerlink" href="#id2003" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the brackets</li>
<li>Restore the flow-control operation that was there and removed</li>
<li>Move the block into a method or function, and call it</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UselessBrackets</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#churchcrm-structures-uselessbrackets"><span class="std std-ref">ChurchCRM</span></a>, <a class="reference internal" href="Cases.html#piwigo-structures-uselessbrackets"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-catch">
<span id="id2004"></span><h2>9.704. Useless Catch<a class="headerlink" href="#useless-catch" title="Permalink to this headline">¶</a></h2>
<p>Catch clause should handle the exception with some work.</p>
<p>Among the task of a catch clause : log the exception, clean any mess that was introduced, fail graciously.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$b</span> <span class="o">=</span> <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// No log of the exception : no one knows it happened.</span>

        <span class="c1">// return immediately ?</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$b</span><span class="o">-&gt;</span><span class="na">complete</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.exceptions.php">Exceptions</a> and <a class="reference external" href="https://www.moxio.com/blog/34/best-practices-for-php-exception-handling">Best practices for PHP exception handling</a>.</p>
<div class="section" id="id2006">
<h3>9.704.1. Suggestions<a class="headerlink" href="#id2006" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a log call to the catch block</li>
<li>Handle correctly the exception</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Exceptions/UselessCatch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zurmo-exceptions-uselesscatch"><span class="std std-ref">Zurmo</span></a>, <a class="reference internal" href="Cases.html#prestashop-exceptions-uselesscatch"><span class="std std-ref">PrestaShop</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-check">
<span id="id2007"></span><h2>9.705. Useless Check<a class="headerlink" href="#useless-check" title="Permalink to this headline">¶</a></h2>
<p>There is no need to check the size of an array content before using foreach. <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">Foreach()</a> applies a test on the source, and skips the loop if no element is found.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Checking for type is good.</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$array</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Foreach on empty arrays doesn&#39;t start. Checking is useless</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$array</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis checks for conditions with <a class="reference external" href="https://www.php.net/sizeof">sizeof()</a> and <a class="reference external" href="https://www.php.net/count">count()</a>. Conditions with <a class="reference external" href="https://www.www.php.net/isset">isset()</a> and <a class="reference external" href="https://www.php.net/empty">empty()</a> are omitted : they also check for the variable existence, and thus, offer extra coverage.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach</a>.</p>
<div class="section" id="id2013">
<h3>9.705.1. Suggestions<a class="headerlink" href="#id2013" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the condition and the check</li>
<li>Turn the condition into isset(), empty() and is_array()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UselessCheck</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#magento-structures-uselesscheck"><span class="std std-ref">Magento</span></a>, <a class="reference internal" href="Cases.html#phinx-structures-uselesscheck"><span class="std std-ref">Phinx</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-constructor">
<span id="id2014"></span><h2>9.706. Useless Constructor<a class="headerlink" href="#useless-constructor" title="Permalink to this headline">¶</a></h2>
<p>Class constructor that have empty bodies are useless. They may be removed.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Do nothing</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Y</span> <span class="k">extends</span> <span class="nx">X</span> <span class="p">{</span>
    <span class="c1">// Useful constructor, as it prevents usage of the parent</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Do nothing</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UselessConstructor</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="useless-default-argument">
<span id="id2015"></span><h2>9.707. Useless Default Argument<a class="headerlink" href="#useless-default-argument" title="Permalink to this headline">¶</a></h2>
<p>One of the argument has a default value, and this default value is never used. Every time the method is called, the argument is provided explicitly, rendering the default value actually useless.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">goo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something here</span>
<span class="p">}</span>

<span class="c1">// foo is called 3 times, and sometimes, $b is not provided.</span>
<span class="nx">goo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">goo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">goo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>


<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something here</span>
<span class="p">}</span>

<span class="c1">// foo is called 3 times, and $b is always provided.</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2016">
<h3>9.707.1. Suggestions<a class="headerlink" href="#id2016" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the default value</li>
<li>Remove the explicit argument in the function call, when it is equal to the default value</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="67%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UselessDefault</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-final">
<span id="id2017"></span><h2>9.708. Useless Final<a class="headerlink" href="#useless-final" title="Permalink to this headline">¶</a></h2>
<p>When a class is declared final, all of its methods are also final by default.</p>
<p>There is no need to declare them individually final.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="k">final</span> <span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
        <span class="c1">// Useless final, as the whole class is final</span>
        <span class="k">final</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">class</span> <span class="nc">bar</span> <span class="p">{</span>
        <span class="c1">// Useful final, as the whole class is not final</span>
        <span class="k">final</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
    <span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.final.php">Final Keyword</a>, and <a class="reference external" href="https://ocramius.github.io/blog/when-to-declare-classes-final/">When to declare final</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UselessFinal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-useless-final.md">no-useless-final</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="useless-global">
<span id="id2019"></span><h2>9.709. Useless Global<a class="headerlink" href="#useless-global" title="Permalink to this headline">¶</a></h2>
<p>Global are useless in two cases. First, on super-globals, which are always globals, like <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.get.php">$_GET</a>; secondly, on variables that are not used.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $_POST is already a global : it is in fact a global everywhere</span>
<span class="k">global</span> <span class="nv">$_POST</span><span class="p">;</span>

<span class="c1">// $unused is useless</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$used</span><span class="p">,</span> <span class="nv">$unused</span><span class="p">;</span>

    <span class="o">++</span><span class="nv">$used</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Also, PHP has superglobals, a special team of variables that are always available, whatever the context.
They are : $GLOBALS, $_SERVER, <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.get.php">$_GET</a>, <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.post.php">$_POST</a>, $_FILES, $_COOKIE, $_SESSION, <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.request.php">$_REQUEST</a> and <a class="reference external" href="https://www.php.net/manual/en/reserved.variables.env.php">$_ENV</a>.</p>
<div class="section" id="id2024">
<h3>9.709.1. Suggestions<a class="headerlink" href="#id2024" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop the global expression</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UselessGlobal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-structures-uselessglobal"><span class="std std-ref">Zencart</span></a>, <a class="reference internal" href="Cases.html#humo-gen-structures-uselessglobal"><span class="std std-ref">HuMo-Gen</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-instructions">
<span id="id2025"></span><h2>9.710. Useless Instructions<a class="headerlink" href="#useless-instructions" title="Permalink to this headline">¶</a></h2>
<p>Those instructions are useless, or contains useless parts.</p>
<p>For example, an addition whose result is not stored in a variable, or immediately used, does nothing : it is actually performed, and the result is lost. Just plain lost. In fact, PHP might detect it, and optimize it away.</p>
<p>Here the useless instructions that are spotted :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Concatenating with an empty string is useless.</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;This part &#39;</span><span class="o">.</span><span class="nv">$is</span><span class="o">.</span><span class="s1">&#39; useful but &#39;</span><span class="o">.</span><span class="nv">$not</span><span class="o">.</span><span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="c1">// This is a typo, that PHP turns into a constant, then a string, then nothing.</span>
<span class="k">continue</span><span class="p">;</span>

<span class="c1">// Empty string in a concatenation</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;abc&#39;</span> <span class="o">.</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="c1">// Returning expression, whose result is not used (additions, comparisons, properties, closures, new without =, ...)</span>
<span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// Returning post-incrementation</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// array_replace() with only one argument</span>
<span class="nv">$replaced</span> <span class="o">=</span> <span class="nb">array_replace</span><span class="p">(</span><span class="nv">$array</span><span class="p">);</span>
<span class="c1">// array_replace() is OK with ...</span>
<span class="nv">$replaced</span> <span class="o">=</span> <span class="nb">array_replace</span><span class="p">(</span><span class="o">...</span><span class="nv">$array</span><span class="p">);</span>

<span class="c1">// @ operator on source array, in foreach, or when assigning literals</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="o">@</span><span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

<span class="c1">// Multiple comparisons in a for loop : only the last is actually used.</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">,</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="o">++</span><span class="nv">$j</span><span class="p">,</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nv">$i</span><span class="o">.</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="nv">$j</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Counting the keys and counting the array is the same.</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="nb">count</span><span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$array</span><span class="p">))</span>

<span class="c1">//array_keys already provides an array with only unique values, as they were keys in a previous array</span>
<span class="nv">$d</span> <span class="o">=</span> <span class="nb">array_unique</span><span class="p">(</span><span class="nb">array_keys</span><span class="p">(</span><span class="nv">$file</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]))</span>

<span class="c1">// No need for assignation inside the ternary operator</span>
<span class="nv">$closeQuote</span> <span class="o">=</span> <span class="nv">$openQuote</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">?</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$openQuote</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">:</span> <span class="nv">$closeQuote</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$openQuote</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2026">
<h3>9.710.1. Suggestions<a class="headerlink" href="#id2026" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the extra semi-colon</li>
<li>Remove the useless instruction</li>
<li>Assign this expression to a variable and make use of it</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UselessInstruction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-useless-instruction.md">no-useless-instruction</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-interfaces">
<span id="id2027"></span><h2>9.711. Useless Interfaces<a class="headerlink" href="#useless-interfaces" title="Permalink to this headline">¶</a></h2>
<p>The interfaces below are defined and are implemented by some classes.</p>
<p>However, they are never used to enforce an object’s class in the code, using <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">instanceof</a> or in a typehint.
As they are currently used, those interfaces may be removed without change in behavior.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// only defined interface but never enforced</span>
    <span class="k">interface</span> <span class="nx">i</span> <span class="p">{};</span>
    <span class="k">class</span> <span class="nc">c</span> <span class="k">implements</span> <span class="nx">i</span> <span class="p">{}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Interfaces should be used in Typehint or with the <a class="reference external" href="https://www.php.net/manual/en/language.operators.type.php">instanceof</a> operator.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">interface</span> <span class="nx">i</span> <span class="p">{};</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">i</span> <span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Now, $arg is always an &#39;i&#39;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nv">$arg</span> <span class="nx">instanceof</span> <span class="nx">i</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// Now, $arg is always an &#39;i&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2030">
<h3>9.711.1. Suggestions<a class="headerlink" href="#id2030" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the interface with instanceof, or a typehint</li>
<li>Drop the interface altogether : both definition and implements keyword</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Interfaces/UselessInterfaces</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-useless-interfaces.md">no-useless-interfaces</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#woocommerce-interfaces-uselessinterfaces"><span class="std std-ref">Woocommerce</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-parenthesis">
<span id="id2031"></span><h2>9.712. Useless Parenthesis<a class="headerlink" href="#useless-parenthesis" title="Permalink to this headline">¶</a></h2>
<p>Situations where parenthesis are not necessary, and may be removed.</p>
<p>Parenthesis group several elements together, and allows for a more readable expression. They are used with logical and mathematical expressions. They are necessary when the precedence of the operators are not the intended execution order : for example, when an addition must be performed before the multiplication.</p>
<p>Sometimes, the parenthesis provide the same execution order than the default order : they are deemed useless.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nv">$condition</span><span class="p">)</span> <span class="p">)</span> <span class="p">{}</span>
    <span class="k">while</span><span class="p">(</span> <span class="p">(</span><span class="nv">$condition</span><span class="p">)</span> <span class="p">)</span> <span class="p">{}</span>
    <span class="k">do</span> <span class="nv">$a</span><span class="o">++</span><span class="p">;</span> <span class="k">while</span> <span class="p">(</span> <span class="p">(</span><span class="nv">$condition</span><span class="p">)</span> <span class="p">);</span>

    <span class="k">switch</span> <span class="p">(</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">)</span> <span class="p">{}</span>
    <span class="nv">$y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">(</span><span class="nv">$y</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="nx">f</span><span class="p">((</span><span class="nv">$x</span><span class="p">));</span>

    <span class="c1">// = has precedence over ==</span>
    <span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$c</span><span class="p">;</span>

    <span class="p">(</span><span class="nv">$a</span><span class="o">++</span><span class="p">);</span>

    <span class="c1">// No need for parenthesis in default values</span>
    <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$c</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="p">{}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.operators.precedence.php">Operators Precedence</a>.</p>
<div class="section" id="id2033">
<h3>9.712.1. Suggestions<a class="headerlink" href="#id2033" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove useless parenthesis, unless they are important for readability.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UselessParenthesis</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#mautic-structures-uselessparenthesis"><span class="std std-ref">Mautic</span></a>, <a class="reference internal" href="Cases.html#woocommerce-structures-uselessparenthesis"><span class="std std-ref">Woocommerce</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-referenced-argument">
<span id="id2034"></span><h2>9.713. Useless Referenced Argument<a class="headerlink" href="#useless-referenced-argument" title="Permalink to this headline">¶</a></h2>
<p>The argument has a reference, but is only used for reading.</p>
<p>This is probably a development artefact that was forgotten. It is better to remove it.</p>
<p>This analysis also applies to <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> loops, that declare the blind variable as reference, then use the variable as an object, accessing properties and methods. When a variable contains an object, there is no need to declare a reference : it is a reference automatically.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$b</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $c is passed by reference, but only read. The reference is useless.</span>
    <span class="nv">$b</span> <span class="o">=</span> <span class="nv">$c</span> <span class="o">+</span> <span class="nv">$a</span><span class="p">;</span>
    <span class="c1">// The reference is useful for $b</span>
<span class="p">}</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$element</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.references.php">Objects and references</a>.</p>
<div class="section" id="id2037">
<h3>9.713.1. Suggestions<a class="headerlink" href="#id2037" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the useless &amp; from the argument</li>
<li>Make an actual use of the argument before the end of the method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UselessReferenceArgument</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#woocommerce-functions-uselessreferenceargument"><span class="std std-ref">Woocommerce</span></a>, <a class="reference internal" href="Cases.html#magento-functions-uselessreferenceargument"><span class="std std-ref">Magento</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-return">
<span id="id2038"></span><h2>9.714. Useless Return<a class="headerlink" href="#useless-return" title="Permalink to this headline">¶</a></h2>
<p>The spotted functions or methods have a return statement, but this statement is useless. This is the case for constructor and destructors, whose return value are ignored or inaccessible.</p>
<p>When return is void, and the last element in a function, it is also useless.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// return is not used by PHP</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="c1">// The last return, when empty, is useless</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2039">
<h3>9.714.1. Suggestions<a class="headerlink" href="#id2039" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the return expression. Keep any other calculation.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UselessReturn</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#thinkphp-functions-uselessreturn"><span class="std std-ref">ThinkPHP</span></a>, <a class="reference internal" href="Cases.html#vanilla-functions-uselessreturn"><span class="std std-ref">Vanilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-switch">
<span id="id2040"></span><h2>9.715. Useless Switch<a class="headerlink" href="#useless-switch" title="Permalink to this headline">¶</a></h2>
<p>This switch has only one case. It may very well be replaced by a ifthen structure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">switch</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
        <span class="nx">doSomething</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Same as</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2041">
<h3>9.715.1. Suggestions<a class="headerlink" href="#id2041" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Turn the switch into a if/then for better readability</li>
<li>Add other cases to the switch, making it adapted to the situation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UselessSwitch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#phpdocumentor-structures-uselessswitch"><span class="std std-ref">Phpdocumentor</span></a>, <a class="reference internal" href="Cases.html#dolphin-structures-uselessswitch"><span class="std std-ref">Dolphin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-type-casting">
<span id="id2042"></span><h2>9.716. Useless Type Casting<a class="headerlink" href="#useless-type-casting" title="Permalink to this headline">¶</a></h2>
<p>There is no need to overcast returned values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// trim always returns a string : cast is useless</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>

<span class="c1">// strpos doesn&#39;t always returns an integer : cast is useful</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="nx">boolean</span><span class="p">)</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$b</span><span class="p">,</span> <span class="nv">$c</span><span class="p">);</span>

<span class="c1">// comparison don&#39;t need casting, nor parenthesis</span>
<span class="nv">$c</span> <span class="o">=</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span> <span class="p">(</span><span class="nv">$b</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.types.type-juggling.php">Type juggling</a>.</p>
<div class="section" id="id2044">
<h3>9.716.1. Suggestions<a class="headerlink" href="#id2044" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the type cast</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UselessCasting</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#fuelcms-structures-uselesscasting"><span class="std std-ref">FuelCMS</span></a>, <a class="reference internal" href="Cases.html#thinkphp-structures-uselesscasting"><span class="std std-ref">ThinkPHP</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-type-check">
<span id="id2045"></span><h2>9.717. Useless Type Check<a class="headerlink" href="#useless-type-check" title="Permalink to this headline">¶</a></h2>
<p>With typehint, some checks on the arguments are now handled by the type system.</p>
<p>In particular, a type hinted argument can’t be null, unless it is explicitly nullable, or has a <code class="docutils literal notranslate"><span class="pre">null</span></code> value as default.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// The test on null is useless, it will never happen</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">A</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// do something</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Either nullable ? is too much, either the default null is</span>
<span class="k">function</span> <span class="nf">barbar</span><span class="p">(</span><span class="o">?</span><span class="nx">A</span> <span class="nv">$a</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">// The test on null is useful, the default value null allows it</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">A</span> <span class="nv">$a</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">===</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// do something</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration">Type Declarations</a>.</p>
<div class="section" id="id2047">
<h3>9.717.1. Suggestions<a class="headerlink" href="#id2047" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the nullable typehint</li>
<li>Remove the null default value</li>
<li>Remove tests on null</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UselessTypeCheck</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#dead-code"><span class="std std-ref">Dead code</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-typehint">
<span id="id2048"></span><h2>9.718. Useless Typehint<a class="headerlink" href="#useless-typehint" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__get</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__set</a> magic methods won’t use any typehint. The name of the magic property is always cast to string.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__call()</a></p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="c1">// typehint is set and ignored</span>
    <span class="k">function</span> <span class="fm">__set</span><span class="p">(</span><span class="nx">float</span> <span class="nv">$name</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$name</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// typehint is set and ignored</span>
    <span class="k">function</span> <span class="fm">__get</span><span class="p">(</span><span class="nx">integer</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$name</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// typehint is checked by PHP 8.0 linting</span>
    <span class="c1">// typehint is enforced by PHP 7.x</span>
    <span class="k">function</span> <span class="fm">__call</span><span class="p">(</span><span class="nx">integer</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$name</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$o</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">x</span><span class="p">;</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="c1">// Property will be called &#39;Array&#39;</span>
<span class="nv">$o</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$b</span><span class="p">}</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1">// type of $m is check at calling time. It must be string.</span>
<span class="nv">$o</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$m</span><span class="p">}();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.overloading.php#object.set">__set</a>.</p>
<div class="section" id="id2052">
<h3>9.718.1. Suggestions<a class="headerlink" href="#id2052" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use <cite>string</cite> for the <cite>$name</cite> parameter</li>
<li>Use no typehint for the <cite>$name</cite> parameter</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UselessTypehint</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="useless-unset">
<span id="id2053"></span><h2>9.719. Useless Unset<a class="headerlink" href="#useless-unset" title="Permalink to this headline">¶</a></h2>
<p>There are situations where trying to remove a variable is actually useless.</p>
<p>PHP ignores any command that tries to unset a global variable, a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> variable, or a blind variable from a foreach loop.</p>
<p>This is different from the garbage collector, which is run on its own schedule. It is also different from an explicit unset, aimed at freeing memory early : those are useful.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// unsetting arguments is useless</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

    <span class="k">global</span> <span class="nv">$b</span><span class="p">;</span>
    <span class="c1">// unsetting global variable has no effect</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$b</span><span class="p">);</span>

    <span class="k">static</span> <span class="nv">$c</span><span class="p">;</span>
    <span class="c1">// unsetting static variable has no effect</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$c</span><span class="p">);</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$d</span> <span class="k">as</span> <span class="o">&amp;</span><span class="nv">$e</span><span class="p">){</span>
        <span class="c1">// unsetting a blind variable is useless</span>
        <span class="p">(</span><span class="nb">unset</span><span class="p">)</span> <span class="nv">$e</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1">// Unsetting a blind variable AFTER the loop is good.</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$e</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/unset">unset</a>.</p>
<div class="section" id="id2056">
<h3>9.719.1. Suggestions<a class="headerlink" href="#id2056" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the unset</li>
<li>Set the variable to null : the effect is the same on memory, but the variable keeps its existence.</li>
<li>Omit unsetting variables, and wait for the end of the scope. That way, PHP free memory en mass.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/UselessUnset</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-useless-unset.md">no-useless-unset</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-structures-uselessunset"><span class="std std-ref">Tine20</span></a>, <a class="reference internal" href="Cases.html#typo3-structures-uselessunset"><span class="std std-ref">Typo3</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="uses-default-values">
<span id="id2057"></span><h2>9.720. Uses Default Values<a class="headerlink" href="#uses-default-values" title="Permalink to this headline">¶</a></h2>
<p>Default values are provided to methods so as to make it convenient to use. However, with new versions, those values may change. For example, in PHP 5.4, <a class="reference external" href="https://www.php.net/htmlentities">htmlentities()</a> switched from <code class="docutils literal notranslate"><span class="pre">Latin1</span></code> to <code class="docutils literal notranslate"><span class="pre">UTF-8</span></code> default encoding.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$string</span> <span class="o">=</span> <span class="nx">Eu</span> <span class="nx">não</span> <span class="nx">sou</span> <span class="nx">o</span> <span class="nx">pão</span><span class="p">;</span>

<span class="k">echo</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>

<span class="c1">// PHP 5.3 : Eu n&amp;Atilde;&amp;pound;o sou o p&amp;Atilde;&amp;pound;o</span>
<span class="c1">// PHP 5.4 : Eu n&amp;atilde;o sou o p&amp;atilde;o</span>

<span class="c1">// Stable across versions</span>
<span class="k">echo</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$string</span><span class="p">,</span> <span class="s1">&#39;UTF8&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>As much as possible, it is recommended to use explicit values in those methods, so as to prevent from being surprise at a future PHP evolution.</p>
<p>This analyzer tend to report a lot of false positives, including usage of <a class="reference external" href="https://www.php.net/count">count()</a>. <a class="reference external" href="https://www.php.net/count">Count()</a> indeed has a second argument for recursive counts, and a default value. This may be ignored safely.</p>
<div class="section" id="id2061">
<h3>9.720.1. Suggestions<a class="headerlink" href="#id2061" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Mention all arguments, as much as possible</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UsesDefaultArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="using-this-outside-a-class">
<span id="id2062"></span><h2>9.721. Using $this Outside A Class<a class="headerlink" href="#using-this-outside-a-class" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">$this</span></code> is a special variable, that should only be used in a class context.</p>
<p>Until PHP 7.1, <code class="docutils literal notranslate"><span class="pre">$this</span></code> may be used as an argument in a function or a method, a global, a <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> : while this is legit, it sounds confusing enough to avoid it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$this</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$this</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// A closure can be bound to an object at later time. It is valid usage.</span>
<span class="nv">$closure</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">foo</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Starting with PHP 7.1, the PHP engine check thoroughly that <code class="docutils literal notranslate"><span class="pre">$this</span></code> is used in an appropriate manner, and raise fatal errors in case it isn’t.</p>
<p>Yet, it is possible to find <code class="docutils literal notranslate"><span class="pre">$this</span></code> outside a class : if the file is included inside a class, then <code class="docutils literal notranslate"><span class="pre">$this</span></code> will be recognized and validated. If the file is included outside a class context, it will yield a fatal error : <code class="docutils literal notranslate"><span class="pre">Using</span> <span class="pre">`$this</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.basic.php&gt;`_</span> <span class="pre">when</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">object</span> <span class="pre">context</span></code>.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/closure.bind.php">Closure::bind</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.basic.php">The Basics</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UsingThisOutsideAClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="using-deprecated-method">
<span id="id2065"></span><h2>9.722. Using Deprecated Method<a class="headerlink" href="#using-deprecated-method" title="Permalink to this headline">¶</a></h2>
<p>A call to a deprecated method has been spotted. A method is deprecated when it bears a <code class="docutils literal notranslate"><span class="pre">&#64;deprecated</span></code> parameter in its typehint definition.</p>
<p>Deprecated methods which are not called are not reported.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// not deprecated method</span>
<span class="nx">not_deprecated</span><span class="p">();</span>

<span class="c1">// deprecated method</span>
<span class="nx">deprecated</span><span class="p">();</span>

<span class="sd">/**</span>
<span class="sd"> * @deprecated since version 2.0.0</span>
<span class="sd"> */</span>
<span class="k">function</span> <span class="nf">deprecated</span><span class="p">()</span> <span class="p">{}</span>

<span class="k">function</span> <span class="nf">not_deprecated</span><span class="p">()</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://docs.phpdoc.org/latest/references/phpdoc/tags/deprecated.html">&#64;deprecated</a>.</p>
<div class="section" id="id2066">
<h3>9.722.1. Suggestions<a class="headerlink" href="#id2066" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace the deprecated call with a stable call</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/UsingDeprecated</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="usort-sorting-in-php-7-0">
<span id="id2067"></span><h2>9.723. Usort Sorting In PHP 7.0<a class="headerlink" href="#usort-sorting-in-php-7-0" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/usort">Usort()</a>, <a class="reference external" href="https://www.php.net/uksort">uksort()</a> and <a class="reference external" href="https://www.php.net/uasort">uasort()</a> behavior has changed in PHP 7. Values that are equals (based on the user-provided method) may be sorted differently than in PHP 5.</p>
<p>If this sorting is important, it is advised to add extra comparison in the user-function and avoid returning 0 (thus, depending on default implementation).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$a</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">];</span>

<span class="k">function</span> <span class="nf">noSort</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">;</span> <span class="p">}</span>

<span class="nb">usort</span><span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="s1">&#39;noSort&#39;</span><span class="p">);</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$a</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>In PHP 5, the results is ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">4</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">2</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">6</span>
<span class="p">)</span>
</pre></div>
</div>
<p>in PHP 7, the result is ::</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Array</span>
<span class="p">(</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">2</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">4</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">3</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="mi">6</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="section" id="id2071">
<h3>9.723.1. Suggestions<a class="headerlink" href="#id2071" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make sure the sorting function doesn’t generate any ex-aequos.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/UsortSorting</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Medium</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="var-keyword">
<span id="id2072"></span><h2>9.724. Var Keyword<a class="headerlink" href="#var-keyword" title="Permalink to this headline">¶</a></h2>
<p>Var was used in PHP 4 to mark properties as public. Nowadays, new keywords are available : public, protected, private. Var is equivalent to public.</p>
<p>It is recommended to avoid using var, and explicitly use the new keywords.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1">// Avoid var</span>
    <span class="c1">//var $bar = 1;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.visibility.php">Visibility</a>.</p>
<div class="section" id="id2074">
<h3>9.724.1. Suggestions<a class="headerlink" href="#id2074" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>It is recommended to avoid using var, and explicitly use the new keywords : private, protected, public</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/OldStyleVar</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-php4-class-syntax.md">no-php4-class-syntax</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-classes-oldstylevar"><span class="std std-ref">xataface</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="variable-global">
<span id="id2075"></span><h2>9.725. Variable Global<a class="headerlink" href="#variable-global" title="Permalink to this headline">¶</a></h2>
<p>Variable global such are valid in PHP 5.6, but no in PHP 7.0. They should be replaced with ${$foo-&gt;bar}.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Forbidden in PHP 7</span>
<span class="k">global</span> <span class="nv">$normalGlobal</span><span class="p">;</span>

<span class="c1">// Forbidden in PHP 7</span>
<span class="k">global</span> <span class="nv">$$variable</span><span class="o">-&gt;</span><span class="na">global</span> <span class="p">;</span>

<span class="c1">// Tolerated in PHP 7</span>
<span class="k">global</span> <span class="err">$</span><span class="p">{</span><span class="nv">$variable</span><span class="o">-&gt;</span><span class="na">global</span><span class="p">};</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/VariableGlobal</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="variable-is-not-a-condition">
<span id="id2076"></span><h2>9.726. Variable Is Not A Condition<a class="headerlink" href="#variable-is-not-a-condition" title="Permalink to this headline">¶</a></h2>
<p>Avoid using a lone variable as a condition. It is recommended to use a comparative value, or one of the filtering function, such as <a class="reference external" href="https://www.www.php.net/isset">isset()</a>, <a class="reference external" href="https://www.php.net/empty">empty()</a>.</p>
<p>Using the raw variable as a condition blurs the difference between an undefined variable and an empty value. By using an explicit comparison or validation function, it is easier to understand what the variable stands for.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$error</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;Found one error : &#39;</span><span class="o">.</span><span class="nv">$error</span><span class="o">!</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$errors</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">print</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$errors</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39; errors found : &#39;</span><span class="o">.</span><span class="nb">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nv">$errors</span><span class="p">)</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="k">echo</span> <span class="s1">&#39;Not found&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Thanks to the <a class="reference external" href="https://www.sigb.net/">PMB</a> team for the inspiration.</p>
<div class="section" id="id2079">
<h3>9.726.1. Suggestions<a class="headerlink" href="#id2079" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the validation explicit, by using a comparison operator, or one of the validation function.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/NoVariableIsACondition</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="variables-with-one-letter-names">
<span id="id2080"></span><h2>9.727. Variables With One Letter Names<a class="headerlink" href="#variables-with-one-letter-names" title="Permalink to this headline">¶</a></h2>
<p>Variables with one letter name are the shortest name for variables. They also bear very little meaning : what does contain the variable <code class="docutils literal notranslate"><span class="pre">$w</span></code> ?</p>
<p>Some one-letter variables have meaning : <code class="docutils literal notranslate"><span class="pre">$x</span></code> and <code class="docutils literal notranslate"><span class="pre">$y</span></code> for coordinates, <code class="docutils literal notranslate"><span class="pre">$i</span></code>, <code class="docutils literal notranslate"><span class="pre">$j</span></code>, <code class="docutils literal notranslate"><span class="pre">$k</span></code> for blind variables. Others tend to be an easy way to give a name to a variable, without thinking too hard a good name.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $a is reported as a one-letter variable</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// $i is considered a false positive.</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="nv">$i</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">+=</span> <span class="nx">doSomething</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://softwareengineering.stackexchange.com/questions/71710/using-single-characters-for-variable-names-in-loops-exceptions?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa/">Using single characters for variable names in loops/exceptions</a> and <a class="reference external" href="https://odetocode.com/blogs/scott/archive/2008/11/17/single-letter-variable-names-still-considered-harmful.aspx">Single Letter Variable Names Still Considered Harmful</a>.</p>
<div class="section" id="id2081">
<h3>9.727.1. Suggestions<a class="headerlink" href="#id2081" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the variable more meaningful, with full words</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/VariableOneLetter</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="weak-typing">
<span id="id2082"></span><h2>9.728. Weak Typing<a class="headerlink" href="#weak-typing" title="Permalink to this headline">¶</a></h2>
<p>The test on a variable is not enough. The variable is checked for null, then used as an object or an array.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">!==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$a</span><span class="o">-&gt;</span><span class="na">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://rskuipers.com/entry/from-assumptions-to-assertions">From assumptions to assertions</a>.</p>
<div class="section" id="id2084">
<h3>9.728.1. Suggestions<a class="headerlink" href="#id2084" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use instanceof when checking for objects</li>
<li>Use is_array() when checking for arrays. Also consider is_string(), is_int(), etc.</li>
<li>Use typehint when the variable is an argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/WeakType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#teampass-classes-weaktype"><span class="std std-ref">TeamPass</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="weird-array-index">
<span id="id2085"></span><h2>9.729. Weird Array Index<a class="headerlink" href="#weird-array-index" title="Permalink to this headline">¶</a></h2>
<p>Array index that looks weird. Arrays index may be string or integer, but some strings looks weird.</p>
<p>In particular, strings that include terminal white spaces, often leads to missed values.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a &#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>

<span class="c1">// Later in the code</span>

<span class="c1">//Notice: Undefined index: a in /Users/famille/Desktop/analyzeG3/test.php on line 8</span>
<span class="k">echo</span> <span class="nv">$array</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">];</span>

<span class="c1">//Notice: Undefined index: b  in /Users/famille/Desktop/analyzeG3/test.php on line 10</span>
<span class="c1">// Note that the space is visible, but easy to miss</span>
<span class="k">echo</span> <span class="nv">$array</span><span class="p">[</span><span class="s1">&#39;b &#39;</span><span class="p">];</span>

<span class="c1">// all fine here</span>
<span class="k">echo</span> <span class="nv">$array</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">];</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Although this is rare error, and often easy to spot, it is also very hard to find when it strikes.</p>
<div class="section" id="id2086">
<h3>9.729.1. Suggestions<a class="headerlink" href="#id2086" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove white spaces when using strings as array index.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="41%" />
<col width="59%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Arrays/WeirdIndex</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="while-list-each">
<span id="id2087"></span><h2>9.730. While(List() = Each())<a class="headerlink" href="#while-list-each" title="Permalink to this headline">¶</a></h2>
<p>This code structure is quite old : it should be replace by the more modern and efficient foreach.</p>
<p>This structure is deprecated since PHP 7.2. It may disappear in the future.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="k">while</span><span class="p">(</span><span class="k">list</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="o">=</span> <span class="nb">each</span><span class="p">(</span><span class="nv">$array</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">doSomethingWith</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$value</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">foreach</span><span class="p">(</span><span class="nv">$array</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">doSomethingWith</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="k">and</span> <span class="nv">$value</span><span class="p">();</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/each">PHP RFC: Deprecations for PHP 7.2 : `Each()</a> &lt;<a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_2#each">https://wiki.php.net/rfc/deprecations_php_7_2#each</a>&gt;`_.</p>
<div class="section" id="id2088">
<h3>9.730.1. Suggestions<a class="headerlink" href="#id2088" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Change this loop with foreach</li>
<li>Change this loop with an array_* function with a callback</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/WhileListEach</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openemr-structures-whilelisteach"><span class="std std-ref">OpenEMR</span></a>, <a class="reference internal" href="Cases.html#dolphin-structures-whilelisteach"><span class="std std-ref">Dolphin</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="written-only-variables">
<span id="id2089"></span><h2>9.731. Written Only Variables<a class="headerlink" href="#written-only-variables" title="Permalink to this headline">¶</a></h2>
<p>Those variables are being written, but never read. This way, they are useless and should be removed, or read at some point.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// $a is used multiple times, but never read</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span>
<span class="nv">$a</span> <span class="o">.=</span> <span class="s1">&#39;b&#39;</span><span class="p">;</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="c1">//$b is actually read once</span>
<span class="nv">$a</span> <span class="o">.=</span> <span class="nv">$b</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2090">
<h3>9.731.1. Suggestions<a class="headerlink" href="#id2090" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check that variables are written AND read in each context</li>
<li>Remove variables that are only read</li>
<li>Use the variable that are only read</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Variables/WrittenOnlyVariable</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-unused-variable.md">no-unused-variable</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-variables-writtenonlyvariable"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#suitecrm-variables-writtenonlyvariable"><span class="std std-ref">SuiteCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-access-style-to-property">
<span id="id2091"></span><h2>9.732. Wrong Access Style to Property<a class="headerlink" href="#wrong-access-style-to-property" title="Permalink to this headline">¶</a></h2>
<p>Use the right syntax when reaching for a property. <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static</a> properties use the <code class="docutils literal notranslate"><span class="pre">\:\:</span></code> operator, and non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> properties use <code class="docutils literal notranslate"><span class="pre">-&gt;</span></code>.</p>
<p>Mistaking one of the other raise two different reactions from PHP : <code class="docutils literal notranslate"><span class="pre">Access</span> <span class="pre">to</span> <span class="pre">undeclared</span> <span class="pre">`static</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.static.php&gt;`_</span> <span class="pre">property</span></code> is a fatal error, while <code class="docutils literal notranslate"><span class="pre">PHP</span> <span class="pre">Notice:</span>&#160; <span class="pre">Accessing</span> <span class="pre">`static</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.static.php&gt;`_</span> <span class="pre">property</span> <span class="pre">aa\:\:$a</span> <span class="pre">as</span> <span class="pre">non</span> <span class="pre">`static</span> <span class="pre">&lt;https://www.php.net/manual/en/language.oop5.static.php&gt;`_</span></code> is a notice.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">a</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">public</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$a</span><span class="p">;</span> <span class="c1">// right</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">a</span><span class="p">;</span> <span class="c1">// WRONG</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">b</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$b</span><span class="p">;</span>  <span class="c1">// right</span>
        <span class="k">echo</span> <span class="nx">b</span><span class="o">::</span><span class="nv">$b</span><span class="p">;</span>      <span class="c1">// WRONG</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis reports both <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> properties with a <cite>-&gt;</cite> access, and non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> properties with a <cite>::</cite> access.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">Static Keyword &lt;https://www.php.net/manual/en/language.oop5.`static</a>.php&gt;`_.</p>
<div class="section" id="id2097">
<h3>9.732.1. Suggestions<a class="headerlink" href="#id2097" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Match the property call with the definition</li>
<li>Make the property static</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/UndeclaredStaticProperty</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#humo-gen-classes-undeclaredstaticproperty"><span class="std std-ref">HuMo-Gen</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-argument-type">
<span id="id2098"></span><h2>9.733. Wrong Argument Type<a class="headerlink" href="#wrong-argument-type" title="Permalink to this headline">¶</a></h2>
<p>Checks that the type of the argument is consistent with the type of the called method.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">//valid call, with an integer</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">//invalid call, with a string</span>
<span class="nx">foo</span><span class="p">(</span><span class="s1">&#39;asd&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This analysis is valid with PHP 8.0.</p>
<div class="section" id="id2099">
<h3>9.733.1. Suggestions<a class="headerlink" href="#id2099" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use a valid type when calling methods.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/WrongArgumentType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-attribute-configuration">
<span id="id2100"></span><h2>9.734. Wrong Attribute Configuration<a class="headerlink" href="#wrong-attribute-configuration" title="Permalink to this headline">¶</a></h2>
<p>A class is attributed to the wrong PHP structure.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">#[Attribute(Attribute::TARGET_CLASS)]</span>
<span class="k">class</span> <span class="nc">ClassAttribute</span> <span class="p">{</span> <span class="p">}</span>

<span class="c1">// Wrong</span>
<span class="c1">#[ClassAttribute]</span>
<span class="k">function</span> <span class="nf">foo</span> <span class="p">()</span> <span class="p">{}</span>

<span class="c1">// OK</span>
<span class="c1">#[ClassAttribute]</span>
<span class="k">class</span> <span class="nc">y</span>  <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2101">
<h3>9.734.1. Suggestions<a class="headerlink" href="#id2101" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the attribute from the wrongly attributed structure</li>
<li>Extend the configuration of the attribute with Attribute::TARGET_*</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/WrongAttributeConfiguration</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>8.0+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-case-namespaces">
<span id="id2102"></span><h2>9.735. Wrong Case Namespaces<a class="headerlink" href="#wrong-case-namespaces" title="Permalink to this headline">¶</a></h2>
<p>Namespaces are case-insentives.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Namespaces should share the same case</span>
<span class="k">namespace</span> <span class="nx">X</span> <span class="p">{}</span>

<span class="k">namespace</span> <span class="nx">x</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2103">
<h3>9.735.1. Suggestions<a class="headerlink" href="#id2103" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Synchronize all names</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Namespaces/WrongCase</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-class-name-case">
<span id="id2104"></span><h2>9.736. Wrong Class Name Case<a class="headerlink" href="#wrong-class-name-case" title="Permalink to this headline">¶</a></h2>
<p>The spotted classes are used with a different case than their definition. While PHP accepts this, it makes the code harder to read.</p>
<p>It may also be a violation of coding conventions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This use statement has wrong case for origin.</span>
<span class="k">use</span> <span class="nx">Foo</span> <span class="k">as</span> <span class="nx">X</span><span class="p">;</span>

<span class="c1">// Definition of the class</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{}</span>

<span class="c1">// Those instantiations have wrong case</span>
<span class="k">new</span> <span class="nx">FOO</span><span class="p">();</span>
<span class="k">new</span> <span class="nx">X</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://gist.github.com/bcremer/9e8d6903ae38a25784fb1985967c6056">PHP class name constant case sensitivity and PSR-11</a>.</p>
<div class="section" id="id2105">
<h3>9.736.1. Suggestions<a class="headerlink" href="#id2105" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Match the defined class name with the called name</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="92%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/WrongCase</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a>, <a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a>, <a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-classes-wrongcase"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-function-name-case">
<span id="id2106"></span><h2>9.737. Wrong Function Name Case<a class="headerlink" href="#wrong-function-name-case" title="Permalink to this headline">¶</a></h2>
<p>The spotted functions are used with a different case than their definition. While PHP accepts this, it makes the code harder to read.</p>
<p>It may also be a violation of coding conventions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Definition of the class</span>
<span class="k">function</span> <span class="nf">foo</span> <span class="p">()</span> <span class="p">{}</span>

<span class="c1">// Those calls have wrong case</span>
<span class="nx">FOO</span><span class="p">();</span>
<span class="nx">\Foo</span><span class="p">();</span>

<span class="c1">// This is valid</span>
<span class="nx">foo</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://gist.github.com/bcremer/9e8d6903ae38a25784fb1985967c6056">PHP class name constant case sensitivity and PSR-11</a>.</p>
<div class="section" id="id2108">
<h3>9.737.1. Suggestions<a class="headerlink" href="#id2108" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Match the defined functioncall with the called name</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/WrongCase</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td>none</td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-number-of-arguments">
<span id="id2109"></span><h2>9.738. Wrong Number Of Arguments<a class="headerlink" href="#wrong-number-of-arguments" title="Permalink to this headline">¶</a></h2>
<p>Those functioncalls are made with too many or too few arguments.</p>
<p>When the number arguments is wrong for native functions, PHP emits a warning.
When the number arguments is too small for custom functions, PHP raises an exception.
When the number arguments is too high for custom functions, PHP ignores the arguments. Such arguments should be handled with the variadic operator, or with <a class="reference external" href="https://www.php.net/func_get_args">func_get_args()</a> family of functions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">echo</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="s1">&#39;This function is&#39;</span><span class="p">,</span> <span class="s1">&#39;ignoring arguments&#39;</span><span class="p">);</span>
<span class="c1">//Warning: strtoupper() expects exactly 1 parameter, 2 given in Command line code on line 1</span>

<span class="k">echo</span> <span class="nb">strtoupper</span><span class="p">();</span>
<span class="c1">//Warning: strtoupper() expects exactly 1 parameter, 0 given in Command line code on line 1</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$argument</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">echo</span> <span class="nx">foo</span><span class="p">();</span>
<span class="c1">//Fatal error: Uncaught ArgumentCountError: Too few arguments to function foo(), 0 passed in /Users/famille/Desktop/analyzeG3/test.php on line 10 and exactly 1 expected in /Users/famille/Desktop/analyzeG3/test.php:3</span>

<span class="k">echo</span> <span class="nx">foo</span><span class="p">(</span><span class="s1">&#39;This function is&#39;</span><span class="p">,</span> <span class="s1">&#39;ignoring arguments&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>It is recommended to check the signature of the methods, and fix the arguments.</p>
<div class="section" id="id2110">
<h3>9.738.1. Suggestions<a class="headerlink" href="#id2110" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add more arguments to fill the list of compulsory arguments</li>
<li>Remove arguments to fit the list of compulsory arguments</li>
<li>Use another method or class</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/WrongNumberOfArguments</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
<tr class="row-even"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-missing-argument.md.md">no-missing-argument.md</a></td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xataface-functions-wrongnumberofarguments"><span class="std std-ref">xataface</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-optional-parameter">
<span id="id2111"></span><h2>9.739. Wrong Optional Parameter<a class="headerlink" href="#wrong-optional-parameter" title="Permalink to this headline">¶</a></h2>
<p>Wrong placement of optional parameters.</p>
<p>PHP parameters are optional when they defined with a default value, like this :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">function</span> <span class="nf">x</span><span class="p">(</span><span class="nv">$arg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// PHP code here</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>When a function have both compulsory and optional parameters, the compulsory ones should appear first, and the optional should appear last :</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">function</span> <span class="nf">x</span><span class="p">(</span><span class="nv">$arg</span><span class="p">,</span> <span class="nv">$arg2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// PHP code here</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>PHP solves this problem at runtime, assign values in the same other, but will miss some of the default values and emits warnings.</p>
<p>It is better to put all the optional parameters at the end of the method’s signature.</p>
<p>Optional parameter wrongly placed are now a Notice in PHP 8.0. The only previous case that is allowed in PHP 8.0 and also in this analysis, is when the <code class="docutils literal notranslate"><span class="pre">null</span></code> value is used as default for typed arguments.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.arguments.php">Function arguments</a>.</p>
<div class="section" id="id2113">
<h3>9.739.1. Suggestions<a class="headerlink" href="#id2113" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Give default values to all but first parameters. Null is a good default value, as PHP will use it if not told otherwise.</li>
<li>Remove default values to all but last parameters. That is probably a weak solution.</li>
<li>Change the order of the values, so default-valued parameters are at the end. This will probably have impact on the rest of the code, as the API is changing.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/WrongOptionalParameter</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#fuelcms-functions-wrongoptionalparameter"><span class="std std-ref">FuelCMS</span></a>, <a class="reference internal" href="Cases.html#vanilla-functions-wrongoptionalparameter"><span class="std std-ref">Vanilla</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-parameter-type">
<span id="id2114"></span><h2>9.740. Wrong Parameter Type<a class="headerlink" href="#wrong-parameter-type" title="Permalink to this headline">¶</a></h2>
<p>The expected parameter is not of the correct type. Check PHP documentation to know which is the right format to be used.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// substr() shouldn&#39;t work on integers.</span>
<span class="c1">// the first argument is first converted to string, and it is 123456.</span>
<span class="k">echo</span> <span class="nb">substr</span><span class="p">(</span><span class="mi">123456</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="c1">// display 1234</span>

<span class="c1">// substr() shouldn&#39;t work on boolean</span>
<span class="c1">// the first argument is first converted to string, and it is 1, and not t</span>
<span class="k">echo</span> <span class="nb">substr</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// displays 1</span>

<span class="c1">// substr() works correctly on strings.</span>
<span class="k">echo</span> <span class="nb">substr</span><span class="p">(</span><span class="mi">123456</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/InternalParameterType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#zencart-php-internalparametertype"><span class="std std-ref">Zencart</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="wrong-range-check">
<span id="id2115"></span><h2>9.741. Wrong Range Check<a class="headerlink" href="#wrong-range-check" title="Permalink to this headline">¶</a></h2>
<p>The interval check should use &amp;&amp; and not ||.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//interval correctly checked a is between 2 and 999</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{}</span>

<span class="c1">//interval incorrectly checked : a is 2 or more ($a &lt; 1000 is never checked)</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2116">
<h3>9.741.1. Suggestions<a class="headerlink" href="#id2116" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Make the interval easy to read and understand</li>
<li>Check the truth table for the logical operation</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/WrongRange</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-structures-wrongrange"><span class="std std-ref">Dolibarr</span></a>, <a class="reference internal" href="Cases.html#wordpress-structures-wrongrange"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-type-for-native-php-function">
<span id="id2117"></span><h2>9.742. Wrong Type For Native PHP Function<a class="headerlink" href="#wrong-type-for-native-php-function" title="Permalink to this headline">¶</a></h2>
<p>This analysis reports calls to a PHP native function with a wrongly typed value.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// valid calls</span>
<span class="k">echo</span> <span class="nb">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">exp</span><span class="p">(</span><span class="mf">2.5</span><span class="p">);</span>

<span class="c1">// invalid calls</span>
<span class="k">echo</span> <span class="nb">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="k">echo</span> <span class="nb">exp</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="mf">2.5</span><span class="p">));</span>

<span class="c1">// valid call, but invalid math</span>
<span class="c1">// -1 is not a valid value for log(), but -1 is a valid type (int) : it is not reported by this analysis.</span>
<span class="k">echo</span> <span class="nb">log</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2118">
<h3>9.742.1. Suggestions<a class="headerlink" href="#id2118" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Set the code to the valid type, when calling a PHP native function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/WrongTypeForNativeFunction</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-type-returned">
<span id="id2119"></span><h2>9.743. Wrong Type Returned<a class="headerlink" href="#wrong-type-returned" title="Permalink to this headline">¶</a></h2>
<p>The returned value is not compatible with the specified return type.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// classic error</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;A&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// classic static error</span>
<span class="k">const</span> <span class="no">B</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">B</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// undecideable error</span>
<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$c</span><span class="p">)</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$c</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// PHP lint this, but won&#39;t execute it</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">()</span> <span class="o">:</span> <span class="nx">void</span> <span class="p">{</span>
    <span class="c1">// No return at all</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/functions.returning-values.php">Returning values</a> and <a class="reference external" href="https://wiki.php.net/rfc/void_return_type">Void Return Type</a>.</p>
<div class="section" id="id2120">
<h3>9.743.1. Suggestions<a class="headerlink" href="#id2120" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Match the return type with the return value</li>
<li>Remove the return expression altogether</li>
<li>Add a typecast to the returning expression</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/WrongReturnedType</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>High</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-type-with-call">
<span id="id2121"></span><h2>9.744. Wrong Type With Call<a class="headerlink" href="#wrong-type-with-call" title="Permalink to this headline">¶</a></h2>
<p>This analysis checks that a call to a method uses the right literal values’ types.</p>
<p>Currently, this analysis doesn’t take into account <code class="docutils literal notranslate"><span class="pre">strict_types</span> <span class="pre">=</span> <span class="pre">1</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// wrong type used</span>
<span class="nx">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1">// wrong type used</span>
<span class="nx">foo</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2122">
<h3>9.744.1. Suggestions<a class="headerlink" href="#id2122" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the right type with all literals</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/WrongTypeWithCall</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#typechecks"><span class="std std-ref">Typechecks</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-typed-property-default">
<span id="id2123"></span><h2>9.745. Wrong Typed Property Default<a class="headerlink" href="#wrong-typed-property-default" title="Permalink to this headline">¶</a></h2>
<p>Property is typed with an incompatible default value type.</p>
<p>Init type might be a new instance, the return of a method call or an interface compatible object.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">x</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nx">A</span> <span class="nv">$property</span><span class="p">;</span>
    <span class="k">private</span> <span class="nx">B</span> <span class="nv">$incompatible</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// This is compatible</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">property</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">A</span><span class="p">();</span>

        <span class="c1">// This is incompatible : new B() expected</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">incompatible</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">C</span><span class="p">();</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>PHP compiles such code, but won’t execute it, as it detects the incompatibility.</p>
<div class="section" id="id2124">
<h3>9.745.1. Suggestions<a class="headerlink" href="#id2124" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the type hint of the property</li>
<li>Fix the initialization call</li>
<li>Use an interface for typehint</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/WrongTypedPropertyInit</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a>, <a class="reference internal" href="Rulesets.html#classreview"><span class="std std-ref">ClassReview</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-typehinted-name">
<span id="id2125"></span><h2>9.746. Wrong Typehinted Name<a class="headerlink" href="#wrong-typehinted-name" title="Permalink to this headline">¶</a></h2>
<p>The parameter name doesn’t reflect the typehint used.</p>
<p>There are no restriction on parameter names, except its uniqueness in the signature. Yet, using a scalar typehint as the name for another typehinted value is just misleading.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$array</span><span class="p">,</span>
             <span class="nx">int</span> <span class="nv">$int</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="k">array</span> <span class="nv">$strings</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// doSomething()</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The comparison relies on exact names : calling an array a list of <code class="docutils literal notranslate"><span class="pre">strings</span></code> is OK with this analysis.</p>
<div class="section" id="id2126">
<h3>9.746.1. Suggestions<a class="headerlink" href="#id2126" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Rename</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/WrongTypehintedName</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a>, <a class="reference internal" href="Rulesets.html#semantics"><span class="std std-ref">Semantics</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="wrong-fopen-mode">
<span id="id2127"></span><h2>9.747. Wrong fopen() Mode<a class="headerlink" href="#wrong-fopen-mode" title="Permalink to this headline">¶</a></h2>
<p>Wrong file opening for <a class="reference external" href="https://www.php.net/fopen">fopen()</a>.</p>
<p><a class="reference external" href="https://www.php.net/fopen">fopen()</a> has a few modes, as described in the documentation : ‘r’, ‘r+’, for reading;  ‘w’, ‘w+’ for writing; ‘a’, ‘a+’ for appending; ‘x’, ‘x+’ for modifying; ‘c’, ‘c+’ for writing and locking, ‘t’ for text files and windows only.
An optional ‘b’ may be used to make the <a class="reference external" href="https://www.php.net/fopen">fopen()</a> call more portable and binary safe. Another optional ‘t’ may be used to make the <a class="reference external" href="https://www.php.net/fopen">fopen()</a> call process automatically text input : this one should be avoided.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// open the file for reading, in binary mode</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/tmp/php.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">);</span>

<span class="c1">// New option e in PHP 7.0.16 and 7.1.2 (beware of compatibility)</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/tmp/php.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rbe&#39;</span><span class="p">);</span>

<span class="c1">// Unknown option x</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;/tmp/php.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rbx&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Any other values are not understood by PHP.</p>
<div class="section" id="id2132">
<h3>9.747.1. Suggestions<a class="headerlink" href="#id2132" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check the docs, choose the right opening mode.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/FopenMode</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tikiwiki-php-fopenmode"><span class="std std-ref">Tikiwiki</span></a>, <a class="reference internal" href="Cases.html#humo-gen-php-fopenmode"><span class="std std-ref">HuMo-Gen</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="yoda-comparison">
<span id="id2133"></span><h2>9.748. Yoda Comparison<a class="headerlink" href="#yoda-comparison" title="Permalink to this headline">¶</a></h2>
<p>Yoda comparison is a way to write conditions which places literal values on the left side.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Then condition</span>
  <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The objective is to avoid mistaking a comparison to an assignation. If the comparison operator is mistaken, but the literal is on the left, then an error will be triggered, instead of a silent bug.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// error in comparison!</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Then condition</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://en.wikipedia.org/wiki/Yoda_conditions">Yoda Conditions</a>, <a class="reference external" href="https://knowthecode.io/yoda-conditions-yoda-not-yoda">Yoda Conditions: To Yoda or Not to Yoda</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/YodaComparison</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#coding-conventions"><span class="std std-ref">Coding Conventions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dir-then-slash">
<span id="id2134"></span><h2>9.749. __DIR__ Then Slash<a class="headerlink" href="#dir-then-slash" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__DIR__</a> must be concatenated with a string starting with /.</p>
<p>The magic constant <a class="reference external" href="https://www.php.net/manual/en/language.constants.predefined.php">__DIR__</a> holds the name of the current directory, without final /. When it is used to build path, then the following path fragment must start with /. Otherwise, two directories names will be merged together.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// __DIR__ = /a/b/c</span>
<span class="c1">// $filePath = /a/b/c/g.php</span>

<span class="c1">// /a/b/c/d/e/f.txt : correct path</span>
<span class="k">echo</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/d/e/f.txt&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;/d/e/f.txt&#39;</span><span class="p">;</span>

<span class="c1">// /a/b/cd/e/f.txt : most probably incorrect path</span>
<span class="k">echo</span> <span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;d/e/f.txt&#39;</span><span class="p">;</span>
<span class="k">echo</span> <span class="nb">dirname</span><span class="p">(</span><span class="nv">$filePath</span><span class="p">)</span><span class="o">.</span><span class="s1">&#39;d/e/f.txt&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2137">
<h3>9.749.1. Suggestions<a class="headerlink" href="#id2137" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a check on __DIR__, as it may be ‘/’ when run at the root of the server</li>
<li>Add a ‘/’ at the beginning of the path after __DIR__.</li>
<li>Add a call to realpath() or file_exists(), before accessing the file.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/DirThenSlash</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#traq-structures-dirthenslash"><span class="std std-ref">Traq</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="debuginfo-usage">
<span id="id2138"></span><h2>9.750. __debugInfo() Usage<a class="headerlink" href="#debuginfo-usage" title="Permalink to this headline">¶</a></h2>
<p>The magic method <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__debugInfo()</a> provides a custom way to dump an object.</p>
<p>It has been introduced in PHP 5.6. In the previous versions of PHP, this method is ignored and won’t be called when debugging.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 5.6 or later</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$bar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$reallyHidden</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">function</span> <span class="fm">__debugInfo</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;bar&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">,</span>
                <span class="s1">&#39;reallyHidden&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Secret&#39;</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$f</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>

<span class="cm">/* Displays :</span>
<span class="cm">object(foo)#1 (2) {</span>
<span class="cm">  [bar]=&gt;</span>
<span class="cm">  int(1)</span>
<span class="cm">  [reallyHidden]=&gt;</span>
<span class="cm">  string(6) Secret</span>
<span class="cm">}</span>
<span class="cm">*/</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">Magic methods</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/debugInfoUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#dolibarr-php-debuginfousage"><span class="std std-ref">Dolibarr</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="tostring-throws-exception">
<span id="id2141"></span><h2>9.751. __toString() Throws Exception<a class="headerlink" href="#tostring-throws-exception" title="Permalink to this headline">¶</a></h2>
<p>Magical method <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a> can’t throw exceptions.</p>
<p>In fact, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a> may not let an exception pass. If it throw an exception, but must catch it. If an underlying method throws an exception, it must be caught.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">myString</span> <span class="p">{</span>
    <span class="k">private</span> <span class="nv">$string</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">string</span> <span class="o">=</span> <span class="nv">$string</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="fm">__toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// Do not throw exceptions in __toString</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$this-&gt;string</span><span class="s2"> is not a string!!&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>A fatal error is displayed, when an exception is not intercepted in the <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a> function.</p>
<p>::</p>
<blockquote>
<div>PHP Fatal error:  Method myString::<a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a> must not throw an exception, caught Exception: ‘Exception message’ in <code class="docutils literal notranslate"><span class="pre">file.php</span></code></div></blockquote>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.magic.php">__toString()</a>.</p>
<div class="section" id="id2147">
<h3>9.751.1. Suggestions<a class="headerlink" href="#id2147" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove any usage of exception from __toString() magic method</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/toStringThrowsException</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="array-key-exists-speedup">
<span id="id2148"></span><h2>9.752. array_key_exists() Speedup<a class="headerlink" href="#array-key-exists-speedup" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.www.php.net/isset">isset()</a> used to be the fastest, but <a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a> is. Since PHP 7.4, <a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a> has its own opcode, leading to better features and speed.</p>
<p><a class="reference external" href="https://www.www.php.net/isset">isset()</a> is faster for all non-empty values, but is limited when the value is <a class="reference external" href="https://www.php.net/manual/en/language.types.null.php">NULL</a> or empty : then, <a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a> has the good features.</p>
<p><code class="docutils literal notranslate"><span class="pre">This</span> <span class="pre">change</span> <span class="pre">makes</span> <span class="pre">`array_key_exists()</span> <span class="pre">&lt;https://www.php.net/array_key_exists&gt;`_</span> <span class="pre">actually</span> <span class="pre">faster</span> <span class="pre">than</span> <span class="pre">`isset()</span> <span class="pre">&lt;https://www.www.php.net/isset&gt;`_</span> <span class="pre">by</span> <span class="pre">~25%</span> <span class="pre">(tested</span> <span class="pre">with</span> <span class="pre">GCC</span> <span class="pre">8,</span> <span class="pre">-O3,</span> <span class="pre">march=native,</span> <span class="pre">mtune=native).</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$foo</span> <span class="o">=</span> <span class="p">[</span><span class="mi">123</span> <span class="o">=&gt;</span> <span class="mi">456</span><span class="p">];</span>

<span class="c1">// This is sufficient and efficient since PHP 7.4</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">array_search_key</span><span class="p">(</span><span class="nv">$foo</span><span class="p">[</span><span class="mi">123</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// do something</span>
<span class="p">}</span>

<span class="c1">// taking advantages of performances for PHP 7.4 and older</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$foo</span><span class="p">[</span><span class="mi">123</span><span class="p">])</span> <span class="o">||</span> <span class="nx">array_search_key</span><span class="p">(</span><span class="nv">$foo</span><span class="p">[</span><span class="mi">123</span><span class="p">]))</span> <span class="p">{</span>
    <span class="c1">// do something</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/array_key_exists">Implement ZEND_ARRAY_KEY_EXISTS opcode to speed up `array_key_exists()</a> &lt;<a class="reference external" href="https://github.com/php/php-src/pull/3360">https://github.com/php/php-src/pull/3360</a>&gt;`_.</p>
<div class="section" id="id2156">
<h3>9.752.1. Suggestions<a class="headerlink" href="#id2156" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the logical test and the isset() call</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/ArrayKeyExistsSpeedup</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4+</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="array-key-exists-works-on-arrays">
<span id="id2157"></span><h2>9.753. array_key_exists() Works On Arrays<a class="headerlink" href="#array-key-exists-works-on-arrays" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/array_key_exists">array_key_exists()</a> requires arrays as second argument. Until PHP 7.4, objects were also allowed, yet it is now deprecated.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Valid way to check for key</span>
<span class="nv">$array</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">];</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nv">$array</span><span class="p">))</span>


<span class="c1">// Deprecated since PHP 7.4</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="k">new</span> <span class="k">Stdclass</span><span class="p">();</span>
<span class="nv">$object</span><span class="o">-&gt;</span><span class="na">a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">var_dump</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="nv">$object</span><span class="p">))</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<dl class="docutils">
<dt>See also <a class="reference external" href="https://wiki.php.net/rfc/deprecations_php_7_4#array_key_exists_with_objects">array_key_exists() with objects</a>, and</dt>
<dd><a class="reference external" href="https://php.net/array-key-exists">array_key_exists</a>, and.</dd>
</dl>
<div class="section" id="id2160">
<h3>9.753.1. Suggestions<a class="headerlink" href="#id2160" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the (array) cast to turn the object into an array</li>
<li>Use the native PHP function proprety_exists() or isset() on the property to check them.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/ArrayKeyExistsWithObjects</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a>, <a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="array-merge-and-variadic">
<span id="id2161"></span><h2>9.754. array_merge() And Variadic<a class="headerlink" href="#array-merge-and-variadic" title="Permalink to this headline">¶</a></h2>
<p>Always check value in variadic before using it with <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a> and <a class="reference external" href="https://www.php.net/array_merge_recursive">array_merge_recursive()</a>.</p>
<p>Before PHP 7.4, <a class="reference external" href="https://www.php.net/array_merge">array_merge()</a> and <a class="reference external" href="https://www.php.net/array_merge_recursive">array_merge_recursive()</a> would complain when no argument was provided. As such, using the spread operator <cite>…</cite> on an empty <a class="reference external" href="https://www.php.net/array">array()</a> would yield no argument, and an error.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">//</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">array_merge</span><span class="p">(</span><span class="o">...</span><span class="nv">$x</span><span class="p">);</span>



<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2167">
<h3>9.754.1. Suggestions<a class="headerlink" href="#id2167" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Add a check to the spread variable to ensure it is not empty</li>
<li>Append an empty array to to the spread variable to ensure it is not empty</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ArrayMergeAndVariadic</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>7.4-</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="crypt-without-salt">
<span id="id2168"></span><h2>9.755. crypt() Without Salt<a class="headerlink" href="#crypt-without-salt" title="Permalink to this headline">¶</a></h2>
<p>PHP requires a salt when calling <a class="reference external" href="https://www.php.net/crypt">crypt()</a>. 5.5 and previous versions didn’t require it. Salt is a simple string, that is usually only known by the application.</p>
<p>According to the manual : The salt parameter is optional. However, <a class="reference external" href="https://www.php.net/crypt">crypt()</a> creates a weak hash without the salt. PHP 5.6 or later raise an E_NOTICE error without it. Make sure to specify a strong enough salt for better security.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// Set the password</span>
<span class="nv">$password</span> <span class="o">=</span> <span class="s1">&#39;mypassword&#39;</span><span class="p">;</span>

<span class="c1">// salted crypt usage (always valid)</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="nb">crypt</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="s1">&#39;123salt&#39;</span><span class="p">);</span>

<span class="c1">// Get the hash, letting the salt be automatically generated</span>
<span class="c1">// This generates a notice after PHP 5.6</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="nb">crypt</span><span class="p">(</span><span class="nv">$password</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/crypt">crypt</a>.</p>
<div class="section" id="id2172">
<h3>9.755.1. Suggestions<a class="headerlink" href="#id2172" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always provide the second argument</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CryptWithoutSalt</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="curl-version-has-no-argument">
<span id="id2173"></span><h2>9.756. curl_version() Has No Argument<a class="headerlink" href="#curl-version-has-no-argument" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/curl_version">curl_version()</a> used to accept <code class="docutils literal notranslate"><span class="pre">CURLVERSION_NOW</span></code> as argument. Since PHP 7.4, it is a function without arguments.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Compatible syntax</span>
<span class="nv">$details</span> <span class="o">=</span> <span class="nb">curl_version</span><span class="p">(</span><span class="nx">CURLVERSION_NOW</span><span class="p">);</span>

<span class="c1">// New PHP 7.4 syntax</span>
<span class="nv">$details</span> <span class="o">=</span> <span class="nb">curl_version</span><span class="p">();</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.curl-version.php">curl_version</a>.</p>
<div class="section" id="id2175">
<h3>9.756.1. Suggestions<a class="headerlink" href="#id2175" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Drop all arguments from curl_version() calls.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/CurlVersionNow</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="error-reporting-with-integers">
<span id="id2176"></span><h2>9.757. error_reporting() With Integers<a class="headerlink" href="#error-reporting-with-integers" title="Permalink to this headline">¶</a></h2>
<p>Using named constants with error_reporting is strongly encouraged to ensure compatibility for future versions. As error levels are added, the range of integers increases, so older integer-based error levels will not always behave as expected. (Adapted from the documentation).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This is ready for PHP next version</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span> <span class="o">&amp;</span> <span class="o">~</span><span class="nx">E_DEPRECATED</span> <span class="o">&amp;</span> <span class="o">~</span><span class="nx">E_STRICT</span> <span class="o">&amp;</span> <span class="o">~</span><span class="nx">E_NOTICE</span> <span class="o">&amp;</span> <span class="o">~</span><span class="k">E_WARNING</span><span class="p">);</span>

<span class="c1">// This is not ready for PHP next version</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">2047</span><span class="p">);</span>

<span class="c1">// -1 and 0 are omitted, as they will be valid even is constants changes.</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/errorfunc.configuration.php#ini.error-reporting">directive error_reporting</a> and <a class="reference external" href="https://www.php.net/manual/en/function.error-reporting.php">error_reporting</a>.</p>
<div class="section" id="id2178">
<h3>9.757.1. Suggestions<a class="headerlink" href="#id2178" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use the constant combination when configuring error_reporting or any PHP native function</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ErrorReportingWithInteger</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#sugarcrm-structures-errorreportingwithinteger"><span class="std std-ref">SugarCrm</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="eval-without-try">
<span id="id2179"></span><h2>9.758. eval() Without Try<a class="headerlink" href="#eval-without-try" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">eval()</span></code> emits a <code class="docutils literal notranslate"><span class="pre">ParseError</span></code> exception with PHP 7 and later. Catching this exception is the recommended way to handle errors when using the <code class="docutils literal notranslate"><span class="pre">eval()</span></code> function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$code</span> <span class="o">=</span> <span class="s1">&#39;This is no PHP code.&#39;</span><span class="p">;</span>

<span class="c1">//PHP 5 style</span>
<span class="k">eval</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>
<span class="c1">// Ends up with a Fatal error, at execution time</span>

<span class="c1">//PHP 7 style</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="k">eval</span><span class="p">(</span><span class="nv">$code</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ParseError</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">cleanUpAfterEval</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Note that it will catch situations where <code class="docutils literal notranslate"><span class="pre">eval()</span></code> is provided with code that can’t be used, but it will not catch security problems. Avoid using <code class="docutils literal notranslate"><span class="pre">eval()</span></code> with incoming data.</p>
<div class="section" id="id2180">
<h3>9.758.1. Suggestions<a class="headerlink" href="#id2180" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always add a try/catch block around eval() call</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/EvalWithoutTry</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#fuelcms-structures-evalwithouttry"><span class="std std-ref">FuelCMS</span></a>, <a class="reference internal" href="Cases.html#expressionengine-structures-evalwithouttry"><span class="std std-ref">ExpressionEngine</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="ext-apc">
<span id="id2181"></span><h2>9.759. ext/apc<a class="headerlink" href="#ext-apc" title="Permalink to this headline">¶</a></h2>
<p>Extension Alternative PHP Cache.</p>
<p>The Alternative PHP Cache (APC) is a free and open opcode cache for PHP. Its goal is to provide a free, open, and robust framework for caching and optimizing PHP intermediate code.</p>
<p>This extension is considered unmaintained and dead.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
   <span class="nv">$bar</span> <span class="o">=</span> <span class="s1">&#39;BAR&#39;</span><span class="p">;</span>
   <span class="nb">apc_add</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">);</span>
   <span class="nb">var_dump</span><span class="p">(</span><span class="nb">apc_fetch</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>
   <span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

   <span class="nv">$bar</span> <span class="o">=</span> <span class="s1">&#39;NEVER GETS SET&#39;</span><span class="p">;</span>
   <span class="nb">apc_add</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="nv">$bar</span><span class="p">);</span>
   <span class="nb">var_dump</span><span class="p">(</span><span class="nb">apc_fetch</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">));</span>
   <span class="k">echo</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/apc">Alternative PHP Cache</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Extensions/Extapc</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ext-dba">
<span id="id2182"></span><h2>9.760. ext/dba<a class="headerlink" href="#ext-dba" title="Permalink to this headline">¶</a></h2>
<p>Extension ext/dba.</p>
<p>These functions build the foundation for accessing Berkeley DB style databases.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$id</span> <span class="o">=</span> <span class="nb">dba_open</span><span class="p">(</span><span class="s1">&#39;/tmp/test.db&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;db2&#39;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;dba_open failed&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="k">exit</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">dba_replace</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="s1">&#39;This is an example!&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">dba_exists</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nb">dba_fetch</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
    <span class="nb">dba_delete</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="nv">$id</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">dba_close</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/book.dba.php">Database (dbm-style) Abstraction Layer</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Extensions/Extdba</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ext-ereg">
<span id="id2183"></span><h2>9.761. ext/ereg<a class="headerlink" href="#ext-ereg" title="Permalink to this headline">¶</a></h2>
<p>Extension ext/ereg.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">ereg</span> <span class="p">(</span><span class="s1">&#39;([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})&#39;</span><span class="p">,</span> <span class="nv">$date</span><span class="p">,</span> <span class="nv">$regs</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$regs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="nv">$regs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="nv">$regs</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s1">&#39;Invalid date format: &#39;</span><span class="o">.</span><span class="nv">$date</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.ereg.php">Ereg</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Extensions/Extereg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ext-fdf">
<span id="id2185"></span><h2>9.762. ext/fdf<a class="headerlink" href="#ext-fdf" title="Permalink to this headline">¶</a></h2>
<p>Extension ext/fdf.</p>
<p>Forms Data Format (<a class="reference external" href="http://www.adobe.com/devnet/acrobat/fdftoolkit.html">FDF</a>) is a format for handling forms within PDF documents.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$outfdf</span> <span class="o">=</span> <span class="nb">fdf_create</span><span class="p">();</span>
<span class="nb">fdf_set_value</span><span class="p">(</span><span class="nv">$outfdf</span><span class="p">,</span> <span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="nv">$volume</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nb">fdf_set_file</span><span class="p">(</span><span class="nv">$outfdf</span><span class="p">,</span> <span class="s1">&#39;http:/testfdf/resultlabel.pdf&#39;</span><span class="p">);</span>
<span class="nb">fdf_save</span><span class="p">(</span><span class="nv">$outfdf</span><span class="p">,</span> <span class="s1">&#39;outtest.fdf&#39;</span><span class="p">);</span>
<span class="nb">fdf_close</span><span class="p">(</span><span class="nv">$outfdf</span><span class="p">);</span>
<span class="nx">Header</span><span class="p">(</span><span class="s1">&#39;Content-type: application/vnd.fdf&#39;</span><span class="p">);</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;outtest.fdf&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">);</span>
<span class="nb">fpassthru</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
<span class="nb">unlink</span><span class="p">(</span><span class="s1">&#39;outtest.fdf&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/book.fdf.php">Form Data Format</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Extensions/Extfdf</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ext-mcrypt">
<span id="id2186"></span><h2>9.763. ext/mcrypt<a class="headerlink" href="#ext-mcrypt" title="Permalink to this headline">¶</a></h2>
<p>Extension for mcrypt.</p>
<p>This extension has been deprecated as of PHP 7.1.0 and moved to PECL as of PHP 7.2.0.</p>
<p>This is an interface to the mcrypt library, which supports a wide variety of block algorithms such as DES, TripleDES, Blowfish (default), 3-WAY, SAFER-SK64, SAFER-SK128, TWOFISH, TEA, RC2 and GOST in CBC, OFB, CFB and ECB cipher modes. Additionally, it supports RC6 and IDEA which are considered ‘non-free’. CFB/OFB are 8bit by default.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1"># --- ENCRYPTION ---</span>

    <span class="c1"># the key should be random binary, use scrypt, bcrypt or PBKDF2 to</span>
    <span class="c1"># convert a string into a key</span>
    <span class="c1"># key is specified using hexadecimal</span>
    <span class="nv">$key</span> <span class="o">=</span> <span class="nb">pack</span><span class="p">(</span><span class="s1">&#39;H*&#39;</span><span class="p">,</span> <span class="s1">&#39;bcb04b7e103a0cd8b54763051cef08bc55abe029fdebae5e1d417e2ffb2a00a3&#39;</span><span class="p">);</span>

    <span class="c1"># show key size use either 16, 24 or 32 byte keys for AES-128, 192</span>
    <span class="c1"># and 256 respectively</span>
    <span class="nv">$key_size</span> <span class="o">=</span>  <span class="nb">strlen</span><span class="p">(</span><span class="nv">$key</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">&#39;Key size: &#39;</span> <span class="o">.</span> <span class="nv">$key_size</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

    <span class="nv">$plaintext</span> <span class="o">=</span> <span class="s1">&#39;This string was AES-256 / CBC / ZeroBytePadding encrypted.&#39;</span><span class="p">;</span>

    <span class="c1"># create a random IV to use with CBC encoding</span>
    <span class="nv">$iv_size</span> <span class="o">=</span> <span class="nb">mcrypt_get_iv_size</span><span class="p">(</span><span class="nx">MCRYPT_RIJNDAEL_128</span><span class="p">,</span> <span class="nx">MCRYPT_MODE_CBC</span><span class="p">);</span>
    <span class="nv">$iv</span> <span class="o">=</span> <span class="nb">mcrypt_create_iv</span><span class="p">(</span><span class="nv">$iv_size</span><span class="p">,</span> <span class="nx">MCRYPT_RAND</span><span class="p">);</span>

    <span class="c1"># creates a cipher text compatible with AES (Rijndael block size = 128)</span>
    <span class="c1"># to keep the text confidential</span>
    <span class="c1"># only suitable for encoded input that never ends with value 00h</span>
    <span class="c1"># (because of default zero padding)</span>
    <span class="nv">$ciphertext</span> <span class="o">=</span> <span class="nb">mcrypt_encrypt</span><span class="p">(</span><span class="nx">MCRYPT_RIJNDAEL_128</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span>
                                 <span class="nv">$plaintext</span><span class="p">,</span> <span class="nx">MCRYPT_MODE_CBC</span><span class="p">,</span> <span class="nv">$iv</span><span class="p">);</span>

    <span class="c1"># prepend the IV for it to be available for decryption</span>
    <span class="nv">$ciphertext</span> <span class="o">=</span> <span class="nv">$iv</span> <span class="o">.</span> <span class="nv">$ciphertext</span><span class="p">;</span>

    <span class="c1"># encode the resulting cipher text so it can be represented by a string</span>
    <span class="nv">$ciphertext_base64</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nv">$ciphertext</span><span class="p">);</span>

    <span class="k">echo</span>  <span class="nv">$ciphertext_base64</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>

    <span class="c1"># === WARNING ===</span>

    <span class="c1"># Resulting cipher text has no integrity or authenticity added</span>
    <span class="c1"># and is not protected against padding oracle attacks.</span>

    <span class="c1"># --- DECRYPTION ---</span>

    <span class="nv">$ciphertext_dec</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$ciphertext_base64</span><span class="p">);</span>

    <span class="c1"># retrieves the IV, iv_size should be created using mcrypt_get_iv_size()</span>
    <span class="nv">$iv_dec</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$ciphertext_dec</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$iv_size</span><span class="p">);</span>

    <span class="c1"># retrieves the cipher text (everything except the $iv_size in the front)</span>
    <span class="nv">$ciphertext_dec</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$ciphertext_dec</span><span class="p">,</span> <span class="nv">$iv_size</span><span class="p">);</span>

    <span class="c1"># may remove 00h valued characters from end of plain text</span>
    <span class="nv">$plaintext_dec</span> <span class="o">=</span> <span class="nb">mcrypt_decrypt</span><span class="p">(</span><span class="nx">MCRYPT_RIJNDAEL_128</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span>
                                    <span class="nv">$ciphertext_dec</span><span class="p">,</span> <span class="nx">MCRYPT_MODE_CBC</span><span class="p">,</span> <span class="nv">$iv_dec</span><span class="p">);</span>

    <span class="k">echo</span>  <span class="nv">$plaintext_dec</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.php.net/manual/en/book.mcrypt.php">extension mcrypt</a> and <a class="reference external" href="http://mcrypt.sourceforge.net/">mcrypt</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Extensions/Extmcrypt</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ext-mhash">
<span id="id2187"></span><h2>9.764. ext/mhash<a class="headerlink" href="#ext-mhash" title="Permalink to this headline">¶</a></h2>
<p>Extension mhash (obsolete since PHP 5.3.0).</p>
<p>This extension provides functions, intended to work with <a class="reference external" href="http://mhash.sourceforge.net/">mhash</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$input</span> <span class="o">=</span> <span class="s1">&#39;what do ya want for nothing?&#39;</span><span class="p">;</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="nb">mhash</span><span class="p">(</span><span class="nx">MHASH_MD5</span><span class="p">,</span> <span class="nv">$input</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39;The hash is &#39;</span> <span class="o">.</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nv">$hash</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="nv">$hash</span> <span class="o">=</span> <span class="nb">mhash</span><span class="p">(</span><span class="nx">MHASH_MD5</span><span class="p">,</span> <span class="nv">$input</span><span class="p">,</span> <span class="s1">&#39;Jefe&#39;</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">&#39;The hmac is &#39;</span> <span class="o">.</span> <span class="nb">bin2hex</span><span class="p">(</span><span class="nv">$hash</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39;&lt;br /&gt;&#39;</span><span class="o">.</span><span class="nx">PHP_EOL</span><span class="p">;</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/book.mhash.php">Extension mhash</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Extensions/Extmhash</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ext-ming">
<span id="id2188"></span><h2>9.765. ext/ming<a class="headerlink" href="#ext-ming" title="Permalink to this headline">¶</a></h2>
<p>Extension ext/ming, to create swf files with PHP.</p>
<p>Ming is an open-source (LGPL) library which allows you to create SWF (‘Flash’) format movies.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="nv">$s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SWFShape</span><span class="p">();</span>
  <span class="nv">$f</span> <span class="o">=</span> <span class="nv">$s</span><span class="o">-&gt;</span><span class="na">addFill</span><span class="p">(</span><span class="mh">0xff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="nv">$s</span><span class="o">-&gt;</span><span class="na">setRightFill</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>

  <span class="nv">$s</span><span class="o">-&gt;</span><span class="na">movePenTo</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">);</span>
  <span class="nv">$s</span><span class="o">-&gt;</span><span class="na">drawLineTo</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">);</span>
  <span class="nv">$s</span><span class="o">-&gt;</span><span class="na">drawLineTo</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
  <span class="nv">$s</span><span class="o">-&gt;</span><span class="na">drawLineTo</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
  <span class="nv">$s</span><span class="o">-&gt;</span><span class="na">drawLineTo</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">);</span>

  <span class="nv">$p</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SWFSprite</span><span class="p">();</span>
  <span class="nv">$i</span> <span class="o">=</span> <span class="nv">$p</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$s</span><span class="p">);</span>
  <span class="nv">$i</span><span class="o">-&gt;</span><span class="na">setDepth</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="nv">$p</span><span class="o">-&gt;</span><span class="na">nextFrame</span><span class="p">();</span>

  <span class="k">for</span> <span class="p">(</span><span class="nv">$n</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$n</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">;</span> <span class="o">++</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$i</span><span class="o">-&gt;</span><span class="na">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">);</span>
    <span class="nv">$p</span><span class="o">-&gt;</span><span class="na">nextFrame</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="nv">$m</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SWFMovie</span><span class="p">();</span>
  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">setBackground</span><span class="p">(</span><span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>
  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">setDimension</span><span class="p">(</span><span class="mi">6000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">);</span>

  <span class="nv">$i</span> <span class="o">=</span> <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$p</span><span class="p">);</span>
  <span class="nv">$i</span><span class="o">-&gt;</span><span class="na">setDepth</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="nv">$i</span><span class="o">-&gt;</span><span class="na">moveTo</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
  <span class="nv">$i</span><span class="o">-&gt;</span><span class="na">setName</span><span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">);</span>

  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">SWFAction</span><span class="p">(</span><span class="s1">&#39;/box.x += 3;&#39;</span><span class="p">));</span>
  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">nextFrame</span><span class="p">();</span>
  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">SWFAction</span><span class="p">(</span><span class="s1">&#39;gotoFrame(0); play();&#39;</span><span class="p">));</span>
  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">nextFrame</span><span class="p">();</span>

  <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Content-type: application/x-shockwave-flash&#39;</span><span class="p">);</span>
  <span class="nv">$m</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">();</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="http://www.libming.org/">Ming (flash)</a> and <a class="reference external" href="http://www.libming.org/">Ming</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Extensions/Extming</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ext-mysql">
<span id="id2189"></span><h2>9.766. ext/mysql<a class="headerlink" href="#ext-mysql" title="Permalink to this headline">¶</a></h2>
<p>Extension for MySQL (Original MySQL API).</p>
<p>This extension is deprecated as of PHP 5.5.0, and has been removed as of PHP 7.0.0. Instead, either the mysqli or PDO_MySQL extension should be used. See also the MySQL API Overview for further help while choosing a MySQL API. .. code-block:: php &lt;?php $result = mysql_query(‘SELECT * WHERE 1=1’); if (!$result) { die(‘Invalid query: ‘ . mysql_error()); } ?&gt; See also <a class="reference external" href="http://www.php.net/manual/en/book.mysql.php">Original MySQL API</a> and <a class="reference external" href="http://www.mysql.com/">MySQL</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Extensions/Extmysql</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="filter-input-as-a-source">
<span id="id2190"></span><h2>9.767. filter_input() As A Source<a class="headerlink" href="#filter-input-as-a-source" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.php.net/filter_input">filter_input()</a> and <a class="reference external" href="https://www.php.net/filter_input_array">filter_input_array()</a> functions access directly to <code class="docutils literal notranslate"><span class="pre">$_GET</span></code>. They represent a source for external data just like <code class="docutils literal notranslate"><span class="pre">$_GET</span></code>, <code class="docutils literal notranslate"><span class="pre">$_POST</span></code>, etc.</p>
<p>The main feature of <a class="reference external" href="https://www.php.net/filter_input">filter_input()</a> is that it is already filtered. The main drawback is that <code class="docutils literal notranslate"><span class="pre">FILTER_FLAG_NONE</span></code> is the <code class="docutils literal notranslate"><span class="pre">none</span></code> filter, and that default configuration is <cite>FILTER_UNSAFE_RAW</cite>.</p>
<p>The filter extension keeps access to the incoming data, even after the super globals, such as <code class="docutils literal notranslate"><span class="pre">$_GET</span></code>, are unset.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Removing $_GET</span>
<span class="nv">$_GET</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// with the default : FILTER_UNSAFE_RAW, this means XSS</span>
<span class="k">echo</span> <span class="nb">filter_input</span><span class="p">(</span><span class="nx">INPUT_GET</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>

<span class="c1">// Same as above :</span>
<span class="k">echo</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nx">_GET</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Thanks to <a class="reference external" href="https://twitter.com/FredBouchery/">Frederic Bouchery</a> for reporting this <a class="reference external" href="https://twitter.com/FredBouchery/status/1049297213598457857">special case</a>.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/book.filter.php">Data filtering</a>.</p>
<div class="section" id="id2194">
<h3>9.767.1. Suggestions<a class="headerlink" href="#id2194" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the classic $_GET, $_POST super globals, which are easier to audit.</li>
<li>Use your framework’s parameter access.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/FilterInputSource</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="fputcsv-in-loops">
<span id="id2195"></span><h2>9.768. fputcsv() In Loops<a class="headerlink" href="#fputcsv-in-loops" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/fputcsv">fputcsv()</a> is slow when called on each row. It actually flushes the data to the disk each time, and that results in a inefficient dump to the disk, each call.</p>
<p>To speed up this process, it is recommended to dump the csv to memory first, then dump the memory to the disk, in larger chunks. Since <a class="reference external" href="https://www.php.net/fputcsv">fputcsv()</a> works only on stream, it is necessary to use a memory stream.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Speedy yet memory intensive version</span>
<span class="nv">$f</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;php://memory&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$data_source</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// You may configure fputcsv as usual</span>
    <span class="nb">fputcsv</span><span class="p">(</span><span class="nv">$f</span><span class="p">,</span> <span class="nv">$row</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">rewind</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span> <span class="c1">// Important</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;final.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">);</span>
<span class="nb">fputs</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nb">stream_get_contents</span><span class="p">(</span><span class="nv">$f</span><span class="p">));</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>

<span class="c1">// Slower version</span>
<span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="s1">&#39;final.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">);</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$data_source</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// You may configure fputcsv as usual</span>
    <span class="nb">fputcsv</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nv">$row</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">fclose</span><span class="p">(</span><span class="nv">$fp</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The speed improvement is significant on small rows, while it may be less significant on larger rows : with more data in the rows, the file buffer may fill up more efficiently. On small rows, the speed gain is up to 7 times.</p>
<div class="section" id="id2197">
<h3>9.768.1. Suggestions<a class="headerlink" href="#id2197" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use fputcsv() on a memory stream, and flush it on the disk once</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/CsvInLoops</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a>, <a class="reference internal" href="Rulesets.html#top10"><span class="std std-ref">Top10</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="func-get-arg-modified">
<span id="id2198"></span><h2>9.769. func_get_arg() Modified<a class="headerlink" href="#func-get-arg-modified" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/func_get_arg">func_get_arg()</a> and <a class="reference external" href="https://www.php.net/func_get_args">func_get_args()</a> used to report the calling value of the argument until PHP 7. Since PHP 7, it is reporting the value of the argument at calling time, which may have been modified by a previous instruction.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">function</span> <span class="nf">x</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">++</span><span class="p">;</span>
    <span class="k">print</span> <span class="nb">func_get_arg</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">x</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This code will display 1 in PHP 7, and 0 in PHP 5.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Functions/funcGetArgModified</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="idn-to-ascii-new-default">
<span id="id2200"></span><h2>9.770. idn_to_ascii() New Default<a class="headerlink" href="#idn-to-ascii-new-default" title="Permalink to this headline">¶</a></h2>
<p>The default parameter value of <a class="reference external" href="https://www.php.net/idn_to_ascii">idn_to_ascii()</a> and <a class="reference external" href="https://www.php.net/idn_to_utf8">idn_to_utf8()</a> is now INTL_IDNA_VARIANT_UTS46 instead of the deprecated INTL_IDNA_VARIANT_2003.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">echo</span> <span class="nb">idn_to_ascii</span><span class="p">(</span><span class="s1">&#39;täst.de&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.idn-to-ascii.php">idn_to_ascii</a>, <a class="reference external" href="https://www.php.net/manual/en/function.idn-to-utf8.php">idn_to_utf8</a> and <a class="reference external" href="http://unicode.org/reports/tr46/">Unicode IDNA Compatibility Processing</a>.</p>
<div class="section" id="id2203">
<h3>9.770.1. Suggestions<a class="headerlink" href="#id2203" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Explicitely add the second parameter to the idn_to_ascii() and idn_to_utf8() functions.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/IdnUts46</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="include-once-usage">
<span id="id2204"></span><h2>9.771. include_once() Usage<a class="headerlink" href="#include-once-usage" title="Permalink to this headline">¶</a></h2>
<p>include_once() and require_once() functions should be avoided for performances reasons.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Including a library.</span>
<span class="k">include</span> <span class="s1">&#39;lib/helpers.inc&#39;</span><span class="p">;</span>

<span class="c1">// Including a library, and avoiding double inclusion</span>
<span class="k">include_once</span> <span class="s1">&#39;lib/helpers.inc&#39;</span><span class="p">;</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Try using autoload for loading classes, or use include() or require() and make it possible to include several times the same file without errors.</p>
<div class="section" id="id2205">
<h3>9.771.1. Suggestions<a class="headerlink" href="#id2205" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Avoid using include_once() whenever possible</li>
<li>Use autoload() to load classes, and avoid loading them with include</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="85%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/OnceUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#xoops-structures-onceusage"><span class="std std-ref">XOOPS</span></a>, <a class="reference internal" href="Cases.html#tikiwiki-structures-onceusage"><span class="std std-ref">Tikiwiki</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="isset-with-constant">
<span id="id2206"></span><h2>9.772. isset() With Constant<a class="headerlink" href="#isset-with-constant" title="Permalink to this headline">¶</a></h2>
<p>Until PHP 7, it was possible to use arrays as constants, but it was not possible to test them with <a class="reference external" href="https://www.www.php.net/isset">isset</a>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="k">const</span> <span class="no">X</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>

<span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nx">X</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span> <span class="p">{}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This would yield an error : <code class="docutils literal notranslate"><span class="pre">Cannot</span> <span class="pre">use</span> <span class="pre">`isset()</span> <span class="pre">&lt;https://www.www.php.net/isset&gt;`_</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">result</span> <span class="pre">of</span> <span class="pre">an</span> <span class="pre">expression</span> <span class="pre">(you</span> <span class="pre">can</span> <span class="pre">use</span> <span class="pre">&quot;null</span> <span class="pre">!==</span> <span class="pre">expression&quot;</span> <span class="pre">instead)</span></code>. This is a backward incompatibility.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/IssetWithConstant</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp53"><span class="std std-ref">CompatibilityPHP53</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp54"><span class="std std-ref">CompatibilityPHP54</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp55"><span class="std std-ref">CompatibilityPHP55</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp56"><span class="std std-ref">CompatibilityPHP56</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 7.0 and more recent</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="list-may-omit-variables">
<span id="id2208"></span><h2>9.773. list() May Omit Variables<a class="headerlink" href="#list-may-omit-variables" title="Permalink to this headline">¶</a></h2>
<p>Simply omit any unused variable in a <a class="reference external" href="https://www.php.net/list">list()</a> call.</p>
<p><a class="reference external" href="https://www.php.net/list">list()</a> is the only PHP function that accepts to have omitted arguments. If the following code makes no usage of a listed variable, just omit it.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// No need for &#39;2&#39;, so no assignation</span>
    <span class="k">list</span> <span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

    <span class="c1">// works with PHP 7.1 short syntax</span>
    <span class="p">[</span><span class="nv">$a</span><span class="p">,</span> <span class="p">,</span> <span class="nv">$b</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

    <span class="c1">// No need for &#39;2&#39;, so no assignation</span>
    <span class="k">list</span> <span class="p">(</span><span class="nv">$a</span><span class="p">,</span> <span class="nv">$c</span><span class="p">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.list.php">list</a>.</p>
<div class="section" id="id2212">
<h3>9.773.1. Suggestions<a class="headerlink" href="#id2212" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove the unused variables from the list call</li>
<li>When the ignored values are at the beginning or the end of the array, array_slice() may be used to shorten the array.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/ListOmissions</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Precision</td>
<td>Very high</td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#openconf-structures-listomissions"><span class="std std-ref">OpenConf</span></a>, <a class="reference internal" href="Cases.html#fuelcms-structures-listomissions"><span class="std std-ref">FuelCMS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mb-strrpos-third-argument">
<span id="id2213"></span><h2>9.774. mb_strrpos() Third Argument<a class="headerlink" href="#mb-strrpos-third-argument" title="Permalink to this headline">¶</a></h2>
<p>Passing the encoding as 3rd parameter to <a class="reference external" href="https://www.php.net/mb_strrpos">mb_strrpos()</a> is deprecated. Instead pass a 0 offset, and encoding as 4th parameter.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Finds the position of the last occurrence of of a string in a string, starting at position 10</span>
<span class="nv">$extract</span> <span class="o">=</span> <span class="nb">mb_strrpos</span><span class="p">(</span><span class="nv">$haystack</span><span class="p">,</span> <span class="nv">$needle</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>

<span class="c1">// This is the old behavior. Here, the offset will be 0, by default</span>
<span class="nv">$extract</span> <span class="o">=</span> <span class="nb">mb_strrpos</span><span class="p">(</span><span class="nv">$haystack</span><span class="p">,</span> <span class="nv">$needle</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/mb_strrpos">mb_strrpos()</a>.</p>
<div class="section" id="id2216">
<h3>9.774.1. Suggestions<a class="headerlink" href="#id2216" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li></li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/Php74mbstrrpos3rdArg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="mcrypt-create-iv-with-default-values">
<span id="id2217"></span><h2>9.775. mcrypt_create_iv() With Default Values<a class="headerlink" href="#mcrypt-create-iv-with-default-values" title="Permalink to this headline">¶</a></h2>
<p>Avoid using <a class="reference external" href="https://www.php.net/manual/en/function.mcrypt-create-iv.php">mcrypt_create_iv()</a> default values.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/function.mcrypt-create-iv.php">mcrypt_create_iv()</a> used to have <code class="docutils literal notranslate"><span class="pre">MCRYPT_DEV_RANDOM</span></code> as default values, and in PHP 5.6, it now uses <code class="docutils literal notranslate"><span class="pre">MCRYPT_DEV_URANDOM</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="nv">$size</span> <span class="o">=</span> <span class="nb">mcrypt_get_iv_size</span><span class="p">(</span><span class="nx">MCRYPT_CAST_256</span><span class="p">,</span> <span class="nx">MCRYPT_MODE_CFB</span><span class="p">);</span>
    <span class="c1">// mcrypt_create_iv is missing the second argument</span>
    <span class="nv">$iv</span> <span class="o">=</span> <span class="nb">mcrypt_create_iv</span><span class="p">(</span><span class="nv">$size</span><span class="p">);</span>

<span class="c1">// Identical to the line below</span>
<span class="c1">//    $iv = mcrypt_create_iv($size, MCRYPT_DEV_RANDOM);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>If the code doesn’t have a second argument, it relies on the default value. It is recommended to set explicitly the value, so has to avoid problems while migrating.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.mcrypt-create-iv.php">mcrypt_create_iv()</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/McryptcreateivWithoutOption</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Php Version</td>
<td>With PHP 5.6 and older</td>
</tr>
<tr class="row-even"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-odd"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="move-uploaded-file-instead-of-copy">
<span id="id2220"></span><h2>9.776. move_uploaded_file Instead Of copy<a class="headerlink" href="#move-uploaded-file-instead-of-copy" title="Permalink to this headline">¶</a></h2>
<p>Always use <a class="reference external" href="https://www.php.net/move_uploaded_file">move_uploaded_file()</a> with uploaded files. Avoid using copy or rename with uploaded file.</p>
<p><a class="reference external" href="https://www.php.net/move_uploaded_file">move_uploaded_file()</a> checks to ensure that the file designated by filename is a valid upload file (meaning that it was uploaded via PHP’s HTTP POST upload mechanism).</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

    <span class="c1">// $a-&gt;file was filled with $_FILES at some point</span>
    <span class="nb">move_uploaded_file</span><span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">[</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$target</span><span class="p">);</span>

    <span class="c1">// $a-&gt;file was filled with $_FILES at some point</span>
    <span class="nb">rename</span><span class="p">(</span><span class="nv">$a</span><span class="o">-&gt;</span><span class="na">file</span><span class="p">[</span><span class="s1">&#39;tmp_name&#39;</span><span class="p">],</span> <span class="nv">$target</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/move_uploaded_file">move_uploaded_file</a> and <a class="reference external" href="https://www.sitepoint.com/file-uploads-with-php/">Uploading Files with PHP</a>.</p>
<div class="section" id="id2223">
<h3>9.776.1. Suggestions<a class="headerlink" href="#id2223" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Always use move_uploaded_file()</li>
<li>Extract the needed information from the file, and leave it for PHP to remove without storage</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/MoveUploadedFile</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="openssl-random-pseudo-byte-second-argument">
<span id="id2224"></span><h2>9.777. openssl_random_pseudo_byte() Second Argument<a class="headerlink" href="#openssl-random-pseudo-byte-second-argument" title="Permalink to this headline">¶</a></h2>
<p>openssl_random_pseudo_byte() uses exceptions to signal an error. Since PHP 7.4, there is no need to use the second argument.</p>
<p>On the other hand, it is important to catch the exception that openssl_random_pseudo_byte() may emit.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="c1">// PHP 7.4 way to check on random number generation</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nv">$bytes</span> <span class="o">=</span> <span class="nb">openssl_random_pseudo_bytes</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="nx">Error</span> <span class="k">while</span> <span class="nx">loading</span> <span class="nx">random</span> <span class="nx">number</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Old way to check on random number generation</span>
    <span class="nv">$bytes</span> <span class="o">=</span> <span class="nb">openssl_random_pseudo_bytes</span><span class="p">(</span><span class="nv">$i</span><span class="p">,</span> <span class="nv">$cstrong</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$cstrong</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">die</span><span class="p">(</span><span class="nx">Error</span> <span class="k">while</span> <span class="nx">loading</span> <span class="nx">random</span> <span class="nx">number</span><span class="p">);</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/openssl_random_pseudo_bytes">openssl_random_pseudo_byte</a> and <a class="reference external" href="https://www.php.net/openssl_random_pseudo_bytes">PHP RFC: Improve `openssl_random_pseudo_bytes()</a> &lt;<a class="reference external" href="https://wiki.php.net/rfc/improve-openssl-random-pseudo-bytes">https://wiki.php.net/rfc/improve-openssl-random-pseudo-bytes</a>&gt;`_.</p>
<div class="section" id="id2225">
<h3>9.777.1. Suggestions<a class="headerlink" href="#id2225" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Skip the second argument, add a try/catch around the call to openssl_random_pseudo_bytes()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/OpensslRandomPseudoByteSecondArg</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp74"><span class="std std-ref">CompatibilityPHP74</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="parse-str-warning">
<span id="id2226"></span><h2>9.778. parse_str() Warning<a class="headerlink" href="#parse-str-warning" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.php.net/parse_str">parse_str()</a> function parses a query string and assigns the resulting variables to the local scope. This may create a unexpected number of variables, and even overwrite the existing one.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
  <span class="k">function</span> <span class="nf">foo</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">global</span> <span class="nv">$a</span><span class="p">;</span>

    <span class="k">echo</span> <span class="nv">$a</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nb">parse_str</span><span class="p">(</span><span class="s1">&#39;a=1&#39;</span><span class="p">);</span> <span class="c1">// No second parameter</span>
  <span class="nx">foo</span><span class="p">(</span> <span class="p">);</span>
  <span class="c1">// displays 1</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Always use an empty variable a second parameter to <a class="reference external" href="https://www.php.net/parse_str">parse_str()</a>, so as to collect the incoming values, and then, filter them in that array.</p>
<div class="section" id="id2229">
<h3>9.778.1. Suggestions<a class="headerlink" href="#id2229" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the second parameter when calling parse_url();</li>
<li>Change to PHP 8.0 version, which made the second argument compulsory</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Security/parseUrlWithoutParameters</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/know-your-variables.md">know-your-variables</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="preg-match-all-flag">
<span id="id2230"></span><h2>9.779. preg_match_all() Flag<a class="headerlink" href="#preg-match-all-flag" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/preg_match_all">preg_match_all()</a> has an option to configure the structure of the results : it is either by capturing parenthesis (by default), or by result sets.</p>
<p>The second option is the most interesting when the following <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach()</a> loop has to manipulate several captured strings at the same time. No need to use an index in the first array and use it in the other arrays.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;ababab&#39;</span><span class="p">;</span>

<span class="c1">// default behavior</span>
<span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/(a)(b)/&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$r</span><span class="p">);</span>
<span class="nv">$found</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$id</span> <span class="o">=&gt;</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$found</span> <span class="o">.=</span> <span class="nv">$s</span><span class="o">.</span><span class="nv">$r</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="nv">$id</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// better behavior</span>
<span class="nb">preg_match_all</span><span class="p">(</span><span class="s1">&#39;/(a)(b)/&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">,</span> <span class="nv">$r</span><span class="p">,</span> <span class="nx">PREG_SET_ORDER</span><span class="p">);</span>
<span class="nv">$found</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$r</span> <span class="k">as</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$found</span> <span class="o">.=</span> <span class="nv">$s</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="nv">$s</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>The second syntax is easier to read and may be marginally faster to execute (<a class="reference external" href="https://www.php.net/preg_match_all">preg_match_all()</a> and <a class="reference external" href="https://www.php.net/manual/en/control-structures.foreach.php">foreach())</a>.</p>
<div class="section" id="id2234">
<h3>9.779.1. Suggestions<a class="headerlink" href="#id2234" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use flags to adapt the results of preg_match_all() to your code, not the contrary.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="74%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/PregMatchAllFlag</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#suggestions"><span class="std std-ref">Suggestions</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#fuelcms-php-pregmatchallflag"><span class="std std-ref">FuelCMS</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="preg-replace-with-option-e">
<span id="id2235"></span><h2>9.780. preg_replace With Option e<a class="headerlink" href="#preg-replace-with-option-e" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/preg_replace">preg_replace()</a> supported the /e option until PHP 7.0. It allowed the use of <a class="reference external" href="https://www.php.net/eval">eval()</a>’ed expression as replacement. This has been dropped in PHP 7.0, for security reasons.</p>
<p><a class="reference external" href="https://www.php.net/preg_replace">preg_replace()</a> with /e option may be replaced with <a class="reference external" href="https://www.php.net/preg_replace_callback">preg_replace_callback()</a> and a closure, or <a class="reference external" href="https://www.php.net/preg_replace_callback_array">preg_replace_callback_array()</a> and an array of closures.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// preg_replace with /e</span>
<span class="nv">$string</span> <span class="o">=</span> <span class="s1">&#39;abcde&#39;</span><span class="p">;</span>

<span class="c1">// PHP 5.6 and older usage of /e</span>
<span class="nv">$replaced</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/c/e&#39;</span><span class="p">,</span> <span class="s1">&#39;strtoupper($0)&#39;</span><span class="p">,</span> <span class="nv">$string</span><span class="p">);</span>

<span class="c1">// PHP 7.0 and more recent</span>
<span class="c1">// With one replacement</span>
<span class="nv">$replaced</span> <span class="o">=</span> <span class="nb">preg_replace_callback</span><span class="p">(</span><span class="s1">&#39;/c/&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="p">},</span> <span class="nv">$string</span><span class="p">);</span>

<span class="c1">// With several replacements, preventing multiple calls to preg_replace_callback</span>
<span class="nv">$replaced</span> <span class="o">=</span> <span class="nx">preg_replace_callback_array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="s1">&#39;/c/&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="p">},</span>
                                              <span class="s1">&#39;/[a-b]/&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$x</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="p">}),</span> <span class="nv">$string</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<div class="section" id="id2241">
<h3>9.780.1. Suggestions<a class="headerlink" href="#id2241" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace call to preg_replace() and /e with preg_replace_callback() or preg_replace_callback_array()</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/pregOptionE</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp71"><span class="std std-ref">CompatibilityPHP71</span></a>, <a class="reference internal" href="Rulesets.html#compatibilityphp72"><span class="std std-ref">CompatibilityPHP72</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#edusoho-structures-pregoptione"><span class="std std-ref">Edusoho</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="self-parent-static-outside-class">
<span id="id2242"></span><h2>9.781. self, parent, static Outside Class<a class="headerlink" href="#self-parent-static-outside-class" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> should be called inside a class or trait. PHP lint won’t report those situations.</p>
<p><a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a>, <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">parent</a> and <a class="reference external" href="https://www.php.net/manual/en/language.oop5.static.php">static</a> may be used in a trait : their actual value will be only known at execution time, when the trait is used.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>
<span class="c1">// In the examples, self, parent and static may be used interchangeably</span>

<span class="c1">// This raises a Fatal error</span>
<span class="c1">//Fatal error: Uncaught Error: Cannot access static:: when no class scope is active</span>
<span class="k">new</span> <span class="k">static</span><span class="p">();</span>

<span class="c1">// static calls</span>
<span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">CONSTANTE</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="nv">$property</span><span class="p">;</span>
<span class="k">echo</span> <span class="nx">self</span><span class="o">::</span><span class="na">method</span><span class="p">();</span>

<span class="c1">// as a type hint</span>
<span class="k">function</span> <span class="nf">foo</span><span class="p">(</span><span class="k">static</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1">// as a instanceof</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$x</span> <span class="nx">instanceof</span> <span class="k">static</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">doSomething</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>Such syntax problem is only revealed at execution time : PHP raises a Fatal error.</p>
<p>The origin of the problem is usually a method that was moved outside a class, at least temporarily.</p>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">Scope Resolution Operator (::)</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Classes/NoPSSOutsideClass</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#lintbutwontexec"><span class="std std-ref">LintButWontExec</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="set-exception-handler-warning">
<span id="id2250"></span><h2>9.782. set_exception_handler() Warning<a class="headerlink" href="#set-exception-handler-warning" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://www.php.net/set_exception_handler">set_exception_handler()</a> callable function has to be adapted to PHP 7 : <code class="docutils literal notranslate"><span class="pre">Exception</span></code> is not the right typehint, it is now <code class="docutils literal notranslate"><span class="pre">Throwable</span></code>.</p>
<p>When in doubt about backward compatibility, just drop the typehint. Otherwise, use <code class="docutils literal notranslate"><span class="pre">Throwable</span></code>.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// PHP 5.6- typehint</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{}</span> <span class="p">}</span>

<span class="c1">// PHP 7+ typehint</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{}</span> <span class="p">}</span>

<span class="c1">// PHP 5 and PHP 7 compatible typehint (note : there is none)</span>
<span class="k">class</span> <span class="nc">foo</span> <span class="p">{</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span> <span class="p">{}</span> <span class="p">}</span>

<span class="nb">set_exception_handler</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Php/SetExceptionHandlerPHP7</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#compatibilityphp70"><span class="std std-ref">CompatibilityPHP70</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Major</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Slow (1 hour)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="strip-tags-skips-closed-tag">
<span id="id2251"></span><h2>9.783. strip_tags Skips Closed Tag<a class="headerlink" href="#strip-tags-skips-closed-tag" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/strip_tags">strip_tags()</a> skips non-<a class="reference external" href="https://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php">self</a> closing tags. This means that tags such as <code class="docutils literal notranslate"><span class="pre">&lt;br</span> <span class="pre">/&gt;</span></code> will be ignored from the 2nd argument of the function.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="nv">$input</span> <span class="o">=</span> <span class="s1">&#39;a&lt;br /&gt;&#39;</span><span class="p">;</span>

<span class="c1">// Displays &#39;a&#39; and clean the tag</span>
<span class="k">echo</span> <span class="nb">strip_tags</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">);</span>

<span class="c1">// Displays &#39;a&lt;br /&gt;&#39; and skips the allowed tag</span>
<span class="k">echo</span> <span class="nb">strip_tags</span><span class="p">(</span><span class="nv">$input</span><span class="p">,</span> <span class="s1">&#39;&lt;br/&gt;&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>See also <a class="reference external" href="https://www.php.net/manual/en/function.strip-tags.php">strip_tags</a>.</p>
<div class="section" id="id2254">
<h3>9.783.1. Suggestions<a class="headerlink" href="#id2254" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Do not use self-closing tags in the 2nd parameter</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/StripTagsSkipsClosedTag</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Quick (30 mins)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="strpos-too-much">
<span id="id2255"></span><h2>9.784. strpos() Too Much<a class="headerlink" href="#strpos-too-much" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/strpos">strpos()</a> covers the whole string before reporting 0. If the expected string is expected be at the beginning, or a fixed place, it is more stable to use <a class="reference external" href="https://www.php.net/substr">substr()</a> for comparison.</p>
<p>The longer the haystack (the searched string), the more efficient is that trick. The string has to be 10k or more to have impact, unless it is in a loop.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// This always reads the same amount of string</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$html</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;&lt;html&gt;&#39;</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// When searching for a single character, checking with a known position ($string[$position]) is even faster</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$html</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// With strpos(), the best way is to search for something that exist, and use absence as worst case scenario</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$html</span><span class="p">,</span> <span class="s1">&#39;&lt;html&gt;&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>

<span class="c1">// When the search fails, the whole string has been read</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$html</span><span class="p">,</span> <span class="s1">&#39;&lt;html&gt;&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This applies to <a class="reference external" href="https://www.php.net/stripos">stripos()</a> too.</p>
<div class="section" id="id2259">
<h3>9.784.1. Suggestions<a class="headerlink" href="#id2259" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check for presence, and not for absence</li>
<li>use substr() and compare the extracted string</li>
<li>For single chars, try using the position in the string</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/StrposTooMuch</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#wordpress-performances-strpostoomuch"><span class="std std-ref">WordPress</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="time-vs-strtotime">
<span id="id2260"></span><h2>9.785. time() Vs strtotime()<a class="headerlink" href="#time-vs-strtotime" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/time">time()</a> is actually faster than <a class="reference external" href="https://www.php.net/strtotime">strtotime()</a> with ‘now’ key string.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="c1">// Faster version</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="nb">time</span><span class="p">();</span>

<span class="c1">// Slower version</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;now&#39;</span><span class="p">);</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>This is a micro-optimisation. Relative gain is real, but small unless the function is used many times.</p>
<div class="section" id="id2263">
<h3>9.785.1. Suggestions<a class="headerlink" href="#id2263" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Replace strtotime() with time(). Do not change strtotime() with other value than ‘now’.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Performances/timeVsstrtotime</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#performances"><span class="std std-ref">Performances</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Minor</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#woocommerce-performances-timevsstrtotime"><span class="std std-ref">Woocommerce</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="var-dump-usage">
<span id="id2264"></span><h2>9.786. var_dump()… Usage<a class="headerlink" href="#var-dump-usage" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.php.net/var_dump">var_dump()</a>, print_r() or <a class="reference external" href="https://www.php.net/var_export">var_export()</a> should not be left in any production code. They are debugging functions.</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$error</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Debugging usage of var_dump</span>
    <span class="c1">// And major security problem</span>
    <span class="nb">var_dump</span><span class="p">(</span><span class="nv">$query</span><span class="p">);</span>

    <span class="c1">// This is OK : the $query is logged, and not displayed</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="p">(</span><span class="nb">print_r</span><span class="p">(</span><span class="nv">$query</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>
</div>
<p>They may be tolerated during development time, but must be removed so as not to have any chance to be run in production.</p>
<div class="section" id="id2265">
<h3>9.786.1. Suggestions<a class="headerlink" href="#id2265" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Remove usage of var_dump(), print_r(), var_export() without 2nd argument, and other debug functions.</li>
<li>Push all logging to an external file, instead of the browser.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Short name</td>
<td>Structures/VardumpUsage</td>
</tr>
<tr class="row-even"><td>Rulesets</td>
<td><a class="reference internal" href="Rulesets.html#analyze"><span class="std std-ref">Analyze</span></a>, <a class="reference internal" href="Rulesets.html#security"><span class="std std-ref">Security</span></a>, <a class="reference internal" href="Rulesets.html#ci-checks"><span class="std std-ref">CI-checks</span></a></td>
</tr>
<tr class="row-odd"><td>Severity</td>
<td>Critical</td>
</tr>
<tr class="row-even"><td>Time To Fix</td>
<td>Instant (5 mins)</td>
</tr>
<tr class="row-odd"><td>ClearPHP</td>
<td><a class="reference external" href="https://github.com/dseguy/clearPHP/tree/master/rules/no-debug-code.md">no-debug-code</a></td>
</tr>
<tr class="row-even"><td>Examples</td>
<td><a class="reference internal" href="Cases.html#tine20-structures-vardumpusage"><span class="std std-ref">Tine20</span></a>, <a class="reference internal" href="Cases.html#piwigo-structures-vardumpusage"><span class="std std-ref">Piwigo</span></a></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Cases.html" class="btn btn-neutral float-right" title="10. Real Code Cases" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Rulesets.html" class="btn btn-neutral float-left" title="8. Rulesets" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2015-2020, Damien Seguy

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>